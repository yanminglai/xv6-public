%!PS-Adobe-2.0
%%DocumentFonts: Courier Times-Bold
%%Title: <stdin> (mpage)
%%Creator: mpage 2.5.6 Januari 2008
%%CreationDate: Thu Sep 13 14:32:02 2018
%%Orientation: Landscape
%%DocumentMedia: letter 612 792
%%BoundingBox: 18 50 594 742
%%Pages: (atend)
%%EndComments

%%BeginProlog

/mp_stm usertime def
/mp_pgc statusdict begin pagecount end def
statusdict begin /jobname (<stdin>) def end
/reencsmalldict 12 dict def /ReEncodeSmall { reencsmalldict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq { exch dup length array copy newfont 3 1 roll put } { exch newfont 3 1 roll put }
ifelse }
  { pop pop }
  ifelse } forall
newfont /FontName newfontname put
newcodesandnames aload pop newcodesandnames length 2 idiv
{ newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/charvec [
026 /Scaron
027 /Ydieresis
028 /Zcaron
029 /scaron
030 /trademark
031 /zcaron
032 /space
033 /exclam
034 /quotedbl
035 /numbersign
036 /dollar
037 /percent
038 /ampersand
039 /quoteright
040 /parenleft
041 /parenright
042 /asterisk
043 /plus
044 /comma
045 /minus
046 /period
047 /slash
048 /zero
049 /one
050 /two
051 /three
052 /four
053 /five
054 /six
055 /seven
056 /eight
057 /nine
058 /colon
059 /semicolon
060 /less
061 /equal
062 /greater
063 /question
064 /at
065 /A
066 /B
067 /C
068 /D
069 /E
070 /F
071 /G
072 /H
073 /I
074 /J
075 /K
076 /L
077 /M
078 /N
079 /O
080 /P
081 /Q
082 /R
083 /S
084 /T
085 /U
086 /V
087 /W
088 /X
089 /Y
090 /Z
091 /bracketleft
092 /backslash
093 /bracketright
094 /asciicircum
095 /underscore
096 /quoteleft
097 /a
098 /b
099 /c
100 /d
101 /e
102 /f
103 /g
104 /h
105 /i
106 /j
107 /k
108 /l
109 /m
110 /n
111 /o
112 /p
113 /q
114 /r
115 /s
116 /t
117 /u
118 /v
119 /w
120 /x
121 /y
122 /z
123 /braceleft
124 /bar
125 /braceright
126 /asciitilde
127 /.notdef
128 /fraction
129 /florin
130 /quotesingle
131 /quotedblleft
132 /guilsinglleft
133 /guilsinglright
134 /fi
135 /fl
136 /endash
137 /dagger
138 /daggerdbl
139 /bullet
140 /quotesinglbase
141 /quotedblbase
142 /quotedblright
143 /ellipsis
144 /dotlessi
145 /grave
146 /acute
147 /circumflex
148 /tilde
149 /oe
150 /breve
151 /dotaccent
152 /perthousand
153 /emdash
154 /ring
155 /Lslash
156 /OE
157 /hungarumlaut
158 /ogonek
159 /caron
160 /lslash
161 /exclamdown
162 /cent
163 /sterling
164 /currency
165 /yen
166 /brokenbar
167 /section
168 /dieresis
169 /copyright
170 /ordfeminine
171 /guillemotleft
172 /logicalnot
173 /hyphen
174 /registered
175 /macron
176 /degree
177 /plusminus
178 /twosuperior
179 /threesuperior
180 /acute
181 /mu
182 /paragraph
183 /periodcentered
184 /cedilla
185 /onesuperior
186 /ordmasculine
187 /guillemotright
188 /onequarter
189 /onehalf
190 /threequarters
191 /questiondown
192 /Agrave
193 /Aacute
194 /Acircumflex
195 /Atilde
196 /Adieresis
197 /Aring
198 /AE
199 /Ccedilla
200 /Egrave
201 /Eacute
202 /Ecircumflex
203 /Edieresis
204 /Igrave
205 /Iacute
206 /Icircumflex
207 /Idieresis
208 /Eth
209 /Ntilde
210 /Ograve
211 /Oacute
212 /Ocircumflex
213 /Otilde
214 /Odieresis
215 /multiply
216 /Oslash
217 /Ugrave
218 /Uacute
219 /Ucircumflex
220 /Udieresis
221 /Yacute
222 /Thorn
223 /germandbls
224 /agrave
225 /aacute
226 /acircumflex
227 /atilde
228 /adieresis
229 /aring
230 /ae
231 /ccedilla
232 /egrave
233 /eacute
234 /ecircumflex
235 /edieresis
236 /igrave
237 /iacute
238 /icircumflex
239 /idieresis
240 /eth
241 /ntilde
242 /ograve
243 /oacute
244 /ocircumflex
245 /otilde
246 /odieresis
247 /divide
248 /oslash
249 /ugrave
250 /uacute
251 /ucircumflex
252 /udieresis
253 /yacute
254 /thorn
255 /ydieresis
] def
/Courier /OurCharSet charvec ReEncodeSmall
/textfont /OurCharSet findfont 11 scalefont def
/textfontbold /OurCharSet-Bold findfont 11 scalefont def
/fnamefont /Times-Bold findfont 14 scalefont def
/headerfont /Times-Bold findfont 12 scalefont def
textfont setfont
(a) stringwidth pop /mp_a_x exch def
%%EndProlog
%%Page: 1 1
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  README  Page 1) show
0 648 moveto (xv6 is a re-implementation of Dennis Ritchie's and Ken Thompson's Unix) show
0 636 moveto (Version 6 \(v6\).  xv6 loosely follows the structure and style of v6,) show
0 624 moveto (but is implemented for a modern x86-based multiprocessor using ANSI C.) show
0 600 moveto (ACKNOWLEDGMENTS) show
0 576 moveto (xv6 is inspired by John Lions's Commentary on UNIX 6th Edition \(Peer) show
0 564 moveto (to Peer Communications; ISBN: 1-57398-013-7; 1st edition \(June 14,) show
0 552 moveto (2000\)\). See also https://pdos.csail.mit.edu/6.828/, which) show
0 540 moveto (provides pointers to on-line resources for v6.) show
0 516 moveto (xv6 borrows code from the following sources:) show
4 mp_a_x mul 504 moveto (JOS \(asm.h, elf.h, mmu.h, bootasm.S, ide.c, console.c, and others\)) show
4 mp_a_x mul 492 moveto (Plan 9 \(entryother.S, mp.h, mp.c, lapic.c\)) show
4 mp_a_x mul 480 moveto (FreeBSD \(ioapic.c\)) show
4 mp_a_x mul 468 moveto (NetBSD \(console.c\)) show
0 444 moveto (The following people have made contributions: Russ Cox \(context switching,) show
0 432 moveto (locking\), Cliff Frey \(MP\), Xiao Yu \(MP\), Nickolai Zeldovich, and Austin) show
0 420 moveto (Clements.) show
0 396 moveto (We are also grateful for the bug reports and patches contributed by Silas) show
0 384 moveto (Boyd-Wickizer, Anton Burtsev, Cody Cutler, Mike CAT, Tej Chajed, eyalz800,) show
0 372 moveto (Nelson Elhage, Saar Ettinger, Alice Ferrazzi, Nathaniel Filardo, Peter) show
0 360 moveto (Froehlich, Yakir Goaron,Shivam Handa, Bryan Henry, Jim Huang, Alexander) show
0 348 moveto (Kapshuk, Anders Kaseorg, kehao95, Wolfgang Keller, Eddie Kohler, Austin) show
0 336 moveto (Liew, Imbar Marinescu, Yandong Mao, Matan Shabtay, Hitoshi Mitake, Carmi) show
0 324 moveto (Merimovich, Mark Morrissey, mtasm, Joel Nider, Greg Price, Ayan Shafqat,) show
0 312 moveto (Eldar Sehayek, Yongming Shen, Cam Tenny, tyfkda, Rafael Ubal, Warren) show
0 300 moveto (Toomey, Stephen Tu, Pablo Ventura, Xi Wang, Keiichi Watanabe, Nicolas) show
0 288 moveto (Wolovick, wxdao, Grant Wu, Jindong Zhang, Icenowy Zheng, and Zou Chang Wei.) show
0 264 moveto (The code in the files that constitute xv6 is) show
0 252 moveto (Copyright 2006-2018 Frans Kaashoek, Robert Morris, and Russ Cox.) show
0 228 moveto (ERROR REPORTS) show
0 204 moveto (Please send errors and suggestions to Frans Kaashoek and Robert Morris) show
0 192 moveto (\(kaashoek,rtm@mit.edu\). The main purpose of xv6 is as a teaching) show
0 180 moveto (operating system for MIT's 6.828, so we are more interested in) show
0 168 moveto (simplifications and clarifications than new features.) show
0 144 moveto (BUILDING AND RUNNING XV6) show
0 120 moveto (To build xv6 on an x86 ELF machine \(like Linux or FreeBSD\), run) show
0 108 moveto ("make". On non-x86 or non-ELF machines \(like OS X, even on x86\), you) show
0 96 moveto (will need to install a cross-compiler gcc suite capable of producing) show
0 84 moveto (x86 ELF binaries \(see https://pdos.csail.mit.edu/6.828/\).) show
0 72 moveto (Then run "make TOOLPREFIX=i386-jos-elf-". Now install the QEMU PC) show
0 60 moveto (simulator and run "make qemu".) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  table of contents  Page 1) show
0 648 moveto (The numbers to the left of the file names in the table are sheet numbers.) show
0 636 moveto (The source code has been printed in a double column format with fifty) show
0 624 moveto (lines per column, giving one hundred lines per sheet \(or page\).) show
0 612 moveto (Thus there is a convenient relationship between line numbers and sheet numbers.) show
0 576 moveto (# basic headers) show
24 mp_a_x mul 576 moveto (# system calls) show
0 564 moveto (01 types.h) show
24 mp_a_x mul 564 moveto (32 traps.h) show
48 mp_a_x mul 564 moveto (# string operations) show
0 552 moveto (01 param.h) show
24 mp_a_x mul 552 moveto (32 vectors.pl) show
48 mp_a_x mul 552 moveto (69 string.c) show
0 540 moveto (02 memlayout.h) show
24 mp_a_x mul 540 moveto (33 trapasm.S) show
0 528 moveto (02 defs.h) show
24 mp_a_x mul 528 moveto (33 trap.c) show
48 mp_a_x mul 528 moveto (# low-level hardware) show
0 516 moveto (04 x86.h) show
24 mp_a_x mul 516 moveto (35 syscall.h) show
48 mp_a_x mul 516 moveto (70 mp.h) show
0 504 moveto (06 asm.h) show
24 mp_a_x mul 504 moveto (35 syscall.c) show
48 mp_a_x mul 504 moveto (72 mp.c) show
0 492 moveto (07 mmu.h) show
24 mp_a_x mul 492 moveto (37 sysproc.c) show
48 mp_a_x mul 492 moveto (73 lapic.c) show
0 480 moveto (09 elf.h) show
48 mp_a_x mul 480 moveto (76 ioapic.c) show
0 468 moveto (09 date.h) show
24 mp_a_x mul 468 moveto (# file system) show
48 mp_a_x mul 468 moveto (77 kbd.h) show
24 mp_a_x mul 456 moveto (38 buf.h) show
48 mp_a_x mul 456 moveto (78 kbd.c) show
0 444 moveto (# entering xv6) show
24 mp_a_x mul 444 moveto (39 sleeplock.h) show
48 mp_a_x mul 444 moveto (79 console.c) show
0 432 moveto (10 entry.S) show
24 mp_a_x mul 432 moveto (39 fcntl.h) show
48 mp_a_x mul 432 moveto (83 uart.c) show
0 420 moveto (11 entryother.S) show
24 mp_a_x mul 420 moveto (40 stat.h) show
0 408 moveto (12 main.c) show
24 mp_a_x mul 408 moveto (40 fs.h) show
48 mp_a_x mul 408 moveto (# user-level) show
24 mp_a_x mul 396 moveto (41 file.h) show
48 mp_a_x mul 396 moveto (84 initcode.S) show
0 384 moveto (# locks) show
24 mp_a_x mul 384 moveto (42 ide.c) show
48 mp_a_x mul 384 moveto (84 usys.S) show
0 372 moveto (15 spinlock.h) show
24 mp_a_x mul 372 moveto (44 bio.c) show
48 mp_a_x mul 372 moveto (85 init.c) show
0 360 moveto (15 spinlock.c) show
24 mp_a_x mul 360 moveto (46 sleeplock.c) show
48 mp_a_x mul 360 moveto (85 sh.c) show
24 mp_a_x mul 348 moveto (47 log.c) show
0 336 moveto (# processes) show
24 mp_a_x mul 336 moveto (49 fs.c) show
48 mp_a_x mul 336 moveto (# bootloader) show
0 324 moveto (17 vm.c) show
24 mp_a_x mul 324 moveto (58 file.c) show
48 mp_a_x mul 324 moveto (91 bootasm.S) show
0 312 moveto (23 proc.h) show
24 mp_a_x mul 312 moveto (60 sysfile.c) show
48 mp_a_x mul 312 moveto (92 bootmain.c) show
0 300 moveto (24 proc.c) show
24 mp_a_x mul 300 moveto (66 exec.c) show
0 288 moveto (30 swtch.S) show
48 mp_a_x mul 288 moveto (# link) show
0 276 moveto (31 kalloc.c) show
24 mp_a_x mul 276 moveto (# pipes) show
48 mp_a_x mul 276 moveto (93 kernel.ld) show
24 mp_a_x mul 264 moveto (67 pipe.c) show
0 228 moveto (The source listing is preceded by a cross-reference that lists every defined ) show
0 216 moveto (constant, struct, global variable, and function in xv6.  Each entry gives,) show
0 204 moveto (on the same line as the name, the line number \(or, in a few cases, numbers\)) show
0 192 moveto (where the name is defined.  Successive lines in an entry list the line) show
0 180 moveto (numbers where the name is used.  For example, this entry:) show
4 mp_a_x mul 156 moveto (swtch 2658) show
8 mp_a_x mul 144 moveto (0374 2428 2466 2657 2658) show
0 120 moveto (indicates that swtch is defined on line 2658 and is mentioned on five lines) show
0 108 moveto (on sheets 03, 24, and 26.) show
grestore
restore
showpage
%%Page: 2 2
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 1) show
0 648 moveto (acquire 1574) show
40 mp_a_x mul 648 moveto (3862 4294 4318 4323 4360) show
4 mp_a_x mul 636 moveto (0380 1574 1578 2478 2548) show
40 mp_a_x mul 636 moveto (4378 4486 4519 4939) show
4 mp_a_x mul 624 moveto (2614 2649 2677 2769 2830) show
36 mp_a_x mul 624 moveto (begin_op 4828) show
4 mp_a_x mul 612 moveto (2891 2906 2966 2979 3175) show
40 mp_a_x mul 612 moveto (0336 2644 4828 5933 6024) show
4 mp_a_x mul 600 moveto (3192 3416 3822 3842 4309) show
40 mp_a_x mul 600 moveto (6210 6311 6411 6456 6473) show
4 mp_a_x mul 588 moveto (4365 4470 4533 4624 4636) show
40 mp_a_x mul 588 moveto (6507 6621) show
4 mp_a_x mul 576 moveto (4655 4830 4857 4876 4931) show
36 mp_a_x mul 576 moveto (bfree 5052) show
4 mp_a_x mul 564 moveto (5258 5291 5362 5375 5880) show
40 mp_a_x mul 564 moveto (5052 5464 5474 5477) show
4 mp_a_x mul 552 moveto (5904 5918 6813 6834 6855) show
36 mp_a_x mul 552 moveto (bget 4466) show
4 mp_a_x mul 540 moveto (8010 8181 8228 8264) show
40 mp_a_x mul 540 moveto (4466 4496 4506) show
0 528 moveto (acquiresleep 4622) show
36 mp_a_x mul 528 moveto (binit 4438) show
4 mp_a_x mul 516 moveto (0389 4477 4492 4622 5311) show
40 mp_a_x mul 516 moveto (0263 1230 4438) show
4 mp_a_x mul 504 moveto (5360) show
36 mp_a_x mul 504 moveto (bmap 5410) show
0 492 moveto (allocproc 2473) show
40 mp_a_x mul 492 moveto (5154 5410 5436 5520 5570) show
4 mp_a_x mul 480 moveto (2473 2525 2587) show
36 mp_a_x mul 480 moveto (bootmain 9217) show
0 468 moveto (allocuvm 1927) show
40 mp_a_x mul 468 moveto (9168 9217) show
4 mp_a_x mul 456 moveto (0430 1927 1941 1947 2565) show
36 mp_a_x mul 456 moveto (BPB 4107) show
4 mp_a_x mul 444 moveto (6651 6665) show
40 mp_a_x mul 444 moveto (4107 4110 5022 5024 5059) show
0 432 moveto (alltraps 3304) show
36 mp_a_x mul 432 moveto (bread 4502) show
4 mp_a_x mul 420 moveto (3259 3267 3280 3285 3303) show
40 mp_a_x mul 420 moveto (0264 4502 4777 4778 4790) show
4 mp_a_x mul 408 moveto (3304) show
40 mp_a_x mul 408 moveto (4806 4890 4891 4985 5006) show
0 396 moveto (ALT 7710) show
40 mp_a_x mul 396 moveto (5023 5058 5211 5235 5314) show
4 mp_a_x mul 384 moveto (7710 7738 7740) show
40 mp_a_x mul 384 moveto (5426 5470 5520 5570) show
0 372 moveto (argfd 6071) show
36 mp_a_x mul 372 moveto (brelse 4526) show
4 mp_a_x mul 360 moveto (6071 6123 6138 6157 6168) show
40 mp_a_x mul 360 moveto (0265 4526 4529 4781 4782) show
4 mp_a_x mul 348 moveto (6181) show
40 mp_a_x mul 348 moveto (4797 4814 4894 4895 4987) show
0 336 moveto (argint 3602) show
40 mp_a_x mul 336 moveto (5009 5029 5034 5065 5217) show
4 mp_a_x mul 324 moveto (0404 3602 3616 3632 3783) show
40 mp_a_x mul 324 moveto (5220 5244 5322 5432 5476) show
4 mp_a_x mul 312 moveto (3806 3820 6076 6138 6157) show
40 mp_a_x mul 312 moveto (5523 5574) show
4 mp_a_x mul 300 moveto (6408 6475 6476 6532) show
36 mp_a_x mul 300 moveto (BSIZE 4055) show
0 288 moveto (argptr 3611) show
40 mp_a_x mul 288 moveto (3859 4055 4074 4101 4107) show
4 mp_a_x mul 276 moveto (0405 3611 6138 6157 6181) show
40 mp_a_x mul 276 moveto (4280 4296 4319 4758 4779) show
4 mp_a_x mul 264 moveto (6557) show
40 mp_a_x mul 264 moveto (4892 5007 5520 5521 5522) show
0 252 moveto (argstr 3629) show
40 mp_a_x mul 252 moveto (5566 5570 5571 5572) show
4 mp_a_x mul 240 moveto (0406 3629 6207 6308 6408) show
36 mp_a_x mul 240 moveto (buf 3850) show
4 mp_a_x mul 228 moveto (6457 6474 6508 6532) show
40 mp_a_x mul 228 moveto (0250 0264 0265 0266 0308) show
0 216 moveto (__attribute__ 1305) show
40 mp_a_x mul 216 moveto (0335 2120 2123 2132 2134) show
4 mp_a_x mul 204 moveto (0272 0367 1209 1305) show
40 mp_a_x mul 204 moveto (3850 3856 3857 3858 4213) show
0 192 moveto (BACK 8561) show
40 mp_a_x mul 192 moveto (4231 4234 4274 4306 4354) show
4 mp_a_x mul 180 moveto (8561 8674 8820 9089) show
40 mp_a_x mul 180 moveto (4356 4359 4426 4430 4434) show
0 168 moveto (backcmd 8596 8814) show
40 mp_a_x mul 168 moveto (4440 4453 4465 4468 4501) show
4 mp_a_x mul 156 moveto (8596 8609 8675 8814 8816) show
40 mp_a_x mul 156 moveto (4504 4515 4526 4706 4777) show
4 mp_a_x mul 144 moveto (8942 9055 9090) show
40 mp_a_x mul 144 moveto (4778 4790 4791 4797 4806) show
0 132 moveto (BACKSPACE 8100) show
40 mp_a_x mul 132 moveto (4807 4813 4814 4890 4891) show
4 mp_a_x mul 120 moveto (8100 8117 8159 8192 8198) show
40 mp_a_x mul 120 moveto (4922 4970 4983 5004 5019) show
0 108 moveto (balloc 5016) show
40 mp_a_x mul 108 moveto (5054 5207 5232 5305 5413) show
4 mp_a_x mul 96 moveto (5016 5036 5417 5425 5429) show
40 mp_a_x mul 96 moveto (5459 5506 5556 7930 7941) show
0 84 moveto (BBLOCK 4110) show
40 mp_a_x mul 84 moveto (7945 7948 8168 8190 8204) show
4 mp_a_x mul 72 moveto (4110 5023 5058) show
40 mp_a_x mul 72 moveto (8238 8259 8266 8684 8687) show
0 60 moveto (B_DIRTY 3862) show
40 mp_a_x mul 60 moveto (8688 8689 8703 8715 8716) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 2) show
4 mp_a_x mul 648 moveto (8718 8719 8720 8724) show
36 mp_a_x mul 648 moveto (CMOS_RETURN 7478) show
0 636 moveto (B_VALID 3861) show
40 mp_a_x mul 636 moveto (7478 7537) show
4 mp_a_x mul 624 moveto (3861 4322 4360 4378 4507) show
36 mp_a_x mul 624 moveto (CMOS_STATA 7520) show
0 612 moveto (bwrite 4515) show
40 mp_a_x mul 612 moveto (7520 7564) show
4 mp_a_x mul 600 moveto (0266 4515 4518 4780 4813) show
36 mp_a_x mul 600 moveto (CMOS_STATB 7521) show
4 mp_a_x mul 588 moveto (4893) show
40 mp_a_x mul 588 moveto (7521 7557) show
0 576 moveto (bzero 5002) show
36 mp_a_x mul 576 moveto (cmostime 7552) show
4 mp_a_x mul 564 moveto (5002 5030) show
40 mp_a_x mul 564 moveto (0325 7552) show
0 552 moveto (C 7731 8174) show
36 mp_a_x mul 552 moveto (CMOS_UIP 7522) show
4 mp_a_x mul 540 moveto (7731 7779 7804 7805 7806) show
40 mp_a_x mul 540 moveto (7522 7564) show
4 mp_a_x mul 528 moveto (7807 7808 7810 8174 8184) show
36 mp_a_x mul 528 moveto (COM1 8314) show
4 mp_a_x mul 516 moveto (8188 8195 8206 8239) show
40 mp_a_x mul 516 moveto (8314 8324 8327 8328 8329) show
0 504 moveto (CAPSLOCK 7712) show
40 mp_a_x mul 504 moveto (8330 8331 8332 8335 8341) show
4 mp_a_x mul 492 moveto (7712 7745 7886) show
40 mp_a_x mul 492 moveto (8342 8357 8359 8367 8369) show
0 480 moveto (cgaputc 8105) show
36 mp_a_x mul 480 moveto (commit 4901) show
4 mp_a_x mul 468 moveto (8105 8163) show
40 mp_a_x mul 468 moveto (4753 4875 4901) show
0 456 moveto (clearpteu 2022) show
36 mp_a_x mul 456 moveto (CONSOLE 4186) show
4 mp_a_x mul 444 moveto (0439 2022 2028 6667) show
40 mp_a_x mul 444 moveto (4186 8278 8279) show
0 432 moveto (cli 0557) show
36 mp_a_x mul 432 moveto (consoleinit 8274) show
4 mp_a_x mul 420 moveto (0557 0559 1124 1672 8060) show
40 mp_a_x mul 420 moveto (0269 1226 8274) show
4 mp_a_x mul 408 moveto (8154 9112) show
36 mp_a_x mul 408 moveto (consoleintr 8177) show
0 396 moveto (cmd 8565) show
40 mp_a_x mul 396 moveto (0271 7898 8177 8375) show
4 mp_a_x mul 384 moveto (8565 8577 8586 8587 8592) show
36 mp_a_x mul 384 moveto (consoleread 8221) show
4 mp_a_x mul 372 moveto (8593 8598 8602 8606 8615) show
40 mp_a_x mul 372 moveto (8221 8279) show
4 mp_a_x mul 360 moveto (8618 8623 8631 8637 8641) show
36 mp_a_x mul 360 moveto (consolewrite 8259) show
4 mp_a_x mul 348 moveto (8651 8675 8677 8752 8755) show
40 mp_a_x mul 348 moveto (8259 8278) show
4 mp_a_x mul 336 moveto (8757 8758 8759 8760 8763) show
36 mp_a_x mul 336 moveto (consputc 8151) show
4 mp_a_x mul 324 moveto (8764 8766 8768 8769 8770) show
40 mp_a_x mul 324 moveto (7917 7948 8018 8036 8039) show
4 mp_a_x mul 312 moveto (8771 8772 8773 8774 8775) show
40 mp_a_x mul 312 moveto (8043 8044 8151 8192 8198) show
4 mp_a_x mul 300 moveto (8776 8779 8780 8782 8784) show
40 mp_a_x mul 300 moveto (8205 8266) show
4 mp_a_x mul 288 moveto (8785 8786 8787 8788 8789) show
36 mp_a_x mul 288 moveto (context 2326) show
4 mp_a_x mul 276 moveto (8800 8801 8803 8805 8806) show
40 mp_a_x mul 276 moveto (0251 0377 2303 2326 2345) show
4 mp_a_x mul 264 moveto (8807 8808 8809 8810 8813) show
40 mp_a_x mul 264 moveto (2509 2510 2511 2512 2781) show
4 mp_a_x mul 252 moveto (8814 8816 8818 8819 8820) show
40 mp_a_x mul 252 moveto (2822 3028) show
4 mp_a_x mul 240 moveto (8821 8822 8912 8913 8914) show
36 mp_a_x mul 240 moveto (CONV 7573) show
4 mp_a_x mul 228 moveto (8915 8917 8921 8924 8930) show
40 mp_a_x mul 228 moveto (7573 7574 7575 7576 7577) show
4 mp_a_x mul 216 moveto (8931 8934 8937 8939 8942) show
40 mp_a_x mul 216 moveto (7578 7579 7580) show
4 mp_a_x mul 204 moveto (8946 8948 8950 8953 8955) show
36 mp_a_x mul 204 moveto (copyout 2118) show
4 mp_a_x mul 192 moveto (8958 8960 8963 8964 8975) show
40 mp_a_x mul 192 moveto (0438 2118 6675 6686) show
4 mp_a_x mul 180 moveto (8978 8981 8985 9000 9003) show
36 mp_a_x mul 180 moveto (copyuvm 2035) show
4 mp_a_x mul 168 moveto (9008 9012 9013 9016 9021) show
40 mp_a_x mul 168 moveto (0435 2035 2046 2048 2592) show
4 mp_a_x mul 156 moveto (9022 9028 9037 9038 9044) show
36 mp_a_x mul 156 moveto (cprintf 8002) show
4 mp_a_x mul 144 moveto (9045 9051 9052 9061 9064) show
40 mp_a_x mul 144 moveto (0270 1254 1941 1947 3026) show
4 mp_a_x mul 132 moveto (9066 9072 9073 9078 9084) show
40 mp_a_x mul 132 moveto (3030 3032 3440 3453 3458) show
4 mp_a_x mul 120 moveto (9090 9091 9094) show
40 mp_a_x mul 120 moveto (3710 5153 6625 7659 8002) show
0 108 moveto (CMOS_PORT 7477) show
40 mp_a_x mul 108 moveto (8063 8064 8065 8068) show
4 mp_a_x mul 96 moveto (7477 7491 7492 7534) show
36 mp_a_x mul 96 moveto (cpu 2301) show
0 84 moveto (cmos_read 7532) show
40 mp_a_x mul 84 moveto (0311 0363 1254 1268 1506) show
4 mp_a_x mul 72 moveto (7532 7543 7544 7545 7546) show
40 mp_a_x mul 72 moveto (1566 1590 1608 1656 1717) show
4 mp_a_x mul 60 moveto (7547 7548 7557 7564) show
40 mp_a_x mul 60 moveto (2301 2312 2436 2458 2761) show
grestore
restore
showpage
%%Page: 3 3
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 3) show
4 mp_a_x mul 648 moveto (3440 3453 3458 7213) show
36 mp_a_x mul 648 moveto (elfhdr 0905) show
0 636 moveto (cpuid 2430) show
40 mp_a_x mul 636 moveto (0905 6615 9219 9224) show
4 mp_a_x mul 624 moveto (0358 1254 1723 2430 3415) show
36 mp_a_x mul 624 moveto (ELF_MAGIC 0902) show
4 mp_a_x mul 612 moveto (3441 3454 3461) show
40 mp_a_x mul 612 moveto (0902 6634 9230) show
0 600 moveto (CR0_PE 0707) show
36 mp_a_x mul 600 moveto (ELF_PROG_LOAD 0936) show
4 mp_a_x mul 588 moveto (0707 1137 1170 9143) show
40 mp_a_x mul 588 moveto (0936 6645) show
0 576 moveto (CR0_PG 0709) show
36 mp_a_x mul 576 moveto (end_op 4853) show
4 mp_a_x mul 564 moveto (0709 1054 1170) show
40 mp_a_x mul 564 moveto (0337 2646 4853 5935 6029) show
0 552 moveto (CR0_WP 0708) show
40 mp_a_x mul 552 moveto (6212 6219 6237 6246 6313) show
4 mp_a_x mul 540 moveto (0708 1054 1170) show
40 mp_a_x mul 540 moveto (6347 6352 6416 6421 6427) show
0 528 moveto (CR4_PSE 0711) show
40 mp_a_x mul 528 moveto (6436 6440 6458 6462 6478) show
4 mp_a_x mul 516 moveto (0711 1047 1163) show
40 mp_a_x mul 516 moveto (6482 6509 6515 6520 6624) show
0 504 moveto (create 6357) show
40 mp_a_x mul 504 moveto (6659 6710) show
4 mp_a_x mul 492 moveto (6357 6377 6390 6394 6414) show
36 mp_a_x mul 492 moveto (entry 1044) show
4 mp_a_x mul 480 moveto (6457 6477) show
40 mp_a_x mul 480 moveto (0911 1040 1043 1044 3252) show
0 468 moveto (CRTPORT 8101) show
40 mp_a_x mul 468 moveto (3253 6699 7071 9221 9245) show
4 mp_a_x mul 456 moveto (8101 8110 8111 8112 8113) show
40 mp_a_x mul 456 moveto (9246) show
4 mp_a_x mul 444 moveto (8131 8132 8133 8134) show
36 mp_a_x mul 444 moveto (EOI 7366) show
0 432 moveto (CTL 7709) show
40 mp_a_x mul 432 moveto (7366 7441 7467) show
4 mp_a_x mul 420 moveto (7709 7735 7739 7885) show
36 mp_a_x mul 420 moveto (ERROR 7387) show
0 408 moveto (DAY 7527) show
40 mp_a_x mul 408 moveto (7387 7434) show
4 mp_a_x mul 396 moveto (7527 7546) show
36 mp_a_x mul 396 moveto (ESR 7369) show
0 384 moveto (deallocuvm 1961) show
40 mp_a_x mul 384 moveto (7369 7437 7438) show
4 mp_a_x mul 372 moveto (0431 1942 1948 1961 2009) show
36 mp_a_x mul 372 moveto (exec 6610) show
4 mp_a_x mul 360 moveto (2568) show
40 mp_a_x mul 360 moveto (0275 6548 6610 6625 8468) show
0 348 moveto (DEVSPACE 0204) show
40 mp_a_x mul 348 moveto (8529 8530 8626 8627) show
4 mp_a_x mul 336 moveto (0204 1813 1826) show
36 mp_a_x mul 336 moveto (EXEC 8557) show
0 324 moveto (devsw 4179) show
40 mp_a_x mul 324 moveto (8557 8622 8759 9065) show
4 mp_a_x mul 312 moveto (4179 4184 5509 5511 5559) show
36 mp_a_x mul 312 moveto (execcmd 8569 8753) show
4 mp_a_x mul 300 moveto (5561 5862 8278 8279) show
40 mp_a_x mul 300 moveto (8569 8610 8623 8753 8755) show
0 288 moveto (dinode 4078) show
40 mp_a_x mul 288 moveto (9021 9027 9028 9056 9066) show
4 mp_a_x mul 276 moveto (4078 4101 5208 5212 5233) show
36 mp_a_x mul 276 moveto (exit 2627) show
4 mp_a_x mul 264 moveto (5236 5306 5315) show
40 mp_a_x mul 264 moveto (0359 2627 2665 3405 3409) show
0 252 moveto (dirent 4115) show
40 mp_a_x mul 252 moveto (3469 3479 3768 8417 8420) show
4 mp_a_x mul 240 moveto (4115 5614 5655 6255 6304) show
40 mp_a_x mul 240 moveto (8461 8526 8531 8616 8625) show
0 228 moveto (dirlink 5652) show
40 mp_a_x mul 228 moveto (8635 8680 8727 8734) show
4 mp_a_x mul 216 moveto (0288 5652 5667 5675 6230) show
36 mp_a_x mul 216 moveto (EXTMEM 0202) show
4 mp_a_x mul 204 moveto (6389 6393 6394) show
40 mp_a_x mul 204 moveto (0202 0208 1810) show
0 192 moveto (dirlookup 5611) show
36 mp_a_x mul 192 moveto (fdalloc 6103) show
4 mp_a_x mul 180 moveto (0289 5611 5617 5621 5659) show
40 mp_a_x mul 180 moveto (6103 6125 6432 6562) show
4 mp_a_x mul 168 moveto (5775 6323 6367) show
36 mp_a_x mul 168 moveto (fetchint 3567) show
0 156 moveto (DIRSIZ 4113) show
40 mp_a_x mul 156 moveto (0407 3567 3604 6539) show
4 mp_a_x mul 144 moveto (4113 4117 5605 5672 5728) show
36 mp_a_x mul 144 moveto (fetchstr 3581) show
4 mp_a_x mul 132 moveto (5729 5792 6204 6305 6361) show
40 mp_a_x mul 132 moveto (0408 3581 3634 6545) show
0 120 moveto (DPL_USER 0761) show
36 mp_a_x mul 120 moveto (file 4150) show
4 mp_a_x mul 108 moveto (0761 1726 1727 2533 2534) show
40 mp_a_x mul 108 moveto (0252 0278 0279 0280 0282) show
4 mp_a_x mul 96 moveto (3373 3468 3478) show
40 mp_a_x mul 96 moveto (0283 0284 0351 2348 4150) show
0 84 moveto (E0ESC 7716) show
40 mp_a_x mul 84 moveto (4971 5860 5865 5875 5878) show
4 mp_a_x mul 72 moveto (7716 7870 7874 7875 7877) show
40 mp_a_x mul 72 moveto (5881 5901 5902 5914 5916) show
4 mp_a_x mul 60 moveto (7880) show
40 mp_a_x mul 60 moveto (5952 5965 6002 6065 6071) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 4) show
4 mp_a_x mul 648 moveto (6074 6103 6120 6134 6153) show
36 mp_a_x mul 648 moveto (havedisk1 4233) show
4 mp_a_x mul 636 moveto (6166 6178 6405 6554 6758) show
40 mp_a_x mul 636 moveto (4233 4263 4362) show
4 mp_a_x mul 624 moveto (6772 7911 8309 8578 8633) show
36 mp_a_x mul 624 moveto (holding 1652) show
4 mp_a_x mul 612 moveto (8634 8764 8772 8972) show
40 mp_a_x mul 612 moveto (0382 1577 1604 1652 2813) show
0 600 moveto (filealloc 5876) show
36 mp_a_x mul 600 moveto (holdingsleep 4651) show
4 mp_a_x mul 588 moveto (0278 5876 6432 6778) show
40 mp_a_x mul 588 moveto (0391 4358 4517 4528 4651) show
0 576 moveto (fileclose 5914) show
40 mp_a_x mul 576 moveto (5333) show
4 mp_a_x mul 564 moveto (0279 2639 5914 5920 6171) show
36 mp_a_x mul 564 moveto (HOURS 7526) show
4 mp_a_x mul 552 moveto (6434 6565 6566 6804 6806) show
40 mp_a_x mul 552 moveto (7526 7545) show
0 540 moveto (filedup 5902) show
36 mp_a_x mul 540 moveto (ialloc 5204) show
4 mp_a_x mul 528 moveto (0280 2607 5902 5906 6127) show
40 mp_a_x mul 528 moveto (0290 5204 5222 6376 6377) show
0 516 moveto (fileinit 5869) show
36 mp_a_x mul 516 moveto (IBLOCK 4104) show
4 mp_a_x mul 504 moveto (0281 1231 5869) show
40 mp_a_x mul 504 moveto (4104 5211 5235 5314) show
0 492 moveto (fileread 5965) show
36 mp_a_x mul 492 moveto (ICRHI 7380) show
4 mp_a_x mul 480 moveto (0282 5965 5980 6140) show
40 mp_a_x mul 480 moveto (7380 7444 7502 7514) show
0 468 moveto (filestat 5952) show
36 mp_a_x mul 468 moveto (ICRLO 7370) show
4 mp_a_x mul 456 moveto (0283 5952 6183) show
40 mp_a_x mul 456 moveto (7370 7445 7446 7503 7505) show
0 444 moveto (filewrite 6002) show
40 mp_a_x mul 444 moveto (7515) show
4 mp_a_x mul 432 moveto (0284 6002 6034 6039 6159) show
36 mp_a_x mul 432 moveto (ID 7363) show
0 420 moveto (fill_rtcdate 7541) show
40 mp_a_x mul 420 moveto (7363 7404 7459) show
4 mp_a_x mul 408 moveto (7541 7563 7566) show
36 mp_a_x mul 408 moveto (IDE_BSY 4216) show
0 396 moveto (FL_IF 0704) show
40 mp_a_x mul 396 moveto (4216 4242) show
4 mp_a_x mul 384 moveto (0704 1674 1681 2441 2537) show
36 mp_a_x mul 384 moveto (IDE_CMD_RDMUL 4223) show
4 mp_a_x mul 372 moveto (2819) show
40 mp_a_x mul 372 moveto (4223 4282) show
0 360 moveto (fork 2580) show
36 mp_a_x mul 360 moveto (IDE_CMD_READ 4221) show
4 mp_a_x mul 348 moveto (0360 2580 3762 8460 8523) show
40 mp_a_x mul 348 moveto (4221 4282) show
4 mp_a_x mul 336 moveto (8525 8742 8744) show
36 mp_a_x mul 336 moveto (IDE_CMD_WRITE 4222) show
0 324 moveto (fork1 8738) show
40 mp_a_x mul 324 moveto (4222 4283) show
4 mp_a_x mul 312 moveto (8600 8642 8654 8661 8676) show
36 mp_a_x mul 312 moveto (IDE_CMD_WRMUL 4224) show
4 mp_a_x mul 300 moveto (8723 8738) show
40 mp_a_x mul 300 moveto (4224 4283) show
0 288 moveto (forkret 2853) show
36 mp_a_x mul 288 moveto (IDE_DF 4218) show
4 mp_a_x mul 276 moveto (2417 2512 2853) show
40 mp_a_x mul 276 moveto (4218 4244) show
0 264 moveto (freerange 3151) show
36 mp_a_x mul 264 moveto (IDE_DRDY 4217) show
4 mp_a_x mul 252 moveto (3111 3135 3141 3151) show
40 mp_a_x mul 252 moveto (4217 4242) show
0 240 moveto (freevm 2003) show
36 mp_a_x mul 240 moveto (IDE_ERR 4219) show
4 mp_a_x mul 228 moveto (0432 1831 2003 2008 2062) show
40 mp_a_x mul 228 moveto (4219 4244) show
4 mp_a_x mul 216 moveto (2690 6702 6707) show
36 mp_a_x mul 216 moveto (ideinit 4251) show
0 204 moveto (FSSIZE 0162) show
40 mp_a_x mul 204 moveto (0306 1232 4251) show
4 mp_a_x mul 192 moveto (0162 4278) show
36 mp_a_x mul 192 moveto (ideintr 4304) show
0 180 moveto (gatedesc 0855) show
40 mp_a_x mul 180 moveto (0307 3424 4304) show
4 mp_a_x mul 168 moveto (0523 0526 0855 3361) show
36 mp_a_x mul 168 moveto (idelock 4230) show
0 156 moveto (getcallerpcs 1627) show
40 mp_a_x mul 156 moveto (4230 4255 4309 4312 4330) show
4 mp_a_x mul 144 moveto (0381 1591 1627 3028 8066) show
40 mp_a_x mul 144 moveto (4365 4379 4383) show
0 132 moveto (getcmd 8684) show
36 mp_a_x mul 132 moveto (iderw 4354) show
4 mp_a_x mul 120 moveto (8684 8715) show
40 mp_a_x mul 120 moveto (0308 4354 4359 4361 4363) show
0 108 moveto (gettoken 8856) show
40 mp_a_x mul 108 moveto (4508 4520) show
4 mp_a_x mul 96 moveto (8856 8941 8945 8957 8970) show
36 mp_a_x mul 96 moveto (idestart 4274) show
4 mp_a_x mul 84 moveto (8971 9007 9011 9033) show
40 mp_a_x mul 84 moveto (4234 4274 4277 4285 4328) show
0 72 moveto (growproc 2558) show
40 mp_a_x mul 72 moveto (4375) show
4 mp_a_x mul 60 moveto (0361 2558 3809) show
36 mp_a_x mul 60 moveto (idewait 4238) show
grestore
restore
showpage
%%Page: 4 4
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 5) show
4 mp_a_x mul 648 moveto (4238 4257 4287 4318) show
36 mp_a_x mul 648 moveto (install_trans 4772) show
0 636 moveto (idtinit 3379) show
40 mp_a_x mul 636 moveto (4772 4821 4906) show
4 mp_a_x mul 624 moveto (0415 1255 3379) show
36 mp_a_x mul 624 moveto (INT_DISABLED 7619) show
0 612 moveto (idup 5289) show
40 mp_a_x mul 612 moveto (7619 7664) show
4 mp_a_x mul 600 moveto (0291 2608 5289 5762) show
36 mp_a_x mul 600 moveto (ioapic 7627) show
0 588 moveto (iget 5254) show
40 mp_a_x mul 588 moveto (7308 7325 7326 7624 7627) show
4 mp_a_x mul 576 moveto (5159 5218 5254 5274 5629) show
40 mp_a_x mul 576 moveto (7636 7637 7643 7644 7655) show
4 mp_a_x mul 564 moveto (5760) show
36 mp_a_x mul 564 moveto (IOAPIC 7608) show
0 552 moveto (iinit 5143) show
40 mp_a_x mul 552 moveto (7608 7655) show
4 mp_a_x mul 540 moveto (0292 2864 5143) show
36 mp_a_x mul 540 moveto (ioapicenable 7670) show
0 528 moveto (ilock 5303) show
40 mp_a_x mul 528 moveto (0311 4256 7670 8282 8343) show
4 mp_a_x mul 516 moveto (0293 5303 5309 5325 5765) show
36 mp_a_x mul 516 moveto (ioapicid 7215) show
4 mp_a_x mul 504 moveto (5955 5974 6025 6216 6229) show
40 mp_a_x mul 504 moveto (0312 7215 7326 7658 7659) show
4 mp_a_x mul 492 moveto (6242 6317 6325 6365 6369) show
36 mp_a_x mul 492 moveto (ioapicinit 7651) show
4 mp_a_x mul 480 moveto (6379 6424 6512 6628 8233) show
40 mp_a_x mul 480 moveto (0313 1225 7651 7659) show
4 mp_a_x mul 468 moveto (8253 8268) show
36 mp_a_x mul 468 moveto (ioapicread 7634) show
0 456 moveto (inb 0453) show
40 mp_a_x mul 456 moveto (7634 7656 7657) show
4 mp_a_x mul 444 moveto (0453 4242 4262 7346 7537) show
36 mp_a_x mul 444 moveto (ioapicwrite 7641) show
4 mp_a_x mul 432 moveto (7864 7867 8111 8113 8335) show
40 mp_a_x mul 432 moveto (7641 7664 7665 7675 7676) show
4 mp_a_x mul 420 moveto (8341 8342 8357 8367 8369) show
36 mp_a_x mul 420 moveto (IPB 4101) show
4 mp_a_x mul 408 moveto (9123 9131 9254) show
40 mp_a_x mul 408 moveto (4101 4104 5212 5236 5315) show
0 396 moveto (initlock 1562) show
36 mp_a_x mul 396 moveto (iput 5358) show
4 mp_a_x mul 384 moveto (0383 1562 2425 3133 3375) show
40 mp_a_x mul 384 moveto (0294 2645 5358 5385 5660) show
4 mp_a_x mul 372 moveto (4255 4442 4615 4762 5147) show
40 mp_a_x mul 372 moveto (5783 5934 6235 6519) show
4 mp_a_x mul 360 moveto (5871 6786 8276) show
36 mp_a_x mul 360 moveto (IRQ_COM1 3233) show
0 348 moveto (initlog 4756) show
40 mp_a_x mul 348 moveto (3233 3434 8343) show
4 mp_a_x mul 336 moveto (0334 2865 4756 4759) show
36 mp_a_x mul 336 moveto (IRQ_ERROR 3235) show
0 324 moveto (initsleeplock 4613) show
40 mp_a_x mul 324 moveto (3235 7434) show
4 mp_a_x mul 312 moveto (0392 4456 4613 5149) show
36 mp_a_x mul 312 moveto (IRQ_IDE 3234) show
0 300 moveto (inituvm 1886) show
40 mp_a_x mul 300 moveto (3234 3423 3427 4256) show
4 mp_a_x mul 288 moveto (0433 1886 1891 2530) show
36 mp_a_x mul 288 moveto (IRQ_KBD 3232) show
0 276 moveto (inode 4162) show
40 mp_a_x mul 276 moveto (3232 3430 8282) show
4 mp_a_x mul 264 moveto (0253 0288 0289 0290 0291) show
36 mp_a_x mul 264 moveto (IRQ_SPURIOUS 3236) show
4 mp_a_x mul 252 moveto (0293 0294 0295 0296 0297) show
40 mp_a_x mul 252 moveto (3236 3439 7414) show
4 mp_a_x mul 240 moveto (0299 0300 0301 0302 0303) show
36 mp_a_x mul 240 moveto (IRQ_TIMER 3231) show
4 mp_a_x mul 228 moveto (0434 1903 2349 4156 4162) show
40 mp_a_x mul 228 moveto (3231 3414 3474 7421) show
4 mp_a_x mul 216 moveto (4180 4181 4974 5139 5149) show
36 mp_a_x mul 216 moveto (isdirempty 6252) show
4 mp_a_x mul 204 moveto (5159 5203 5230 5253 5256) show
40 mp_a_x mul 204 moveto (6252 6259 6329) show
4 mp_a_x mul 192 moveto (5262 5288 5289 5303 5331) show
36 mp_a_x mul 192 moveto (itrunc 5456) show
4 mp_a_x mul 180 moveto (5358 5382 5410 5456 5488) show
40 mp_a_x mul 180 moveto (4974 5367 5456) show
4 mp_a_x mul 168 moveto (5503 5553 5610 5611 5652) show
36 mp_a_x mul 168 moveto (iunlock 5331) show
4 mp_a_x mul 156 moveto (5656 5754 5757 5789 5800) show
40 mp_a_x mul 156 moveto (0295 5331 5334 5384 5772) show
4 mp_a_x mul 144 moveto (6205 6252 6303 6356 6360) show
40 mp_a_x mul 144 moveto (5957 5977 6028 6225 6439) show
4 mp_a_x mul 132 moveto (6406 6454 6469 6504 6616) show
40 mp_a_x mul 132 moveto (6518 8226 8263) show
4 mp_a_x mul 120 moveto (8221 8259) show
36 mp_a_x mul 120 moveto (iunlockput 5382) show
0 108 moveto (INPUT_BUF 8166) show
40 mp_a_x mul 108 moveto (0296 5382 5767 5776 5779) show
4 mp_a_x mul 96 moveto (8166 8168 8190 8202 8204) show
40 mp_a_x mul 96 moveto (6218 6231 6234 6245 6330) show
4 mp_a_x mul 84 moveto (8206 8238) show
40 mp_a_x mul 84 moveto (6341 6345 6351 6368 6372) show
0 72 moveto (insl 0462) show
40 mp_a_x mul 72 moveto (6396 6426 6435 6461 6481) show
4 mp_a_x mul 60 moveto (0462 0464 4319 9273) show
40 mp_a_x mul 60 moveto (6514 6658 6709) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 6) show
0 648 moveto (iupdate 5230) show
40 mp_a_x mul 648 moveto (0318 1219 3131) show
4 mp_a_x mul 636 moveto (0297 5230 5369 5482 5579) show
36 mp_a_x mul 636 moveto (kinit2 3139) show
4 mp_a_x mul 624 moveto (6224 6244 6339 6344 6383) show
40 mp_a_x mul 624 moveto (0319 1234 3139) show
4 mp_a_x mul 612 moveto (6387) show
36 mp_a_x mul 612 moveto (KSTACKSIZE 0151) show
0 600 moveto (kalloc 3187) show
40 mp_a_x mul 600 moveto (0151 1058 1067 1285 1874) show
4 mp_a_x mul 588 moveto (0316 1284 1744 1823 1892) show
40 mp_a_x mul 588 moveto (2498) show
4 mp_a_x mul 576 moveto (1939 2051 2494 3187 6780) show
36 mp_a_x mul 576 moveto (kvmalloc 1840) show
0 564 moveto (KBDATAP 7704) show
40 mp_a_x mul 564 moveto (0427 1220 1840) show
4 mp_a_x mul 552 moveto (7704 7867) show
36 mp_a_x mul 552 moveto (lapiceoi 7464) show
0 540 moveto (kbdgetc 7856) show
40 mp_a_x mul 540 moveto (0328 3421 3425 3432 3436) show
4 mp_a_x mul 528 moveto (7856 7898) show
40 mp_a_x mul 528 moveto (3442 7464) show
0 516 moveto (kbdintr 7896) show
36 mp_a_x mul 516 moveto (lapicid 7455) show
4 mp_a_x mul 504 moveto (0322 3431 7896) show
40 mp_a_x mul 504 moveto (0326 2444 7455 8063) show
0 492 moveto (KBS_DIB 7703) show
36 mp_a_x mul 492 moveto (lapicinit 7408) show
4 mp_a_x mul 480 moveto (7703 7865) show
40 mp_a_x mul 480 moveto (0329 1222 1245 7408) show
0 468 moveto (KBSTATP 7702) show
36 mp_a_x mul 468 moveto (lapicstartap 7483) show
4 mp_a_x mul 456 moveto (7702 7864) show
40 mp_a_x mul 456 moveto (0330 1289 7483) show
0 444 moveto (KERNBASE 0207) show
36 mp_a_x mul 444 moveto (lapicw 7401) show
4 mp_a_x mul 432 moveto (0207 0208 0210 0211 0213) show
40 mp_a_x mul 432 moveto (7401 7414 7420 7421 7422) show
4 mp_a_x mul 420 moveto (0214 1310 1634 1810 1932) show
40 mp_a_x mul 420 moveto (7425 7426 7431 7434 7437) show
4 mp_a_x mul 408 moveto (2009) show
40 mp_a_x mul 408 moveto (7438 7441 7444 7445 7451) show
0 396 moveto (KERNLINK 0208) show
40 mp_a_x mul 396 moveto (7467 7502 7503 7505 7514) show
4 mp_a_x mul 384 moveto (0208 1811 9310) show
40 mp_a_x mul 384 moveto (7515) show
0 372 moveto (KEY_DEL 7728) show
36 mp_a_x mul 372 moveto (lcr3 0590) show
4 mp_a_x mul 360 moveto (7728 7769 7791 7815) show
40 mp_a_x mul 360 moveto (0590 1855 1879) show
0 348 moveto (KEY_DN 7722) show
36 mp_a_x mul 348 moveto (lgdt 0512) show
4 mp_a_x mul 336 moveto (7722 7765 7787 7811) show
40 mp_a_x mul 336 moveto (0512 0520 1135 1728 9141) show
0 324 moveto (KEY_END 7720) show
36 mp_a_x mul 324 moveto (lidt 0526) show
4 mp_a_x mul 312 moveto (7720 7768 7790 7814) show
40 mp_a_x mul 312 moveto (0526 0534 3381) show
0 300 moveto (KEY_HOME 7719) show
36 mp_a_x mul 300 moveto (LINT0 7385) show
4 mp_a_x mul 288 moveto (7719 7768 7790 7814) show
40 mp_a_x mul 288 moveto (7385 7425) show
0 276 moveto (KEY_INS 7727) show
36 mp_a_x mul 276 moveto (LINT1 7386) show
4 mp_a_x mul 264 moveto (7727 7769 7791 7815) show
40 mp_a_x mul 264 moveto (7386 7426) show
0 252 moveto (KEY_LF 7723) show
36 mp_a_x mul 252 moveto (LIST 8560) show
4 mp_a_x mul 240 moveto (7723 7767 7789 7813) show
40 mp_a_x mul 240 moveto (8560 8640 8807 9083) show
0 228 moveto (KEY_PGDN 7726) show
36 mp_a_x mul 228 moveto (listcmd 8590 8801) show
4 mp_a_x mul 216 moveto (7726 7766 7788 7812) show
40 mp_a_x mul 216 moveto (8590 8611 8641 8801 8803) show
0 204 moveto (KEY_PGUP 7725) show
40 mp_a_x mul 204 moveto (8946 9057 9084) show
4 mp_a_x mul 192 moveto (7725 7766 7788 7812) show
36 mp_a_x mul 192 moveto (loaduvm 1903) show
0 180 moveto (KEY_RT 7724) show
40 mp_a_x mul 180 moveto (0434 1903 1909 1912 6655) show
4 mp_a_x mul 168 moveto (7724 7767 7789 7813) show
36 mp_a_x mul 168 moveto (log 4738 4750) show
0 156 moveto (KEY_UP 7721) show
40 mp_a_x mul 156 moveto (4738 4750 4762 4764 4765) show
4 mp_a_x mul 144 moveto (7721 7765 7787 7811) show
40 mp_a_x mul 144 moveto (4766 4776 4777 4778 4790) show
0 132 moveto (kfree 3164) show
40 mp_a_x mul 132 moveto (4793 4794 4795 4806 4809) show
4 mp_a_x mul 120 moveto (0317 1949 1977 1979 2013) show
40 mp_a_x mul 120 moveto (4810 4811 4822 4830 4832) show
4 mp_a_x mul 108 moveto (2016 2055 2593 2688 3156) show
40 mp_a_x mul 108 moveto (4833 4834 4836 4838 4839) show
4 mp_a_x mul 96 moveto (3164 3169 6802 6823) show
40 mp_a_x mul 96 moveto (4857 4858 4859 4860 4861) show
0 84 moveto (kill 2975) show
40 mp_a_x mul 84 moveto (4863 4868 4870 4876 4877) show
4 mp_a_x mul 72 moveto (0362 2975 3459 3785 8467) show
40 mp_a_x mul 72 moveto (4878 4879 4889 4890 4891) show
0 60 moveto (kinit1 3131) show
40 mp_a_x mul 60 moveto (4903 4907 4926 4928 4931) show
grestore
restore
showpage
%%Page: 5 5
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 7) show
4 mp_a_x mul 648 moveto (4932 4933 4936 4937 4938) show
36 mp_a_x mul 648 moveto (mpconf 7063) show
4 mp_a_x mul 636 moveto (4940) show
40 mp_a_x mul 636 moveto (7063 7279 7282 7287 7306) show
0 624 moveto (logheader 4733) show
36 mp_a_x mul 624 moveto (mpconfig 7280) show
4 mp_a_x mul 612 moveto (4733 4745 4758 4759 4791) show
40 mp_a_x mul 612 moveto (7280 7310) show
4 mp_a_x mul 600 moveto (4807) show
36 mp_a_x mul 600 moveto (mpenter 1241) show
0 588 moveto (LOGSIZE 0160) show
40 mp_a_x mul 588 moveto (1241 1286) show
4 mp_a_x mul 576 moveto (0160 4735 4834 4926) show
36 mp_a_x mul 576 moveto (mpinit 7301) show
0 564 moveto (log_write 4922) show
40 mp_a_x mul 564 moveto (0341 1221 7301) show
4 mp_a_x mul 552 moveto (0335 4922 4929 5008 5028) show
36 mp_a_x mul 552 moveto (mpioapic 7089) show
4 mp_a_x mul 540 moveto (5064 5216 5243 5430 5573) show
40 mp_a_x mul 540 moveto (7089 7308 7325 7327) show
0 528 moveto (ltr 0538) show
36 mp_a_x mul 528 moveto (MPIOAPIC 7103) show
4 mp_a_x mul 516 moveto (0538 0540 1878) show
40 mp_a_x mul 516 moveto (7103 7324) show
0 504 moveto (mappages 1760) show
36 mp_a_x mul 504 moveto (MPIOINTR 7104) show
4 mp_a_x mul 492 moveto (1760 1829 1894 1946 2054) show
40 mp_a_x mul 492 moveto (7104 7330) show
0 480 moveto (MAXARG 0158) show
36 mp_a_x mul 480 moveto (MPLINTR 7105) show
4 mp_a_x mul 468 moveto (0158 6528 6614 6672) show
40 mp_a_x mul 468 moveto (7105 7331) show
0 456 moveto (MAXARGS 8563) show
36 mp_a_x mul 456 moveto (mpmain 1252) show
4 mp_a_x mul 444 moveto (8563 8571 8572 9040) show
40 mp_a_x mul 444 moveto (1209 1236 1246 1252) show
0 432 moveto (MAXFILE 4075) show
36 mp_a_x mul 432 moveto (mpproc 7078) show
4 mp_a_x mul 420 moveto (4075 5566) show
40 mp_a_x mul 420 moveto (7078 7307 7317 7322) show
0 408 moveto (MAXOPBLOCKS 0159) show
36 mp_a_x mul 408 moveto (MPPROC 7101) show
4 mp_a_x mul 396 moveto (0159 0160 0161 4834 6017) show
40 mp_a_x mul 396 moveto (7101 7316) show
0 384 moveto (memcmp 6915) show
36 mp_a_x mul 384 moveto (mpsearch 7256) show
4 mp_a_x mul 372 moveto (0395 6915 7237 7288 7567) show
40 mp_a_x mul 372 moveto (7256 7285) show
0 360 moveto (memmove 6931) show
36 mp_a_x mul 360 moveto (mpsearch1 7230) show
4 mp_a_x mul 348 moveto (0396 1275 1895 2053 2132) show
40 mp_a_x mul 348 moveto (7230 7264 7268 7271) show
4 mp_a_x mul 336 moveto (4779 4892 4986 5242 5321) show
36 mp_a_x mul 336 moveto (multiboot_header 1029) show
4 mp_a_x mul 324 moveto (5522 5572 5729 5731 6931) show
40 mp_a_x mul 324 moveto (1028 1029) show
4 mp_a_x mul 312 moveto (6954 8126) show
36 mp_a_x mul 312 moveto (mycpu 2437) show
0 300 moveto (memset 6904) show
40 mp_a_x mul 300 moveto (0363 1256 1278 1590 1656) show
4 mp_a_x mul 288 moveto (0397 1747 1825 1893 1945) show
40 mp_a_x mul 288 moveto (1673 1674 1675 1683 1685) show
4 mp_a_x mul 276 moveto (2511 2532 3172 5007 5214) show
40 mp_a_x mul 276 moveto (1870 1871 1872 1873 1874) show
4 mp_a_x mul 264 moveto (6334 6535 6904 8128 8687) show
40 mp_a_x mul 264 moveto (1877 2431 2437 2442 2461) show
4 mp_a_x mul 252 moveto (8758 8769 8785 8806 8819) show
40 mp_a_x mul 252 moveto (2761 2815 2821 2822 2823) show
0 240 moveto (microdelay 7473) show
36 mp_a_x mul 240 moveto (myproc 2457) show
4 mp_a_x mul 228 moveto (0331 7473 7504 7506 7516) show
40 mp_a_x mul 228 moveto (0364 2457 2561 2584 2629) show
4 mp_a_x mul 216 moveto (7535 8358) show
40 mp_a_x mul 216 moveto (2675 2811 2831 2876 3404) show
0 204 moveto (min 4973) show
40 mp_a_x mul 204 moveto (3406 3408 3451 3460 3462) show
4 mp_a_x mul 192 moveto (4973 5521 5571) show
40 mp_a_x mul 192 moveto (3468 3473 3478 3569 3584) show
0 180 moveto (MINS 7525) show
40 mp_a_x mul 180 moveto (3604 3614 3704 3791 3808) show
4 mp_a_x mul 168 moveto (7525 7544) show
40 mp_a_x mul 168 moveto (3825 4629 4656 5762 6078) show
0 156 moveto (MONTH 7528) show
40 mp_a_x mul 156 moveto (6106 6170 6505 6564 6619) show
4 mp_a_x mul 144 moveto (7528 7547) show
40 mp_a_x mul 144 moveto (6837 6857 8231) show
0 132 moveto (mp 7052) show
36 mp_a_x mul 132 moveto (namecmp 5603) show
4 mp_a_x mul 120 moveto (7052 7208 7229 7236 7237) show
40 mp_a_x mul 120 moveto (0298 5603 5624 6320) show
4 mp_a_x mul 108 moveto (7238 7255 7260 7264 7265) show
36 mp_a_x mul 108 moveto (namei 5790) show
4 mp_a_x mul 96 moveto (7268 7269 7280 7283 7285) show
40 mp_a_x mul 96 moveto (0299 2542 5790 6211 6420) show
4 mp_a_x mul 84 moveto (7287 7294 7305 7310 7342) show
40 mp_a_x mul 84 moveto (6508 6623) show
0 72 moveto (MPBUS 7102) show
36 mp_a_x mul 72 moveto (nameiparent 5801) show
4 mp_a_x mul 60 moveto (7102 7329) show
40 mp_a_x mul 60 moveto (0300 5755 5770 5782 5801) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 8) show
4 mp_a_x mul 648 moveto (6227 6312 6363) show
40 mp_a_x mul 648 moveto (3950 6425 8975) show
0 636 moveto (namex 5755) show
36 mp_a_x mul 636 moveto (O_RDWR 3952) show
4 mp_a_x mul 624 moveto (5755 5793 5803) show
40 mp_a_x mul 624 moveto (3952 6446 8514 8516 8707) show
0 612 moveto (NBUF 0161) show
36 mp_a_x mul 612 moveto (outb 0471) show
4 mp_a_x mul 600 moveto (0161 4430 4453) show
40 mp_a_x mul 600 moveto (0471 4260 4269 4288 4289) show
0 588 moveto (ncpu 7214) show
40 mp_a_x mul 588 moveto (4290 4291 4292 4293 4295) show
4 mp_a_x mul 576 moveto (1277 2313 2447 4256 7214) show
40 mp_a_x mul 576 moveto (4298 7345 7346 7491 7492) show
4 mp_a_x mul 564 moveto (7318 7319 7320) show
40 mp_a_x mul 564 moveto (7534 8110 8112 8131 8132) show
0 552 moveto (NCPU 0152) show
40 mp_a_x mul 552 moveto (8133 8134 8324 8327 8328) show
4 mp_a_x mul 540 moveto (0152 2312 7213 7318) show
40 mp_a_x mul 540 moveto (8329 8330 8331 8332 8359) show
0 528 moveto (NDEV 0156) show
40 mp_a_x mul 528 moveto (9128 9136 9264 9265 9266) show
4 mp_a_x mul 516 moveto (0156 5509 5559 5862) show
40 mp_a_x mul 516 moveto (9267 9268 9269) show
0 504 moveto (NDIRECT 4073) show
36 mp_a_x mul 504 moveto (outsl 0483) show
4 mp_a_x mul 492 moveto (4073 4075 4084 4174 5415) show
40 mp_a_x mul 492 moveto (0483 0485 4296) show
4 mp_a_x mul 480 moveto (5420 5424 5425 5462 5469) show
36 mp_a_x mul 480 moveto (outw 0477) show
4 mp_a_x mul 468 moveto (5470 5477 5478) show
40 mp_a_x mul 468 moveto (0477 1180 1182 9174 9176) show
0 456 moveto (NELEM 0442) show
36 mp_a_x mul 456 moveto (O_WRONLY 3951) show
4 mp_a_x mul 444 moveto (0442 1828 3022 3707 6537) show
40 mp_a_x mul 444 moveto (3951 6445 6446 8978 8981) show
0 432 moveto (nextpid 2416) show
36 mp_a_x mul 432 moveto (P2V 0211) show
4 mp_a_x mul 420 moveto (2416 2489) show
40 mp_a_x mul 420 moveto (0211 1219 1234 1274 1742) show
0 408 moveto (NFILE 0154) show
40 mp_a_x mul 408 moveto (1826 1918 1978 2012 2053) show
4 mp_a_x mul 396 moveto (0154 5865 5881) show
40 mp_a_x mul 396 moveto (2111 7234 7262 7287 7493) show
0 384 moveto (NINDIRECT 4074) show
40 mp_a_x mul 384 moveto (8102) show
4 mp_a_x mul 372 moveto (4074 4075 5422 5472) show
36 mp_a_x mul 372 moveto (panic 8055 8731) show
0 360 moveto (NINODE 0155) show
40 mp_a_x mul 360 moveto (0272 1578 1605 1682 1684) show
4 mp_a_x mul 348 moveto (0155 5139 5148 5262) show
40 mp_a_x mul 348 moveto (1771 1827 1863 1865 1867) show
0 336 moveto (NO 7706) show
40 mp_a_x mul 336 moveto (1891 1909 1912 1977 2008) show
4 mp_a_x mul 324 moveto (7706 7752 7755 7757 7758) show
40 mp_a_x mul 324 moveto (2028 2046 2048 2442 2451) show
4 mp_a_x mul 312 moveto (7759 7760 7762 7774 7777) show
40 mp_a_x mul 312 moveto (2529 2634 2665 2814 2816) show
4 mp_a_x mul 300 moveto (7779 7780 7781 7782 7784) show
40 mp_a_x mul 300 moveto (2818 2820 2879 2882 3169) show
4 mp_a_x mul 288 moveto (7802 7803 7805 7806 7807) show
40 mp_a_x mul 288 moveto (3455 4277 4279 4285 4359) show
4 mp_a_x mul 276 moveto (7808) show
40 mp_a_x mul 276 moveto (4361 4363 4496 4518 4529) show
0 264 moveto (NOFILE 0153) show
40 mp_a_x mul 264 moveto (4759 4860 4927 4929 5036) show
4 mp_a_x mul 252 moveto (0153 2348 2605 2637 6078) show
40 mp_a_x mul 252 moveto (5062 5222 5274 5309 5325) show
4 mp_a_x mul 240 moveto (6108) show
40 mp_a_x mul 240 moveto (5334 5436 5617 5621 5667) show
0 228 moveto (NPDENTRIES 0791) show
40 mp_a_x mul 228 moveto (5675 5906 5920 5980 6034) show
4 mp_a_x mul 216 moveto (0791 1306 2010) show
40 mp_a_x mul 216 moveto (6039 6259 6328 6336 6377) show
0 204 moveto (NPROC 0150) show
40 mp_a_x mul 204 moveto (6390 6394 7311 7340 8013) show
4 mp_a_x mul 192 moveto (0150 2411 2480 2654 2681) show
40 mp_a_x mul 192 moveto (8055 8063 8123 8601 8620) show
4 mp_a_x mul 180 moveto (2770 2957 2980 3019) show
40 mp_a_x mul 180 moveto (8653 8731 8744 8928 8972) show
0 168 moveto (NSEGS 0721) show
40 mp_a_x mul 168 moveto (9006 9010 9036 9041) show
4 mp_a_x mul 156 moveto (0721 2305) show
36 mp_a_x mul 156 moveto (panicked 7919) show
0 144 moveto (nulterminate 9052) show
40 mp_a_x mul 144 moveto (7919 8069 8153) show
4 mp_a_x mul 132 moveto (8915 8930 9052 9073 9079) show
36 mp_a_x mul 132 moveto (parseblock 9001) show
4 mp_a_x mul 120 moveto (9080 9085 9086 9091) show
40 mp_a_x mul 120 moveto (9001 9006 9025) show
0 108 moveto (NUMLOCK 7713) show
36 mp_a_x mul 108 moveto (parsecmd 8918) show
4 mp_a_x mul 96 moveto (7713 7746) show
40 mp_a_x mul 96 moveto (8602 8724 8918) show
0 84 moveto (O_CREATE 3953) show
36 mp_a_x mul 84 moveto (parseexec 9017) show
4 mp_a_x mul 72 moveto (3953 6413 8978 8981) show
40 mp_a_x mul 72 moveto (8914 8955 9017) show
0 60 moveto (O_RDONLY 3950) show
36 mp_a_x mul 60 moveto (parseline 8935) show
grestore
restore
showpage
%%Page: 6 6
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 9) show
4 mp_a_x mul 648 moveto (8912 8924 8935 8946 9008) show
36 mp_a_x mul 648 moveto (pipeclose 6811) show
0 636 moveto (parsepipe 8951) show
40 mp_a_x mul 636 moveto (0352 5931 6811) show
4 mp_a_x mul 624 moveto (8913 8939 8951 8958) show
36 mp_a_x mul 624 moveto (pipecmd 8584 8780) show
0 612 moveto (parseredirs 8964) show
40 mp_a_x mul 612 moveto (8584 8612 8651 8780 8782) show
4 mp_a_x mul 600 moveto (8964 9012 9031 9042) show
40 mp_a_x mul 600 moveto (8958 9058 9078) show
0 588 moveto (PCINT 7384) show
36 mp_a_x mul 588 moveto (piperead 6851) show
4 mp_a_x mul 576 moveto (7384 7431) show
40 mp_a_x mul 576 moveto (0353 5972 6851) show
0 564 moveto (pde_t 0103) show
36 mp_a_x mul 564 moveto (PIPESIZE 6760) show
4 mp_a_x mul 552 moveto (0103 0428 0429 0430 0431) show
40 mp_a_x mul 552 moveto (6760 6764 6836 6844 6866) show
4 mp_a_x mul 540 moveto (0432 0433 0434 0435 0438) show
36 mp_a_x mul 540 moveto (pipewrite 6830) show
4 mp_a_x mul 528 moveto (0439 1210 1260 1306 1710) show
40 mp_a_x mul 528 moveto (0354 6009 6830) show
4 mp_a_x mul 516 moveto (1735 1737 1760 1817 1820) show
36 mp_a_x mul 516 moveto (popcli 1679) show
4 mp_a_x mul 504 moveto (1823 1886 1903 1927 1961) show
40 mp_a_x mul 504 moveto (0386 1622 1657 1679 1682) show
4 mp_a_x mul 492 moveto (2003 2022 2034 2035 2037) show
40 mp_a_x mul 492 moveto (1684 1880 2463) show
4 mp_a_x mul 480 moveto (2102 2118 2339 6618) show
36 mp_a_x mul 480 moveto (printint 7927) show
0 468 moveto (PDX 0782) show
40 mp_a_x mul 468 moveto (7927 8026 8030) show
4 mp_a_x mul 456 moveto (0782 1740 1973) show
36 mp_a_x mul 456 moveto (proc 2337) show
0 444 moveto (PDXSHIFT 0796) show
40 mp_a_x mul 444 moveto (0255 0364 0369 0436 1205) show
4 mp_a_x mul 432 moveto (0782 0788 0796 1310) show
40 mp_a_x mul 432 moveto (1558 1706 1860 2309 2337) show
0 420 moveto (peek 8901) show
40 mp_a_x mul 420 moveto (2343 2406 2411 2414 2456) show
4 mp_a_x mul 408 moveto (8901 8925 8940 8944 8956) show
40 mp_a_x mul 408 moveto (2459 2462 2472 2475 2480) show
4 mp_a_x mul 396 moveto (8969 9005 9009 9024 9032) show
40 mp_a_x mul 396 moveto (2522 2561 2583 2584 2629) show
0 384 moveto (PGADDR 0788) show
40 mp_a_x mul 384 moveto (2630 2654 2673 2675 2681) show
4 mp_a_x mul 372 moveto (0788 1973) show
40 mp_a_x mul 372 moveto (2760 2762 2770 2777 2786) show
0 360 moveto (PGROUNDDOWN 0799) show
40 mp_a_x mul 360 moveto (2811 2876 2955 2957 2977) show
4 mp_a_x mul 348 moveto (0799 1765 1766 2125) show
40 mp_a_x mul 348 moveto (2980 3015 3019 3355 3459) show
0 336 moveto (PGROUNDUP 0798) show
40 mp_a_x mul 336 moveto (3555 3569 3584 3614 3704) show
4 mp_a_x mul 324 moveto (0798 1937 1969 3154 6664) show
40 mp_a_x mul 324 moveto (3757 4207 4608 4966 6061) show
0 312 moveto (PGSIZE 0793) show
40 mp_a_x mul 312 moveto (6106 6505 6604 6619 6754) show
4 mp_a_x mul 300 moveto (0793 0798 0799 1305 1747) show
40 mp_a_x mul 300 moveto (7211 7307 7317 7319 7914) show
4 mp_a_x mul 288 moveto (1775 1776 1825 1890 1893) show
40 mp_a_x mul 288 moveto (8311) show
4 mp_a_x mul 276 moveto (1894 1908 1910 1914 1917) show
36 mp_a_x mul 276 moveto (procdump 3004) show
4 mp_a_x mul 264 moveto (1938 1945 1946 1970 1973) show
40 mp_a_x mul 264 moveto (0366 3004 8216) show
4 mp_a_x mul 252 moveto (2044 2053 2054 2129 2135) show
36 mp_a_x mul 252 moveto (proghdr 0924) show
4 mp_a_x mul 240 moveto (2531 2538 3155 3168 3172) show
40 mp_a_x mul 240 moveto (0924 6617 9220 9234) show
4 mp_a_x mul 228 moveto (6653 6665 6667) show
36 mp_a_x mul 228 moveto (PTE_ADDR 0807) show
0 216 moveto (PHYSTOP 0203) show
40 mp_a_x mul 216 moveto (0807 1742 1913 1975 2012) show
4 mp_a_x mul 204 moveto (0203 1234 1812 1826 1827) show
40 mp_a_x mul 204 moveto (2049 2111) show
4 mp_a_x mul 192 moveto (3168) show
36 mp_a_x mul 192 moveto (PTE_FLAGS 0808) show
0 180 moveto (pinit 2423) show
40 mp_a_x mul 180 moveto (0808 2050) show
4 mp_a_x mul 168 moveto (0365 1228 2423) show
36 mp_a_x mul 168 moveto (PTE_P 0801) show
0 156 moveto (pipe 6762) show
40 mp_a_x mul 156 moveto (0801 1308 1310 1741 1751) show
4 mp_a_x mul 144 moveto (0254 0352 0353 0354 4155) show
40 mp_a_x mul 144 moveto (1770 1772 1974 2011 2047) show
4 mp_a_x mul 132 moveto (5931 5972 6009 6762 6774) show
40 mp_a_x mul 132 moveto (2107) show
4 mp_a_x mul 120 moveto (6780 6786 6790 6794 6811) show
36 mp_a_x mul 120 moveto (PTE_PS 0804) show
4 mp_a_x mul 108 moveto (6830 6851 8463 8652 8653) show
40 mp_a_x mul 108 moveto (0804 1308 1310) show
0 96 moveto (PIPE 8559) show
36 mp_a_x mul 96 moveto (pte_t 0811) show
4 mp_a_x mul 84 moveto (8559 8650 8786 9077) show
40 mp_a_x mul 84 moveto (0811 1734 1738 1742 1744) show
0 72 moveto (pipealloc 6772) show
40 mp_a_x mul 72 moveto (1763 1906 1963 2024 2038) show
4 mp_a_x mul 60 moveto (0351 6559 6772) show
40 mp_a_x mul 60 moveto (2104) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 10) show
0 648 moveto (PTE_U 0803) show
40 mp_a_x mul 648 moveto (5377 5884 5888 5908 5922) show
4 mp_a_x mul 636 moveto (0803 1751 1894 1946 2029) show
40 mp_a_x mul 636 moveto (5928 6822 6825 6838 6847) show
4 mp_a_x mul 624 moveto (2109) show
40 mp_a_x mul 624 moveto (6858 6869 8051 8214 8232) show
0 612 moveto (PTE_W 0802) show
40 mp_a_x mul 612 moveto (8252 8267) show
4 mp_a_x mul 600 moveto (0802 1308 1310 1751 1810) show
36 mp_a_x mul 600 moveto (releasesleep 4634) show
4 mp_a_x mul 588 moveto (1812 1813 1894 1946) show
40 mp_a_x mul 588 moveto (0390 4531 4634 5336 5373) show
0 576 moveto (PTX 0785) show
36 mp_a_x mul 576 moveto (ROOTDEV 0157) show
4 mp_a_x mul 564 moveto (0785 1753) show
40 mp_a_x mul 564 moveto (0157 2864 2865 5760) show
0 552 moveto (PTXSHIFT 0795) show
36 mp_a_x mul 552 moveto (ROOTINO 4054) show
4 mp_a_x mul 540 moveto (0785 0788 0795) show
40 mp_a_x mul 540 moveto (4054 5760) show
0 528 moveto (pushcli 1667) show
36 mp_a_x mul 528 moveto (rtcdate 0950) show
4 mp_a_x mul 516 moveto (0385 1576 1655 1667 1869) show
40 mp_a_x mul 516 moveto (0256 0325 0950 7541 7552) show
4 mp_a_x mul 504 moveto (2460) show
40 mp_a_x mul 504 moveto (7554) show
0 492 moveto (rcr2 0582) show
36 mp_a_x mul 492 moveto (run 3115) show
4 mp_a_x mul 480 moveto (0582 3454 3461) show
40 mp_a_x mul 480 moveto (3011 3115 3116 3122 3166) show
0 468 moveto (readeflags 0544) show
40 mp_a_x mul 468 moveto (3176 3189 7311) show
4 mp_a_x mul 456 moveto (0544 1671 1681 2441 2819) show
36 mp_a_x mul 456 moveto (runcmd 8606) show
0 444 moveto (read_head 4788) show
40 mp_a_x mul 444 moveto (8606 8620 8637 8643 8645) show
4 mp_a_x mul 432 moveto (4788 4820) show
40 mp_a_x mul 432 moveto (8659 8666 8677 8724) show
0 420 moveto (readi 5503) show
36 mp_a_x mul 420 moveto (RUNNING 2334) show
4 mp_a_x mul 408 moveto (0301 1918 5503 5620 5666) show
40 mp_a_x mul 408 moveto (2334 2779 2817 3011 3473) show
4 mp_a_x mul 396 moveto (5975 6258 6259 6632 6643) show
36 mp_a_x mul 396 moveto (safestrcpy 6982) show
0 384 moveto (readsb 4981) show
40 mp_a_x mul 384 moveto (0398 2541 2610 6693 6982) show
4 mp_a_x mul 372 moveto (0287 4763 4981 5057 5152) show
36 mp_a_x mul 372 moveto (sb 4977) show
0 360 moveto (readsect 9260) show
40 mp_a_x mul 360 moveto (0287 4104 4110 4761 4763) show
4 mp_a_x mul 348 moveto (9260 9295) show
40 mp_a_x mul 348 moveto (4764 4765 4977 4981 4986) show
0 336 moveto (readseg 9279) show
40 mp_a_x mul 336 moveto (5022 5023 5024 5057 5058) show
4 mp_a_x mul 324 moveto (9214 9227 9238 9279) show
40 mp_a_x mul 324 moveto (5152 5153 5154 5155 5156) show
0 312 moveto (recover_from_log 4818) show
40 mp_a_x mul 312 moveto (5210 5211 5235 5314 7555) show
4 mp_a_x mul 300 moveto (4752 4767 4818) show
40 mp_a_x mul 300 moveto (7557 7559) show
0 288 moveto (REDIR 8558) show
36 mp_a_x mul 288 moveto (sched 2808) show
4 mp_a_x mul 276 moveto (8558 8630 8770 9071) show
40 mp_a_x mul 276 moveto (0368 2664 2808 2814 2816) show
0 264 moveto (redircmd 8575 8764) show
40 mp_a_x mul 264 moveto (2818 2820 2832 2898) show
4 mp_a_x mul 252 moveto (8575 8613 8631 8764 8766) show
36 mp_a_x mul 252 moveto (scheduler 2758) show
4 mp_a_x mul 240 moveto (8975 8978 8981 9059 9072) show
40 mp_a_x mul 240 moveto (0367 1257 2303 2758 2781) show
0 228 moveto (REG_ID 7610) show
40 mp_a_x mul 228 moveto (2822) show
4 mp_a_x mul 216 moveto (7610 7657) show
36 mp_a_x mul 216 moveto (SCROLLLOCK 7714) show
0 204 moveto (REG_TABLE 7612) show
40 mp_a_x mul 204 moveto (7714 7747) show
4 mp_a_x mul 192 moveto (7612 7664 7665 7675 7676) show
36 mp_a_x mul 192 moveto (SECS 7524) show
0 180 moveto (REG_VER 7611) show
40 mp_a_x mul 180 moveto (7524 7543) show
4 mp_a_x mul 168 moveto (7611 7656) show
36 mp_a_x mul 168 moveto (SECTOR_SIZE 4215) show
0 156 moveto (release 1602) show
40 mp_a_x mul 156 moveto (4215 4280) show
4 mp_a_x mul 144 moveto (0384 1602 1605 2484 2491) show
36 mp_a_x mul 144 moveto (SECTSIZE 9212) show
4 mp_a_x mul 132 moveto (2552 2618 2696 2702 2788) show
40 mp_a_x mul 132 moveto (9212 9273 9286 9289 9294) show
4 mp_a_x mul 120 moveto (2833 2857 2892 2905 2968) show
36 mp_a_x mul 120 moveto (SEG 0751) show
4 mp_a_x mul 108 moveto (2986 2990 3180 3197 3419) show
40 mp_a_x mul 108 moveto (0751 1724 1725 1726 1727) show
4 mp_a_x mul 96 moveto (3826 3831 3844 4312 4330) show
36 mp_a_x mul 96 moveto (SEG16 0755) show
4 mp_a_x mul 84 moveto (4383 4476 4491 4545 4630) show
40 mp_a_x mul 84 moveto (0755 1870) show
4 mp_a_x mul 72 moveto (4640 4657 4839 4870 4879) show
36 mp_a_x mul 72 moveto (SEG_ASM 0660) show
4 mp_a_x mul 60 moveto (4940 5265 5281 5293 5364) show
40 mp_a_x mul 60 moveto (0660 1189 1190 9184 9185) show
grestore
restore
showpage
%%Page: 7 7
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 11) show
0 648 moveto (segdesc 0725) show
40 mp_a_x mul 648 moveto (9184) show
4 mp_a_x mul 636 moveto (0509 0512 0725 0751 0755) show
36 mp_a_x mul 636 moveto (start 1123 8409 9111) show
4 mp_a_x mul 624 moveto (2305) show
40 mp_a_x mul 624 moveto (1122 1123 1166 1174 1176) show
0 612 moveto (seginit 1715) show
40 mp_a_x mul 612 moveto (4740 4764 4777 4790 4806) show
4 mp_a_x mul 600 moveto (0426 1223 1244 1715) show
40 mp_a_x mul 600 moveto (4890 5154 8408 8409 9110) show
0 588 moveto (SEG_KCODE 0714) show
40 mp_a_x mul 588 moveto (9111 9167) show
4 mp_a_x mul 576 moveto (0714 1143 1724 3372 3373) show
36 mp_a_x mul 576 moveto (startothers 1264) show
4 mp_a_x mul 564 moveto (9153) show
40 mp_a_x mul 564 moveto (1208 1233 1264) show
0 552 moveto (SEG_KDATA 0715) show
36 mp_a_x mul 552 moveto (stat 4004) show
4 mp_a_x mul 540 moveto (0715 1153 1725 1873 3313) show
40 mp_a_x mul 540 moveto (0259 0283 0302 4004 4964) show
4 mp_a_x mul 528 moveto (9158) show
40 mp_a_x mul 528 moveto (5488 5952 6059 6179 8503) show
0 516 moveto (SEG_NULLASM 0654) show
36 mp_a_x mul 516 moveto (stati 5488) show
4 mp_a_x mul 504 moveto (0654 1188 9183) show
40 mp_a_x mul 504 moveto (0302 5488 5956) show
0 492 moveto (SEG_TSS 0718) show
36 mp_a_x mul 492 moveto (STA_W 0666 0765) show
4 mp_a_x mul 480 moveto (0718 1870 1872 1878) show
40 mp_a_x mul 480 moveto (0666 0765 1190 1725 1727) show
0 468 moveto (SEG_UCODE 0716) show
40 mp_a_x mul 468 moveto (9185) show
4 mp_a_x mul 456 moveto (0716 1726 2533) show
36 mp_a_x mul 456 moveto (STA_X 0665 0764) show
0 444 moveto (SEG_UDATA 0717) show
40 mp_a_x mul 444 moveto (0665 0764 1189 1724 1726) show
4 mp_a_x mul 432 moveto (0717 1727 2534) show
40 mp_a_x mul 432 moveto (9184) show
0 420 moveto (SETGATE 0875) show
36 mp_a_x mul 420 moveto (sti 0563) show
4 mp_a_x mul 408 moveto (0875 3372 3373) show
40 mp_a_x mul 408 moveto (0563 0565 1686 2766) show
0 396 moveto (setupkvm 1818) show
36 mp_a_x mul 396 moveto (stosb 0492) show
4 mp_a_x mul 384 moveto (0428 1818 1842 2042 2528) show
40 mp_a_x mul 384 moveto (0492 0494 6910 9240) show
4 mp_a_x mul 372 moveto (6637) show
36 mp_a_x mul 372 moveto (stosl 0501) show
0 360 moveto (SHIFT 7708) show
40 mp_a_x mul 360 moveto (0501 0503 6908) show
4 mp_a_x mul 348 moveto (7708 7736 7737 7885) show
36 mp_a_x mul 348 moveto (strlen 7001) show
0 336 moveto (skipelem 5715) show
40 mp_a_x mul 336 moveto (0399 6674 6675 7001 8718) show
4 mp_a_x mul 324 moveto (5715 5764) show
40 mp_a_x mul 324 moveto (8923) show
0 312 moveto (sleep 2874) show
36 mp_a_x mul 312 moveto (strncmp 6958) show
4 mp_a_x mul 300 moveto (0370 2707 2874 2879 2882) show
40 mp_a_x mul 300 moveto (0400 5605 6958) show
4 mp_a_x mul 288 moveto (3009 3829 4379 4615 4626) show
36 mp_a_x mul 288 moveto (strncpy 6968) show
4 mp_a_x mul 276 moveto (4833 4836 6842 6861 8236) show
40 mp_a_x mul 276 moveto (0401 5672 6968) show
4 mp_a_x mul 264 moveto (8479) show
36 mp_a_x mul 264 moveto (STS_IG32 0770) show
0 252 moveto (sleeplock 3901) show
40 mp_a_x mul 252 moveto (0770 0881) show
4 mp_a_x mul 240 moveto (0258 0389 0390 0391 0392) show
36 mp_a_x mul 240 moveto (STS_T32A 0769) show
4 mp_a_x mul 228 moveto (3854 3901 4166 4211 4424) show
40 mp_a_x mul 228 moveto (0769 1870) show
4 mp_a_x mul 216 moveto (4610 4613 4622 4634 4651) show
36 mp_a_x mul 216 moveto (STS_TG32 0771) show
4 mp_a_x mul 204 moveto (4704 4968 5859 6064 6757) show
40 mp_a_x mul 204 moveto (0771 0881) show
4 mp_a_x mul 192 moveto (7909 8307) show
36 mp_a_x mul 192 moveto (sum 7218) show
0 180 moveto (spinlock 1501) show
40 mp_a_x mul 180 moveto (7218 7220 7222 7224 7225) show
4 mp_a_x mul 168 moveto (0257 0370 0380 0382 0383) show
40 mp_a_x mul 168 moveto (7237 7292) show
4 mp_a_x mul 156 moveto (0384 0418 1501 1559 1562) show
36 mp_a_x mul 156 moveto (superblock 4063) show
4 mp_a_x mul 144 moveto (1574 1602 1652 2407 2410) show
40 mp_a_x mul 144 moveto (0260 0287 4063 4761 4977) show
4 mp_a_x mul 132 moveto (2874 3109 3120 3358 3363) show
40 mp_a_x mul 132 moveto (4981) show
4 mp_a_x mul 120 moveto (3903 4210 4230 4423 4429) show
36 mp_a_x mul 120 moveto (SVR 7367) show
4 mp_a_x mul 108 moveto (4609 4703 4739 4967 5138) show
40 mp_a_x mul 108 moveto (7367 7414) show
4 mp_a_x mul 96 moveto (5858 5864 6063 6756 6763) show
36 mp_a_x mul 96 moveto (switchkvm 1853) show
4 mp_a_x mul 84 moveto (7908 7922 8306) show
40 mp_a_x mul 84 moveto (0437 1243 1843 1853 2782) show
0 72 moveto (STA_R 0667 0766) show
36 mp_a_x mul 72 moveto (switchuvm 1860) show
4 mp_a_x mul 60 moveto (0667 0766 1189 1724 1726) show
40 mp_a_x mul 60 moveto (0436 1860 1863 1865 1867) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 12) show
4 mp_a_x mul 648 moveto (2572 2778 6701) show
40 mp_a_x mul 648 moveto (3519 3691) show
0 636 moveto (swtch 3059) show
36 mp_a_x mul 636 moveto (sys_mkdir 6451) show
4 mp_a_x mul 624 moveto (0377 2781 2822 3058 3059) show
40 mp_a_x mul 624 moveto (3660 3692 6451) show
0 612 moveto (syscall 3701) show
36 mp_a_x mul 612 moveto (SYS_mkdir 3520) show
4 mp_a_x mul 600 moveto (0409 3407 3557 3701) show
40 mp_a_x mul 600 moveto (3520 3692) show
0 588 moveto (SYSCALL 8453 8460 8461 8462 8463 84 sys_mknod 6467) show
4 mp_a_x mul 576 moveto (8460 8461 8462 8463 8464) show
40 mp_a_x mul 576 moveto (3661 3689 6467) show
4 mp_a_x mul 564 moveto (8465 8466 8467 8468 8469) show
36 mp_a_x mul 564 moveto (SYS_mknod 3517) show
4 mp_a_x mul 552 moveto (8470 8471 8472 8473 8474) show
40 mp_a_x mul 552 moveto (3517 3689) show
4 mp_a_x mul 540 moveto (8475 8476 8477 8478 8479) show
36 mp_a_x mul 540 moveto (sys_open 6401) show
4 mp_a_x mul 528 moveto (8480) show
40 mp_a_x mul 528 moveto (3662 3687 6401) show
0 516 moveto (sys_chdir 6501) show
36 mp_a_x mul 516 moveto (SYS_open 3515) show
4 mp_a_x mul 504 moveto (3650 3681 6501) show
40 mp_a_x mul 504 moveto (3515 3687) show
0 492 moveto (SYS_chdir 3509) show
36 mp_a_x mul 492 moveto (sys_pipe 6551) show
4 mp_a_x mul 480 moveto (3509 3681) show
40 mp_a_x mul 480 moveto (3663 3676 6551) show
0 468 moveto (sys_close 6163) show
36 mp_a_x mul 468 moveto (SYS_pipe 3504) show
4 mp_a_x mul 456 moveto (3651 3693 6163) show
40 mp_a_x mul 456 moveto (3504 3676) show
0 444 moveto (SYS_close 3521) show
36 mp_a_x mul 444 moveto (sys_read 6132) show
4 mp_a_x mul 432 moveto (3521 3693) show
40 mp_a_x mul 432 moveto (3664 3677 6132) show
0 420 moveto (sys_dup 6118) show
36 mp_a_x mul 420 moveto (SYS_read 3505) show
4 mp_a_x mul 408 moveto (3652 3682 6118) show
40 mp_a_x mul 408 moveto (3505 3677) show
0 396 moveto (SYS_dup 3510) show
36 mp_a_x mul 396 moveto (sys_sbrk 3801) show
4 mp_a_x mul 384 moveto (3510 3682) show
40 mp_a_x mul 384 moveto (3665 3684 3801) show
0 372 moveto (sys_exec 6526) show
36 mp_a_x mul 372 moveto (SYS_sbrk 3512) show
4 mp_a_x mul 360 moveto (3653 3679 6526) show
40 mp_a_x mul 360 moveto (3512 3684) show
0 348 moveto (SYS_exec 3507) show
36 mp_a_x mul 348 moveto (sys_sleep 3815) show
4 mp_a_x mul 336 moveto (3507 3679 8413) show
40 mp_a_x mul 336 moveto (3666 3685 3815) show
0 324 moveto (sys_exit 3766) show
36 mp_a_x mul 324 moveto (SYS_sleep 3513) show
4 mp_a_x mul 312 moveto (3654 3674 3766) show
40 mp_a_x mul 312 moveto (3513 3685) show
0 300 moveto (SYS_exit 3502) show
36 mp_a_x mul 300 moveto (sys_unlink 6301) show
4 mp_a_x mul 288 moveto (3502 3674 8418) show
40 mp_a_x mul 288 moveto (3667 3690 6301) show
0 276 moveto (sys_fork 3760) show
36 mp_a_x mul 276 moveto (SYS_unlink 3518) show
4 mp_a_x mul 264 moveto (3655 3673 3760) show
40 mp_a_x mul 264 moveto (3518 3690) show
0 252 moveto (SYS_fork 3501) show
36 mp_a_x mul 252 moveto (sys_uptime 3838) show
4 mp_a_x mul 240 moveto (3501 3673) show
40 mp_a_x mul 240 moveto (3670 3686 3838) show
0 228 moveto (sys_fstat 6176) show
36 mp_a_x mul 228 moveto (SYS_uptime 3514) show
4 mp_a_x mul 216 moveto (3656 3680 6176) show
40 mp_a_x mul 216 moveto (3514 3686) show
0 204 moveto (SYS_fstat 3508) show
36 mp_a_x mul 204 moveto (sys_wait 3773) show
4 mp_a_x mul 192 moveto (3508 3680) show
40 mp_a_x mul 192 moveto (3668 3675 3773) show
0 180 moveto (sys_getpid 3789) show
36 mp_a_x mul 180 moveto (SYS_wait 3503) show
4 mp_a_x mul 168 moveto (3657 3683 3789) show
40 mp_a_x mul 168 moveto (3503 3675) show
0 156 moveto (SYS_getpid 3511) show
36 mp_a_x mul 156 moveto (sys_write 6151) show
4 mp_a_x mul 144 moveto (3511 3683) show
40 mp_a_x mul 144 moveto (3669 3688 6151) show
0 132 moveto (sys_kill 3779) show
36 mp_a_x mul 132 moveto (SYS_write 3516) show
4 mp_a_x mul 120 moveto (3658 3678 3779) show
40 mp_a_x mul 120 moveto (3516 3688) show
0 108 moveto (SYS_kill 3506) show
36 mp_a_x mul 108 moveto (taskstate 0814) show
4 mp_a_x mul 96 moveto (3506 3678) show
40 mp_a_x mul 96 moveto (0814 2304) show
0 84 moveto (sys_link 6202) show
36 mp_a_x mul 84 moveto (TDCR 7391) show
4 mp_a_x mul 72 moveto (3659 3691 6202) show
40 mp_a_x mul 72 moveto (7391 7420) show
0 60 moveto (SYS_link 3519) show
36 mp_a_x mul 60 moveto (T_DEV 4002) show
grestore
restore
showpage
%%Page: 8 8
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  cross-references  Page 13) show
4 mp_a_x mul 648 moveto (4002 5508 5558 6477) show
40 mp_a_x mul 648 moveto (0422 3435 8373) show
0 636 moveto (T_DIR 4000) show
36 mp_a_x mul 636 moveto (uartputc 8351) show
4 mp_a_x mul 624 moveto (4000 5616 5766 6217 6329) show
40 mp_a_x mul 624 moveto (0423 8160 8162 8347 8351) show
4 mp_a_x mul 612 moveto (6337 6385 6425 6457 6513) show
36 mp_a_x mul 612 moveto (userinit 2520) show
0 600 moveto (T_FILE 4001) show
40 mp_a_x mul 600 moveto (0371 1235 2520 2529) show
4 mp_a_x mul 588 moveto (4001 6370 6414) show
36 mp_a_x mul 588 moveto (uva2ka 2102) show
0 576 moveto (ticks 3364) show
40 mp_a_x mul 576 moveto (0429 2102 2126) show
4 mp_a_x mul 564 moveto (0416 3364 3417 3418 3823) show
36 mp_a_x mul 564 moveto (V2P 0210) show
4 mp_a_x mul 552 moveto (3824 3829 3843) show
40 mp_a_x mul 552 moveto (0210 1287 1289 1751 1811) show
0 540 moveto (tickslock 3363) show
40 mp_a_x mul 540 moveto (1812 1855 1879 1894 1946) show
4 mp_a_x mul 528 moveto (0418 3363 3375 3416 3419) show
40 mp_a_x mul 528 moveto (2054 3168) show
4 mp_a_x mul 516 moveto (3822 3826 3829 3831 3842) show
36 mp_a_x mul 516 moveto (V2P_WO 0213) show
4 mp_a_x mul 504 moveto (3844) show
40 mp_a_x mul 504 moveto (0213 1040 1050) show
0 492 moveto (TICR 7389) show
36 mp_a_x mul 492 moveto (VER 7364) show
4 mp_a_x mul 480 moveto (7389 7422) show
40 mp_a_x mul 480 moveto (7364 7430) show
0 468 moveto (TIMER 7381) show
36 mp_a_x mul 468 moveto (wait 2671) show
4 mp_a_x mul 456 moveto (7381 7421) show
40 mp_a_x mul 456 moveto (0372 2671 3775 8462 8533) show
0 444 moveto (T_IRQ0 3229) show
40 mp_a_x mul 444 moveto (8644 8670 8671 8725) show
4 mp_a_x mul 432 moveto (3229 3414 3423 3427 3430) show
36 mp_a_x mul 432 moveto (waitdisk 9251) show
4 mp_a_x mul 420 moveto (3434 3438 3439 3474 7414) show
40 mp_a_x mul 420 moveto (9251 9263 9272) show
4 mp_a_x mul 408 moveto (7421 7434 7664 7675) show
36 mp_a_x mul 408 moveto (wakeup 2964) show
0 396 moveto (TPR 7365) show
40 mp_a_x mul 396 moveto (0373 2964 3418 4324 4639) show
4 mp_a_x mul 384 moveto (7365 7451) show
40 mp_a_x mul 384 moveto (4868 4878 6816 6819 6841) show
0 372 moveto (trap 3401) show
40 mp_a_x mul 372 moveto (6846 6868 8208) show
4 mp_a_x mul 360 moveto (3252 3254 3319 3401 3453) show
36 mp_a_x mul 360 moveto (wakeup1 2953) show
4 mp_a_x mul 348 moveto (3455 3458) show
40 mp_a_x mul 348 moveto (2420 2651 2658 2953 2967) show
0 336 moveto (trapframe 0602) show
36 mp_a_x mul 336 moveto (walkpgdir 1735) show
4 mp_a_x mul 324 moveto (0602 2344 2502 3401) show
40 mp_a_x mul 324 moveto (1735 1768 1911 1971 2026) show
0 312 moveto (trapret 3324) show
40 mp_a_x mul 312 moveto (2045 2106) show
4 mp_a_x mul 300 moveto (2418 2507 3323 3324) show
36 mp_a_x mul 300 moveto (write_head 4804) show
0 288 moveto (T_SYSCALL 3226) show
40 mp_a_x mul 288 moveto (4804 4823 4905 4908) show
4 mp_a_x mul 276 moveto (3226 3373 3403 8414 8419) show
36 mp_a_x mul 276 moveto (writei 5553) show
4 mp_a_x mul 264 moveto (8457) show
40 mp_a_x mul 264 moveto (0303 5553 5674 6026 6335) show
0 252 moveto (tvinit 3367) show
40 mp_a_x mul 252 moveto (6336) show
4 mp_a_x mul 240 moveto (0417 1229 3367) show
36 mp_a_x mul 240 moveto (write_log 4885) show
0 228 moveto (uart 8316) show
40 mp_a_x mul 228 moveto (4885 4904) show
4 mp_a_x mul 216 moveto (8316 8337 8355 8365) show
36 mp_a_x mul 216 moveto (xchg 0569) show
0 204 moveto (uartgetc 8363) show
40 mp_a_x mul 204 moveto (0569 1256 1581) show
4 mp_a_x mul 192 moveto (8363 8375) show
36 mp_a_x mul 192 moveto (YEAR 7529) show
0 180 moveto (uartinit 8319) show
40 mp_a_x mul 180 moveto (7529 7548) show
4 mp_a_x mul 168 moveto (0421 1227 8319) show
36 mp_a_x mul 168 moveto (yield 2828) show
0 156 moveto (uartintr 8373) show
40 mp_a_x mul 156 moveto (0374 2828 3475) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
grestore
restore
showpage
%%Page: 9 9
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  blank  Page 1) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  blank  Page 1) show
grestore
restore
showpage
%%Page: 10 10
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/types.h  Page 1) show
0 648 moveto (0100 typedef unsigned int   uint;) show
0 636 moveto (0101 typedef unsigned short ushort;) show
0 624 moveto (0102 typedef unsigned char  uchar;) show
0 612 moveto (0103 typedef uint pde_t;) show
0 600 moveto (0104 ) show
0 588 moveto (0105 ) show
0 576 moveto (0106 ) show
0 564 moveto (0107 ) show
0 552 moveto (0108 ) show
0 540 moveto (0109 ) show
0 528 moveto (0110 ) show
0 516 moveto (0111 ) show
0 504 moveto (0112 ) show
0 492 moveto (0113 ) show
0 480 moveto (0114 ) show
0 468 moveto (0115 ) show
0 456 moveto (0116 ) show
0 444 moveto (0117 ) show
0 432 moveto (0118 ) show
0 420 moveto (0119 ) show
0 408 moveto (0120 ) show
0 396 moveto (0121 ) show
0 384 moveto (0122 ) show
0 372 moveto (0123 ) show
0 360 moveto (0124 ) show
0 348 moveto (0125 ) show
0 336 moveto (0126 ) show
0 324 moveto (0127 ) show
0 312 moveto (0128 ) show
0 300 moveto (0129 ) show
0 288 moveto (0130 ) show
0 276 moveto (0131 ) show
0 264 moveto (0132 ) show
0 252 moveto (0133 ) show
0 240 moveto (0134 ) show
0 228 moveto (0135 ) show
0 216 moveto (0136 ) show
0 204 moveto (0137 ) show
0 192 moveto (0138 ) show
0 180 moveto (0139 ) show
0 168 moveto (0140 ) show
0 156 moveto (0141 ) show
0 144 moveto (0142 ) show
0 132 moveto (0143 ) show
0 120 moveto (0144 ) show
0 108 moveto (0145 ) show
0 96 moveto (0146 ) show
0 84 moveto (0147 ) show
0 72 moveto (0148 ) show
0 60 moveto (0149 ) show
0 24 moveto (Sheet 01) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/param.h  Page 1) show
0 648 moveto (0150 #define NPROC        64  // maximum number of processes) show
0 636 moveto (0151 #define KSTACKSIZE 4096  // size of per-process kernel stack) show
0 624 moveto (0152 #define NCPU          8  // maximum number of CPUs) show
0 612 moveto (0153 #define NOFILE       16  // open files per process) show
0 600 moveto (0154 #define NFILE       100  // open files per system) show
0 588 moveto (0155 #define NINODE       50  // maximum number of active i-nodes) show
0 576 moveto (0156 #define NDEV         10  // maximum major device number) show
0 564 moveto (0157 #define ROOTDEV       1  // device number of file system root disk) show
0 552 moveto (0158 #define MAXARG       32  // max exec arguments) show
0 540 moveto (0159 #define MAXOPBLOCKS  10  // max # of blocks any FS op writes) show
0 528 moveto (0160 #define LOGSIZE      \(MAXOPBLOCKS*3\)  // max data blocks in on-disk log) show
0 516 moveto (0161 #define NBUF         \(MAXOPBLOCKS*3\)  // size of disk block cache) show
0 504 moveto (0162 #define FSSIZE       1000  // size of file system in blocks) show
0 492 moveto (0163 ) show
0 480 moveto (0164 ) show
0 468 moveto (0165 ) show
0 456 moveto (0166 ) show
0 444 moveto (0167 ) show
0 432 moveto (0168 ) show
0 420 moveto (0169 ) show
0 408 moveto (0170 ) show
0 396 moveto (0171 ) show
0 384 moveto (0172 ) show
0 372 moveto (0173 ) show
0 360 moveto (0174 ) show
0 348 moveto (0175 ) show
0 336 moveto (0176 ) show
0 324 moveto (0177 ) show
0 312 moveto (0178 ) show
0 300 moveto (0179 ) show
0 288 moveto (0180 ) show
0 276 moveto (0181 ) show
0 264 moveto (0182 ) show
0 252 moveto (0183 ) show
0 240 moveto (0184 ) show
0 228 moveto (0185 ) show
0 216 moveto (0186 ) show
0 204 moveto (0187 ) show
0 192 moveto (0188 ) show
0 180 moveto (0189 ) show
0 168 moveto (0190 ) show
0 156 moveto (0191 ) show
0 144 moveto (0192 ) show
0 132 moveto (0193 ) show
0 120 moveto (0194 ) show
0 108 moveto (0195 ) show
0 96 moveto (0196 ) show
0 84 moveto (0197 ) show
0 72 moveto (0198 ) show
0 60 moveto (0199 ) show
0 24 moveto (Sheet 01) show
grestore
restore
showpage
%%Page: 11 11
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/memlayout.h  Page 1) show
0 648 moveto (0200 // Memory layout) show
0 636 moveto (0201 ) show
0 624 moveto (0202 #define EXTMEM  0x100000            // Start of extended memory) show
0 612 moveto (0203 #define PHYSTOP 0xE000000           // Top physical memory) show
0 600 moveto (0204 #define DEVSPACE 0xFE000000         // Other devices are at high addresses) show
0 588 moveto (0205 ) show
0 576 moveto (0206 // Key addresses for address space layout \(see kmap in vm.c for layout\)) show
0 564 moveto (0207 #define KERNBASE 0x80000000         // First kernel virtual address) show
0 552 moveto (0208 #define KERNLINK \(KERNBASE+EXTMEM\)  // Address where kernel is linked) show
0 540 moveto (0209 ) show
0 528 moveto (0210 #define V2P\(a\) \(\(\(uint\) \(a\)\) - KERNBASE\)) show
0 516 moveto (0211 #define P2V\(a\) \(\(void *\)\(\(\(char *\) \(a\)\) + KERNBASE\)\)) show
0 504 moveto (0212 ) show
0 492 moveto (0213 #define V2P_WO\(x\) \(\(x\) - KERNBASE\)    // same as V2P, but without casts) show
0 480 moveto (0214 #define P2V_WO\(x\) \(\(x\) + KERNBASE\)    // same as P2V, but without casts) show
0 468 moveto (0215 ) show
0 456 moveto (0216 ) show
0 444 moveto (0217 ) show
0 432 moveto (0218 ) show
0 420 moveto (0219 ) show
0 408 moveto (0220 ) show
0 396 moveto (0221 ) show
0 384 moveto (0222 ) show
0 372 moveto (0223 ) show
0 360 moveto (0224 ) show
0 348 moveto (0225 ) show
0 336 moveto (0226 ) show
0 324 moveto (0227 ) show
0 312 moveto (0228 ) show
0 300 moveto (0229 ) show
0 288 moveto (0230 ) show
0 276 moveto (0231 ) show
0 264 moveto (0232 ) show
0 252 moveto (0233 ) show
0 240 moveto (0234 ) show
0 228 moveto (0235 ) show
0 216 moveto (0236 ) show
0 204 moveto (0237 ) show
0 192 moveto (0238 ) show
0 180 moveto (0239 ) show
0 168 moveto (0240 ) show
0 156 moveto (0241 ) show
0 144 moveto (0242 ) show
0 132 moveto (0243 ) show
0 120 moveto (0244 ) show
0 108 moveto (0245 ) show
0 96 moveto (0246 ) show
0 84 moveto (0247 ) show
0 72 moveto (0248 ) show
0 60 moveto (0249 ) show
0 24 moveto (Sheet 02) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/defs.h  Page 1) show
0 648 moveto (0250 struct buf;) show
0 636 moveto (0251 struct context;) show
0 624 moveto (0252 struct file;) show
0 612 moveto (0253 struct inode;) show
0 600 moveto (0254 struct pipe;) show
0 588 moveto (0255 struct proc;) show
0 576 moveto (0256 struct rtcdate;) show
0 564 moveto (0257 struct spinlock;) show
0 552 moveto (0258 struct sleeplock;) show
0 540 moveto (0259 struct stat;) show
0 528 moveto (0260 struct superblock;) show
0 516 moveto (0261 ) show
0 504 moveto (0262 // bio.c) show
0 492 moveto (0263 void            binit\(void\);) show
0 480 moveto (0264 struct buf*     bread\(uint, uint\);) show
0 468 moveto (0265 void            brelse\(struct buf*\);) show
0 456 moveto (0266 void            bwrite\(struct buf*\);) show
0 444 moveto (0267 ) show
0 432 moveto (0268 // console.c) show
0 420 moveto (0269 void            consoleinit\(void\);) show
0 408 moveto (0270 void            cprintf\(char*, ...\);) show
0 396 moveto (0271 void            consoleintr\(int\(*\)\(void\)\);) show
0 384 moveto (0272 void            panic\(char*\) __attribute__\(\(noreturn\)\);) show
0 372 moveto (0273 ) show
0 360 moveto (0274 // exec.c) show
0 348 moveto (0275 int             exec\(char*, char**\);) show
0 336 moveto (0276 ) show
0 324 moveto (0277 // file.c) show
0 312 moveto (0278 struct file*    filealloc\(void\);) show
0 300 moveto (0279 void            fileclose\(struct file*\);) show
0 288 moveto (0280 struct file*    filedup\(struct file*\);) show
0 276 moveto (0281 void            fileinit\(void\);) show
0 264 moveto (0282 int             fileread\(struct file*, char*, int n\);) show
0 252 moveto (0283 int             filestat\(struct file*, struct stat*\);) show
0 240 moveto (0284 int             filewrite\(struct file*, char*, int n\);) show
0 228 moveto (0285 ) show
0 216 moveto (0286 // fs.c) show
0 204 moveto (0287 void            readsb\(int dev, struct superblock *sb\);) show
0 192 moveto (0288 int             dirlink\(struct inode*, char*, uint\);) show
0 180 moveto (0289 struct inode*   dirlookup\(struct inode*, char*, uint*\);) show
0 168 moveto (0290 struct inode*   ialloc\(uint, short\);) show
0 156 moveto (0291 struct inode*   idup\(struct inode*\);) show
0 144 moveto (0292 void            iinit\(int dev\);) show
0 132 moveto (0293 void            ilock\(struct inode*\);) show
0 120 moveto (0294 void            iput\(struct inode*\);) show
0 108 moveto (0295 void            iunlock\(struct inode*\);) show
0 96 moveto (0296 void            iunlockput\(struct inode*\);) show
0 84 moveto (0297 void            iupdate\(struct inode*\);) show
0 72 moveto (0298 int             namecmp\(const char*, const char*\);) show
0 60 moveto (0299 struct inode*   namei\(char*\);) show
0 24 moveto (Sheet 02) show
grestore
restore
showpage
%%Page: 12 12
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/defs.h  Page 2) show
0 648 moveto (0300 struct inode*   nameiparent\(char*, char*\);) show
0 636 moveto (0301 int             readi\(struct inode*, char*, uint, uint\);) show
0 624 moveto (0302 void            stati\(struct inode*, struct stat*\);) show
0 612 moveto (0303 int             writei\(struct inode*, char*, uint, uint\);) show
0 600 moveto (0304 ) show
0 588 moveto (0305 // ide.c) show
0 576 moveto (0306 void            ideinit\(void\);) show
0 564 moveto (0307 void            ideintr\(void\);) show
0 552 moveto (0308 void            iderw\(struct buf*\);) show
0 540 moveto (0309 ) show
0 528 moveto (0310 // ioapic.c) show
0 516 moveto (0311 void            ioapicenable\(int irq, int cpu\);) show
0 504 moveto (0312 extern uchar    ioapicid;) show
0 492 moveto (0313 void            ioapicinit\(void\);) show
0 480 moveto (0314 ) show
0 468 moveto (0315 // kalloc.c) show
0 456 moveto (0316 char*           kalloc\(void\);) show
0 444 moveto (0317 void            kfree\(char*\);) show
0 432 moveto (0318 void            kinit1\(void*, void*\);) show
0 420 moveto (0319 void            kinit2\(void*, void*\);) show
0 408 moveto (0320 ) show
0 396 moveto (0321 // kbd.c) show
0 384 moveto (0322 void            kbdintr\(void\);) show
0 372 moveto (0323 ) show
0 360 moveto (0324 // lapic.c) show
0 348 moveto (0325 void            cmostime\(struct rtcdate *r\);) show
0 336 moveto (0326 int             lapicid\(void\);) show
0 324 moveto (0327 extern volatile uint*    lapic;) show
0 312 moveto (0328 void            lapiceoi\(void\);) show
0 300 moveto (0329 void            lapicinit\(void\);) show
0 288 moveto (0330 void            lapicstartap\(uchar, uint\);) show
0 276 moveto (0331 void            microdelay\(int\);) show
0 264 moveto (0332 ) show
0 252 moveto (0333 // log.c) show
0 240 moveto (0334 void            initlog\(int dev\);) show
0 228 moveto (0335 void            log_write\(struct buf*\);) show
0 216 moveto (0336 void            begin_op\(\);) show
0 204 moveto (0337 void            end_op\(\);) show
0 192 moveto (0338 ) show
0 180 moveto (0339 // mp.c) show
0 168 moveto (0340 extern int      ismp;) show
0 156 moveto (0341 void            mpinit\(void\);) show
0 144 moveto (0342 ) show
0 132 moveto (0343 // picirq.c) show
0 120 moveto (0344 void            picenable\(int\);) show
0 108 moveto (0345 void            picinit\(void\);) show
0 96 moveto (0346 ) show
0 84 moveto (0347 ) show
0 72 moveto (0348 ) show
0 60 moveto (0349 ) show
0 24 moveto (Sheet 03) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/defs.h  Page 3) show
0 648 moveto (0350 // pipe.c) show
0 636 moveto (0351 int             pipealloc\(struct file**, struct file**\);) show
0 624 moveto (0352 void            pipeclose\(struct pipe*, int\);) show
0 612 moveto (0353 int             piperead\(struct pipe*, char*, int\);) show
0 600 moveto (0354 int             pipewrite\(struct pipe*, char*, int\);) show
0 588 moveto (0355 ) show
0 576 moveto (0356 ) show
0 564 moveto (0357 // proc.c) show
0 552 moveto (0358 int             cpuid\(void\);) show
0 540 moveto (0359 void            exit\(void\);) show
0 528 moveto (0360 int             fork\(void\);) show
0 516 moveto (0361 int             growproc\(int\);) show
0 504 moveto (0362 int             kill\(int\);) show
0 492 moveto (0363 struct cpu*     mycpu\(void\);) show
0 480 moveto (0364 struct proc*    myproc\(\);) show
0 468 moveto (0365 void            pinit\(void\);) show
0 456 moveto (0366 void            procdump\(void\);) show
0 444 moveto (0367 void            scheduler\(void\) __attribute__\(\(noreturn\)\);) show
0 432 moveto (0368 void            sched\(void\);) show
0 420 moveto (0369 void            setproc\(struct proc*\);) show
0 408 moveto (0370 void            sleep\(void*, struct spinlock*\);) show
0 396 moveto (0371 void            userinit\(void\);) show
0 384 moveto (0372 int             wait\(void\);) show
0 372 moveto (0373 void            wakeup\(void*\);) show
0 360 moveto (0374 void            yield\(void\);) show
0 348 moveto (0375 ) show
0 336 moveto (0376 // swtch.S) show
0 324 moveto (0377 void            swtch\(struct context**, struct context*\);) show
0 312 moveto (0378 ) show
0 300 moveto (0379 // spinlock.c) show
0 288 moveto (0380 void            acquire\(struct spinlock*\);) show
0 276 moveto (0381 void            getcallerpcs\(void*, uint*\);) show
0 264 moveto (0382 int             holding\(struct spinlock*\);) show
0 252 moveto (0383 void            initlock\(struct spinlock*, char*\);) show
0 240 moveto (0384 void            release\(struct spinlock*\);) show
0 228 moveto (0385 void            pushcli\(void\);) show
0 216 moveto (0386 void            popcli\(void\);) show
0 204 moveto (0387 ) show
0 192 moveto (0388 // sleeplock.c) show
0 180 moveto (0389 void            acquiresleep\(struct sleeplock*\);) show
0 168 moveto (0390 void            releasesleep\(struct sleeplock*\);) show
0 156 moveto (0391 int             holdingsleep\(struct sleeplock*\);) show
0 144 moveto (0392 void            initsleeplock\(struct sleeplock*, char*\);) show
0 132 moveto (0393 ) show
0 120 moveto (0394 // string.c) show
0 108 moveto (0395 int             memcmp\(const void*, const void*, uint\);) show
0 96 moveto (0396 void*           memmove\(void*, const void*, uint\);) show
0 84 moveto (0397 void*           memset\(void*, int, uint\);) show
0 72 moveto (0398 char*           safestrcpy\(char*, const char*, int\);) show
0 60 moveto (0399 int             strlen\(const char*\);) show
0 24 moveto (Sheet 03) show
grestore
restore
showpage
%%Page: 13 13
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/defs.h  Page 4) show
0 648 moveto (0400 int             strncmp\(const char*, const char*, uint\);) show
0 636 moveto (0401 char*           strncpy\(char*, const char*, int\);) show
0 624 moveto (0402 ) show
0 612 moveto (0403 // syscall.c) show
0 600 moveto (0404 int             argint\(int, int*\);) show
0 588 moveto (0405 int             argptr\(int, char**, int\);) show
0 576 moveto (0406 int             argstr\(int, char**\);) show
0 564 moveto (0407 int             fetchint\(uint, int*\);) show
0 552 moveto (0408 int             fetchstr\(uint, char**\);) show
0 540 moveto (0409 void            syscall\(void\);) show
0 528 moveto (0410 ) show
0 516 moveto (0411 // timer.c) show
0 504 moveto (0412 void            timerinit\(void\);) show
0 492 moveto (0413 ) show
0 480 moveto (0414 // trap.c) show
0 468 moveto (0415 void            idtinit\(void\);) show
0 456 moveto (0416 extern uint     ticks;) show
0 444 moveto (0417 void            tvinit\(void\);) show
0 432 moveto (0418 extern struct spinlock tickslock;) show
0 420 moveto (0419 ) show
0 408 moveto (0420 // uart.c) show
0 396 moveto (0421 void            uartinit\(void\);) show
0 384 moveto (0422 void            uartintr\(void\);) show
0 372 moveto (0423 void            uartputc\(int\);) show
0 360 moveto (0424 ) show
0 348 moveto (0425 // vm.c) show
0 336 moveto (0426 void            seginit\(void\);) show
0 324 moveto (0427 void            kvmalloc\(void\);) show
0 312 moveto (0428 pde_t*          setupkvm\(void\);) show
0 300 moveto (0429 char*           uva2ka\(pde_t*, char*\);) show
0 288 moveto (0430 int             allocuvm\(pde_t*, uint, uint\);) show
0 276 moveto (0431 int             deallocuvm\(pde_t*, uint, uint\);) show
0 264 moveto (0432 void            freevm\(pde_t*\);) show
0 252 moveto (0433 void            inituvm\(pde_t*, char*, uint\);) show
0 240 moveto (0434 int             loaduvm\(pde_t*, char*, struct inode*, uint, uint\);) show
0 228 moveto (0435 pde_t*          copyuvm\(pde_t*, uint\);) show
0 216 moveto (0436 void            switchuvm\(struct proc*\);) show
0 204 moveto (0437 void            switchkvm\(void\);) show
0 192 moveto (0438 int             copyout\(pde_t*, uint, void*, uint\);) show
0 180 moveto (0439 void            clearpteu\(pde_t *pgdir, char *uva\);) show
0 168 moveto (0440 ) show
0 156 moveto (0441 // number of elements in fixed-size array) show
0 144 moveto (0442 #define NELEM\(x\) \(sizeof\(x\)/sizeof\(\(x\)[0]\)\)) show
0 132 moveto (0443 ) show
0 120 moveto (0444 ) show
0 108 moveto (0445 ) show
0 96 moveto (0446 ) show
0 84 moveto (0447 ) show
0 72 moveto (0448 ) show
0 60 moveto (0449 ) show
0 24 moveto (Sheet 04) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/x86.h  Page 1) show
0 648 moveto (0450 // Routines to let C code use special x86 instructions.) show
0 636 moveto (0451 ) show
0 624 moveto (0452 static inline uchar) show
0 612 moveto (0453 inb\(ushort port\)) show
0 600 moveto (0454 {) show
0 588 moveto (0455   uchar data;) show
0 576 moveto (0456 ) show
0 564 moveto (0457   asm volatile\("in %1,%0" : "=a" \(data\) : "d" \(port\)\);) show
0 552 moveto (0458   return data;) show
0 540 moveto (0459 }) show
0 528 moveto (0460 ) show
0 516 moveto (0461 static inline void) show
0 504 moveto (0462 insl\(int port, void *addr, int cnt\)) show
0 492 moveto (0463 {) show
0 480 moveto (0464   asm volatile\("cld; rep insl" :) show
0 468 moveto (0465                "=D" \(addr\), "=c" \(cnt\) :) show
0 456 moveto (0466                "d" \(port\), "0" \(addr\), "1" \(cnt\) :) show
0 444 moveto (0467                "memory", "cc"\);) show
0 432 moveto (0468 }) show
0 420 moveto (0469 ) show
0 408 moveto (0470 static inline void) show
0 396 moveto (0471 outb\(ushort port, uchar data\)) show
0 384 moveto (0472 {) show
0 372 moveto (0473   asm volatile\("out %0,%1" : : "a" \(data\), "d" \(port\)\);) show
0 360 moveto (0474 }) show
0 348 moveto (0475 ) show
0 336 moveto (0476 static inline void) show
0 324 moveto (0477 outw\(ushort port, ushort data\)) show
0 312 moveto (0478 {) show
0 300 moveto (0479   asm volatile\("out %0,%1" : : "a" \(data\), "d" \(port\)\);) show
0 288 moveto (0480 }) show
0 276 moveto (0481 ) show
0 264 moveto (0482 static inline void) show
0 252 moveto (0483 outsl\(int port, const void *addr, int cnt\)) show
0 240 moveto (0484 {) show
0 228 moveto (0485   asm volatile\("cld; rep outsl" :) show
0 216 moveto (0486                "=S" \(addr\), "=c" \(cnt\) :) show
0 204 moveto (0487                "d" \(port\), "0" \(addr\), "1" \(cnt\) :) show
0 192 moveto (0488                "cc"\);) show
0 180 moveto (0489 }) show
0 168 moveto (0490 ) show
0 156 moveto (0491 static inline void) show
0 144 moveto (0492 stosb\(void *addr, int data, int cnt\)) show
0 132 moveto (0493 {) show
0 120 moveto (0494   asm volatile\("cld; rep stosb" :) show
0 108 moveto (0495                "=D" \(addr\), "=c" \(cnt\) :) show
0 96 moveto (0496                "0" \(addr\), "1" \(cnt\), "a" \(data\) :) show
0 84 moveto (0497                "memory", "cc"\);) show
0 72 moveto (0498 }) show
0 60 moveto (0499 ) show
0 24 moveto (Sheet 04) show
grestore
restore
showpage
%%Page: 14 14
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/x86.h  Page 2) show
0 648 moveto (0500 static inline void) show
0 636 moveto (0501 stosl\(void *addr, int data, int cnt\)) show
0 624 moveto (0502 {) show
0 612 moveto (0503   asm volatile\("cld; rep stosl" :) show
0 600 moveto (0504                "=D" \(addr\), "=c" \(cnt\) :) show
0 588 moveto (0505                "0" \(addr\), "1" \(cnt\), "a" \(data\) :) show
0 576 moveto (0506                "memory", "cc"\);) show
0 564 moveto (0507 }) show
0 552 moveto (0508 ) show
0 540 moveto (0509 struct segdesc;) show
0 528 moveto (0510 ) show
0 516 moveto (0511 static inline void) show
0 504 moveto (0512 lgdt\(struct segdesc *p, int size\)) show
0 492 moveto (0513 {) show
0 480 moveto (0514   volatile ushort pd[3];) show
0 468 moveto (0515 ) show
0 456 moveto (0516   pd[0] = size-1;) show
0 444 moveto (0517   pd[1] = \(uint\)p;) show
0 432 moveto (0518   pd[2] = \(uint\)p >> 16;) show
0 420 moveto (0519 ) show
0 408 moveto (0520   asm volatile\("lgdt \(%0\)" : : "r" \(pd\)\);) show
0 396 moveto (0521 }) show
0 384 moveto (0522 ) show
0 372 moveto (0523 struct gatedesc;) show
0 360 moveto (0524 ) show
0 348 moveto (0525 static inline void) show
0 336 moveto (0526 lidt\(struct gatedesc *p, int size\)) show
0 324 moveto (0527 {) show
0 312 moveto (0528   volatile ushort pd[3];) show
0 300 moveto (0529 ) show
0 288 moveto (0530   pd[0] = size-1;) show
0 276 moveto (0531   pd[1] = \(uint\)p;) show
0 264 moveto (0532   pd[2] = \(uint\)p >> 16;) show
0 252 moveto (0533 ) show
0 240 moveto (0534   asm volatile\("lidt \(%0\)" : : "r" \(pd\)\);) show
0 228 moveto (0535 }) show
0 216 moveto (0536 ) show
0 204 moveto (0537 static inline void) show
0 192 moveto (0538 ltr\(ushort sel\)) show
0 180 moveto (0539 {) show
0 168 moveto (0540   asm volatile\("ltr %0" : : "r" \(sel\)\);) show
0 156 moveto (0541 }) show
0 144 moveto (0542 ) show
0 132 moveto (0543 static inline uint) show
0 120 moveto (0544 readeflags\(void\)) show
0 108 moveto (0545 {) show
0 96 moveto (0546   uint eflags;) show
0 84 moveto (0547   asm volatile\("pushfl; popl %0" : "=r" \(eflags\)\);) show
0 72 moveto (0548   return eflags;) show
0 60 moveto (0549 }) show
0 24 moveto (Sheet 05) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/x86.h  Page 3) show
0 648 moveto (0550 static inline void) show
0 636 moveto (0551 loadgs\(ushort v\)) show
0 624 moveto (0552 {) show
0 612 moveto (0553   asm volatile\("movw %0, %%gs" : : "r" \(v\)\);) show
0 600 moveto (0554 }) show
0 588 moveto (0555 ) show
0 576 moveto (0556 static inline void) show
0 564 moveto (0557 cli\(void\)) show
0 552 moveto (0558 {) show
0 540 moveto (0559   asm volatile\("cli"\);) show
0 528 moveto (0560 }) show
0 516 moveto (0561 ) show
0 504 moveto (0562 static inline void) show
0 492 moveto (0563 sti\(void\)) show
0 480 moveto (0564 {) show
0 468 moveto (0565   asm volatile\("sti"\);) show
0 456 moveto (0566 }) show
0 444 moveto (0567 ) show
0 432 moveto (0568 static inline uint) show
0 420 moveto (0569 xchg\(volatile uint *addr, uint newval\)) show
0 408 moveto (0570 {) show
0 396 moveto (0571   uint result;) show
0 384 moveto (0572 ) show
0 372 moveto (0573   // The + in "+m" denotes a read-modify-write operand.) show
0 360 moveto (0574   asm volatile\("lock; xchgl %0, %1" :) show
0 348 moveto (0575                "+m" \(*addr\), "=a" \(result\) :) show
0 336 moveto (0576                "1" \(newval\) :) show
0 324 moveto (0577                "cc"\);) show
0 312 moveto (0578   return result;) show
0 300 moveto (0579 }) show
0 288 moveto (0580 ) show
0 276 moveto (0581 static inline uint) show
0 264 moveto (0582 rcr2\(void\)) show
0 252 moveto (0583 {) show
0 240 moveto (0584   uint val;) show
0 228 moveto (0585   asm volatile\("movl %%cr2,%0" : "=r" \(val\)\);) show
0 216 moveto (0586   return val;) show
0 204 moveto (0587 }) show
0 192 moveto (0588 ) show
0 180 moveto (0589 static inline void) show
0 168 moveto (0590 lcr3\(uint val\)) show
0 156 moveto (0591 {) show
0 144 moveto (0592   asm volatile\("movl %0,%%cr3" : : "r" \(val\)\);) show
0 132 moveto (0593 }) show
0 120 moveto (0594 ) show
0 108 moveto (0595 ) show
0 96 moveto (0596 ) show
0 84 moveto (0597 ) show
0 72 moveto (0598 ) show
0 60 moveto (0599 ) show
0 24 moveto (Sheet 05) show
grestore
restore
showpage
%%Page: 15 15
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/x86.h  Page 4) show
0 648 moveto (0600 // Layout of the trap frame built on the stack by the) show
0 636 moveto (0601 // hardware and by trapasm.S, and passed to trap\(\).) show
0 624 moveto (0602 struct trapframe {) show
0 612 moveto (0603   // registers as pushed by pusha) show
0 600 moveto (0604   uint edi;) show
0 588 moveto (0605   uint esi;) show
0 576 moveto (0606   uint ebp;) show
0 564 moveto (0607   uint oesp;      // useless & ignored) show
0 552 moveto (0608   uint ebx;) show
0 540 moveto (0609   uint edx;) show
0 528 moveto (0610   uint ecx;) show
0 516 moveto (0611   uint eax;) show
0 504 moveto (0612 ) show
0 492 moveto (0613   // rest of trap frame) show
0 480 moveto (0614   ushort gs;) show
0 468 moveto (0615   ushort padding1;) show
0 456 moveto (0616   ushort fs;) show
0 444 moveto (0617   ushort padding2;) show
0 432 moveto (0618   ushort es;) show
0 420 moveto (0619   ushort padding3;) show
0 408 moveto (0620   ushort ds;) show
0 396 moveto (0621   ushort padding4;) show
0 384 moveto (0622   uint trapno;) show
0 372 moveto (0623 ) show
0 360 moveto (0624   // below here defined by x86 hardware) show
0 348 moveto (0625   uint err;) show
0 336 moveto (0626   uint eip;) show
0 324 moveto (0627   ushort cs;) show
0 312 moveto (0628   ushort padding5;) show
0 300 moveto (0629   uint eflags;) show
0 288 moveto (0630 ) show
0 276 moveto (0631   // below here only when crossing rings, such as from user to kernel) show
0 264 moveto (0632   uint esp;) show
0 252 moveto (0633   ushort ss;) show
0 240 moveto (0634   ushort padding6;) show
0 228 moveto (0635 };) show
0 216 moveto (0636 ) show
0 204 moveto (0637 ) show
0 192 moveto (0638 ) show
0 180 moveto (0639 ) show
0 168 moveto (0640 ) show
0 156 moveto (0641 ) show
0 144 moveto (0642 ) show
0 132 moveto (0643 ) show
0 120 moveto (0644 ) show
0 108 moveto (0645 ) show
0 96 moveto (0646 ) show
0 84 moveto (0647 ) show
0 72 moveto (0648 ) show
0 60 moveto (0649 ) show
0 24 moveto (Sheet 06) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/asm.h  Page 1) show
0 648 moveto (0650 //) show
0 636 moveto (0651 // assembler macros to create x86 segments) show
0 624 moveto (0652 //) show
0 612 moveto (0653 ) show
0 600 moveto (0654 #define SEG_NULLASM                                             \\) show
0 588 moveto (0655         .word 0, 0;                                             \\) show
0 576 moveto (0656         .byte 0, 0, 0, 0) show
0 564 moveto (0657 ) show
0 552 moveto (0658 // The 0xC0 means the limit is in 4096-byte units) show
0 540 moveto (0659 // and \(for executable segments\) 32-bit mode.) show
0 528 moveto (0660 #define SEG_ASM\(type,base,lim\)                                  \\) show
0 516 moveto (0661         .word \(\(\(lim\) >> 12\) & 0xffff\), \(\(base\) & 0xffff\);      \\) show
0 504 moveto (0662         .byte \(\(\(base\) >> 16\) & 0xff\), \(0x90 | \(type\)\),         \\) show
0 492 moveto (0663                 \(0xC0 | \(\(\(lim\) >> 28\) & 0xf\)\), \(\(\(base\) >> 24\) & 0xff\)) show
0 480 moveto (0664 ) show
0 468 moveto (0665 #define STA_X     0x8       // Executable segment) show
0 456 moveto (0666 #define STA_W     0x2       // Writeable \(non-executable segments\)) show
0 444 moveto (0667 #define STA_R     0x2       // Readable \(executable segments\)) show
0 432 moveto (0668 ) show
0 420 moveto (0669 ) show
0 408 moveto (0670 ) show
0 396 moveto (0671 ) show
0 384 moveto (0672 ) show
0 372 moveto (0673 ) show
0 360 moveto (0674 ) show
0 348 moveto (0675 ) show
0 336 moveto (0676 ) show
0 324 moveto (0677 ) show
0 312 moveto (0678 ) show
0 300 moveto (0679 ) show
0 288 moveto (0680 ) show
0 276 moveto (0681 ) show
0 264 moveto (0682 ) show
0 252 moveto (0683 ) show
0 240 moveto (0684 ) show
0 228 moveto (0685 ) show
0 216 moveto (0686 ) show
0 204 moveto (0687 ) show
0 192 moveto (0688 ) show
0 180 moveto (0689 ) show
0 168 moveto (0690 ) show
0 156 moveto (0691 ) show
0 144 moveto (0692 ) show
0 132 moveto (0693 ) show
0 120 moveto (0694 ) show
0 108 moveto (0695 ) show
0 96 moveto (0696 ) show
0 84 moveto (0697 ) show
0 72 moveto (0698 ) show
0 60 moveto (0699 ) show
0 24 moveto (Sheet 06) show
grestore
restore
showpage
%%Page: 16 16
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mmu.h  Page 1) show
0 648 moveto (0700 // This file contains definitions for the) show
0 636 moveto (0701 // x86 memory management unit \(MMU\).) show
0 624 moveto (0702 ) show
0 612 moveto (0703 // Eflags register) show
0 600 moveto (0704 #define FL_IF           0x00000200      // Interrupt Enable) show
0 588 moveto (0705 ) show
0 576 moveto (0706 // Control Register flags) show
0 564 moveto (0707 #define CR0_PE          0x00000001      // Protection Enable) show
0 552 moveto (0708 #define CR0_WP          0x00010000      // Write Protect) show
0 540 moveto (0709 #define CR0_PG          0x80000000      // Paging) show
0 528 moveto (0710 ) show
0 516 moveto (0711 #define CR4_PSE         0x00000010      // Page size extension) show
0 504 moveto (0712 ) show
0 492 moveto (0713 // various segment selectors.) show
0 480 moveto (0714 #define SEG_KCODE 1  // kernel code) show
0 468 moveto (0715 #define SEG_KDATA 2  // kernel data+stack) show
0 456 moveto (0716 #define SEG_UCODE 3  // user code) show
0 444 moveto (0717 #define SEG_UDATA 4  // user data+stack) show
0 432 moveto (0718 #define SEG_TSS   5  // this process's task state) show
0 420 moveto (0719 ) show
0 408 moveto (0720 // cpu->gdt[NSEGS] holds the above segments.) show
0 396 moveto (0721 #define NSEGS     6) show
0 384 moveto (0722 ) show
0 372 moveto (0723 #ifndef __ASSEMBLER__) show
0 360 moveto (0724 // Segment Descriptor) show
0 348 moveto (0725 struct segdesc {) show
0 336 moveto (0726   uint lim_15_0 : 16;  // Low bits of segment limit) show
0 324 moveto (0727   uint base_15_0 : 16; // Low bits of segment base address) show
0 312 moveto (0728   uint base_23_16 : 8; // Middle bits of segment base address) show
0 300 moveto (0729   uint type : 4;       // Segment type \(see STS_ constants\)) show
0 288 moveto (0730   uint s : 1;          // 0 = system, 1 = application) show
0 276 moveto (0731   uint dpl : 2;        // Descriptor Privilege Level) show
0 264 moveto (0732   uint p : 1;          // Present) show
0 252 moveto (0733   uint lim_19_16 : 4;  // High bits of segment limit) show
0 240 moveto (0734   uint avl : 1;        // Unused \(available for software use\)) show
0 228 moveto (0735   uint rsv1 : 1;       // Reserved) show
0 216 moveto (0736   uint db : 1;         // 0 = 16-bit segment, 1 = 32-bit segment) show
0 204 moveto (0737   uint g : 1;          // Granularity: limit scaled by 4K when set) show
0 192 moveto (0738   uint base_31_24 : 8; // High bits of segment base address) show
0 180 moveto (0739 };) show
0 168 moveto (0740 ) show
0 156 moveto (0741 ) show
0 144 moveto (0742 ) show
0 132 moveto (0743 ) show
0 120 moveto (0744 ) show
0 108 moveto (0745 ) show
0 96 moveto (0746 ) show
0 84 moveto (0747 ) show
0 72 moveto (0748 ) show
0 60 moveto (0749 ) show
0 24 moveto (Sheet 07) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mmu.h  Page 2) show
0 648 moveto (0750 // Normal segment) show
0 636 moveto (0751 #define SEG\(type, base, lim, dpl\) \(struct segdesc\)    \\) show
0 624 moveto (0752 { \(\(lim\) >> 12\) & 0xffff, \(uint\)\(base\) & 0xffff,      \\) show
0 612 moveto (0753   \(\(uint\)\(base\) >> 16\) & 0xff, type, 1, dpl, 1,       \\) show
0 600 moveto (0754   \(uint\)\(lim\) >> 28, 0, 0, 1, 1, \(uint\)\(base\) >> 24 }) show
0 588 moveto (0755 #define SEG16\(type, base, lim, dpl\) \(struct segdesc\)  \\) show
0 576 moveto (0756 { \(lim\) & 0xffff, \(uint\)\(base\) & 0xffff,              \\) show
0 564 moveto (0757   \(\(uint\)\(base\) >> 16\) & 0xff, type, 1, dpl, 1,       \\) show
0 552 moveto (0758   \(uint\)\(lim\) >> 16, 0, 0, 1, 0, \(uint\)\(base\) >> 24 }) show
0 540 moveto (0759 #endif) show
0 528 moveto (0760 ) show
0 516 moveto (0761 #define DPL_USER    0x3     // User DPL) show
0 504 moveto (0762 ) show
0 492 moveto (0763 // Application segment type bits) show
0 480 moveto (0764 #define STA_X       0x8     // Executable segment) show
0 468 moveto (0765 #define STA_W       0x2     // Writeable \(non-executable segments\)) show
0 456 moveto (0766 #define STA_R       0x2     // Readable \(executable segments\)) show
0 444 moveto (0767 ) show
0 432 moveto (0768 // System segment type bits) show
0 420 moveto (0769 #define STS_T32A    0x9     // Available 32-bit TSS) show
0 408 moveto (0770 #define STS_IG32    0xE     // 32-bit Interrupt Gate) show
0 396 moveto (0771 #define STS_TG32    0xF     // 32-bit Trap Gate) show
0 384 moveto (0772 ) show
0 372 moveto (0773 // A virtual address 'la' has a three-part structure as follows:) show
0 360 moveto (0774 //) show
0 348 moveto (0775 // +--------10------+-------10-------+---------12----------+) show
0 336 moveto (0776 // | Page Directory |   Page Table   | Offset within Page  |) show
0 324 moveto (0777 // |      Index     |      Index     |                     |) show
0 312 moveto (0778 // +----------------+----------------+---------------------+) show
0 300 moveto (0779 //  \\--- PDX\(va\) --/ \\--- PTX\(va\) --/) show
0 288 moveto (0780 ) show
0 276 moveto (0781 // page directory index) show
0 264 moveto (0782 #define PDX\(va\)         \(\(\(uint\)\(va\) >> PDXSHIFT\) & 0x3FF\)) show
0 252 moveto (0783 ) show
0 240 moveto (0784 // page table index) show
0 228 moveto (0785 #define PTX\(va\)         \(\(\(uint\)\(va\) >> PTXSHIFT\) & 0x3FF\)) show
0 216 moveto (0786 ) show
0 204 moveto (0787 // construct virtual address from indexes and offset) show
0 192 moveto (0788 #define PGADDR\(d, t, o\) \(\(uint\)\(\(d\) << PDXSHIFT | \(t\) << PTXSHIFT | \(o\)\)\)) show
0 180 moveto (0789 ) show
0 168 moveto (0790 // Page directory and page table constants.) show
0 156 moveto (0791 #define NPDENTRIES      1024    // # directory entries per page directory) show
0 144 moveto (0792 #define NPTENTRIES      1024    // # PTEs per page table) show
0 132 moveto (0793 #define PGSIZE          4096    // bytes mapped by a page) show
0 120 moveto (0794 ) show
0 108 moveto (0795 #define PTXSHIFT        12      // offset of PTX in a linear address) show
0 96 moveto (0796 #define PDXSHIFT        22      // offset of PDX in a linear address) show
0 84 moveto (0797 ) show
0 72 moveto (0798 #define PGROUNDUP\(sz\)  \(\(\(sz\)+PGSIZE-1\) & ~\(PGSIZE-1\)\)) show
0 60 moveto (0799 #define PGROUNDDOWN\(a\) \(\(\(a\)\) & ~\(PGSIZE-1\)\)) show
0 24 moveto (Sheet 07) show
grestore
restore
showpage
%%Page: 17 17
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mmu.h  Page 3) show
0 648 moveto (0800 // Page table/directory entry flags.) show
0 636 moveto (0801 #define PTE_P           0x001   // Present) show
0 624 moveto (0802 #define PTE_W           0x002   // Writeable) show
0 612 moveto (0803 #define PTE_U           0x004   // User) show
0 600 moveto (0804 #define PTE_PS          0x080   // Page Size) show
0 588 moveto (0805 ) show
0 576 moveto (0806 // Address in page table or page directory entry) show
0 564 moveto (0807 #define PTE_ADDR\(pte\)   \(\(uint\)\(pte\) & ~0xFFF\)) show
0 552 moveto (0808 #define PTE_FLAGS\(pte\)  \(\(uint\)\(pte\) &  0xFFF\)) show
0 540 moveto (0809 ) show
0 528 moveto (0810 #ifndef __ASSEMBLER__) show
0 516 moveto (0811 typedef uint pte_t;) show
0 504 moveto (0812 ) show
0 492 moveto (0813 // Task state segment format) show
0 480 moveto (0814 struct taskstate {) show
0 468 moveto (0815   uint link;         // Old ts selector) show
0 456 moveto (0816   uint esp0;         // Stack pointers and segment selectors) show
0 444 moveto (0817   ushort ss0;        //   after an increase in privilege level) show
0 432 moveto (0818   ushort padding1;) show
0 420 moveto (0819   uint *esp1;) show
0 408 moveto (0820   ushort ss1;) show
0 396 moveto (0821   ushort padding2;) show
0 384 moveto (0822   uint *esp2;) show
0 372 moveto (0823   ushort ss2;) show
0 360 moveto (0824   ushort padding3;) show
0 348 moveto (0825   void *cr3;         // Page directory base) show
0 336 moveto (0826   uint *eip;         // Saved state from last task switch) show
0 324 moveto (0827   uint eflags;) show
0 312 moveto (0828   uint eax;          // More saved state \(registers\)) show
0 300 moveto (0829   uint ecx;) show
0 288 moveto (0830   uint edx;) show
0 276 moveto (0831   uint ebx;) show
0 264 moveto (0832   uint *esp;) show
0 252 moveto (0833   uint *ebp;) show
0 240 moveto (0834   uint esi;) show
0 228 moveto (0835   uint edi;) show
0 216 moveto (0836   ushort es;         // Even more saved state \(segment selectors\)) show
0 204 moveto (0837   ushort padding4;) show
0 192 moveto (0838   ushort cs;) show
0 180 moveto (0839   ushort padding5;) show
0 168 moveto (0840   ushort ss;) show
0 156 moveto (0841   ushort padding6;) show
0 144 moveto (0842   ushort ds;) show
0 132 moveto (0843   ushort padding7;) show
0 120 moveto (0844   ushort fs;) show
0 108 moveto (0845   ushort padding8;) show
0 96 moveto (0846   ushort gs;) show
0 84 moveto (0847   ushort padding9;) show
0 72 moveto (0848   ushort ldt;) show
0 60 moveto (0849   ushort padding10;) show
0 24 moveto (Sheet 08) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mmu.h  Page 4) show
0 648 moveto (0850   ushort t;          // Trap on task switch) show
0 636 moveto (0851   ushort iomb;       // I/O map base address) show
0 624 moveto (0852 };) show
0 612 moveto (0853 ) show
0 600 moveto (0854 // Gate descriptors for interrupts and traps) show
0 588 moveto (0855 struct gatedesc {) show
0 576 moveto (0856   uint off_15_0 : 16;   // low 16 bits of offset in segment) show
0 564 moveto (0857   uint cs : 16;         // code segment selector) show
0 552 moveto (0858   uint args : 5;        // # args, 0 for interrupt/trap gates) show
0 540 moveto (0859   uint rsv1 : 3;        // reserved\(should be zero I guess\)) show
0 528 moveto (0860   uint type : 4;        // type\(STS_{IG32,TG32}\)) show
0 516 moveto (0861   uint s : 1;           // must be 0 \(system\)) show
0 504 moveto (0862   uint dpl : 2;         // descriptor\(meaning new\) privilege level) show
0 492 moveto (0863   uint p : 1;           // Present) show
0 480 moveto (0864   uint off_31_16 : 16;  // high bits of offset in segment) show
0 468 moveto (0865 };) show
0 456 moveto (0866 ) show
0 444 moveto (0867 // Set up a normal interrupt/trap gate descriptor.) show
0 432 moveto (0868 // - istrap: 1 for a trap \(= exception\) gate, 0 for an interrupt gate.) show
0 420 moveto (0869 //   interrupt gate clears FL_IF, trap gate leaves FL_IF alone) show
0 408 moveto (0870 // - sel: Code segment selector for interrupt/trap handler) show
0 396 moveto (0871 // - off: Offset in code segment for interrupt/trap handler) show
0 384 moveto (0872 // - dpl: Descriptor Privilege Level -) show
0 372 moveto (0873 //        the privilege level required for software to invoke) show
0 360 moveto (0874 //        this interrupt/trap gate explicitly using an int instruction.) show
0 348 moveto (0875 #define SETGATE\(gate, istrap, sel, off, d\)                \\) show
0 336 moveto (0876 {                                                         \\) show
0 324 moveto (0877   \(gate\).off_15_0 = \(uint\)\(off\) & 0xffff;                \\) show
0 312 moveto (0878   \(gate\).cs = \(sel\);                                      \\) show
0 300 moveto (0879   \(gate\).args = 0;                                        \\) show
0 288 moveto (0880   \(gate\).rsv1 = 0;                                        \\) show
0 276 moveto (0881   \(gate\).type = \(istrap\) ? STS_TG32 : STS_IG32;           \\) show
0 264 moveto (0882   \(gate\).s = 0;                                           \\) show
0 252 moveto (0883   \(gate\).dpl = \(d\);                                       \\) show
0 240 moveto (0884   \(gate\).p = 1;                                           \\) show
0 228 moveto (0885   \(gate\).off_31_16 = \(uint\)\(off\) >> 16;                  \\) show
0 216 moveto (0886 }) show
0 204 moveto (0887 ) show
0 192 moveto (0888 #endif) show
0 180 moveto (0889 ) show
0 168 moveto (0890 ) show
0 156 moveto (0891 ) show
0 144 moveto (0892 ) show
0 132 moveto (0893 ) show
0 120 moveto (0894 ) show
0 108 moveto (0895 ) show
0 96 moveto (0896 ) show
0 84 moveto (0897 ) show
0 72 moveto (0898 ) show
0 60 moveto (0899 ) show
0 24 moveto (Sheet 08) show
grestore
restore
showpage
%%Page: 18 18
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/elf.h  Page 1) show
0 648 moveto (0900 // Format of an ELF executable file) show
0 636 moveto (0901 ) show
0 624 moveto (0902 #define ELF_MAGIC 0x464C457FU  // "\\x7FELF" in little endian) show
0 612 moveto (0903 ) show
0 600 moveto (0904 // File header) show
0 588 moveto (0905 struct elfhdr {) show
0 576 moveto (0906   uint magic;  // must equal ELF_MAGIC) show
0 564 moveto (0907   uchar elf[12];) show
0 552 moveto (0908   ushort type;) show
0 540 moveto (0909   ushort machine;) show
0 528 moveto (0910   uint version;) show
0 516 moveto (0911   uint entry;) show
0 504 moveto (0912   uint phoff;) show
0 492 moveto (0913   uint shoff;) show
0 480 moveto (0914   uint flags;) show
0 468 moveto (0915   ushort ehsize;) show
0 456 moveto (0916   ushort phentsize;) show
0 444 moveto (0917   ushort phnum;) show
0 432 moveto (0918   ushort shentsize;) show
0 420 moveto (0919   ushort shnum;) show
0 408 moveto (0920   ushort shstrndx;) show
0 396 moveto (0921 };) show
0 384 moveto (0922 ) show
0 372 moveto (0923 // Program section header) show
0 360 moveto (0924 struct proghdr {) show
0 348 moveto (0925   uint type;) show
0 336 moveto (0926   uint off;) show
0 324 moveto (0927   uint vaddr;) show
0 312 moveto (0928   uint paddr;) show
0 300 moveto (0929   uint filesz;) show
0 288 moveto (0930   uint memsz;) show
0 276 moveto (0931   uint flags;) show
0 264 moveto (0932   uint align;) show
0 252 moveto (0933 };) show
0 240 moveto (0934 ) show
0 228 moveto (0935 // Values for Proghdr type) show
0 216 moveto (0936 #define ELF_PROG_LOAD           1) show
0 204 moveto (0937 ) show
0 192 moveto (0938 // Flag bits for Proghdr flags) show
0 180 moveto (0939 #define ELF_PROG_FLAG_EXEC      1) show
0 168 moveto (0940 #define ELF_PROG_FLAG_WRITE     2) show
0 156 moveto (0941 #define ELF_PROG_FLAG_READ      4) show
0 144 moveto (0942 ) show
0 132 moveto (0943 ) show
0 120 moveto (0944 ) show
0 108 moveto (0945 ) show
0 96 moveto (0946 ) show
0 84 moveto (0947 ) show
0 72 moveto (0948 ) show
0 60 moveto (0949 ) show
0 24 moveto (Sheet 09) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/date.h  Page 1) show
0 648 moveto (0950 struct rtcdate {) show
0 636 moveto (0951   uint second;) show
0 624 moveto (0952   uint minute;) show
0 612 moveto (0953   uint hour;) show
0 600 moveto (0954   uint day;) show
0 588 moveto (0955   uint month;) show
0 576 moveto (0956   uint year;) show
0 564 moveto (0957 };) show
0 552 moveto (0958 ) show
0 540 moveto (0959 ) show
0 528 moveto (0960 ) show
0 516 moveto (0961 ) show
0 504 moveto (0962 ) show
0 492 moveto (0963 ) show
0 480 moveto (0964 ) show
0 468 moveto (0965 ) show
0 456 moveto (0966 ) show
0 444 moveto (0967 ) show
0 432 moveto (0968 ) show
0 420 moveto (0969 ) show
0 408 moveto (0970 ) show
0 396 moveto (0971 ) show
0 384 moveto (0972 ) show
0 372 moveto (0973 ) show
0 360 moveto (0974 ) show
0 348 moveto (0975 ) show
0 336 moveto (0976 ) show
0 324 moveto (0977 ) show
0 312 moveto (0978 ) show
0 300 moveto (0979 ) show
0 288 moveto (0980 ) show
0 276 moveto (0981 ) show
0 264 moveto (0982 ) show
0 252 moveto (0983 ) show
0 240 moveto (0984 ) show
0 228 moveto (0985 ) show
0 216 moveto (0986 ) show
0 204 moveto (0987 ) show
0 192 moveto (0988 ) show
0 180 moveto (0989 ) show
0 168 moveto (0990 ) show
0 156 moveto (0991 ) show
0 144 moveto (0992 ) show
0 132 moveto (0993 ) show
0 120 moveto (0994 ) show
0 108 moveto (0995 ) show
0 96 moveto (0996 ) show
0 84 moveto (0997 ) show
0 72 moveto (0998 ) show
0 60 moveto (0999 ) show
0 24 moveto (Sheet 09) show
grestore
restore
showpage
%%Page: 19 19
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/entry.S  Page 1) show
0 648 moveto (1000 # The xv6 kernel starts executing in this file. This file is linked with) show
0 636 moveto (1001 # the kernel C code, so it can refer to kernel symbols such as main\(\).) show
0 624 moveto (1002 # The boot block \(bootasm.S and bootmain.c\) jumps to entry below.) show
0 612 moveto (1003 ) show
0 600 moveto (1004 # Multiboot header, for multiboot boot loaders like GNU Grub.) show
0 588 moveto (1005 # http://www.gnu.org/software/grub/manual/multiboot/multiboot.html) show
0 576 moveto (1006 #) show
0 564 moveto (1007 # Using GRUB 2, you can boot xv6 from a file stored in a) show
0 552 moveto (1008 # Linux file system by copying kernel or kernelmemfs to /boot) show
0 540 moveto (1009 # and then adding this menu entry:) show
0 528 moveto (1010 #) show
0 516 moveto (1011 # menuentry "xv6" {) show
0 504 moveto (1012 # ) show
8 mp_a_x mul 504 moveto (insmod ext2) show
0 492 moveto (1013 # ) show
8 mp_a_x mul 492 moveto (set root='\(hd0,msdos1\)') show
0 480 moveto (1014 # ) show
8 mp_a_x mul 480 moveto (set kernel='/boot/kernel') show
0 468 moveto (1015 # ) show
8 mp_a_x mul 468 moveto (echo "Loading ${kernel}...") show
0 456 moveto (1016 # ) show
8 mp_a_x mul 456 moveto (multiboot ${kernel} ${kernel}) show
0 444 moveto (1017 # ) show
8 mp_a_x mul 444 moveto (boot) show
0 432 moveto (1018 # }) show
0 420 moveto (1019 ) show
0 408 moveto (1020 #include "asm.h") show
0 396 moveto (1021 #include "memlayout.h") show
0 384 moveto (1022 #include "mmu.h") show
0 372 moveto (1023 #include "param.h") show
0 360 moveto (1024 ) show
0 348 moveto (1025 # Multiboot header.  Data to direct multiboot loader.) show
0 336 moveto (1026 .p2align 2) show
0 324 moveto (1027 .text) show
0 312 moveto (1028 .globl multiboot_header) show
0 300 moveto (1029 multiboot_header:) show
0 288 moveto (1030   #define magic 0x1badb002) show
0 276 moveto (1031   #define flags 0) show
0 264 moveto (1032   .long magic) show
0 252 moveto (1033   .long flags) show
0 240 moveto (1034   .long \(-magic-flags\)) show
0 228 moveto (1035 ) show
0 216 moveto (1036 # By convention, the _start symbol specifies the ELF entry point.) show
0 204 moveto (1037 # Since we haven't set up virtual memory yet, our entry point is) show
0 192 moveto (1038 # the physical address of 'entry'.) show
0 180 moveto (1039 .globl _start) show
0 168 moveto (1040 _start = V2P_WO\(entry\)) show
0 156 moveto (1041 ) show
0 144 moveto (1042 # Entering xv6 on boot processor, with paging off.) show
0 132 moveto (1043 .globl entry) show
0 120 moveto (1044 entry:) show
0 108 moveto (1045   # Turn on page size extension for 4Mbyte pages) show
0 96 moveto (1046   movl    %cr4, %eax) show
0 84 moveto (1047   orl     $\(CR4_PSE\), %eax) show
0 72 moveto (1048   movl    %eax, %cr4) show
0 60 moveto (1049   # Set page directory) show
0 24 moveto (Sheet 10) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/entry.S  Page 2) show
0 648 moveto (1050   movl    $\(V2P_WO\(entrypgdir\)\), %eax) show
0 636 moveto (1051   movl    %eax, %cr3) show
0 624 moveto (1052   # Turn on paging.) show
0 612 moveto (1053   movl    %cr0, %eax) show
0 600 moveto (1054   orl     $\(CR0_PG|CR0_WP\), %eax) show
0 588 moveto (1055   movl    %eax, %cr0) show
0 576 moveto (1056 ) show
0 564 moveto (1057   # Set up the stack pointer.) show
0 552 moveto (1058   movl $\(stack + KSTACKSIZE\), %esp) show
0 540 moveto (1059 ) show
0 528 moveto (1060   # Jump to main\(\), and switch to executing at) show
0 516 moveto (1061   # high addresses. The indirect call is needed because) show
0 504 moveto (1062   # the assembler produces a PC-relative instruction) show
0 492 moveto (1063   # for a direct jump.) show
0 480 moveto (1064   mov $main, %eax) show
0 468 moveto (1065   jmp *%eax) show
0 456 moveto (1066 ) show
0 444 moveto (1067 .comm stack, KSTACKSIZE) show
0 432 moveto (1068 ) show
0 420 moveto (1069 ) show
0 408 moveto (1070 ) show
0 396 moveto (1071 ) show
0 384 moveto (1072 ) show
0 372 moveto (1073 ) show
0 360 moveto (1074 ) show
0 348 moveto (1075 ) show
0 336 moveto (1076 ) show
0 324 moveto (1077 ) show
0 312 moveto (1078 ) show
0 300 moveto (1079 ) show
0 288 moveto (1080 ) show
0 276 moveto (1081 ) show
0 264 moveto (1082 ) show
0 252 moveto (1083 ) show
0 240 moveto (1084 ) show
0 228 moveto (1085 ) show
0 216 moveto (1086 ) show
0 204 moveto (1087 ) show
0 192 moveto (1088 ) show
0 180 moveto (1089 ) show
0 168 moveto (1090 ) show
0 156 moveto (1091 ) show
0 144 moveto (1092 ) show
0 132 moveto (1093 ) show
0 120 moveto (1094 ) show
0 108 moveto (1095 ) show
0 96 moveto (1096 ) show
0 84 moveto (1097 ) show
0 72 moveto (1098 ) show
0 60 moveto (1099 ) show
0 24 moveto (Sheet 10) show
grestore
restore
showpage
%%Page: 20 20
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/entryother.S  Page 1) show
0 648 moveto (1100 #include "asm.h") show
0 636 moveto (1101 #include "memlayout.h") show
0 624 moveto (1102 #include "mmu.h") show
0 612 moveto (1103 ) show
0 600 moveto (1104 # Each non-boot CPU \("AP"\) is started up in response to a STARTUP) show
0 588 moveto (1105 # IPI from the boot CPU.  Section B.4.2 of the Multi-Processor) show
0 576 moveto (1106 # Specification says that the AP will start in real mode with CS:IP) show
0 564 moveto (1107 # set to XY00:0000, where XY is an 8-bit value sent with the) show
0 552 moveto (1108 # STARTUP. Thus this code must start at a 4096-byte boundary.) show
0 540 moveto (1109 #) show
0 528 moveto (1110 # Because this code sets DS to zero, it must sit) show
0 516 moveto (1111 # at an address in the low 2^16 bytes.) show
0 504 moveto (1112 #) show
0 492 moveto (1113 # Startothers \(in main.c\) sends the STARTUPs one at a time.) show
0 480 moveto (1114 # It copies this code \(start\) at 0x7000.  It puts the address of) show
0 468 moveto (1115 # a newly allocated per-core stack in start-4,the address of the) show
0 456 moveto (1116 # place to jump to \(mpenter\) in start-8, and the physical address) show
0 444 moveto (1117 # of entrypgdir in start-12.) show
0 432 moveto (1118 #) show
0 420 moveto (1119 # This code combines elements of bootasm.S and entry.S.) show
0 408 moveto (1120 ) show
0 396 moveto (1121 .code16) show
0 384 moveto (1122 .globl start) show
0 372 moveto (1123 start:) show
0 360 moveto (1124   cli) show
0 348 moveto (1125 ) show
0 336 moveto (1126   # Zero data segment registers DS, ES, and SS.) show
0 324 moveto (1127   xorw    %ax,%ax) show
0 312 moveto (1128   movw    %ax,%ds) show
0 300 moveto (1129   movw    %ax,%es) show
0 288 moveto (1130   movw    %ax,%ss) show
0 276 moveto (1131 ) show
0 264 moveto (1132   # Switch from real to protected mode.  Use a bootstrap GDT that makes) show
0 252 moveto (1133   # virtual addresses map directly to physical addresses so that the) show
0 240 moveto (1134   # effective memory map doesn't change during the transition.) show
0 228 moveto (1135   lgdt    gdtdesc) show
0 216 moveto (1136   movl    %cr0, %eax) show
0 204 moveto (1137   orl     $CR0_PE, %eax) show
0 192 moveto (1138   movl    %eax, %cr0) show
0 180 moveto (1139 ) show
0 168 moveto (1140   # Complete the transition to 32-bit protected mode by using a long jmp) show
0 156 moveto (1141   # to reload %cs and %eip.  The segment descriptors are set up with no) show
0 144 moveto (1142   # translation, so that the mapping is still the identity mapping.) show
0 132 moveto (1143   ljmpl    $\(SEG_KCODE<<3\), $\(start32\)) show
0 120 moveto (1144 ) show
0 108 moveto (1145 ) show
0 96 moveto (1146 ) show
0 84 moveto (1147 ) show
0 72 moveto (1148 ) show
0 60 moveto (1149 ) show
0 24 moveto (Sheet 11) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/entryother.S  Page 2) show
0 648 moveto (1150 .code32  # Tell assembler to generate 32-bit code now.) show
0 636 moveto (1151 start32:) show
0 624 moveto (1152   # Set up the protected-mode data segment registers) show
0 612 moveto (1153   movw    $\(SEG_KDATA<<3\), %ax    # Our data segment selector) show
0 600 moveto (1154   movw    %ax, %ds                # -> DS: Data Segment) show
0 588 moveto (1155   movw    %ax, %es                # -> ES: Extra Segment) show
0 576 moveto (1156   movw    %ax, %ss                # -> SS: Stack Segment) show
0 564 moveto (1157   movw    $0, %ax                 # Zero segments not ready for use) show
0 552 moveto (1158   movw    %ax, %fs                # -> FS) show
0 540 moveto (1159   movw    %ax, %gs                # -> GS) show
0 528 moveto (1160 ) show
0 516 moveto (1161   # Turn on page size extension for 4Mbyte pages) show
0 504 moveto (1162   movl    %cr4, %eax) show
0 492 moveto (1163   orl     $\(CR4_PSE\), %eax) show
0 480 moveto (1164   movl    %eax, %cr4) show
0 468 moveto (1165   # Use entrypgdir as our initial page table) show
0 456 moveto (1166   movl    \(start-12\), %eax) show
0 444 moveto (1167   movl    %eax, %cr3) show
0 432 moveto (1168   # Turn on paging.) show
0 420 moveto (1169   movl    %cr0, %eax) show
0 408 moveto (1170   orl     $\(CR0_PE|CR0_PG|CR0_WP\), %eax) show
0 396 moveto (1171   movl    %eax, %cr0) show
0 384 moveto (1172 ) show
0 372 moveto (1173   # Switch to the stack allocated by startothers\(\)) show
0 360 moveto (1174   movl    \(start-4\), %esp) show
0 348 moveto (1175   # Call mpenter\(\)) show
0 336 moveto (1176   call) show
17 mp_a_x mul 336 moveto (*\(start-8\)) show
0 324 moveto (1177 ) show
0 312 moveto (1178   movw    $0x8a00, %ax) show
0 300 moveto (1179   movw    %ax, %dx) show
0 288 moveto (1180   outw    %ax, %dx) show
0 276 moveto (1181   movw    $0x8ae0, %ax) show
0 264 moveto (1182   outw    %ax, %dx) show
0 252 moveto (1183 spin:) show
0 240 moveto (1184   jmp     spin) show
0 228 moveto (1185 ) show
0 216 moveto (1186 .p2align 2) show
0 204 moveto (1187 gdt:) show
0 192 moveto (1188   SEG_NULLASM) show
0 180 moveto (1189   SEG_ASM\(STA_X|STA_R, 0, 0xffffffff\)) show
0 168 moveto (1190   SEG_ASM\(STA_W, 0, 0xffffffff\)) show
0 156 moveto (1191 ) show
0 144 moveto (1192 ) show
0 132 moveto (1193 gdtdesc:) show
0 120 moveto (1194   .word   \(gdtdesc - gdt - 1\)) show
0 108 moveto (1195   .long   gdt) show
0 96 moveto (1196 ) show
0 84 moveto (1197 ) show
0 72 moveto (1198 ) show
0 60 moveto (1199 ) show
0 24 moveto (Sheet 11) show
grestore
restore
showpage
%%Page: 21 21
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/main.c  Page 1) show
0 648 moveto (1200 #include "types.h") show
0 636 moveto (1201 #include "defs.h") show
0 624 moveto (1202 #include "param.h") show
0 612 moveto (1203 #include "memlayout.h") show
0 600 moveto (1204 #include "mmu.h") show
0 588 moveto (1205 #include "proc.h") show
0 576 moveto (1206 #include "x86.h") show
0 564 moveto (1207 ) show
0 552 moveto (1208 static void startothers\(void\);) show
0 540 moveto (1209 static void mpmain\(void\)  __attribute__\(\(noreturn\)\);) show
0 528 moveto (1210 extern pde_t *kpgdir;) show
0 516 moveto (1211 extern char end[]; // first address after kernel loaded from ELF file) show
0 504 moveto (1212 ) show
0 492 moveto (1213 // Bootstrap processor starts running C code here.) show
0 480 moveto (1214 // Allocate a real stack and switch to it, first) show
0 468 moveto (1215 // doing some setup required for memory allocator to work.) show
0 456 moveto (1216 int) show
0 444 moveto (1217 main\(void\)) show
0 432 moveto (1218 {) show
0 420 moveto (1219   kinit1\(end, P2V\(4*1024*1024\)\); // phys page allocator) show
0 408 moveto (1220   kvmalloc\(\);      // kernel page table) show
0 396 moveto (1221   mpinit\(\);        // detect other processors) show
0 384 moveto (1222   lapicinit\(\);     // interrupt controller) show
0 372 moveto (1223   seginit\(\);       // segment descriptors) show
0 360 moveto (1224   picinit\(\);       // disable pic) show
0 348 moveto (1225   ioapicinit\(\);    // another interrupt controller) show
0 336 moveto (1226   consoleinit\(\);   // console hardware) show
0 324 moveto (1227   uartinit\(\);      // serial port) show
0 312 moveto (1228   pinit\(\);         // process table) show
0 300 moveto (1229   tvinit\(\);        // trap vectors) show
0 288 moveto (1230   binit\(\);         // buffer cache) show
0 276 moveto (1231   fileinit\(\);      // file table) show
0 264 moveto (1232   ideinit\(\);       // disk) show
0 252 moveto (1233   startothers\(\);   // start other processors) show
0 240 moveto (1234   kinit2\(P2V\(4*1024*1024\), P2V\(PHYSTOP\)\); // must come after startothers\(\)) show
0 228 moveto (1235   userinit\(\);      // first user process) show
0 216 moveto (1236   mpmain\(\);        // finish this processor's setup) show
0 204 moveto (1237 }) show
0 192 moveto (1238 ) show
0 180 moveto (1239 // Other CPUs jump here from entryother.S.) show
0 168 moveto (1240 static void) show
0 156 moveto (1241 mpenter\(void\)) show
0 144 moveto (1242 {) show
0 132 moveto (1243   switchkvm\(\);) show
0 120 moveto (1244   seginit\(\);) show
0 108 moveto (1245   lapicinit\(\);) show
0 96 moveto (1246   mpmain\(\);) show
0 84 moveto (1247 }) show
0 72 moveto (1248 ) show
0 60 moveto (1249 ) show
0 24 moveto (Sheet 12) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/main.c  Page 2) show
0 648 moveto (1250 // Common CPU setup code.) show
0 636 moveto (1251 static void) show
0 624 moveto (1252 mpmain\(void\)) show
0 612 moveto (1253 {) show
0 600 moveto (1254   cprintf\("cpu%d: starting %d\\n", cpuid\(\), cpuid\(\)\);) show
0 588 moveto (1255   idtinit\(\);       // load idt register) show
0 576 moveto (1256   xchg\(&\(mycpu\(\)->started\), 1\); // tell startothers\(\) we're up) show
0 564 moveto (1257   scheduler\(\);     // start running processes) show
0 552 moveto (1258 }) show
0 540 moveto (1259 ) show
0 528 moveto (1260 pde_t entrypgdir[];  // For entry.S) show
0 516 moveto (1261 ) show
0 504 moveto (1262 // Start the non-boot \(AP\) processors.) show
0 492 moveto (1263 static void) show
0 480 moveto (1264 startothers\(void\)) show
0 468 moveto (1265 {) show
0 456 moveto (1266   extern uchar _binary_entryother_start[], _binary_entryother_size[];) show
0 444 moveto (1267   uchar *code;) show
0 432 moveto (1268   struct cpu *c;) show
0 420 moveto (1269   char *stack;) show
0 408 moveto (1270 ) show
0 396 moveto (1271   // Write entry code to unused memory at 0x7000.) show
0 384 moveto (1272   // The linker has placed the image of entryother.S in) show
0 372 moveto (1273   // _binary_entryother_start.) show
0 360 moveto (1274   code = P2V\(0x7000\);) show
0 348 moveto (1275   memmove\(code, _binary_entryother_start, \(uint\)_binary_entryother_size\);) show
0 336 moveto (1276 ) show
0 324 moveto (1277   for\(c = cpus; c < cpus+ncpu; c++\){) show
0 312 moveto (1278     if\(c == mycpu\(\)\)  // We've started already.) show
0 300 moveto (1279       continue;) show
0 288 moveto (1280 ) show
0 276 moveto (1281     // Tell entryother.S what stack to use, where to enter, and what) show
0 264 moveto (1282     // pgdir to use. We cannot use kpgdir yet, because the AP processor) show
0 252 moveto (1283     // is running in low  memory, so we use entrypgdir for the APs too.) show
0 240 moveto (1284     stack = kalloc\(\);) show
0 228 moveto (1285     *\(void**\)\(code-4\) = stack + KSTACKSIZE;) show
0 216 moveto (1286     *\(void\(**\)\(void\)\)\(code-8\) = mpenter;) show
0 204 moveto (1287     *\(int**\)\(code-12\) = \(void *\) V2P\(entrypgdir\);) show
0 192 moveto (1288 ) show
0 180 moveto (1289     lapicstartap\(c->apicid, V2P\(code\)\);) show
0 168 moveto (1290 ) show
0 156 moveto (1291     // wait for cpu to finish mpmain\(\)) show
0 144 moveto (1292     while\(c->started == 0\)) show
0 132 moveto (1293       ;) show
0 120 moveto (1294   }) show
0 108 moveto (1295 }) show
0 96 moveto (1296 ) show
0 84 moveto (1297 ) show
0 72 moveto (1298 ) show
0 60 moveto (1299 ) show
0 24 moveto (Sheet 12) show
grestore
restore
showpage
%%Page: 22 22
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/main.c  Page 3) show
0 648 moveto (1300 // The boot page table used in entry.S and entryother.S.) show
0 636 moveto (1301 // Page directories \(and page tables\) must start on page boundaries,) show
0 624 moveto (1302 // hence the __aligned__ attribute.) show
0 612 moveto (1303 // PTE_PS in a page directory entry enables 4Mbyte pages.) show
0 600 moveto (1304 ) show
0 588 moveto (1305 __attribute__\(\(__aligned__\(PGSIZE\)\)\)) show
0 576 moveto (1306 pde_t entrypgdir[NPDENTRIES] = {) show
0 564 moveto (1307   // Map VA's [0, 4MB\) to PA's [0, 4MB\)) show
0 552 moveto (1308   [0] = \(0\) | PTE_P | PTE_W | PTE_PS,) show
0 540 moveto (1309   // Map VA's [KERNBASE, KERNBASE+4MB\) to PA's [0, 4MB\)) show
0 528 moveto (1310   [KERNBASE>>PDXSHIFT] = \(0\) | PTE_P | PTE_W | PTE_PS,) show
0 516 moveto (1311 };) show
0 504 moveto (1312 ) show
0 492 moveto (1313 ) show
0 480 moveto (1314 ) show
0 468 moveto (1315 ) show
0 456 moveto (1316 ) show
0 444 moveto (1317 ) show
0 432 moveto (1318 ) show
0 420 moveto (1319 ) show
0 408 moveto (1320 ) show
0 396 moveto (1321 ) show
0 384 moveto (1322 ) show
0 372 moveto (1323 ) show
0 360 moveto (1324 ) show
0 348 moveto (1325 ) show
0 336 moveto (1326 ) show
0 324 moveto (1327 ) show
0 312 moveto (1328 ) show
0 300 moveto (1329 ) show
0 288 moveto (1330 ) show
0 276 moveto (1331 ) show
0 264 moveto (1332 ) show
0 252 moveto (1333 ) show
0 240 moveto (1334 ) show
0 228 moveto (1335 ) show
0 216 moveto (1336 ) show
0 204 moveto (1337 ) show
0 192 moveto (1338 ) show
0 180 moveto (1339 ) show
0 168 moveto (1340 ) show
0 156 moveto (1341 ) show
0 144 moveto (1342 ) show
0 132 moveto (1343 ) show
0 120 moveto (1344 ) show
0 108 moveto (1345 ) show
0 96 moveto (1346 ) show
0 84 moveto (1347 ) show
0 72 moveto (1348 ) show
0 60 moveto (1349 ) show
0 24 moveto (Sheet 13) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/main.c  Page 4) show
0 648 moveto (1350 // Blank page.) show
0 636 moveto (1351 ) show
0 624 moveto (1352 ) show
0 612 moveto (1353 ) show
0 600 moveto (1354 ) show
0 588 moveto (1355 ) show
0 576 moveto (1356 ) show
0 564 moveto (1357 ) show
0 552 moveto (1358 ) show
0 540 moveto (1359 ) show
0 528 moveto (1360 ) show
0 516 moveto (1361 ) show
0 504 moveto (1362 ) show
0 492 moveto (1363 ) show
0 480 moveto (1364 ) show
0 468 moveto (1365 ) show
0 456 moveto (1366 ) show
0 444 moveto (1367 ) show
0 432 moveto (1368 ) show
0 420 moveto (1369 ) show
0 408 moveto (1370 ) show
0 396 moveto (1371 ) show
0 384 moveto (1372 ) show
0 372 moveto (1373 ) show
0 360 moveto (1374 ) show
0 348 moveto (1375 ) show
0 336 moveto (1376 ) show
0 324 moveto (1377 ) show
0 312 moveto (1378 ) show
0 300 moveto (1379 ) show
0 288 moveto (1380 ) show
0 276 moveto (1381 ) show
0 264 moveto (1382 ) show
0 252 moveto (1383 ) show
0 240 moveto (1384 ) show
0 228 moveto (1385 ) show
0 216 moveto (1386 ) show
0 204 moveto (1387 ) show
0 192 moveto (1388 ) show
0 180 moveto (1389 ) show
0 168 moveto (1390 ) show
0 156 moveto (1391 ) show
0 144 moveto (1392 ) show
0 132 moveto (1393 ) show
0 120 moveto (1394 ) show
0 108 moveto (1395 ) show
0 96 moveto (1396 ) show
0 84 moveto (1397 ) show
0 72 moveto (1398 ) show
0 60 moveto (1399 ) show
0 24 moveto (Sheet 13) show
grestore
restore
showpage
%%Page: 23 23
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/main.c  Page 5) show
0 648 moveto (1400 // Blank page.) show
0 636 moveto (1401 ) show
0 624 moveto (1402 ) show
0 612 moveto (1403 ) show
0 600 moveto (1404 ) show
0 588 moveto (1405 ) show
0 576 moveto (1406 ) show
0 564 moveto (1407 ) show
0 552 moveto (1408 ) show
0 540 moveto (1409 ) show
0 528 moveto (1410 ) show
0 516 moveto (1411 ) show
0 504 moveto (1412 ) show
0 492 moveto (1413 ) show
0 480 moveto (1414 ) show
0 468 moveto (1415 ) show
0 456 moveto (1416 ) show
0 444 moveto (1417 ) show
0 432 moveto (1418 ) show
0 420 moveto (1419 ) show
0 408 moveto (1420 ) show
0 396 moveto (1421 ) show
0 384 moveto (1422 ) show
0 372 moveto (1423 ) show
0 360 moveto (1424 ) show
0 348 moveto (1425 ) show
0 336 moveto (1426 ) show
0 324 moveto (1427 ) show
0 312 moveto (1428 ) show
0 300 moveto (1429 ) show
0 288 moveto (1430 ) show
0 276 moveto (1431 ) show
0 264 moveto (1432 ) show
0 252 moveto (1433 ) show
0 240 moveto (1434 ) show
0 228 moveto (1435 ) show
0 216 moveto (1436 ) show
0 204 moveto (1437 ) show
0 192 moveto (1438 ) show
0 180 moveto (1439 ) show
0 168 moveto (1440 ) show
0 156 moveto (1441 ) show
0 144 moveto (1442 ) show
0 132 moveto (1443 ) show
0 120 moveto (1444 ) show
0 108 moveto (1445 ) show
0 96 moveto (1446 ) show
0 84 moveto (1447 ) show
0 72 moveto (1448 ) show
0 60 moveto (1449 ) show
0 24 moveto (Sheet 14) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/main.c  Page 6) show
0 648 moveto (1450 // Blank page.) show
0 636 moveto (1451 ) show
0 624 moveto (1452 ) show
0 612 moveto (1453 ) show
0 600 moveto (1454 ) show
0 588 moveto (1455 ) show
0 576 moveto (1456 ) show
0 564 moveto (1457 ) show
0 552 moveto (1458 ) show
0 540 moveto (1459 ) show
0 528 moveto (1460 ) show
0 516 moveto (1461 ) show
0 504 moveto (1462 ) show
0 492 moveto (1463 ) show
0 480 moveto (1464 ) show
0 468 moveto (1465 ) show
0 456 moveto (1466 ) show
0 444 moveto (1467 ) show
0 432 moveto (1468 ) show
0 420 moveto (1469 ) show
0 408 moveto (1470 ) show
0 396 moveto (1471 ) show
0 384 moveto (1472 ) show
0 372 moveto (1473 ) show
0 360 moveto (1474 ) show
0 348 moveto (1475 ) show
0 336 moveto (1476 ) show
0 324 moveto (1477 ) show
0 312 moveto (1478 ) show
0 300 moveto (1479 ) show
0 288 moveto (1480 ) show
0 276 moveto (1481 ) show
0 264 moveto (1482 ) show
0 252 moveto (1483 ) show
0 240 moveto (1484 ) show
0 228 moveto (1485 ) show
0 216 moveto (1486 ) show
0 204 moveto (1487 ) show
0 192 moveto (1488 ) show
0 180 moveto (1489 ) show
0 168 moveto (1490 ) show
0 156 moveto (1491 ) show
0 144 moveto (1492 ) show
0 132 moveto (1493 ) show
0 120 moveto (1494 ) show
0 108 moveto (1495 ) show
0 96 moveto (1496 ) show
0 84 moveto (1497 ) show
0 72 moveto (1498 ) show
0 60 moveto (1499 ) show
0 24 moveto (Sheet 14) show
grestore
restore
showpage
%%Page: 24 24
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/spinlock.h  Page 1) show
0 648 moveto (1500 // Mutual exclusion lock.) show
0 636 moveto (1501 struct spinlock {) show
0 624 moveto (1502   uint locked;       // Is the lock held?) show
0 612 moveto (1503 ) show
0 600 moveto (1504   // For debugging:) show
0 588 moveto (1505   char *name;        // Name of lock.) show
0 576 moveto (1506   struct cpu *cpu;   // The cpu holding the lock.) show
0 564 moveto (1507   uint pcs[10];      // The call stack \(an array of program counters\)) show
0 552 moveto (1508                      // that locked the lock.) show
0 540 moveto (1509 };) show
0 528 moveto (1510 ) show
0 516 moveto (1511 ) show
0 504 moveto (1512 ) show
0 492 moveto (1513 ) show
0 480 moveto (1514 ) show
0 468 moveto (1515 ) show
0 456 moveto (1516 ) show
0 444 moveto (1517 ) show
0 432 moveto (1518 ) show
0 420 moveto (1519 ) show
0 408 moveto (1520 ) show
0 396 moveto (1521 ) show
0 384 moveto (1522 ) show
0 372 moveto (1523 ) show
0 360 moveto (1524 ) show
0 348 moveto (1525 ) show
0 336 moveto (1526 ) show
0 324 moveto (1527 ) show
0 312 moveto (1528 ) show
0 300 moveto (1529 ) show
0 288 moveto (1530 ) show
0 276 moveto (1531 ) show
0 264 moveto (1532 ) show
0 252 moveto (1533 ) show
0 240 moveto (1534 ) show
0 228 moveto (1535 ) show
0 216 moveto (1536 ) show
0 204 moveto (1537 ) show
0 192 moveto (1538 ) show
0 180 moveto (1539 ) show
0 168 moveto (1540 ) show
0 156 moveto (1541 ) show
0 144 moveto (1542 ) show
0 132 moveto (1543 ) show
0 120 moveto (1544 ) show
0 108 moveto (1545 ) show
0 96 moveto (1546 ) show
0 84 moveto (1547 ) show
0 72 moveto (1548 ) show
0 60 moveto (1549 ) show
0 24 moveto (Sheet 15) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/spinlock.c  Page 1) show
0 648 moveto (1550 // Mutual exclusion spin locks.) show
0 636 moveto (1551 ) show
0 624 moveto (1552 #include "types.h") show
0 612 moveto (1553 #include "defs.h") show
0 600 moveto (1554 #include "param.h") show
0 588 moveto (1555 #include "x86.h") show
0 576 moveto (1556 #include "memlayout.h") show
0 564 moveto (1557 #include "mmu.h") show
0 552 moveto (1558 #include "proc.h") show
0 540 moveto (1559 #include "spinlock.h") show
0 528 moveto (1560 ) show
0 516 moveto (1561 void) show
0 504 moveto (1562 initlock\(struct spinlock *lk, char *name\)) show
0 492 moveto (1563 {) show
0 480 moveto (1564   lk->name = name;) show
0 468 moveto (1565   lk->locked = 0;) show
0 456 moveto (1566   lk->cpu = 0;) show
0 444 moveto (1567 }) show
0 432 moveto (1568 ) show
0 420 moveto (1569 // Acquire the lock.) show
0 408 moveto (1570 // Loops \(spins\) until the lock is acquired.) show
0 396 moveto (1571 // Holding a lock for a long time may cause) show
0 384 moveto (1572 // other CPUs to waste time spinning to acquire it.) show
0 372 moveto (1573 void) show
0 360 moveto (1574 acquire\(struct spinlock *lk\)) show
0 348 moveto (1575 {) show
0 336 moveto (1576   pushcli\(\); // disable interrupts to avoid deadlock.) show
0 324 moveto (1577   if\(holding\(lk\)\)) show
0 312 moveto (1578     panic\("acquire"\);) show
0 300 moveto (1579 ) show
0 288 moveto (1580   // The xchg is atomic.) show
0 276 moveto (1581   while\(xchg\(&lk->locked, 1\) != 0\)) show
0 264 moveto (1582     ;) show
0 252 moveto (1583 ) show
0 240 moveto (1584   // Tell the C compiler and the processor to not move loads or stores) show
0 228 moveto (1585   // past this point, to ensure that the critical section's memory) show
0 216 moveto (1586   // references happen after the lock is acquired.) show
0 204 moveto (1587   __sync_synchronize\(\);) show
0 192 moveto (1588 ) show
0 180 moveto (1589   // Record info about lock acquisition for debugging.) show
0 168 moveto (1590   lk->cpu = mycpu\(\);) show
0 156 moveto (1591   getcallerpcs\(&lk, lk->pcs\);) show
0 144 moveto (1592 }) show
0 132 moveto (1593 ) show
0 120 moveto (1594 ) show
0 108 moveto (1595 ) show
0 96 moveto (1596 ) show
0 84 moveto (1597 ) show
0 72 moveto (1598 ) show
0 60 moveto (1599 ) show
0 24 moveto (Sheet 15) show
grestore
restore
showpage
%%Page: 25 25
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/spinlock.c  Page 2) show
0 648 moveto (1600 // Release the lock.) show
0 636 moveto (1601 void) show
0 624 moveto (1602 release\(struct spinlock *lk\)) show
0 612 moveto (1603 {) show
0 600 moveto (1604   if\(!holding\(lk\)\)) show
0 588 moveto (1605     panic\("release"\);) show
0 576 moveto (1606 ) show
0 564 moveto (1607   lk->pcs[0] = 0;) show
0 552 moveto (1608   lk->cpu = 0;) show
0 540 moveto (1609 ) show
0 528 moveto (1610   // Tell the C compiler and the processor to not move loads or stores) show
0 516 moveto (1611   // past this point, to ensure that all the stores in the critical) show
0 504 moveto (1612   // section are visible to other cores before the lock is released.) show
0 492 moveto (1613   // Both the C compiler and the hardware may re-order loads and) show
0 480 moveto (1614   // stores; __sync_synchronize\(\) tells them both not to.) show
0 468 moveto (1615   __sync_synchronize\(\);) show
0 456 moveto (1616 ) show
0 444 moveto (1617   // Release the lock, equivalent to lk->locked = 0.) show
0 432 moveto (1618   // This code can't use a C assignment, since it might) show
0 420 moveto (1619   // not be atomic. A real OS would use C atomics here.) show
0 408 moveto (1620   asm volatile\("movl $0, %0" : "+m" \(lk->locked\) : \);) show
0 396 moveto (1621 ) show
0 384 moveto (1622   popcli\(\);) show
0 372 moveto (1623 }) show
0 360 moveto (1624 ) show
0 348 moveto (1625 // Record the current call stack in pcs[] by following the %ebp chain.) show
0 336 moveto (1626 void) show
0 324 moveto (1627 getcallerpcs\(void *v, uint pcs[]\)) show
0 312 moveto (1628 {) show
0 300 moveto (1629   uint *ebp;) show
0 288 moveto (1630   int i;) show
0 276 moveto (1631 ) show
0 264 moveto (1632   ebp = \(uint*\)v - 2;) show
0 252 moveto (1633   for\(i = 0; i < 10; i++\){) show
0 240 moveto (1634     if\(ebp == 0 || ebp < \(uint*\)KERNBASE || ebp == \(uint*\)0xffffffff\)) show
0 228 moveto (1635       break;) show
0 216 moveto (1636     pcs[i] = ebp[1];     // saved %eip) show
0 204 moveto (1637     ebp = \(uint*\)ebp[0]; // saved %ebp) show
0 192 moveto (1638   }) show
0 180 moveto (1639   for\(; i < 10; i++\)) show
0 168 moveto (1640     pcs[i] = 0;) show
0 156 moveto (1641 }) show
0 144 moveto (1642 ) show
0 132 moveto (1643 ) show
0 120 moveto (1644 ) show
0 108 moveto (1645 ) show
0 96 moveto (1646 ) show
0 84 moveto (1647 ) show
0 72 moveto (1648 ) show
0 60 moveto (1649 ) show
0 24 moveto (Sheet 16) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/spinlock.c  Page 3) show
0 648 moveto (1650 // Check whether this cpu is holding the lock.) show
0 636 moveto (1651 int) show
0 624 moveto (1652 holding\(struct spinlock *lock\)) show
0 612 moveto (1653 {) show
0 600 moveto (1654   int r;) show
0 588 moveto (1655   pushcli\(\);) show
0 576 moveto (1656   r = lock->locked && lock->cpu == mycpu\(\);) show
0 564 moveto (1657   popcli\(\);) show
0 552 moveto (1658   return r;) show
0 540 moveto (1659 }) show
0 528 moveto (1660 ) show
0 516 moveto (1661 ) show
0 504 moveto (1662 // Pushcli/popcli are like cli/sti except that they are matched:) show
0 492 moveto (1663 // it takes two popcli to undo two pushcli.  Also, if interrupts) show
0 480 moveto (1664 // are off, then pushcli, popcli leaves them off.) show
0 468 moveto (1665 ) show
0 456 moveto (1666 void) show
0 444 moveto (1667 pushcli\(void\)) show
0 432 moveto (1668 {) show
0 420 moveto (1669   int eflags;) show
0 408 moveto (1670 ) show
0 396 moveto (1671   eflags = readeflags\(\);) show
0 384 moveto (1672   cli\(\);) show
0 372 moveto (1673   if\(mycpu\(\)->ncli == 0\)) show
0 360 moveto (1674     mycpu\(\)->intena = eflags & FL_IF;) show
0 348 moveto (1675   mycpu\(\)->ncli += 1;) show
0 336 moveto (1676 }) show
0 324 moveto (1677 ) show
0 312 moveto (1678 void) show
0 300 moveto (1679 popcli\(void\)) show
0 288 moveto (1680 {) show
0 276 moveto (1681   if\(readeflags\(\)&FL_IF\)) show
0 264 moveto (1682     panic\("popcli - interruptible"\);) show
0 252 moveto (1683   if\(--mycpu\(\)->ncli < 0\)) show
0 240 moveto (1684     panic\("popcli"\);) show
0 228 moveto (1685   if\(mycpu\(\)->ncli == 0 && mycpu\(\)->intena\)) show
0 216 moveto (1686     sti\(\);) show
0 204 moveto (1687 }) show
0 192 moveto (1688 ) show
0 180 moveto (1689 ) show
0 168 moveto (1690 ) show
0 156 moveto (1691 ) show
0 144 moveto (1692 ) show
0 132 moveto (1693 ) show
0 120 moveto (1694 ) show
0 108 moveto (1695 ) show
0 96 moveto (1696 ) show
0 84 moveto (1697 ) show
0 72 moveto (1698 ) show
0 60 moveto (1699 ) show
0 24 moveto (Sheet 16) show
grestore
restore
showpage
%%Page: 26 26
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 1) show
0 648 moveto (1700 #include "param.h") show
0 636 moveto (1701 #include "types.h") show
0 624 moveto (1702 #include "defs.h") show
0 612 moveto (1703 #include "x86.h") show
0 600 moveto (1704 #include "memlayout.h") show
0 588 moveto (1705 #include "mmu.h") show
0 576 moveto (1706 #include "proc.h") show
0 564 moveto (1707 #include "elf.h") show
0 552 moveto (1708 ) show
0 540 moveto (1709 extern char data[];  // defined by kernel.ld) show
0 528 moveto (1710 pde_t *kpgdir;  // for use in scheduler\(\)) show
0 516 moveto (1711 ) show
0 504 moveto (1712 // Set up CPU's kernel segment descriptors.) show
0 492 moveto (1713 // Run once on entry on each CPU.) show
0 480 moveto (1714 void) show
0 468 moveto (1715 seginit\(void\)) show
0 456 moveto (1716 {) show
0 444 moveto (1717   struct cpu *c;) show
0 432 moveto (1718 ) show
0 420 moveto (1719   // Map "logical" addresses to virtual addresses using identity map.) show
0 408 moveto (1720   // Cannot share a CODE descriptor for both kernel and user) show
0 396 moveto (1721   // because it would have to have DPL_USR, but the CPU forbids) show
0 384 moveto (1722   // an interrupt from CPL=0 to DPL=3.) show
0 372 moveto (1723   c = &cpus[cpuid\(\)];) show
0 360 moveto (1724   c->gdt[SEG_KCODE] = SEG\(STA_X|STA_R, 0, 0xffffffff, 0\);) show
0 348 moveto (1725   c->gdt[SEG_KDATA] = SEG\(STA_W, 0, 0xffffffff, 0\);) show
0 336 moveto (1726   c->gdt[SEG_UCODE] = SEG\(STA_X|STA_R, 0, 0xffffffff, DPL_USER\);) show
0 324 moveto (1727   c->gdt[SEG_UDATA] = SEG\(STA_W, 0, 0xffffffff, DPL_USER\);) show
0 312 moveto (1728   lgdt\(c->gdt, sizeof\(c->gdt\)\);) show
0 300 moveto (1729 }) show
0 288 moveto (1730 ) show
0 276 moveto (1731 // Return the address of the PTE in page table pgdir) show
0 264 moveto (1732 // that corresponds to virtual address va.  If alloc!=0,) show
0 252 moveto (1733 // create any required page table pages.) show
0 240 moveto (1734 static pte_t *) show
0 228 moveto (1735 walkpgdir\(pde_t *pgdir, const void *va, int alloc\)) show
0 216 moveto (1736 {) show
0 204 moveto (1737   pde_t *pde;) show
0 192 moveto (1738   pte_t *pgtab;) show
0 180 moveto (1739 ) show
0 168 moveto (1740   pde = &pgdir[PDX\(va\)];) show
0 156 moveto (1741   if\(*pde & PTE_P\){) show
0 144 moveto (1742     pgtab = \(pte_t*\)P2V\(PTE_ADDR\(*pde\)\);) show
0 132 moveto (1743   } else {) show
0 120 moveto (1744     if\(!alloc || \(pgtab = \(pte_t*\)kalloc\(\)\) == 0\)) show
0 108 moveto (1745       return 0;) show
0 96 moveto (1746     // Make sure all those PTE_P bits are zero.) show
0 84 moveto (1747     memset\(pgtab, 0, PGSIZE\);) show
0 72 moveto (1748     // The permissions here are overly generous, but they can) show
0 60 moveto (1749     // be further restricted by the permissions in the page table) show
0 24 moveto (Sheet 17) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 2) show
0 648 moveto (1750     // entries, if necessary.) show
0 636 moveto (1751     *pde = V2P\(pgtab\) | PTE_P | PTE_W | PTE_U;) show
0 624 moveto (1752   }) show
0 612 moveto (1753   return &pgtab[PTX\(va\)];) show
0 600 moveto (1754 }) show
0 588 moveto (1755 ) show
0 576 moveto (1756 // Create PTEs for virtual addresses starting at va that refer to) show
0 564 moveto (1757 // physical addresses starting at pa. va and size might not) show
0 552 moveto (1758 // be page-aligned.) show
0 540 moveto (1759 static int) show
0 528 moveto (1760 mappages\(pde_t *pgdir, void *va, uint size, uint pa, int perm\)) show
0 516 moveto (1761 {) show
0 504 moveto (1762   char *a, *last;) show
0 492 moveto (1763   pte_t *pte;) show
0 480 moveto (1764 ) show
0 468 moveto (1765   a = \(char*\)PGROUNDDOWN\(\(uint\)va\);) show
0 456 moveto (1766   last = \(char*\)PGROUNDDOWN\(\(\(uint\)va\) + size - 1\);) show
0 444 moveto (1767   for\(;;\){) show
0 432 moveto (1768     if\(\(pte = walkpgdir\(pgdir, a, 1\)\) == 0\)) show
0 420 moveto (1769       return -1;) show
0 408 moveto (1770     if\(*pte & PTE_P\)) show
0 396 moveto (1771       panic\("remap"\);) show
0 384 moveto (1772     *pte = pa | perm | PTE_P;) show
0 372 moveto (1773     if\(a == last\)) show
0 360 moveto (1774       break;) show
0 348 moveto (1775     a += PGSIZE;) show
0 336 moveto (1776     pa += PGSIZE;) show
0 324 moveto (1777   }) show
0 312 moveto (1778   return 0;) show
0 300 moveto (1779 }) show
0 288 moveto (1780 ) show
0 276 moveto (1781 // There is one page table per process, plus one that's used when) show
0 264 moveto (1782 // a CPU is not running any process \(kpgdir\). The kernel uses the) show
0 252 moveto (1783 // current process's page table during system calls and interrupts;) show
0 240 moveto (1784 // page protection bits prevent user code from using the kernel's) show
0 228 moveto (1785 // mappings.) show
0 216 moveto (1786 //) show
0 204 moveto (1787 // setupkvm\(\) and exec\(\) set up every page table like this:) show
0 192 moveto (1788 //) show
0 180 moveto (1789 //   0..KERNBASE: user memory \(text+data+stack+heap\), mapped to) show
0 168 moveto (1790 //                phys memory allocated by the kernel) show
0 156 moveto (1791 //   KERNBASE..KERNBASE+EXTMEM: mapped to 0..EXTMEM \(for I/O space\)) show
0 144 moveto (1792 //   KERNBASE+EXTMEM..data: mapped to EXTMEM..V2P\(data\)) show
0 132 moveto (1793 //                for the kernel's instructions and r/o data) show
0 120 moveto (1794 //   data..KERNBASE+PHYSTOP: mapped to V2P\(data\)..PHYSTOP,) show
0 108 moveto (1795 //                                  rw data + free physical memory) show
0 96 moveto (1796 //   0xfe000000..0: mapped direct \(devices such as ioapic\)) show
0 84 moveto (1797 //) show
0 72 moveto (1798 // The kernel allocates physical memory for its heap and for user memory) show
0 60 moveto (1799 // between V2P\(end\) and the end of physical memory \(PHYSTOP\)) show
0 24 moveto (Sheet 17) show
grestore
restore
showpage
%%Page: 27 27
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 3) show
0 648 moveto (1800 // \(directly addressable from end..P2V\(PHYSTOP\)\).) show
0 636 moveto (1801 ) show
0 624 moveto (1802 // This table defines the kernel's mappings, which are present in) show
0 612 moveto (1803 // every process's page table.) show
0 600 moveto (1804 static struct kmap {) show
0 588 moveto (1805   void *virt;) show
0 576 moveto (1806   uint phys_start;) show
0 564 moveto (1807   uint phys_end;) show
0 552 moveto (1808   int perm;) show
0 540 moveto (1809 } kmap[] = {) show
0 528 moveto (1810  { \(void*\)KERNBASE, 0,             EXTMEM,    PTE_W}, // I/O space) show
0 516 moveto (1811  { \(void*\)KERNLINK, V2P\(KERNLINK\), V2P\(data\), 0},     // kern text+rodata) show
0 504 moveto (1812  { \(void*\)data,     V2P\(data\),     PHYSTOP,   PTE_W}, // kern data+memory) show
0 492 moveto (1813  { \(void*\)DEVSPACE, DEVSPACE,      0,         PTE_W}, // more devices) show
0 480 moveto (1814 };) show
0 468 moveto (1815 ) show
0 456 moveto (1816 // Set up kernel part of a page table.) show
0 444 moveto (1817 pde_t*) show
0 432 moveto (1818 setupkvm\(void\)) show
0 420 moveto (1819 {) show
0 408 moveto (1820   pde_t *pgdir;) show
0 396 moveto (1821   struct kmap *k;) show
0 384 moveto (1822 ) show
0 372 moveto (1823   if\(\(pgdir = \(pde_t*\)kalloc\(\)\) == 0\)) show
0 360 moveto (1824     return 0;) show
0 348 moveto (1825   memset\(pgdir, 0, PGSIZE\);) show
0 336 moveto (1826   if \(P2V\(PHYSTOP\) > \(void*\)DEVSPACE\)) show
0 324 moveto (1827     panic\("PHYSTOP too high"\);) show
0 312 moveto (1828   for\(k = kmap; k < &kmap[NELEM\(kmap\)]; k++\)) show
0 300 moveto (1829     if\(mappages\(pgdir, k->virt, k->phys_end - k->phys_start,) show
0 288 moveto (1830                 \(uint\)k->phys_start, k->perm\) < 0\) {) show
0 276 moveto (1831       freevm\(pgdir\);) show
0 264 moveto (1832       return 0;) show
0 252 moveto (1833     }) show
0 240 moveto (1834   return pgdir;) show
0 228 moveto (1835 }) show
0 216 moveto (1836 ) show
0 204 moveto (1837 // Allocate one page table for the machine for the kernel address) show
0 192 moveto (1838 // space for scheduler processes.) show
0 180 moveto (1839 void) show
0 168 moveto (1840 kvmalloc\(void\)) show
0 156 moveto (1841 {) show
0 144 moveto (1842   kpgdir = setupkvm\(\);) show
0 132 moveto (1843   switchkvm\(\);) show
0 120 moveto (1844 }) show
0 108 moveto (1845 ) show
0 96 moveto (1846 ) show
0 84 moveto (1847 ) show
0 72 moveto (1848 ) show
0 60 moveto (1849 ) show
0 24 moveto (Sheet 18) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 4) show
0 648 moveto (1850 // Switch h/w page table register to the kernel-only page table,) show
0 636 moveto (1851 // for when no process is running.) show
0 624 moveto (1852 void) show
0 612 moveto (1853 switchkvm\(void\)) show
0 600 moveto (1854 {) show
0 588 moveto (1855   lcr3\(V2P\(kpgdir\)\);   // switch to the kernel page table) show
0 576 moveto (1856 }) show
0 564 moveto (1857 ) show
0 552 moveto (1858 // Switch TSS and h/w page table to correspond to process p.) show
0 540 moveto (1859 void) show
0 528 moveto (1860 switchuvm\(struct proc *p\)) show
0 516 moveto (1861 {) show
0 504 moveto (1862   if\(p == 0\)) show
0 492 moveto (1863     panic\("switchuvm: no process"\);) show
0 480 moveto (1864   if\(p->kstack == 0\)) show
0 468 moveto (1865     panic\("switchuvm: no kstack"\);) show
0 456 moveto (1866   if\(p->pgdir == 0\)) show
0 444 moveto (1867     panic\("switchuvm: no pgdir"\);) show
0 432 moveto (1868 ) show
0 420 moveto (1869   pushcli\(\);) show
0 408 moveto (1870   mycpu\(\)->gdt[SEG_TSS] = SEG16\(STS_T32A, &mycpu\(\)->ts,) show
0 396 moveto (1871                                 sizeof\(mycpu\(\)->ts\)-1, 0\);) show
0 384 moveto (1872   mycpu\(\)->gdt[SEG_TSS].s = 0;) show
0 372 moveto (1873   mycpu\(\)->ts.ss0 = SEG_KDATA << 3;) show
0 360 moveto (1874   mycpu\(\)->ts.esp0 = \(uint\)p->kstack + KSTACKSIZE;) show
0 348 moveto (1875   // setting IOPL=0 in eflags *and* iomb beyond the tss segment limit) show
0 336 moveto (1876   // forbids I/O instructions \(e.g., inb and outb\) from user space) show
0 324 moveto (1877   mycpu\(\)->ts.iomb = \(ushort\) 0xFFFF;) show
0 312 moveto (1878   ltr\(SEG_TSS << 3\);) show
0 300 moveto (1879   lcr3\(V2P\(p->pgdir\)\);  // switch to process's address space) show
0 288 moveto (1880   popcli\(\);) show
0 276 moveto (1881 }) show
0 264 moveto (1882 ) show
0 252 moveto (1883 // Load the initcode into address 0 of pgdir.) show
0 240 moveto (1884 // sz must be less than a page.) show
0 228 moveto (1885 void) show
0 216 moveto (1886 inituvm\(pde_t *pgdir, char *init, uint sz\)) show
0 204 moveto (1887 {) show
0 192 moveto (1888   char *mem;) show
0 180 moveto (1889 ) show
0 168 moveto (1890   if\(sz >= PGSIZE\)) show
0 156 moveto (1891     panic\("inituvm: more than a page"\);) show
0 144 moveto (1892   mem = kalloc\(\);) show
0 132 moveto (1893   memset\(mem, 0, PGSIZE\);) show
0 120 moveto (1894   mappages\(pgdir, 0, PGSIZE, V2P\(mem\), PTE_W|PTE_U\);) show
0 108 moveto (1895   memmove\(mem, init, sz\);) show
0 96 moveto (1896 }) show
0 84 moveto (1897 ) show
0 72 moveto (1898 ) show
0 60 moveto (1899 ) show
0 24 moveto (Sheet 18) show
grestore
restore
showpage
%%Page: 28 28
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 5) show
0 648 moveto (1900 // Load a program segment into pgdir.  addr must be page-aligned) show
0 636 moveto (1901 // and the pages from addr to addr+sz must already be mapped.) show
0 624 moveto (1902 int) show
0 612 moveto (1903 loaduvm\(pde_t *pgdir, char *addr, struct inode *ip, uint offset, uint sz\)) show
0 600 moveto (1904 {) show
0 588 moveto (1905   uint i, pa, n;) show
0 576 moveto (1906   pte_t *pte;) show
0 564 moveto (1907 ) show
0 552 moveto (1908   if\(\(uint\) addr % PGSIZE != 0\)) show
0 540 moveto (1909     panic\("loaduvm: addr must be page aligned"\);) show
0 528 moveto (1910   for\(i = 0; i < sz; i += PGSIZE\){) show
0 516 moveto (1911     if\(\(pte = walkpgdir\(pgdir, addr+i, 0\)\) == 0\)) show
0 504 moveto (1912       panic\("loaduvm: address should exist"\);) show
0 492 moveto (1913     pa = PTE_ADDR\(*pte\);) show
0 480 moveto (1914     if\(sz - i < PGSIZE\)) show
0 468 moveto (1915       n = sz - i;) show
0 456 moveto (1916     else) show
0 444 moveto (1917       n = PGSIZE;) show
0 432 moveto (1918     if\(readi\(ip, P2V\(pa\), offset+i, n\) != n\)) show
0 420 moveto (1919       return -1;) show
0 408 moveto (1920   }) show
0 396 moveto (1921   return 0;) show
0 384 moveto (1922 }) show
0 372 moveto (1923 ) show
0 360 moveto (1924 // Allocate page tables and physical memory to grow process from oldsz to) show
0 348 moveto (1925 // newsz, which need not be page aligned.  Returns new size or 0 on error.) show
0 336 moveto (1926 int) show
0 324 moveto (1927 allocuvm\(pde_t *pgdir, uint oldsz, uint newsz\)) show
0 312 moveto (1928 {) show
0 300 moveto (1929   char *mem;) show
0 288 moveto (1930   uint a;) show
0 276 moveto (1931 ) show
0 264 moveto (1932   if\(newsz >= KERNBASE\)) show
0 252 moveto (1933     return 0;) show
0 240 moveto (1934   if\(newsz < oldsz\)) show
0 228 moveto (1935     return oldsz;) show
0 216 moveto (1936 ) show
0 204 moveto (1937   a = PGROUNDUP\(oldsz\);) show
0 192 moveto (1938   for\(; a < newsz; a += PGSIZE\){) show
0 180 moveto (1939     mem = kalloc\(\);) show
0 168 moveto (1940     if\(mem == 0\){) show
0 156 moveto (1941       cprintf\("allocuvm out of memory\\n"\);) show
0 144 moveto (1942       deallocuvm\(pgdir, newsz, oldsz\);) show
0 132 moveto (1943       return 0;) show
0 120 moveto (1944     }) show
0 108 moveto (1945     memset\(mem, 0, PGSIZE\);) show
0 96 moveto (1946     if\(mappages\(pgdir, \(char*\)a, PGSIZE, V2P\(mem\), PTE_W|PTE_U\) < 0\){) show
0 84 moveto (1947       cprintf\("allocuvm out of memory \(2\)\\n"\);) show
0 72 moveto (1948       deallocuvm\(pgdir, newsz, oldsz\);) show
0 60 moveto (1949       kfree\(mem\);) show
0 24 moveto (Sheet 19) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 6) show
0 648 moveto (1950       return 0;) show
0 636 moveto (1951     }) show
0 624 moveto (1952   }) show
0 612 moveto (1953   return newsz;) show
0 600 moveto (1954 }) show
0 588 moveto (1955 ) show
0 576 moveto (1956 // Deallocate user pages to bring the process size from oldsz to) show
0 564 moveto (1957 // newsz.  oldsz and newsz need not be page-aligned, nor does newsz) show
0 552 moveto (1958 // need to be less than oldsz.  oldsz can be larger than the actual) show
0 540 moveto (1959 // process size.  Returns the new process size.) show
0 528 moveto (1960 int) show
0 516 moveto (1961 deallocuvm\(pde_t *pgdir, uint oldsz, uint newsz\)) show
0 504 moveto (1962 {) show
0 492 moveto (1963   pte_t *pte;) show
0 480 moveto (1964   uint a, pa;) show
0 468 moveto (1965 ) show
0 456 moveto (1966   if\(newsz >= oldsz\)) show
0 444 moveto (1967     return oldsz;) show
0 432 moveto (1968 ) show
0 420 moveto (1969   a = PGROUNDUP\(newsz\);) show
0 408 moveto (1970   for\(; a  < oldsz; a += PGSIZE\){) show
0 396 moveto (1971     pte = walkpgdir\(pgdir, \(char*\)a, 0\);) show
0 384 moveto (1972     if\(!pte\)) show
0 372 moveto (1973       a = PGADDR\(PDX\(a\) + 1, 0, 0\) - PGSIZE;) show
0 360 moveto (1974     else if\(\(*pte & PTE_P\) != 0\){) show
0 348 moveto (1975       pa = PTE_ADDR\(*pte\);) show
0 336 moveto (1976       if\(pa == 0\)) show
0 324 moveto (1977         panic\("kfree"\);) show
0 312 moveto (1978       char *v = P2V\(pa\);) show
0 300 moveto (1979       kfree\(v\);) show
0 288 moveto (1980       *pte = 0;) show
0 276 moveto (1981     }) show
0 264 moveto (1982   }) show
0 252 moveto (1983   return newsz;) show
0 240 moveto (1984 }) show
0 228 moveto (1985 ) show
0 216 moveto (1986 ) show
0 204 moveto (1987 ) show
0 192 moveto (1988 ) show
0 180 moveto (1989 ) show
0 168 moveto (1990 ) show
0 156 moveto (1991 ) show
0 144 moveto (1992 ) show
0 132 moveto (1993 ) show
0 120 moveto (1994 ) show
0 108 moveto (1995 ) show
0 96 moveto (1996 ) show
0 84 moveto (1997 ) show
0 72 moveto (1998 ) show
0 60 moveto (1999 ) show
0 24 moveto (Sheet 19) show
grestore
restore
showpage
%%Page: 29 29
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 7) show
0 648 moveto (2000 // Free a page table and all the physical memory pages) show
0 636 moveto (2001 // in the user part.) show
0 624 moveto (2002 void) show
0 612 moveto (2003 freevm\(pde_t *pgdir\)) show
0 600 moveto (2004 {) show
0 588 moveto (2005   uint i;) show
0 576 moveto (2006 ) show
0 564 moveto (2007   if\(pgdir == 0\)) show
0 552 moveto (2008     panic\("freevm: no pgdir"\);) show
0 540 moveto (2009   deallocuvm\(pgdir, KERNBASE, 0\);) show
0 528 moveto (2010   for\(i = 0; i < NPDENTRIES; i++\){) show
0 516 moveto (2011     if\(pgdir[i] & PTE_P\){) show
0 504 moveto (2012       char * v = P2V\(PTE_ADDR\(pgdir[i]\)\);) show
0 492 moveto (2013       kfree\(v\);) show
0 480 moveto (2014     }) show
0 468 moveto (2015   }) show
0 456 moveto (2016   kfree\(\(char*\)pgdir\);) show
0 444 moveto (2017 }) show
0 432 moveto (2018 ) show
0 420 moveto (2019 // Clear PTE_U on a page. Used to create an inaccessible) show
0 408 moveto (2020 // page beneath the user stack.) show
0 396 moveto (2021 void) show
0 384 moveto (2022 clearpteu\(pde_t *pgdir, char *uva\)) show
0 372 moveto (2023 {) show
0 360 moveto (2024   pte_t *pte;) show
0 348 moveto (2025 ) show
0 336 moveto (2026   pte = walkpgdir\(pgdir, uva, 0\);) show
0 324 moveto (2027   if\(pte == 0\)) show
0 312 moveto (2028     panic\("clearpteu"\);) show
0 300 moveto (2029   *pte &= ~PTE_U;) show
0 288 moveto (2030 }) show
0 276 moveto (2031 ) show
0 264 moveto (2032 // Given a parent process's page table, create a copy) show
0 252 moveto (2033 // of it for a child.) show
0 240 moveto (2034 pde_t*) show
0 228 moveto (2035 copyuvm\(pde_t *pgdir, uint sz\)) show
0 216 moveto (2036 {) show
0 204 moveto (2037   pde_t *d;) show
0 192 moveto (2038   pte_t *pte;) show
0 180 moveto (2039   uint pa, i, flags;) show
0 168 moveto (2040   char *mem;) show
0 156 moveto (2041 ) show
0 144 moveto (2042   if\(\(d = setupkvm\(\)\) == 0\)) show
0 132 moveto (2043     return 0;) show
0 120 moveto (2044   for\(i = 0; i < sz; i += PGSIZE\){) show
0 108 moveto (2045     if\(\(pte = walkpgdir\(pgdir, \(void *\) i, 0\)\) == 0\)) show
0 96 moveto (2046       panic\("copyuvm: pte should exist"\);) show
0 84 moveto (2047     if\(!\(*pte & PTE_P\)\)) show
0 72 moveto (2048       panic\("copyuvm: page not present"\);) show
0 60 moveto (2049     pa = PTE_ADDR\(*pte\);) show
0 24 moveto (Sheet 20) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 8) show
0 648 moveto (2050     flags = PTE_FLAGS\(*pte\);) show
0 636 moveto (2051     if\(\(mem = kalloc\(\)\) == 0\)) show
0 624 moveto (2052       goto bad;) show
0 612 moveto (2053     memmove\(mem, \(char*\)P2V\(pa\), PGSIZE\);) show
0 600 moveto (2054     if\(mappages\(d, \(void*\)i, PGSIZE, V2P\(mem\), flags\) < 0\) {) show
0 588 moveto (2055       kfree\(mem\);) show
0 576 moveto (2056       goto bad;) show
0 564 moveto (2057     }) show
0 552 moveto (2058   }) show
0 540 moveto (2059   return d;) show
0 528 moveto (2060 ) show
0 516 moveto (2061 bad:) show
0 504 moveto (2062   freevm\(d\);) show
0 492 moveto (2063   return 0;) show
0 480 moveto (2064 }) show
0 468 moveto (2065 ) show
0 456 moveto (2066 ) show
0 444 moveto (2067 ) show
0 432 moveto (2068 ) show
0 420 moveto (2069 ) show
0 408 moveto (2070 ) show
0 396 moveto (2071 ) show
0 384 moveto (2072 ) show
0 372 moveto (2073 ) show
0 360 moveto (2074 ) show
0 348 moveto (2075 ) show
0 336 moveto (2076 ) show
0 324 moveto (2077 ) show
0 312 moveto (2078 ) show
0 300 moveto (2079 ) show
0 288 moveto (2080 ) show
0 276 moveto (2081 ) show
0 264 moveto (2082 ) show
0 252 moveto (2083 ) show
0 240 moveto (2084 ) show
0 228 moveto (2085 ) show
0 216 moveto (2086 ) show
0 204 moveto (2087 ) show
0 192 moveto (2088 ) show
0 180 moveto (2089 ) show
0 168 moveto (2090 ) show
0 156 moveto (2091 ) show
0 144 moveto (2092 ) show
0 132 moveto (2093 ) show
0 120 moveto (2094 ) show
0 108 moveto (2095 ) show
0 96 moveto (2096 ) show
0 84 moveto (2097 ) show
0 72 moveto (2098 ) show
0 60 moveto (2099 ) show
0 24 moveto (Sheet 20) show
grestore
restore
showpage
%%Page: 30 30
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 9) show
0 648 moveto (2100 // Map user virtual address to kernel address.) show
0 636 moveto (2101 char*) show
0 624 moveto (2102 uva2ka\(pde_t *pgdir, char *uva\)) show
0 612 moveto (2103 {) show
0 600 moveto (2104   pte_t *pte;) show
0 588 moveto (2105 ) show
0 576 moveto (2106   pte = walkpgdir\(pgdir, uva, 0\);) show
0 564 moveto (2107   if\(\(*pte & PTE_P\) == 0\)) show
0 552 moveto (2108     return 0;) show
0 540 moveto (2109   if\(\(*pte & PTE_U\) == 0\)) show
0 528 moveto (2110     return 0;) show
0 516 moveto (2111   return \(char*\)P2V\(PTE_ADDR\(*pte\)\);) show
0 504 moveto (2112 }) show
0 492 moveto (2113 ) show
0 480 moveto (2114 // Copy len bytes from p to user address va in page table pgdir.) show
0 468 moveto (2115 // Most useful when pgdir is not the current page table.) show
0 456 moveto (2116 // uva2ka ensures this only works for PTE_U pages.) show
0 444 moveto (2117 int) show
0 432 moveto (2118 copyout\(pde_t *pgdir, uint va, void *p, uint len\)) show
0 420 moveto (2119 {) show
0 408 moveto (2120   char *buf, *pa0;) show
0 396 moveto (2121   uint n, va0;) show
0 384 moveto (2122 ) show
0 372 moveto (2123   buf = \(char*\)p;) show
0 360 moveto (2124   while\(len > 0\){) show
0 348 moveto (2125     va0 = \(uint\)PGROUNDDOWN\(va\);) show
0 336 moveto (2126     pa0 = uva2ka\(pgdir, \(char*\)va0\);) show
0 324 moveto (2127     if\(pa0 == 0\)) show
0 312 moveto (2128       return -1;) show
0 300 moveto (2129     n = PGSIZE - \(va - va0\);) show
0 288 moveto (2130     if\(n > len\)) show
0 276 moveto (2131       n = len;) show
0 264 moveto (2132     memmove\(pa0 + \(va - va0\), buf, n\);) show
0 252 moveto (2133     len -= n;) show
0 240 moveto (2134     buf += n;) show
0 228 moveto (2135     va = va0 + PGSIZE;) show
0 216 moveto (2136   }) show
0 204 moveto (2137   return 0;) show
0 192 moveto (2138 }) show
0 180 moveto (2139 ) show
0 168 moveto (2140 ) show
0 156 moveto (2141 ) show
0 144 moveto (2142 ) show
0 132 moveto (2143 ) show
0 120 moveto (2144 ) show
0 108 moveto (2145 ) show
0 96 moveto (2146 ) show
0 84 moveto (2147 ) show
0 72 moveto (2148 ) show
0 60 moveto (2149 ) show
0 24 moveto (Sheet 21) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 10) show
0 648 moveto (2150 // Blank page.) show
0 636 moveto (2151 ) show
0 624 moveto (2152 ) show
0 612 moveto (2153 ) show
0 600 moveto (2154 ) show
0 588 moveto (2155 ) show
0 576 moveto (2156 ) show
0 564 moveto (2157 ) show
0 552 moveto (2158 ) show
0 540 moveto (2159 ) show
0 528 moveto (2160 ) show
0 516 moveto (2161 ) show
0 504 moveto (2162 ) show
0 492 moveto (2163 ) show
0 480 moveto (2164 ) show
0 468 moveto (2165 ) show
0 456 moveto (2166 ) show
0 444 moveto (2167 ) show
0 432 moveto (2168 ) show
0 420 moveto (2169 ) show
0 408 moveto (2170 ) show
0 396 moveto (2171 ) show
0 384 moveto (2172 ) show
0 372 moveto (2173 ) show
0 360 moveto (2174 ) show
0 348 moveto (2175 ) show
0 336 moveto (2176 ) show
0 324 moveto (2177 ) show
0 312 moveto (2178 ) show
0 300 moveto (2179 ) show
0 288 moveto (2180 ) show
0 276 moveto (2181 ) show
0 264 moveto (2182 ) show
0 252 moveto (2183 ) show
0 240 moveto (2184 ) show
0 228 moveto (2185 ) show
0 216 moveto (2186 ) show
0 204 moveto (2187 ) show
0 192 moveto (2188 ) show
0 180 moveto (2189 ) show
0 168 moveto (2190 ) show
0 156 moveto (2191 ) show
0 144 moveto (2192 ) show
0 132 moveto (2193 ) show
0 120 moveto (2194 ) show
0 108 moveto (2195 ) show
0 96 moveto (2196 ) show
0 84 moveto (2197 ) show
0 72 moveto (2198 ) show
0 60 moveto (2199 ) show
0 24 moveto (Sheet 21) show
grestore
restore
showpage
%%Page: 31 31
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 11) show
0 648 moveto (2200 // Blank page.) show
0 636 moveto (2201 ) show
0 624 moveto (2202 ) show
0 612 moveto (2203 ) show
0 600 moveto (2204 ) show
0 588 moveto (2205 ) show
0 576 moveto (2206 ) show
0 564 moveto (2207 ) show
0 552 moveto (2208 ) show
0 540 moveto (2209 ) show
0 528 moveto (2210 ) show
0 516 moveto (2211 ) show
0 504 moveto (2212 ) show
0 492 moveto (2213 ) show
0 480 moveto (2214 ) show
0 468 moveto (2215 ) show
0 456 moveto (2216 ) show
0 444 moveto (2217 ) show
0 432 moveto (2218 ) show
0 420 moveto (2219 ) show
0 408 moveto (2220 ) show
0 396 moveto (2221 ) show
0 384 moveto (2222 ) show
0 372 moveto (2223 ) show
0 360 moveto (2224 ) show
0 348 moveto (2225 ) show
0 336 moveto (2226 ) show
0 324 moveto (2227 ) show
0 312 moveto (2228 ) show
0 300 moveto (2229 ) show
0 288 moveto (2230 ) show
0 276 moveto (2231 ) show
0 264 moveto (2232 ) show
0 252 moveto (2233 ) show
0 240 moveto (2234 ) show
0 228 moveto (2235 ) show
0 216 moveto (2236 ) show
0 204 moveto (2237 ) show
0 192 moveto (2238 ) show
0 180 moveto (2239 ) show
0 168 moveto (2240 ) show
0 156 moveto (2241 ) show
0 144 moveto (2242 ) show
0 132 moveto (2243 ) show
0 120 moveto (2244 ) show
0 108 moveto (2245 ) show
0 96 moveto (2246 ) show
0 84 moveto (2247 ) show
0 72 moveto (2248 ) show
0 60 moveto (2249 ) show
0 24 moveto (Sheet 22) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vm.c  Page 12) show
0 648 moveto (2250 // Blank page.) show
0 636 moveto (2251 ) show
0 624 moveto (2252 ) show
0 612 moveto (2253 ) show
0 600 moveto (2254 ) show
0 588 moveto (2255 ) show
0 576 moveto (2256 ) show
0 564 moveto (2257 ) show
0 552 moveto (2258 ) show
0 540 moveto (2259 ) show
0 528 moveto (2260 ) show
0 516 moveto (2261 ) show
0 504 moveto (2262 ) show
0 492 moveto (2263 ) show
0 480 moveto (2264 ) show
0 468 moveto (2265 ) show
0 456 moveto (2266 ) show
0 444 moveto (2267 ) show
0 432 moveto (2268 ) show
0 420 moveto (2269 ) show
0 408 moveto (2270 ) show
0 396 moveto (2271 ) show
0 384 moveto (2272 ) show
0 372 moveto (2273 ) show
0 360 moveto (2274 ) show
0 348 moveto (2275 ) show
0 336 moveto (2276 ) show
0 324 moveto (2277 ) show
0 312 moveto (2278 ) show
0 300 moveto (2279 ) show
0 288 moveto (2280 ) show
0 276 moveto (2281 ) show
0 264 moveto (2282 ) show
0 252 moveto (2283 ) show
0 240 moveto (2284 ) show
0 228 moveto (2285 ) show
0 216 moveto (2286 ) show
0 204 moveto (2287 ) show
0 192 moveto (2288 ) show
0 180 moveto (2289 ) show
0 168 moveto (2290 ) show
0 156 moveto (2291 ) show
0 144 moveto (2292 ) show
0 132 moveto (2293 ) show
0 120 moveto (2294 ) show
0 108 moveto (2295 ) show
0 96 moveto (2296 ) show
0 84 moveto (2297 ) show
0 72 moveto (2298 ) show
0 60 moveto (2299 ) show
0 24 moveto (Sheet 22) show
grestore
restore
showpage
%%Page: 32 32
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.h  Page 1) show
0 648 moveto (2300 // Per-CPU state) show
0 636 moveto (2301 struct cpu {) show
0 624 moveto (2302   uchar apicid;                // Local APIC ID) show
0 612 moveto (2303   struct context *scheduler;   // swtch\(\) here to enter scheduler) show
0 600 moveto (2304   struct taskstate ts;         // Used by x86 to find stack for interrupt) show
0 588 moveto (2305   struct segdesc gdt[NSEGS];   // x86 global descriptor table) show
0 576 moveto (2306   volatile uint started;       // Has the CPU started?) show
0 564 moveto (2307   int ncli;                    // Depth of pushcli nesting.) show
0 552 moveto (2308   int intena;                  // Were interrupts enabled before pushcli?) show
0 540 moveto (2309   struct proc *proc;           // The process running on this cpu or null) show
0 528 moveto (2310 };) show
0 516 moveto (2311 ) show
0 504 moveto (2312 extern struct cpu cpus[NCPU];) show
0 492 moveto (2313 extern int ncpu;) show
0 480 moveto (2314 ) show
0 468 moveto (2315 ) show
0 456 moveto (2316 // Saved registers for kernel context switches.) show
0 444 moveto (2317 // Don't need to save all the segment registers \(%cs, etc\),) show
0 432 moveto (2318 // because they are constant across kernel contexts.) show
0 420 moveto (2319 // Don't need to save %eax, %ecx, %edx, because the) show
0 408 moveto (2320 // x86 convention is that the caller has saved them.) show
0 396 moveto (2321 // Contexts are stored at the bottom of the stack they) show
0 384 moveto (2322 // describe; the stack pointer is the address of the context.) show
0 372 moveto (2323 // The layout of the context matches the layout of the stack in swtch.S) show
0 360 moveto (2324 // at the "Switch stacks" comment. Switch doesn't save eip explicitly,) show
0 348 moveto (2325 // but it is on the stack and allocproc\(\) manipulates it.) show
0 336 moveto (2326 struct context {) show
0 324 moveto (2327   uint edi;) show
0 312 moveto (2328   uint esi;) show
0 300 moveto (2329   uint ebx;) show
0 288 moveto (2330   uint ebp;) show
0 276 moveto (2331   uint eip;) show
0 264 moveto (2332 };) show
0 252 moveto (2333 ) show
0 240 moveto (2334 enum procstate { UNUSED, EMBRYO, SLEEPING, RUNNABLE, RUNNING, ZOMBIE };) show
0 228 moveto (2335 ) show
0 216 moveto (2336 // Per-process state) show
0 204 moveto (2337 struct proc {) show
0 192 moveto (2338   uint sz;                     // Size of process memory \(bytes\)) show
0 180 moveto (2339   pde_t* pgdir;                // Page table) show
0 168 moveto (2340   char *kstack;                // Bottom of kernel stack for this process) show
0 156 moveto (2341   enum procstate state;        // Process state) show
0 144 moveto (2342   int pid;                     // Process ID) show
0 132 moveto (2343   struct proc *parent;         // Parent process) show
0 120 moveto (2344   struct trapframe *tf;        // Trap frame for current syscall) show
0 108 moveto (2345   struct context *context;     // swtch\(\) here to run process) show
0 96 moveto (2346   void *chan;                  // If non-zero, sleeping on chan) show
0 84 moveto (2347   int killed;                  // If non-zero, have been killed) show
0 72 moveto (2348   struct file *ofile[NOFILE];  // Open files) show
0 60 moveto (2349   struct inode *cwd;           // Current directory) show
0 24 moveto (Sheet 23) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.h  Page 2) show
0 648 moveto (2350   char name[16];               // Process name \(debugging\)) show
0 636 moveto (2351 };) show
0 624 moveto (2352 ) show
0 612 moveto (2353 // Process memory is laid out contiguously, low addresses first:) show
0 600 moveto (2354 //   text) show
0 588 moveto (2355 //   original data and bss) show
0 576 moveto (2356 //   fixed-size stack) show
0 564 moveto (2357 //   expandable heap) show
0 552 moveto (2358 ) show
0 540 moveto (2359 ) show
0 528 moveto (2360 ) show
0 516 moveto (2361 ) show
0 504 moveto (2362 ) show
0 492 moveto (2363 ) show
0 480 moveto (2364 ) show
0 468 moveto (2365 ) show
0 456 moveto (2366 ) show
0 444 moveto (2367 ) show
0 432 moveto (2368 ) show
0 420 moveto (2369 ) show
0 408 moveto (2370 ) show
0 396 moveto (2371 ) show
0 384 moveto (2372 ) show
0 372 moveto (2373 ) show
0 360 moveto (2374 ) show
0 348 moveto (2375 ) show
0 336 moveto (2376 ) show
0 324 moveto (2377 ) show
0 312 moveto (2378 ) show
0 300 moveto (2379 ) show
0 288 moveto (2380 ) show
0 276 moveto (2381 ) show
0 264 moveto (2382 ) show
0 252 moveto (2383 ) show
0 240 moveto (2384 ) show
0 228 moveto (2385 ) show
0 216 moveto (2386 ) show
0 204 moveto (2387 ) show
0 192 moveto (2388 ) show
0 180 moveto (2389 ) show
0 168 moveto (2390 ) show
0 156 moveto (2391 ) show
0 144 moveto (2392 ) show
0 132 moveto (2393 ) show
0 120 moveto (2394 ) show
0 108 moveto (2395 ) show
0 96 moveto (2396 ) show
0 84 moveto (2397 ) show
0 72 moveto (2398 ) show
0 60 moveto (2399 ) show
0 24 moveto (Sheet 23) show
grestore
restore
showpage
%%Page: 33 33
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 1) show
0 648 moveto (2400 #include "types.h") show
0 636 moveto (2401 #include "defs.h") show
0 624 moveto (2402 #include "param.h") show
0 612 moveto (2403 #include "memlayout.h") show
0 600 moveto (2404 #include "mmu.h") show
0 588 moveto (2405 #include "x86.h") show
0 576 moveto (2406 #include "proc.h") show
0 564 moveto (2407 #include "spinlock.h") show
0 552 moveto (2408 ) show
0 540 moveto (2409 struct {) show
0 528 moveto (2410   struct spinlock lock;) show
0 516 moveto (2411   struct proc proc[NPROC];) show
0 504 moveto (2412 } ptable;) show
0 492 moveto (2413 ) show
0 480 moveto (2414 static struct proc *initproc;) show
0 468 moveto (2415 ) show
0 456 moveto (2416 int nextpid = 1;) show
0 444 moveto (2417 extern void forkret\(void\);) show
0 432 moveto (2418 extern void trapret\(void\);) show
0 420 moveto (2419 ) show
0 408 moveto (2420 static void wakeup1\(void *chan\);) show
0 396 moveto (2421 ) show
0 384 moveto (2422 void) show
0 372 moveto (2423 pinit\(void\)) show
0 360 moveto (2424 {) show
0 348 moveto (2425   initlock\(&ptable.lock, "ptable"\);) show
0 336 moveto (2426 }) show
0 324 moveto (2427 ) show
0 312 moveto (2428 // Must be called with interrupts disabled) show
0 300 moveto (2429 int) show
0 288 moveto (2430 cpuid\(\) {) show
0 276 moveto (2431   return mycpu\(\)-cpus;) show
0 264 moveto (2432 }) show
0 252 moveto (2433 ) show
0 240 moveto (2434 // Must be called with interrupts disabled to avoid the caller being) show
0 228 moveto (2435 // rescheduled between reading lapicid and running through the loop.) show
0 216 moveto (2436 struct cpu*) show
0 204 moveto (2437 mycpu\(void\)) show
0 192 moveto (2438 {) show
0 180 moveto (2439   int apicid, i;) show
0 168 moveto (2440 ) show
0 156 moveto (2441   if\(readeflags\(\)&FL_IF\)) show
0 144 moveto (2442     panic\("mycpu called with interrupts enabled\\n"\);) show
0 132 moveto (2443 ) show
0 120 moveto (2444   apicid = lapicid\(\);) show
0 108 moveto (2445   // APIC IDs are not guaranteed to be contiguous. Maybe we should have) show
0 96 moveto (2446   // a reverse map, or reserve a register to store &cpus[i].) show
0 84 moveto (2447   for \(i = 0; i < ncpu; ++i\) {) show
0 72 moveto (2448     if \(cpus[i].apicid == apicid\)) show
0 60 moveto (2449       return &cpus[i];) show
0 24 moveto (Sheet 24) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 2) show
0 648 moveto (2450   }) show
0 636 moveto (2451   panic\("unknown apicid\\n"\);) show
0 624 moveto (2452 }) show
0 612 moveto (2453 ) show
0 600 moveto (2454 // Disable interrupts so that we are not rescheduled) show
0 588 moveto (2455 // while reading proc from the cpu structure) show
0 576 moveto (2456 struct proc*) show
0 564 moveto (2457 myproc\(void\) {) show
0 552 moveto (2458   struct cpu *c;) show
0 540 moveto (2459   struct proc *p;) show
0 528 moveto (2460   pushcli\(\);) show
0 516 moveto (2461   c = mycpu\(\);) show
0 504 moveto (2462   p = c->proc;) show
0 492 moveto (2463   popcli\(\);) show
0 480 moveto (2464   return p;) show
0 468 moveto (2465 }) show
0 456 moveto (2466 ) show
0 444 moveto (2467 ) show
0 432 moveto (2468 // Look in the process table for an UNUSED proc.) show
0 420 moveto (2469 // If found, change state to EMBRYO and initialize) show
0 408 moveto (2470 // state required to run in the kernel.) show
0 396 moveto (2471 // Otherwise return 0.) show
0 384 moveto (2472 static struct proc*) show
0 372 moveto (2473 allocproc\(void\)) show
0 360 moveto (2474 {) show
0 348 moveto (2475   struct proc *p;) show
0 336 moveto (2476   char *sp;) show
0 324 moveto (2477 ) show
0 312 moveto (2478   acquire\(&ptable.lock\);) show
0 300 moveto (2479 ) show
0 288 moveto (2480   for\(p = ptable.proc; p < &ptable.proc[NPROC]; p++\)) show
0 276 moveto (2481     if\(p->state == UNUSED\)) show
0 264 moveto (2482       goto found;) show
0 252 moveto (2483 ) show
0 240 moveto (2484   release\(&ptable.lock\);) show
0 228 moveto (2485   return 0;) show
0 216 moveto (2486 ) show
0 204 moveto (2487 found:) show
0 192 moveto (2488   p->state = EMBRYO;) show
0 180 moveto (2489   p->pid = nextpid++;) show
0 168 moveto (2490 ) show
0 156 moveto (2491   release\(&ptable.lock\);) show
0 144 moveto (2492 ) show
0 132 moveto (2493   // Allocate kernel stack.) show
0 120 moveto (2494   if\(\(p->kstack = kalloc\(\)\) == 0\){) show
0 108 moveto (2495     p->state = UNUSED;) show
0 96 moveto (2496     return 0;) show
0 84 moveto (2497   }) show
0 72 moveto (2498   sp = p->kstack + KSTACKSIZE;) show
0 60 moveto (2499 ) show
0 24 moveto (Sheet 24) show
grestore
restore
showpage
%%Page: 34 34
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 3) show
0 648 moveto (2500   // Leave room for trap frame.) show
0 636 moveto (2501   sp -= sizeof *p->tf;) show
0 624 moveto (2502   p->tf = \(struct trapframe*\)sp;) show
0 612 moveto (2503 ) show
0 600 moveto (2504   // Set up new context to start executing at forkret,) show
0 588 moveto (2505   // which returns to trapret.) show
0 576 moveto (2506   sp -= 4;) show
0 564 moveto (2507   *\(uint*\)sp = \(uint\)trapret;) show
0 552 moveto (2508 ) show
0 540 moveto (2509   sp -= sizeof *p->context;) show
0 528 moveto (2510   p->context = \(struct context*\)sp;) show
0 516 moveto (2511   memset\(p->context, 0, sizeof *p->context\);) show
0 504 moveto (2512   p->context->eip = \(uint\)forkret;) show
0 492 moveto (2513 ) show
0 480 moveto (2514   return p;) show
0 468 moveto (2515 }) show
0 456 moveto (2516 ) show
0 444 moveto (2517 ) show
0 432 moveto (2518 // Set up first user process.) show
0 420 moveto (2519 void) show
0 408 moveto (2520 userinit\(void\)) show
0 396 moveto (2521 {) show
0 384 moveto (2522   struct proc *p;) show
0 372 moveto (2523   extern char _binary_initcode_start[], _binary_initcode_size[];) show
0 360 moveto (2524 ) show
0 348 moveto (2525   p = allocproc\(\);) show
0 336 moveto (2526 ) show
0 324 moveto (2527   initproc = p;) show
0 312 moveto (2528   if\(\(p->pgdir = setupkvm\(\)\) == 0\)) show
0 300 moveto (2529     panic\("userinit: out of memory?"\);) show
0 288 moveto (2530   inituvm\(p->pgdir, _binary_initcode_start, \(int\)_binary_initcode_size\);) show
0 276 moveto (2531   p->sz = PGSIZE;) show
0 264 moveto (2532   memset\(p->tf, 0, sizeof\(*p->tf\)\);) show
0 252 moveto (2533   p->tf->cs = \(SEG_UCODE << 3\) | DPL_USER;) show
0 240 moveto (2534   p->tf->ds = \(SEG_UDATA << 3\) | DPL_USER;) show
0 228 moveto (2535   p->tf->es = p->tf->ds;) show
0 216 moveto (2536   p->tf->ss = p->tf->ds;) show
0 204 moveto (2537   p->tf->eflags = FL_IF;) show
0 192 moveto (2538   p->tf->esp = PGSIZE;) show
0 180 moveto (2539   p->tf->eip = 0;  // beginning of initcode.S) show
0 168 moveto (2540 ) show
0 156 moveto (2541   safestrcpy\(p->name, "initcode", sizeof\(p->name\)\);) show
0 144 moveto (2542   p->cwd = namei\("/"\);) show
0 132 moveto (2543 ) show
0 120 moveto (2544   // this assignment to p->state lets other cores) show
0 108 moveto (2545   // run this process. the acquire forces the above) show
0 96 moveto (2546   // writes to be visible, and the lock is also needed) show
0 84 moveto (2547   // because the assignment might not be atomic.) show
0 72 moveto (2548   acquire\(&ptable.lock\);) show
0 60 moveto (2549 ) show
0 24 moveto (Sheet 25) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 4) show
0 648 moveto (2550   p->state = RUNNABLE;) show
0 636 moveto (2551 ) show
0 624 moveto (2552   release\(&ptable.lock\);) show
0 612 moveto (2553 }) show
0 600 moveto (2554 ) show
0 588 moveto (2555 // Grow current process's memory by n bytes.) show
0 576 moveto (2556 // Return 0 on success, -1 on failure.) show
0 564 moveto (2557 int) show
0 552 moveto (2558 growproc\(int n\)) show
0 540 moveto (2559 {) show
0 528 moveto (2560   uint sz;) show
0 516 moveto (2561   struct proc *curproc = myproc\(\);) show
0 504 moveto (2562 ) show
0 492 moveto (2563   sz = curproc->sz;) show
0 480 moveto (2564   if\(n > 0\){) show
0 468 moveto (2565     if\(\(sz = allocuvm\(curproc->pgdir, sz, sz + n\)\) == 0\)) show
0 456 moveto (2566       return -1;) show
0 444 moveto (2567   } else if\(n < 0\){) show
0 432 moveto (2568     if\(\(sz = deallocuvm\(curproc->pgdir, sz, sz + n\)\) == 0\)) show
0 420 moveto (2569       return -1;) show
0 408 moveto (2570   }) show
0 396 moveto (2571   curproc->sz = sz;) show
0 384 moveto (2572   switchuvm\(curproc\);) show
0 372 moveto (2573   return 0;) show
0 360 moveto (2574 }) show
0 348 moveto (2575 ) show
0 336 moveto (2576 // Create a new process copying p as the parent.) show
0 324 moveto (2577 // Sets up stack to return as if from system call.) show
0 312 moveto (2578 // Caller must set state of returned proc to RUNNABLE.) show
0 300 moveto (2579 int) show
0 288 moveto (2580 fork\(void\)) show
0 276 moveto (2581 {) show
0 264 moveto (2582   int i, pid;) show
0 252 moveto (2583   struct proc *np;) show
0 240 moveto (2584   struct proc *curproc = myproc\(\);) show
0 228 moveto (2585 ) show
0 216 moveto (2586   // Allocate process.) show
0 204 moveto (2587   if\(\(np = allocproc\(\)\) == 0\){) show
0 192 moveto (2588     return -1;) show
0 180 moveto (2589   }) show
0 168 moveto (2590 ) show
0 156 moveto (2591   // Copy process state from proc.) show
0 144 moveto (2592   if\(\(np->pgdir = copyuvm\(curproc->pgdir, curproc->sz\)\) == 0\){) show
0 132 moveto (2593     kfree\(np->kstack\);) show
0 120 moveto (2594     np->kstack = 0;) show
0 108 moveto (2595     np->state = UNUSED;) show
0 96 moveto (2596     return -1;) show
0 84 moveto (2597   }) show
0 72 moveto (2598   np->sz = curproc->sz;) show
0 60 moveto (2599   np->parent = curproc;) show
0 24 moveto (Sheet 25) show
grestore
restore
showpage
%%Page: 35 35
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 5) show
0 648 moveto (2600   *np->tf = *curproc->tf;) show
0 636 moveto (2601 ) show
0 624 moveto (2602   // Clear %eax so that fork returns 0 in the child.) show
0 612 moveto (2603   np->tf->eax = 0;) show
0 600 moveto (2604 ) show
0 588 moveto (2605   for\(i = 0; i < NOFILE; i++\)) show
0 576 moveto (2606     if\(curproc->ofile[i]\)) show
0 564 moveto (2607       np->ofile[i] = filedup\(curproc->ofile[i]\);) show
0 552 moveto (2608   np->cwd = idup\(curproc->cwd\);) show
0 540 moveto (2609 ) show
0 528 moveto (2610   safestrcpy\(np->name, curproc->name, sizeof\(curproc->name\)\);) show
0 516 moveto (2611 ) show
0 504 moveto (2612   pid = np->pid;) show
0 492 moveto (2613 ) show
0 480 moveto (2614   acquire\(&ptable.lock\);) show
0 468 moveto (2615 ) show
0 456 moveto (2616   np->state = RUNNABLE;) show
0 444 moveto (2617 ) show
0 432 moveto (2618   release\(&ptable.lock\);) show
0 420 moveto (2619 ) show
0 408 moveto (2620   return pid;) show
0 396 moveto (2621 }) show
0 384 moveto (2622 ) show
0 372 moveto (2623 // Exit the current process.  Does not return.) show
0 360 moveto (2624 // An exited process remains in the zombie state) show
0 348 moveto (2625 // until its parent calls wait\(\) to find out it exited.) show
0 336 moveto (2626 void) show
0 324 moveto (2627 exit\(void\)) show
0 312 moveto (2628 {) show
0 300 moveto (2629   struct proc *curproc = myproc\(\);) show
0 288 moveto (2630   struct proc *p;) show
0 276 moveto (2631   int fd;) show
0 264 moveto (2632 ) show
0 252 moveto (2633   if\(curproc == initproc\)) show
0 240 moveto (2634     panic\("init exiting"\);) show
0 228 moveto (2635 ) show
0 216 moveto (2636   // Close all open files.) show
0 204 moveto (2637   for\(fd = 0; fd < NOFILE; fd++\){) show
0 192 moveto (2638     if\(curproc->ofile[fd]\){) show
0 180 moveto (2639       fileclose\(curproc->ofile[fd]\);) show
0 168 moveto (2640       curproc->ofile[fd] = 0;) show
0 156 moveto (2641     }) show
0 144 moveto (2642   }) show
0 132 moveto (2643 ) show
0 120 moveto (2644   begin_op\(\);) show
0 108 moveto (2645   iput\(curproc->cwd\);) show
0 96 moveto (2646   end_op\(\);) show
0 84 moveto (2647   curproc->cwd = 0;) show
0 72 moveto (2648 ) show
0 60 moveto (2649   acquire\(&ptable.lock\);) show
0 24 moveto (Sheet 26) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 6) show
0 648 moveto (2650   // Parent might be sleeping in wait\(\).) show
0 636 moveto (2651   wakeup1\(curproc->parent\);) show
0 624 moveto (2652 ) show
0 612 moveto (2653   // Pass abandoned children to init.) show
0 600 moveto (2654   for\(p = ptable.proc; p < &ptable.proc[NPROC]; p++\){) show
0 588 moveto (2655     if\(p->parent == curproc\){) show
0 576 moveto (2656       p->parent = initproc;) show
0 564 moveto (2657       if\(p->state == ZOMBIE\)) show
0 552 moveto (2658         wakeup1\(initproc\);) show
0 540 moveto (2659     }) show
0 528 moveto (2660   }) show
0 516 moveto (2661 ) show
0 504 moveto (2662   // Jump into the scheduler, never to return.) show
0 492 moveto (2663   curproc->state = ZOMBIE;) show
0 480 moveto (2664   sched\(\);) show
0 468 moveto (2665   panic\("zombie exit"\);) show
0 456 moveto (2666 }) show
0 444 moveto (2667 ) show
0 432 moveto (2668 // Wait for a child process to exit and return its pid.) show
0 420 moveto (2669 // Return -1 if this process has no children.) show
0 408 moveto (2670 int) show
0 396 moveto (2671 wait\(void\)) show
0 384 moveto (2672 {) show
0 372 moveto (2673   struct proc *p;) show
0 360 moveto (2674   int havekids, pid;) show
0 348 moveto (2675   struct proc *curproc = myproc\(\);) show
0 336 moveto (2676 ) show
0 324 moveto (2677   acquire\(&ptable.lock\);) show
0 312 moveto (2678   for\(;;\){) show
0 300 moveto (2679     // Scan through table looking for exited children.) show
0 288 moveto (2680     havekids = 0;) show
0 276 moveto (2681     for\(p = ptable.proc; p < &ptable.proc[NPROC]; p++\){) show
0 264 moveto (2682       if\(p->parent != curproc\)) show
0 252 moveto (2683         continue;) show
0 240 moveto (2684       havekids = 1;) show
0 228 moveto (2685       if\(p->state == ZOMBIE\){) show
0 216 moveto (2686         // Found one.) show
0 204 moveto (2687         pid = p->pid;) show
0 192 moveto (2688         kfree\(p->kstack\);) show
0 180 moveto (2689         p->kstack = 0;) show
0 168 moveto (2690         freevm\(p->pgdir\);) show
0 156 moveto (2691         p->pid = 0;) show
0 144 moveto (2692         p->parent = 0;) show
0 132 moveto (2693         p->name[0] = 0;) show
0 120 moveto (2694         p->killed = 0;) show
0 108 moveto (2695         p->state = UNUSED;) show
0 96 moveto (2696         release\(&ptable.lock\);) show
0 84 moveto (2697         return pid;) show
0 72 moveto (2698       }) show
0 60 moveto (2699     }) show
0 24 moveto (Sheet 26) show
grestore
restore
showpage
%%Page: 36 36
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 7) show
0 648 moveto (2700     // No point waiting if we don't have any children.) show
0 636 moveto (2701     if\(!havekids || curproc->killed\){) show
0 624 moveto (2702       release\(&ptable.lock\);) show
0 612 moveto (2703       return -1;) show
0 600 moveto (2704     }) show
0 588 moveto (2705 ) show
0 576 moveto (2706     // Wait for children to exit.  \(See wakeup1 call in proc_exit.\)) show
0 564 moveto (2707     sleep\(curproc, &ptable.lock\);  ) show
0 552 moveto (2708   }) show
0 540 moveto (2709 }) show
0 528 moveto (2710 ) show
0 516 moveto (2711 ) show
0 504 moveto (2712 ) show
0 492 moveto (2713 ) show
0 480 moveto (2714 ) show
0 468 moveto (2715 ) show
0 456 moveto (2716 ) show
0 444 moveto (2717 ) show
0 432 moveto (2718 ) show
0 420 moveto (2719 ) show
0 408 moveto (2720 ) show
0 396 moveto (2721 ) show
0 384 moveto (2722 ) show
0 372 moveto (2723 ) show
0 360 moveto (2724 ) show
0 348 moveto (2725 ) show
0 336 moveto (2726 ) show
0 324 moveto (2727 ) show
0 312 moveto (2728 ) show
0 300 moveto (2729 ) show
0 288 moveto (2730 ) show
0 276 moveto (2731 ) show
0 264 moveto (2732 ) show
0 252 moveto (2733 ) show
0 240 moveto (2734 ) show
0 228 moveto (2735 ) show
0 216 moveto (2736 ) show
0 204 moveto (2737 ) show
0 192 moveto (2738 ) show
0 180 moveto (2739 ) show
0 168 moveto (2740 ) show
0 156 moveto (2741 ) show
0 144 moveto (2742 ) show
0 132 moveto (2743 ) show
0 120 moveto (2744 ) show
0 108 moveto (2745 ) show
0 96 moveto (2746 ) show
0 84 moveto (2747 ) show
0 72 moveto (2748 ) show
0 60 moveto (2749 ) show
0 24 moveto (Sheet 27) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 8) show
0 648 moveto (2750 // Per-CPU process scheduler.) show
0 636 moveto (2751 // Each CPU calls scheduler\(\) after setting itself up.) show
0 624 moveto (2752 // Scheduler never returns.  It loops, doing:) show
0 612 moveto (2753 //  - choose a process to run) show
0 600 moveto (2754 //  - swtch to start running that process) show
0 588 moveto (2755 //  - eventually that process transfers control) show
0 576 moveto (2756 //      via swtch back to the scheduler.) show
0 564 moveto (2757 void) show
0 552 moveto (2758 scheduler\(void\)) show
0 540 moveto (2759 {) show
0 528 moveto (2760   struct proc *p;) show
0 516 moveto (2761   struct cpu *c = mycpu\(\);) show
0 504 moveto (2762   c->proc = 0;) show
0 492 moveto (2763 ) show
0 480 moveto (2764   for\(;;\){) show
0 468 moveto (2765     // Enable interrupts on this processor.) show
0 456 moveto (2766     sti\(\);) show
0 444 moveto (2767 ) show
0 432 moveto (2768     // Loop over process table looking for process to run.) show
0 420 moveto (2769     acquire\(&ptable.lock\);) show
0 408 moveto (2770     for\(p = ptable.proc; p < &ptable.proc[NPROC]; p++\){) show
0 396 moveto (2771       if\(p->state != RUNNABLE\)) show
0 384 moveto (2772         continue;) show
0 372 moveto (2773 ) show
0 360 moveto (2774       // Switch to chosen process.  It is the process's job) show
0 348 moveto (2775       // to release ptable.lock and then reacquire it) show
0 336 moveto (2776       // before jumping back to us.) show
0 324 moveto (2777       c->proc = p;) show
0 312 moveto (2778       switchuvm\(p\);) show
0 300 moveto (2779       p->state = RUNNING;) show
0 288 moveto (2780 ) show
0 276 moveto (2781       swtch\(&\(c->scheduler\), p->context\);) show
0 264 moveto (2782       switchkvm\(\);) show
0 252 moveto (2783 ) show
0 240 moveto (2784       // Process is done running for now.) show
0 228 moveto (2785       // It should have changed its p->state before coming back.) show
0 216 moveto (2786       c->proc = 0;) show
0 204 moveto (2787     }) show
0 192 moveto (2788     release\(&ptable.lock\);) show
0 180 moveto (2789 ) show
0 168 moveto (2790   }) show
0 156 moveto (2791 }) show
0 144 moveto (2792 ) show
0 132 moveto (2793 ) show
0 120 moveto (2794 ) show
0 108 moveto (2795 ) show
0 96 moveto (2796 ) show
0 84 moveto (2797 ) show
0 72 moveto (2798 ) show
0 60 moveto (2799 ) show
0 24 moveto (Sheet 27) show
grestore
restore
showpage
%%Page: 37 37
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 9) show
0 648 moveto (2800 // Enter scheduler.  Must hold only ptable.lock) show
0 636 moveto (2801 // and have changed proc->state. Saves and restores) show
0 624 moveto (2802 // intena because intena is a property of this) show
0 612 moveto (2803 // kernel thread, not this CPU. It should) show
0 600 moveto (2804 // be proc->intena and proc->ncli, but that would) show
0 588 moveto (2805 // break in the few places where a lock is held but) show
0 576 moveto (2806 // there's no process.) show
0 564 moveto (2807 void) show
0 552 moveto (2808 sched\(void\)) show
0 540 moveto (2809 {) show
0 528 moveto (2810   int intena;) show
0 516 moveto (2811   struct proc *p = myproc\(\);) show
0 504 moveto (2812 ) show
0 492 moveto (2813   if\(!holding\(&ptable.lock\)\)) show
0 480 moveto (2814     panic\("sched ptable.lock"\);) show
0 468 moveto (2815   if\(mycpu\(\)->ncli != 1\)) show
0 456 moveto (2816     panic\("sched locks"\);) show
0 444 moveto (2817   if\(p->state == RUNNING\)) show
0 432 moveto (2818     panic\("sched running"\);) show
0 420 moveto (2819   if\(readeflags\(\)&FL_IF\)) show
0 408 moveto (2820     panic\("sched interruptible"\);) show
0 396 moveto (2821   intena = mycpu\(\)->intena;) show
0 384 moveto (2822   swtch\(&p->context, mycpu\(\)->scheduler\);) show
0 372 moveto (2823   mycpu\(\)->intena = intena;) show
0 360 moveto (2824 }) show
0 348 moveto (2825 ) show
0 336 moveto (2826 // Give up the CPU for one scheduling round.) show
0 324 moveto (2827 void) show
0 312 moveto (2828 yield\(void\)) show
0 300 moveto (2829 {) show
0 288 moveto (2830   acquire\(&ptable.lock\);  ) show
0 276 moveto (2831   myproc\(\)->state = RUNNABLE;) show
0 264 moveto (2832   sched\(\);) show
0 252 moveto (2833   release\(&ptable.lock\);) show
0 240 moveto (2834 }) show
0 228 moveto (2835 ) show
0 216 moveto (2836 ) show
0 204 moveto (2837 ) show
0 192 moveto (2838 ) show
0 180 moveto (2839 ) show
0 168 moveto (2840 ) show
0 156 moveto (2841 ) show
0 144 moveto (2842 ) show
0 132 moveto (2843 ) show
0 120 moveto (2844 ) show
0 108 moveto (2845 ) show
0 96 moveto (2846 ) show
0 84 moveto (2847 ) show
0 72 moveto (2848 ) show
0 60 moveto (2849 ) show
0 24 moveto (Sheet 28) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 10) show
0 648 moveto (2850 // A fork child's very first scheduling by scheduler\(\)) show
0 636 moveto (2851 // will swtch here.  "Return" to user space.) show
0 624 moveto (2852 void) show
0 612 moveto (2853 forkret\(void\)) show
0 600 moveto (2854 {) show
0 588 moveto (2855   static int first = 1;) show
0 576 moveto (2856   // Still holding ptable.lock from scheduler.) show
0 564 moveto (2857   release\(&ptable.lock\);) show
0 552 moveto (2858 ) show
0 540 moveto (2859   if \(first\) {) show
0 528 moveto (2860     // Some initialization functions must be run in the context) show
0 516 moveto (2861     // of a regular process \(e.g., they call sleep\), and thus cannot) show
0 504 moveto (2862     // be run from main\(\).) show
0 492 moveto (2863     first = 0;) show
0 480 moveto (2864     iinit\(ROOTDEV\);) show
0 468 moveto (2865     initlog\(ROOTDEV\);) show
0 456 moveto (2866   }) show
0 444 moveto (2867 ) show
0 432 moveto (2868   // Return to "caller", actually trapret \(see allocproc\).) show
0 420 moveto (2869 }) show
0 408 moveto (2870 ) show
0 396 moveto (2871 // Atomically release lock and sleep on chan.) show
0 384 moveto (2872 // Reacquires lock when awakened.) show
0 372 moveto (2873 void) show
0 360 moveto (2874 sleep\(void *chan, struct spinlock *lk\)) show
0 348 moveto (2875 {) show
0 336 moveto (2876   struct proc *p = myproc\(\);) show
0 324 moveto (2877 ) show
0 312 moveto (2878   if\(p == 0\)) show
0 300 moveto (2879     panic\("sleep"\);) show
0 288 moveto (2880 ) show
0 276 moveto (2881   if\(lk == 0\)) show
0 264 moveto (2882     panic\("sleep without lk"\);) show
0 252 moveto (2883 ) show
0 240 moveto (2884   // Must acquire ptable.lock in order to) show
0 228 moveto (2885   // change p->state and then call sched.) show
0 216 moveto (2886   // Once we hold ptable.lock, we can be) show
0 204 moveto (2887   // guaranteed that we won't miss any wakeup) show
0 192 moveto (2888   // \(wakeup runs with ptable.lock locked\),) show
0 180 moveto (2889   // so it's okay to release lk.) show
0 168 moveto (2890   if\(lk != &ptable.lock\){  ) show
0 156 moveto (2891     acquire\(&ptable.lock\);  ) show
0 144 moveto (2892     release\(lk\);) show
0 132 moveto (2893   }) show
0 120 moveto (2894   // Go to sleep.) show
0 108 moveto (2895   p->chan = chan;) show
0 96 moveto (2896   p->state = SLEEPING;) show
0 84 moveto (2897 ) show
0 72 moveto (2898   sched\(\);) show
0 60 moveto (2899 ) show
0 24 moveto (Sheet 28) show
grestore
restore
showpage
%%Page: 38 38
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 11) show
0 648 moveto (2900   // Tidy up.) show
0 636 moveto (2901   p->chan = 0;) show
0 624 moveto (2902 ) show
0 612 moveto (2903   // Reacquire original lock.) show
0 600 moveto (2904   if\(lk != &ptable.lock\){  ) show
0 588 moveto (2905     release\(&ptable.lock\);) show
0 576 moveto (2906     acquire\(lk\);) show
0 564 moveto (2907   }) show
0 552 moveto (2908 }) show
0 540 moveto (2909 ) show
0 528 moveto (2910 ) show
0 516 moveto (2911 ) show
0 504 moveto (2912 ) show
0 492 moveto (2913 ) show
0 480 moveto (2914 ) show
0 468 moveto (2915 ) show
0 456 moveto (2916 ) show
0 444 moveto (2917 ) show
0 432 moveto (2918 ) show
0 420 moveto (2919 ) show
0 408 moveto (2920 ) show
0 396 moveto (2921 ) show
0 384 moveto (2922 ) show
0 372 moveto (2923 ) show
0 360 moveto (2924 ) show
0 348 moveto (2925 ) show
0 336 moveto (2926 ) show
0 324 moveto (2927 ) show
0 312 moveto (2928 ) show
0 300 moveto (2929 ) show
0 288 moveto (2930 ) show
0 276 moveto (2931 ) show
0 264 moveto (2932 ) show
0 252 moveto (2933 ) show
0 240 moveto (2934 ) show
0 228 moveto (2935 ) show
0 216 moveto (2936 ) show
0 204 moveto (2937 ) show
0 192 moveto (2938 ) show
0 180 moveto (2939 ) show
0 168 moveto (2940 ) show
0 156 moveto (2941 ) show
0 144 moveto (2942 ) show
0 132 moveto (2943 ) show
0 120 moveto (2944 ) show
0 108 moveto (2945 ) show
0 96 moveto (2946 ) show
0 84 moveto (2947 ) show
0 72 moveto (2948 ) show
0 60 moveto (2949 ) show
0 24 moveto (Sheet 29) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 12) show
0 648 moveto (2950 // Wake up all processes sleeping on chan.) show
0 636 moveto (2951 // The ptable lock must be held.) show
0 624 moveto (2952 static void) show
0 612 moveto (2953 wakeup1\(void *chan\)) show
0 600 moveto (2954 {) show
0 588 moveto (2955   struct proc *p;) show
0 576 moveto (2956 ) show
0 564 moveto (2957   for\(p = ptable.proc; p < &ptable.proc[NPROC]; p++\)) show
0 552 moveto (2958     if\(p->state == SLEEPING && p->chan == chan\)) show
0 540 moveto (2959       p->state = RUNNABLE;) show
0 528 moveto (2960 }) show
0 516 moveto (2961 ) show
0 504 moveto (2962 // Wake up all processes sleeping on chan.) show
0 492 moveto (2963 void) show
0 480 moveto (2964 wakeup\(void *chan\)) show
0 468 moveto (2965 {) show
0 456 moveto (2966   acquire\(&ptable.lock\);) show
0 444 moveto (2967   wakeup1\(chan\);) show
0 432 moveto (2968   release\(&ptable.lock\);) show
0 420 moveto (2969 }) show
0 408 moveto (2970 ) show
0 396 moveto (2971 // Kill the process with the given pid.) show
0 384 moveto (2972 // Process won't exit until it returns) show
0 372 moveto (2973 // to user space \(see trap in trap.c\).) show
0 360 moveto (2974 int) show
0 348 moveto (2975 kill\(int pid\)) show
0 336 moveto (2976 {) show
0 324 moveto (2977   struct proc *p;) show
0 312 moveto (2978 ) show
0 300 moveto (2979   acquire\(&ptable.lock\);) show
0 288 moveto (2980   for\(p = ptable.proc; p < &ptable.proc[NPROC]; p++\){) show
0 276 moveto (2981     if\(p->pid == pid\){) show
0 264 moveto (2982       p->killed = 1;) show
0 252 moveto (2983       // Wake process from sleep if necessary.) show
0 240 moveto (2984       if\(p->state == SLEEPING\)) show
0 228 moveto (2985         p->state = RUNNABLE;) show
0 216 moveto (2986       release\(&ptable.lock\);) show
0 204 moveto (2987       return 0;) show
0 192 moveto (2988     }) show
0 180 moveto (2989   }) show
0 168 moveto (2990   release\(&ptable.lock\);) show
0 156 moveto (2991   return -1;) show
0 144 moveto (2992 }) show
0 132 moveto (2993 ) show
0 120 moveto (2994 ) show
0 108 moveto (2995 ) show
0 96 moveto (2996 ) show
0 84 moveto (2997 ) show
0 72 moveto (2998 ) show
0 60 moveto (2999 ) show
0 24 moveto (Sheet 29) show
grestore
restore
showpage
%%Page: 39 39
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/proc.c  Page 13) show
0 648 moveto (3000 // Print a process listing to console.  For debugging.) show
0 636 moveto (3001 // Runs when user types ^P on console.) show
0 624 moveto (3002 // No lock to avoid wedging a stuck machine further.) show
0 612 moveto (3003 void) show
0 600 moveto (3004 procdump\(void\)) show
0 588 moveto (3005 {) show
0 576 moveto (3006   static char *states[] = {) show
0 564 moveto (3007   [UNUSED]    "unused",) show
0 552 moveto (3008   [EMBRYO]    "embryo",) show
0 540 moveto (3009   [SLEEPING]  "sleep ",) show
0 528 moveto (3010   [RUNNABLE]  "runble",) show
0 516 moveto (3011   [RUNNING]   "run   ",) show
0 504 moveto (3012   [ZOMBIE]    "zombie") show
0 492 moveto (3013   };) show
0 480 moveto (3014   int i;) show
0 468 moveto (3015   struct proc *p;) show
0 456 moveto (3016   char *state;) show
0 444 moveto (3017   uint pc[10];) show
0 432 moveto (3018 ) show
0 420 moveto (3019   for\(p = ptable.proc; p < &ptable.proc[NPROC]; p++\){) show
0 408 moveto (3020     if\(p->state == UNUSED\)) show
0 396 moveto (3021       continue;) show
0 384 moveto (3022     if\(p->state >= 0 && p->state < NELEM\(states\) && states[p->state]\)) show
0 372 moveto (3023       state = states[p->state];) show
0 360 moveto (3024     else) show
0 348 moveto (3025       state = "???";) show
0 336 moveto (3026     cprintf\("%d %s %s", p->pid, state, p->name\);) show
0 324 moveto (3027     if\(p->state == SLEEPING\){) show
0 312 moveto (3028       getcallerpcs\(\(uint*\)p->context->ebp+2, pc\);) show
0 300 moveto (3029       for\(i=0; i<10 && pc[i] != 0; i++\)) show
0 288 moveto (3030         cprintf\(" %p", pc[i]\);) show
0 276 moveto (3031     }) show
0 264 moveto (3032     cprintf\("\\n"\);) show
0 252 moveto (3033   }) show
0 240 moveto (3034 }) show
0 228 moveto (3035 ) show
0 216 moveto (3036 ) show
0 204 moveto (3037 ) show
0 192 moveto (3038 ) show
0 180 moveto (3039 ) show
0 168 moveto (3040 ) show
0 156 moveto (3041 ) show
0 144 moveto (3042 ) show
0 132 moveto (3043 ) show
0 120 moveto (3044 ) show
0 108 moveto (3045 ) show
0 96 moveto (3046 ) show
0 84 moveto (3047 ) show
0 72 moveto (3048 ) show
0 60 moveto (3049 ) show
0 24 moveto (Sheet 30) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/swtch.S  Page 1) show
0 648 moveto (3050 # Context switch) show
0 636 moveto (3051 #) show
0 624 moveto (3052 #   void swtch\(struct context **old, struct context *new\);) show
0 612 moveto (3053 #) show
0 600 moveto (3054 # Save the current registers on the stack, creating) show
0 588 moveto (3055 # a struct context, and save its address in *old.) show
0 576 moveto (3056 # Switch stacks to new and pop previously-saved registers.) show
0 564 moveto (3057 ) show
0 552 moveto (3058 .globl swtch) show
0 540 moveto (3059 swtch:) show
0 528 moveto (3060   movl 4\(%esp\), %eax) show
0 516 moveto (3061   movl 8\(%esp\), %edx) show
0 504 moveto (3062 ) show
0 492 moveto (3063   # Save old callee-saved registers) show
0 480 moveto (3064   pushl %ebp) show
0 468 moveto (3065   pushl %ebx) show
0 456 moveto (3066   pushl %esi) show
0 444 moveto (3067   pushl %edi) show
0 432 moveto (3068 ) show
0 420 moveto (3069   # Switch stacks) show
0 408 moveto (3070   movl %esp, \(%eax\)) show
0 396 moveto (3071   movl %edx, %esp) show
0 384 moveto (3072 ) show
0 372 moveto (3073   # Load new callee-saved registers) show
0 360 moveto (3074   popl %edi) show
0 348 moveto (3075   popl %esi) show
0 336 moveto (3076   popl %ebx) show
0 324 moveto (3077   popl %ebp) show
0 312 moveto (3078   ret) show
0 300 moveto (3079 ) show
0 288 moveto (3080 ) show
0 276 moveto (3081 ) show
0 264 moveto (3082 ) show
0 252 moveto (3083 ) show
0 240 moveto (3084 ) show
0 228 moveto (3085 ) show
0 216 moveto (3086 ) show
0 204 moveto (3087 ) show
0 192 moveto (3088 ) show
0 180 moveto (3089 ) show
0 168 moveto (3090 ) show
0 156 moveto (3091 ) show
0 144 moveto (3092 ) show
0 132 moveto (3093 ) show
0 120 moveto (3094 ) show
0 108 moveto (3095 ) show
0 96 moveto (3096 ) show
0 84 moveto (3097 ) show
0 72 moveto (3098 ) show
0 60 moveto (3099 ) show
0 24 moveto (Sheet 30) show
grestore
restore
showpage
%%Page: 40 40
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/kalloc.c  Page 1) show
0 648 moveto (3100 // Physical memory allocator, intended to allocate) show
0 636 moveto (3101 // memory for user processes, kernel stacks, page table pages,) show
0 624 moveto (3102 // and pipe buffers. Allocates 4096-byte pages.) show
0 612 moveto (3103 ) show
0 600 moveto (3104 #include "types.h") show
0 588 moveto (3105 #include "defs.h") show
0 576 moveto (3106 #include "param.h") show
0 564 moveto (3107 #include "memlayout.h") show
0 552 moveto (3108 #include "mmu.h") show
0 540 moveto (3109 #include "spinlock.h") show
0 528 moveto (3110 ) show
0 516 moveto (3111 void freerange\(void *vstart, void *vend\);) show
0 504 moveto (3112 extern char end[]; // first address after kernel loaded from ELF file) show
0 492 moveto (3113                    // defined by the kernel linker script in kernel.ld) show
0 480 moveto (3114 ) show
0 468 moveto (3115 struct run {) show
0 456 moveto (3116   struct run *next;) show
0 444 moveto (3117 };) show
0 432 moveto (3118 ) show
0 420 moveto (3119 struct {) show
0 408 moveto (3120   struct spinlock lock;) show
0 396 moveto (3121   int use_lock;) show
0 384 moveto (3122   struct run *freelist;) show
0 372 moveto (3123 } kmem;) show
0 360 moveto (3124 ) show
0 348 moveto (3125 // Initialization happens in two phases.) show
0 336 moveto (3126 // 1. main\(\) calls kinit1\(\) while still using entrypgdir to place just) show
0 324 moveto (3127 // the pages mapped by entrypgdir on free list.) show
0 312 moveto (3128 // 2. main\(\) calls kinit2\(\) with the rest of the physical pages) show
0 300 moveto (3129 // after installing a full page table that maps them on all cores.) show
0 288 moveto (3130 void) show
0 276 moveto (3131 kinit1\(void *vstart, void *vend\)) show
0 264 moveto (3132 {) show
0 252 moveto (3133   initlock\(&kmem.lock, "kmem"\);) show
0 240 moveto (3134   kmem.use_lock = 0;) show
0 228 moveto (3135   freerange\(vstart, vend\);) show
0 216 moveto (3136 }) show
0 204 moveto (3137 ) show
0 192 moveto (3138 void) show
0 180 moveto (3139 kinit2\(void *vstart, void *vend\)) show
0 168 moveto (3140 {) show
0 156 moveto (3141   freerange\(vstart, vend\);) show
0 144 moveto (3142   kmem.use_lock = 1;) show
0 132 moveto (3143 }) show
0 120 moveto (3144 ) show
0 108 moveto (3145 ) show
0 96 moveto (3146 ) show
0 84 moveto (3147 ) show
0 72 moveto (3148 ) show
0 60 moveto (3149 ) show
0 24 moveto (Sheet 31) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/kalloc.c  Page 2) show
0 648 moveto (3150 void) show
0 636 moveto (3151 freerange\(void *vstart, void *vend\)) show
0 624 moveto (3152 {) show
0 612 moveto (3153   char *p;) show
0 600 moveto (3154   p = \(char*\)PGROUNDUP\(\(uint\)vstart\);) show
0 588 moveto (3155   for\(; p + PGSIZE <= \(char*\)vend; p += PGSIZE\)) show
0 576 moveto (3156     kfree\(p\);) show
0 564 moveto (3157 }) show
0 552 moveto (3158 ) show
0 540 moveto (3159 // Free the page of physical memory pointed at by v,) show
0 528 moveto (3160 // which normally should have been returned by a) show
0 516 moveto (3161 // call to kalloc\(\).  \(The exception is when) show
0 504 moveto (3162 // initializing the allocator; see kinit above.\)) show
0 492 moveto (3163 void) show
0 480 moveto (3164 kfree\(char *v\)) show
0 468 moveto (3165 {) show
0 456 moveto (3166   struct run *r;) show
0 444 moveto (3167 ) show
0 432 moveto (3168   if\(\(uint\)v % PGSIZE || v < end || V2P\(v\) >= PHYSTOP\)) show
0 420 moveto (3169     panic\("kfree"\);) show
0 408 moveto (3170 ) show
0 396 moveto (3171   // Fill with junk to catch dangling refs.) show
0 384 moveto (3172   memset\(v, 1, PGSIZE\);) show
0 372 moveto (3173 ) show
0 360 moveto (3174   if\(kmem.use_lock\)) show
0 348 moveto (3175     acquire\(&kmem.lock\);) show
0 336 moveto (3176   r = \(struct run*\)v;) show
0 324 moveto (3177   r->next = kmem.freelist;) show
0 312 moveto (3178   kmem.freelist = r;) show
0 300 moveto (3179   if\(kmem.use_lock\)) show
0 288 moveto (3180     release\(&kmem.lock\);) show
0 276 moveto (3181 }) show
0 264 moveto (3182 ) show
0 252 moveto (3183 // Allocate one 4096-byte page of physical memory.) show
0 240 moveto (3184 // Returns a pointer that the kernel can use.) show
0 228 moveto (3185 // Returns 0 if the memory cannot be allocated.) show
0 216 moveto (3186 char*) show
0 204 moveto (3187 kalloc\(void\)) show
0 192 moveto (3188 {) show
0 180 moveto (3189   struct run *r;) show
0 168 moveto (3190 ) show
0 156 moveto (3191   if\(kmem.use_lock\)) show
0 144 moveto (3192     acquire\(&kmem.lock\);) show
0 132 moveto (3193   r = kmem.freelist;) show
0 120 moveto (3194   if\(r\)) show
0 108 moveto (3195     kmem.freelist = r->next;) show
0 96 moveto (3196   if\(kmem.use_lock\)) show
0 84 moveto (3197     release\(&kmem.lock\);) show
0 72 moveto (3198   return \(char*\)r;) show
0 60 moveto (3199 }) show
0 24 moveto (Sheet 31) show
grestore
restore
showpage
%%Page: 41 41
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/traps.h  Page 1) show
0 648 moveto (3200 // x86 trap and interrupt constants.) show
0 636 moveto (3201 ) show
0 624 moveto (3202 // Processor-defined:) show
0 612 moveto (3203 #define T_DIVIDE         0      // divide error) show
0 600 moveto (3204 #define T_DEBUG          1      // debug exception) show
0 588 moveto (3205 #define T_NMI            2      // non-maskable interrupt) show
0 576 moveto (3206 #define T_BRKPT          3      // breakpoint) show
0 564 moveto (3207 #define T_OFLOW          4      // overflow) show
0 552 moveto (3208 #define T_BOUND          5      // bounds check) show
0 540 moveto (3209 #define T_ILLOP          6      // illegal opcode) show
0 528 moveto (3210 #define T_DEVICE         7      // device not available) show
0 516 moveto (3211 #define T_DBLFLT         8      // double fault) show
0 504 moveto (3212 // #define T_COPROC      9      // reserved \(not used since 486\)) show
0 492 moveto (3213 #define T_TSS           10      // invalid task switch segment) show
0 480 moveto (3214 #define T_SEGNP         11      // segment not present) show
0 468 moveto (3215 #define T_STACK         12      // stack exception) show
0 456 moveto (3216 #define T_GPFLT         13      // general protection fault) show
0 444 moveto (3217 #define T_PGFLT         14      // page fault) show
0 432 moveto (3218 // #define T_RES        15      // reserved) show
0 420 moveto (3219 #define T_FPERR         16      // floating point error) show
0 408 moveto (3220 #define T_ALIGN         17      // aligment check) show
0 396 moveto (3221 #define T_MCHK          18      // machine check) show
0 384 moveto (3222 #define T_SIMDERR       19      // SIMD floating point error) show
0 372 moveto (3223 ) show
0 360 moveto (3224 // These are arbitrarily chosen, but with care not to overlap) show
0 348 moveto (3225 // processor defined exceptions or interrupt vectors.) show
0 336 moveto (3226 #define T_SYSCALL       64      // system call) show
0 324 moveto (3227 #define T_DEFAULT      500      // catchall) show
0 312 moveto (3228 ) show
0 300 moveto (3229 #define T_IRQ0          32      // IRQ 0 corresponds to int T_IRQ) show
0 288 moveto (3230 ) show
0 276 moveto (3231 #define IRQ_TIMER        0) show
0 264 moveto (3232 #define IRQ_KBD          1) show
0 252 moveto (3233 #define IRQ_COM1         4) show
0 240 moveto (3234 #define IRQ_IDE         14) show
0 228 moveto (3235 #define IRQ_ERROR       19) show
0 216 moveto (3236 #define IRQ_SPURIOUS    31) show
0 204 moveto (3237 ) show
0 192 moveto (3238 ) show
0 180 moveto (3239 ) show
0 168 moveto (3240 ) show
0 156 moveto (3241 ) show
0 144 moveto (3242 ) show
0 132 moveto (3243 ) show
0 120 moveto (3244 ) show
0 108 moveto (3245 ) show
0 96 moveto (3246 ) show
0 84 moveto (3247 ) show
0 72 moveto (3248 ) show
0 60 moveto (3249 ) show
0 24 moveto (Sheet 32) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/vectors.pl  Page 1) show
0 648 moveto (3250 #!/usr/bin/perl -w) show
0 636 moveto (3251 ) show
0 624 moveto (3252 # Generate vectors.S, the trap/interrupt entry points.) show
0 612 moveto (3253 # There has to be one entry point per interrupt number) show
0 600 moveto (3254 # since otherwise there's no way for trap\(\) to discover) show
0 588 moveto (3255 # the interrupt number.) show
0 576 moveto (3256 ) show
0 564 moveto (3257 print "# generated by vectors.pl - do not edit\\n";) show
0 552 moveto (3258 print "# handlers\\n";) show
0 540 moveto (3259 print ".globl alltraps\\n";) show
0 528 moveto (3260 for\(my $i = 0; $i < 256; $i++\){) show
0 516 moveto (3261     print ".globl vector$i\\n";) show
0 504 moveto (3262     print "vector$i:\\n";) show
0 492 moveto (3263     if\(!\($i == 8 || \($i >= 10 && $i <= 14\) || $i == 17\)\){) show
0 480 moveto (3264         print "  pushl \\$0\\n";) show
0 468 moveto (3265     }) show
0 456 moveto (3266     print "  pushl \\$$i\\n";) show
0 444 moveto (3267     print "  jmp alltraps\\n";) show
0 432 moveto (3268 }) show
0 420 moveto (3269 ) show
0 408 moveto (3270 print "\\n# vector table\\n";) show
0 396 moveto (3271 print ".data\\n";) show
0 384 moveto (3272 print ".globl vectors\\n";) show
0 372 moveto (3273 print "vectors:\\n";) show
0 360 moveto (3274 for\(my $i = 0; $i < 256; $i++\){) show
0 348 moveto (3275     print "  .long vector$i\\n";) show
0 336 moveto (3276 }) show
0 324 moveto (3277 ) show
0 312 moveto (3278 # sample output:) show
0 300 moveto (3279 #   # handlers) show
0 288 moveto (3280 #   .globl alltraps) show
0 276 moveto (3281 #   .globl vector0) show
0 264 moveto (3282 #   vector0:) show
0 252 moveto (3283 #     pushl $0) show
0 240 moveto (3284 #     pushl $0) show
0 228 moveto (3285 #     jmp alltraps) show
0 216 moveto (3286 #   ...) show
0 204 moveto (3287 #) show
0 192 moveto (3288 #   # vector table) show
0 180 moveto (3289 #   .data) show
0 168 moveto (3290 #   .globl vectors) show
0 156 moveto (3291 #   vectors:) show
0 144 moveto (3292 #     .long vector0) show
0 132 moveto (3293 #     .long vector1) show
0 120 moveto (3294 #     .long vector2) show
0 108 moveto (3295 #   ...) show
0 96 moveto (3296 ) show
0 84 moveto (3297 ) show
0 72 moveto (3298 ) show
0 60 moveto (3299 ) show
0 24 moveto (Sheet 32) show
grestore
restore
showpage
%%Page: 42 42
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/trapasm.S  Page 1) show
0 648 moveto (3300 #include "mmu.h") show
0 636 moveto (3301 ) show
0 624 moveto (3302   # vectors.S sends all traps here.) show
0 612 moveto (3303 .globl alltraps) show
0 600 moveto (3304 alltraps:) show
0 588 moveto (3305   # Build trap frame.) show
0 576 moveto (3306   pushl %ds) show
0 564 moveto (3307   pushl %es) show
0 552 moveto (3308   pushl %fs) show
0 540 moveto (3309   pushl %gs) show
0 528 moveto (3310   pushal) show
0 516 moveto (3311 ) show
0 504 moveto (3312   # Set up data segments.) show
0 492 moveto (3313   movw $\(SEG_KDATA<<3\), %ax) show
0 480 moveto (3314   movw %ax, %ds) show
0 468 moveto (3315   movw %ax, %es) show
0 456 moveto (3316 ) show
0 444 moveto (3317   # Call trap\(tf\), where tf=%esp) show
0 432 moveto (3318   pushl %esp) show
0 420 moveto (3319   call trap) show
0 408 moveto (3320   addl $4, %esp) show
0 396 moveto (3321 ) show
0 384 moveto (3322   # Return falls through to trapret...) show
0 372 moveto (3323 .globl trapret) show
0 360 moveto (3324 trapret:) show
0 348 moveto (3325   popal) show
0 336 moveto (3326   popl %gs) show
0 324 moveto (3327   popl %fs) show
0 312 moveto (3328   popl %es) show
0 300 moveto (3329   popl %ds) show
0 288 moveto (3330   addl $0x8, %esp  # trapno and errcode) show
0 276 moveto (3331   iret) show
0 264 moveto (3332 ) show
0 252 moveto (3333 ) show
0 240 moveto (3334 ) show
0 228 moveto (3335 ) show
0 216 moveto (3336 ) show
0 204 moveto (3337 ) show
0 192 moveto (3338 ) show
0 180 moveto (3339 ) show
0 168 moveto (3340 ) show
0 156 moveto (3341 ) show
0 144 moveto (3342 ) show
0 132 moveto (3343 ) show
0 120 moveto (3344 ) show
0 108 moveto (3345 ) show
0 96 moveto (3346 ) show
0 84 moveto (3347 ) show
0 72 moveto (3348 ) show
0 60 moveto (3349 ) show
0 24 moveto (Sheet 33) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/trap.c  Page 1) show
0 648 moveto (3350 #include "types.h") show
0 636 moveto (3351 #include "defs.h") show
0 624 moveto (3352 #include "param.h") show
0 612 moveto (3353 #include "memlayout.h") show
0 600 moveto (3354 #include "mmu.h") show
0 588 moveto (3355 #include "proc.h") show
0 576 moveto (3356 #include "x86.h") show
0 564 moveto (3357 #include "traps.h") show
0 552 moveto (3358 #include "spinlock.h") show
0 540 moveto (3359 ) show
0 528 moveto (3360 // Interrupt descriptor table \(shared by all CPUs\).) show
0 516 moveto (3361 struct gatedesc idt[256];) show
0 504 moveto (3362 extern uint vectors[];  // in vectors.S: array of 256 entry pointers) show
0 492 moveto (3363 struct spinlock tickslock;) show
0 480 moveto (3364 uint ticks;) show
0 468 moveto (3365 ) show
0 456 moveto (3366 void) show
0 444 moveto (3367 tvinit\(void\)) show
0 432 moveto (3368 {) show
0 420 moveto (3369   int i;) show
0 408 moveto (3370 ) show
0 396 moveto (3371   for\(i = 0; i < 256; i++\)) show
0 384 moveto (3372     SETGATE\(idt[i], 0, SEG_KCODE<<3, vectors[i], 0\);) show
0 372 moveto (3373   SETGATE\(idt[T_SYSCALL], 1, SEG_KCODE<<3, vectors[T_SYSCALL], DPL_USER\);) show
0 360 moveto (3374 ) show
0 348 moveto (3375   initlock\(&tickslock, "time"\);) show
0 336 moveto (3376 }) show
0 324 moveto (3377 ) show
0 312 moveto (3378 void) show
0 300 moveto (3379 idtinit\(void\)) show
0 288 moveto (3380 {) show
0 276 moveto (3381   lidt\(idt, sizeof\(idt\)\);) show
0 264 moveto (3382 }) show
0 252 moveto (3383 ) show
0 240 moveto (3384 ) show
0 228 moveto (3385 ) show
0 216 moveto (3386 ) show
0 204 moveto (3387 ) show
0 192 moveto (3388 ) show
0 180 moveto (3389 ) show
0 168 moveto (3390 ) show
0 156 moveto (3391 ) show
0 144 moveto (3392 ) show
0 132 moveto (3393 ) show
0 120 moveto (3394 ) show
0 108 moveto (3395 ) show
0 96 moveto (3396 ) show
0 84 moveto (3397 ) show
0 72 moveto (3398 ) show
0 60 moveto (3399 ) show
0 24 moveto (Sheet 33) show
grestore
restore
showpage
%%Page: 43 43
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/trap.c  Page 2) show
0 648 moveto (3400 void) show
0 636 moveto (3401 trap\(struct trapframe *tf\)) show
0 624 moveto (3402 {) show
0 612 moveto (3403   if\(tf->trapno == T_SYSCALL\){) show
0 600 moveto (3404     if\(myproc\(\)->killed\)) show
0 588 moveto (3405       exit\(\);) show
0 576 moveto (3406     myproc\(\)->tf = tf;) show
0 564 moveto (3407     syscall\(\);) show
0 552 moveto (3408     if\(myproc\(\)->killed\)) show
0 540 moveto (3409       exit\(\);) show
0 528 moveto (3410     return;) show
0 516 moveto (3411   }) show
0 504 moveto (3412 ) show
0 492 moveto (3413   switch\(tf->trapno\){) show
0 480 moveto (3414   case T_IRQ0 + IRQ_TIMER:) show
0 468 moveto (3415     if\(cpuid\(\) == 0\){) show
0 456 moveto (3416       acquire\(&tickslock\);) show
0 444 moveto (3417       ticks++;) show
0 432 moveto (3418       wakeup\(&ticks\);) show
0 420 moveto (3419       release\(&tickslock\);) show
0 408 moveto (3420     }) show
0 396 moveto (3421     lapiceoi\(\);) show
0 384 moveto (3422     break;) show
0 372 moveto (3423   case T_IRQ0 + IRQ_IDE:) show
0 360 moveto (3424     ideintr\(\);) show
0 348 moveto (3425     lapiceoi\(\);) show
0 336 moveto (3426     break;) show
0 324 moveto (3427   case T_IRQ0 + IRQ_IDE+1:) show
0 312 moveto (3428     // Bochs generates spurious IDE1 interrupts.) show
0 300 moveto (3429     break;) show
0 288 moveto (3430   case T_IRQ0 + IRQ_KBD:) show
0 276 moveto (3431     kbdintr\(\);) show
0 264 moveto (3432     lapiceoi\(\);) show
0 252 moveto (3433     break;) show
0 240 moveto (3434   case T_IRQ0 + IRQ_COM1:) show
0 228 moveto (3435     uartintr\(\);) show
0 216 moveto (3436     lapiceoi\(\);) show
0 204 moveto (3437     break;) show
0 192 moveto (3438   case T_IRQ0 + 7:) show
0 180 moveto (3439   case T_IRQ0 + IRQ_SPURIOUS:) show
0 168 moveto (3440     cprintf\("cpu%d: spurious interrupt at %x:%x\\n",) show
0 156 moveto (3441             cpuid\(\), tf->cs, tf->eip\);) show
0 144 moveto (3442     lapiceoi\(\);) show
0 132 moveto (3443     break;) show
0 120 moveto (3444 ) show
0 108 moveto (3445 ) show
0 96 moveto (3446 ) show
0 84 moveto (3447 ) show
0 72 moveto (3448 ) show
0 60 moveto (3449 ) show
0 24 moveto (Sheet 34) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/trap.c  Page 3) show
0 648 moveto (3450   default:) show
0 636 moveto (3451     if\(myproc\(\) == 0 || \(tf->cs&3\) == 0\){) show
0 624 moveto (3452       // In kernel, it must be our mistake.) show
0 612 moveto (3453       cprintf\("unexpected trap %d from cpu %d eip %x \(cr2=0x%x\)\\n",) show
0 600 moveto (3454               tf->trapno, cpuid\(\), tf->eip, rcr2\(\)\);) show
0 588 moveto (3455       panic\("trap"\);) show
0 576 moveto (3456     }) show
0 564 moveto (3457     // In user space, assume process misbehaved.) show
0 552 moveto (3458     cprintf\("pid %d %s: trap %d err %d on cpu %d ") show
0 540 moveto (3459             "eip 0x%x addr 0x%x--kill proc\\n",) show
0 528 moveto (3460             myproc\(\)->pid, myproc\(\)->name, tf->trapno,) show
0 516 moveto (3461             tf->err, cpuid\(\), tf->eip, rcr2\(\)\);) show
0 504 moveto (3462     myproc\(\)->killed = 1;) show
0 492 moveto (3463   }) show
0 480 moveto (3464 ) show
0 468 moveto (3465   // Force process exit if it has been killed and is in user space.) show
0 456 moveto (3466   // \(If it is still executing in the kernel, let it keep running) show
0 444 moveto (3467   // until it gets to the regular system call return.\)) show
0 432 moveto (3468   if\(myproc\(\) && myproc\(\)->killed && \(tf->cs&3\) == DPL_USER\)) show
0 420 moveto (3469     exit\(\);) show
0 408 moveto (3470 ) show
0 396 moveto (3471   // Force process to give up CPU on clock tick.) show
0 384 moveto (3472   // If interrupts were on while locks held, would need to check nlock.) show
0 372 moveto (3473   if\(myproc\(\) && myproc\(\)->state == RUNNING &&) show
0 360 moveto (3474      tf->trapno == T_IRQ0+IRQ_TIMER\)) show
0 348 moveto (3475     yield\(\);) show
0 336 moveto (3476 ) show
0 324 moveto (3477   // Check if the process has been killed since we yielded) show
0 312 moveto (3478   if\(myproc\(\) && myproc\(\)->killed && \(tf->cs&3\) == DPL_USER\)) show
0 300 moveto (3479     exit\(\);) show
0 288 moveto (3480 }) show
0 276 moveto (3481 ) show
0 264 moveto (3482 ) show
0 252 moveto (3483 ) show
0 240 moveto (3484 ) show
0 228 moveto (3485 ) show
0 216 moveto (3486 ) show
0 204 moveto (3487 ) show
0 192 moveto (3488 ) show
0 180 moveto (3489 ) show
0 168 moveto (3490 ) show
0 156 moveto (3491 ) show
0 144 moveto (3492 ) show
0 132 moveto (3493 ) show
0 120 moveto (3494 ) show
0 108 moveto (3495 ) show
0 96 moveto (3496 ) show
0 84 moveto (3497 ) show
0 72 moveto (3498 ) show
0 60 moveto (3499 ) show
0 24 moveto (Sheet 34) show
grestore
restore
showpage
%%Page: 44 44
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/syscall.h  Page 1) show
0 648 moveto (3500 // System call numbers) show
0 636 moveto (3501 #define SYS_fork    1) show
0 624 moveto (3502 #define SYS_exit    2) show
0 612 moveto (3503 #define SYS_wait    3) show
0 600 moveto (3504 #define SYS_pipe    4) show
0 588 moveto (3505 #define SYS_read    5) show
0 576 moveto (3506 #define SYS_kill    6) show
0 564 moveto (3507 #define SYS_exec    7) show
0 552 moveto (3508 #define SYS_fstat   8) show
0 540 moveto (3509 #define SYS_chdir   9) show
0 528 moveto (3510 #define SYS_dup    10) show
0 516 moveto (3511 #define SYS_getpid 11) show
0 504 moveto (3512 #define SYS_sbrk   12) show
0 492 moveto (3513 #define SYS_sleep  13) show
0 480 moveto (3514 #define SYS_uptime 14) show
0 468 moveto (3515 #define SYS_open   15) show
0 456 moveto (3516 #define SYS_write  16) show
0 444 moveto (3517 #define SYS_mknod  17) show
0 432 moveto (3518 #define SYS_unlink 18) show
0 420 moveto (3519 #define SYS_link   19) show
0 408 moveto (3520 #define SYS_mkdir  20) show
0 396 moveto (3521 #define SYS_close  21) show
0 384 moveto (3522 ) show
0 372 moveto (3523 ) show
0 360 moveto (3524 ) show
0 348 moveto (3525 ) show
0 336 moveto (3526 ) show
0 324 moveto (3527 ) show
0 312 moveto (3528 ) show
0 300 moveto (3529 ) show
0 288 moveto (3530 ) show
0 276 moveto (3531 ) show
0 264 moveto (3532 ) show
0 252 moveto (3533 ) show
0 240 moveto (3534 ) show
0 228 moveto (3535 ) show
0 216 moveto (3536 ) show
0 204 moveto (3537 ) show
0 192 moveto (3538 ) show
0 180 moveto (3539 ) show
0 168 moveto (3540 ) show
0 156 moveto (3541 ) show
0 144 moveto (3542 ) show
0 132 moveto (3543 ) show
0 120 moveto (3544 ) show
0 108 moveto (3545 ) show
0 96 moveto (3546 ) show
0 84 moveto (3547 ) show
0 72 moveto (3548 ) show
0 60 moveto (3549 ) show
0 24 moveto (Sheet 35) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/syscall.c  Page 1) show
0 648 moveto (3550 #include "types.h") show
0 636 moveto (3551 #include "defs.h") show
0 624 moveto (3552 #include "param.h") show
0 612 moveto (3553 #include "memlayout.h") show
0 600 moveto (3554 #include "mmu.h") show
0 588 moveto (3555 #include "proc.h") show
0 576 moveto (3556 #include "x86.h") show
0 564 moveto (3557 #include "syscall.h") show
0 552 moveto (3558 ) show
0 540 moveto (3559 // User code makes a system call with INT T_SYSCALL.) show
0 528 moveto (3560 // System call number in %eax.) show
0 516 moveto (3561 // Arguments on the stack, from the user call to the C) show
0 504 moveto (3562 // library system call function. The saved user %esp points) show
0 492 moveto (3563 // to a saved program counter, and then the first argument.) show
0 480 moveto (3564 ) show
0 468 moveto (3565 // Fetch the int at addr from the current process.) show
0 456 moveto (3566 int) show
0 444 moveto (3567 fetchint\(uint addr, int *ip\)) show
0 432 moveto (3568 {) show
0 420 moveto (3569   struct proc *curproc = myproc\(\);) show
0 408 moveto (3570 ) show
0 396 moveto (3571   if\(addr >= curproc->sz || addr+4 > curproc->sz\)) show
0 384 moveto (3572     return -1;) show
0 372 moveto (3573   *ip = *\(int*\)\(addr\);) show
0 360 moveto (3574   return 0;) show
0 348 moveto (3575 }) show
0 336 moveto (3576 ) show
0 324 moveto (3577 // Fetch the nul-terminated string at addr from the current process.) show
0 312 moveto (3578 // Doesn't actually copy the string - just sets *pp to point at it.) show
0 300 moveto (3579 // Returns length of string, not including nul.) show
0 288 moveto (3580 int) show
0 276 moveto (3581 fetchstr\(uint addr, char **pp\)) show
0 264 moveto (3582 {) show
0 252 moveto (3583   char *s, *ep;) show
0 240 moveto (3584   struct proc *curproc = myproc\(\);) show
0 228 moveto (3585 ) show
0 216 moveto (3586   if\(addr >= curproc->sz\)) show
0 204 moveto (3587     return -1;) show
0 192 moveto (3588   *pp = \(char*\)addr;) show
0 180 moveto (3589   ep = \(char*\)curproc->sz;) show
0 168 moveto (3590   for\(s = *pp; s < ep; s++\){) show
0 156 moveto (3591     if\(*s == 0\)) show
0 144 moveto (3592       return s - *pp;) show
0 132 moveto (3593   }) show
0 120 moveto (3594   return -1;) show
0 108 moveto (3595 }) show
0 96 moveto (3596 ) show
0 84 moveto (3597 ) show
0 72 moveto (3598 ) show
0 60 moveto (3599 ) show
0 24 moveto (Sheet 35) show
grestore
restore
showpage
%%Page: 45 45
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/syscall.c  Page 2) show
0 648 moveto (3600 // Fetch the nth 32-bit system call argument.) show
0 636 moveto (3601 int) show
0 624 moveto (3602 argint\(int n, int *ip\)) show
0 612 moveto (3603 {) show
0 600 moveto (3604   return fetchint\(\(myproc\(\)->tf->esp\) + 4 + 4*n, ip\);) show
0 588 moveto (3605 }) show
0 576 moveto (3606 ) show
0 564 moveto (3607 // Fetch the nth word-sized system call argument as a pointer) show
0 552 moveto (3608 // to a block of memory of size bytes.  Check that the pointer) show
0 540 moveto (3609 // lies within the process address space.) show
0 528 moveto (3610 int) show
0 516 moveto (3611 argptr\(int n, char **pp, int size\)) show
0 504 moveto (3612 {) show
0 492 moveto (3613   int i;) show
0 480 moveto (3614   struct proc *curproc = myproc\(\);) show
0 468 moveto (3615 ) show
0 456 moveto (3616   if\(argint\(n, &i\) < 0\)) show
0 444 moveto (3617     return -1;) show
0 432 moveto (3618   if\(size < 0 || \(uint\)i >= curproc->sz || \(uint\)i+size > curproc->sz\)) show
0 420 moveto (3619     return -1;) show
0 408 moveto (3620   *pp = \(char*\)i;) show
0 396 moveto (3621   return 0;) show
0 384 moveto (3622 }) show
0 372 moveto (3623 ) show
0 360 moveto (3624 // Fetch the nth word-sized system call argument as a string pointer.) show
0 348 moveto (3625 // Check that the pointer is valid and the string is nul-terminated.) show
0 336 moveto (3626 // \(There is no shared writable memory, so the string can't change) show
0 324 moveto (3627 // between this check and being used by the kernel.\)) show
0 312 moveto (3628 int) show
0 300 moveto (3629 argstr\(int n, char **pp\)) show
0 288 moveto (3630 {) show
0 276 moveto (3631   int addr;) show
0 264 moveto (3632   if\(argint\(n, &addr\) < 0\)) show
0 252 moveto (3633     return -1;) show
0 240 moveto (3634   return fetchstr\(addr, pp\);) show
0 228 moveto (3635 }) show
0 216 moveto (3636 ) show
0 204 moveto (3637 ) show
0 192 moveto (3638 ) show
0 180 moveto (3639 ) show
0 168 moveto (3640 ) show
0 156 moveto (3641 ) show
0 144 moveto (3642 ) show
0 132 moveto (3643 ) show
0 120 moveto (3644 ) show
0 108 moveto (3645 ) show
0 96 moveto (3646 ) show
0 84 moveto (3647 ) show
0 72 moveto (3648 ) show
0 60 moveto (3649 ) show
0 24 moveto (Sheet 36) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/syscall.c  Page 3) show
0 648 moveto (3650 extern int sys_chdir\(void\);) show
0 636 moveto (3651 extern int sys_close\(void\);) show
0 624 moveto (3652 extern int sys_dup\(void\);) show
0 612 moveto (3653 extern int sys_exec\(void\);) show
0 600 moveto (3654 extern int sys_exit\(void\);) show
0 588 moveto (3655 extern int sys_fork\(void\);) show
0 576 moveto (3656 extern int sys_fstat\(void\);) show
0 564 moveto (3657 extern int sys_getpid\(void\);) show
0 552 moveto (3658 extern int sys_kill\(void\);) show
0 540 moveto (3659 extern int sys_link\(void\);) show
0 528 moveto (3660 extern int sys_mkdir\(void\);) show
0 516 moveto (3661 extern int sys_mknod\(void\);) show
0 504 moveto (3662 extern int sys_open\(void\);) show
0 492 moveto (3663 extern int sys_pipe\(void\);) show
0 480 moveto (3664 extern int sys_read\(void\);) show
0 468 moveto (3665 extern int sys_sbrk\(void\);) show
0 456 moveto (3666 extern int sys_sleep\(void\);) show
0 444 moveto (3667 extern int sys_unlink\(void\);) show
0 432 moveto (3668 extern int sys_wait\(void\);) show
0 420 moveto (3669 extern int sys_write\(void\);) show
0 408 moveto (3670 extern int sys_uptime\(void\);) show
0 396 moveto (3671 ) show
0 384 moveto (3672 static int \(*syscalls[]\)\(void\) = {) show
0 372 moveto (3673 [SYS_fork]    sys_fork,) show
0 360 moveto (3674 [SYS_exit]    sys_exit,) show
0 348 moveto (3675 [SYS_wait]    sys_wait,) show
0 336 moveto (3676 [SYS_pipe]    sys_pipe,) show
0 324 moveto (3677 [SYS_read]    sys_read,) show
0 312 moveto (3678 [SYS_kill]    sys_kill,) show
0 300 moveto (3679 [SYS_exec]    sys_exec,) show
0 288 moveto (3680 [SYS_fstat]   sys_fstat,) show
0 276 moveto (3681 [SYS_chdir]   sys_chdir,) show
0 264 moveto (3682 [SYS_dup]     sys_dup,) show
0 252 moveto (3683 [SYS_getpid]  sys_getpid,) show
0 240 moveto (3684 [SYS_sbrk]    sys_sbrk,) show
0 228 moveto (3685 [SYS_sleep]   sys_sleep,) show
0 216 moveto (3686 [SYS_uptime]  sys_uptime,) show
0 204 moveto (3687 [SYS_open]    sys_open,) show
0 192 moveto (3688 [SYS_write]   sys_write,) show
0 180 moveto (3689 [SYS_mknod]   sys_mknod,) show
0 168 moveto (3690 [SYS_unlink]  sys_unlink,) show
0 156 moveto (3691 [SYS_link]    sys_link,) show
0 144 moveto (3692 [SYS_mkdir]   sys_mkdir,) show
0 132 moveto (3693 [SYS_close]   sys_close,) show
0 120 moveto (3694 };) show
0 108 moveto (3695 ) show
0 96 moveto (3696 ) show
0 84 moveto (3697 ) show
0 72 moveto (3698 ) show
0 60 moveto (3699 ) show
0 24 moveto (Sheet 36) show
grestore
restore
showpage
%%Page: 46 46
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/syscall.c  Page 4) show
0 648 moveto (3700 void) show
0 636 moveto (3701 syscall\(void\)) show
0 624 moveto (3702 {) show
0 612 moveto (3703   int num;) show
0 600 moveto (3704   struct proc *curproc = myproc\(\);) show
0 588 moveto (3705 ) show
0 576 moveto (3706   num = curproc->tf->eax;) show
0 564 moveto (3707   if\(num > 0 && num < NELEM\(syscalls\) && syscalls[num]\) {) show
0 552 moveto (3708     curproc->tf->eax = syscalls[num]\(\);) show
0 540 moveto (3709   } else {) show
0 528 moveto (3710     cprintf\("%d %s: unknown sys call %d\\n",) show
0 516 moveto (3711             curproc->pid, curproc->name, num\);) show
0 504 moveto (3712     curproc->tf->eax = -1;) show
0 492 moveto (3713   }) show
0 480 moveto (3714 }) show
0 468 moveto (3715 ) show
0 456 moveto (3716 ) show
0 444 moveto (3717 ) show
0 432 moveto (3718 ) show
0 420 moveto (3719 ) show
0 408 moveto (3720 ) show
0 396 moveto (3721 ) show
0 384 moveto (3722 ) show
0 372 moveto (3723 ) show
0 360 moveto (3724 ) show
0 348 moveto (3725 ) show
0 336 moveto (3726 ) show
0 324 moveto (3727 ) show
0 312 moveto (3728 ) show
0 300 moveto (3729 ) show
0 288 moveto (3730 ) show
0 276 moveto (3731 ) show
0 264 moveto (3732 ) show
0 252 moveto (3733 ) show
0 240 moveto (3734 ) show
0 228 moveto (3735 ) show
0 216 moveto (3736 ) show
0 204 moveto (3737 ) show
0 192 moveto (3738 ) show
0 180 moveto (3739 ) show
0 168 moveto (3740 ) show
0 156 moveto (3741 ) show
0 144 moveto (3742 ) show
0 132 moveto (3743 ) show
0 120 moveto (3744 ) show
0 108 moveto (3745 ) show
0 96 moveto (3746 ) show
0 84 moveto (3747 ) show
0 72 moveto (3748 ) show
0 60 moveto (3749 ) show
0 24 moveto (Sheet 37) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysproc.c  Page 1) show
0 648 moveto (3750 #include "types.h") show
0 636 moveto (3751 #include "x86.h") show
0 624 moveto (3752 #include "defs.h") show
0 612 moveto (3753 #include "date.h") show
0 600 moveto (3754 #include "param.h") show
0 588 moveto (3755 #include "memlayout.h") show
0 576 moveto (3756 #include "mmu.h") show
0 564 moveto (3757 #include "proc.h") show
0 552 moveto (3758 ) show
0 540 moveto (3759 int) show
0 528 moveto (3760 sys_fork\(void\)) show
0 516 moveto (3761 {) show
0 504 moveto (3762   return fork\(\);) show
0 492 moveto (3763 }) show
0 480 moveto (3764 ) show
0 468 moveto (3765 int) show
0 456 moveto (3766 sys_exit\(void\)) show
0 444 moveto (3767 {) show
0 432 moveto (3768   exit\(\);) show
0 420 moveto (3769   return 0;  // not reached) show
0 408 moveto (3770 }) show
0 396 moveto (3771 ) show
0 384 moveto (3772 int) show
0 372 moveto (3773 sys_wait\(void\)) show
0 360 moveto (3774 {) show
0 348 moveto (3775   return wait\(\);) show
0 336 moveto (3776 }) show
0 324 moveto (3777 ) show
0 312 moveto (3778 int) show
0 300 moveto (3779 sys_kill\(void\)) show
0 288 moveto (3780 {) show
0 276 moveto (3781   int pid;) show
0 264 moveto (3782 ) show
0 252 moveto (3783   if\(argint\(0, &pid\) < 0\)) show
0 240 moveto (3784     return -1;) show
0 228 moveto (3785   return kill\(pid\);) show
0 216 moveto (3786 }) show
0 204 moveto (3787 ) show
0 192 moveto (3788 int) show
0 180 moveto (3789 sys_getpid\(void\)) show
0 168 moveto (3790 {) show
0 156 moveto (3791   return myproc\(\)->pid;) show
0 144 moveto (3792 }) show
0 132 moveto (3793 ) show
0 120 moveto (3794 ) show
0 108 moveto (3795 ) show
0 96 moveto (3796 ) show
0 84 moveto (3797 ) show
0 72 moveto (3798 ) show
0 60 moveto (3799 ) show
0 24 moveto (Sheet 37) show
grestore
restore
showpage
%%Page: 47 47
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysproc.c  Page 2) show
0 648 moveto (3800 int) show
0 636 moveto (3801 sys_sbrk\(void\)) show
0 624 moveto (3802 {) show
0 612 moveto (3803   int addr;) show
0 600 moveto (3804   int n;) show
0 588 moveto (3805 ) show
0 576 moveto (3806   if\(argint\(0, &n\) < 0\)) show
0 564 moveto (3807     return -1;) show
0 552 moveto (3808   addr = myproc\(\)->sz;) show
0 540 moveto (3809   if\(growproc\(n\) < 0\)) show
0 528 moveto (3810     return -1;) show
0 516 moveto (3811   return addr;) show
0 504 moveto (3812 }) show
0 492 moveto (3813 ) show
0 480 moveto (3814 int) show
0 468 moveto (3815 sys_sleep\(void\)) show
0 456 moveto (3816 {) show
0 444 moveto (3817   int n;) show
0 432 moveto (3818   uint ticks0;) show
0 420 moveto (3819 ) show
0 408 moveto (3820   if\(argint\(0, &n\) < 0\)) show
0 396 moveto (3821     return -1;) show
0 384 moveto (3822   acquire\(&tickslock\);) show
0 372 moveto (3823   ticks0 = ticks;) show
0 360 moveto (3824   while\(ticks - ticks0 < n\){) show
0 348 moveto (3825     if\(myproc\(\)->killed\){) show
0 336 moveto (3826       release\(&tickslock\);) show
0 324 moveto (3827       return -1;) show
0 312 moveto (3828     }) show
0 300 moveto (3829     sleep\(&ticks, &tickslock\);) show
0 288 moveto (3830   }) show
0 276 moveto (3831   release\(&tickslock\);) show
0 264 moveto (3832   return 0;) show
0 252 moveto (3833 }) show
0 240 moveto (3834 ) show
0 228 moveto (3835 // return how many clock tick interrupts have occurred) show
0 216 moveto (3836 // since start.) show
0 204 moveto (3837 int) show
0 192 moveto (3838 sys_uptime\(void\)) show
0 180 moveto (3839 {) show
0 168 moveto (3840   uint xticks;) show
0 156 moveto (3841 ) show
0 144 moveto (3842   acquire\(&tickslock\);) show
0 132 moveto (3843   xticks = ticks;) show
0 120 moveto (3844   release\(&tickslock\);) show
0 108 moveto (3845   return xticks;) show
0 96 moveto (3846 }) show
0 84 moveto (3847 ) show
0 72 moveto (3848 ) show
0 60 moveto (3849 ) show
0 24 moveto (Sheet 38) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/buf.h  Page 1) show
0 648 moveto (3850 struct buf {) show
0 636 moveto (3851   int flags;) show
0 624 moveto (3852   uint dev;) show
0 612 moveto (3853   uint blockno;) show
0 600 moveto (3854   struct sleeplock lock;) show
0 588 moveto (3855   uint refcnt;) show
0 576 moveto (3856   struct buf *prev; // LRU cache list) show
0 564 moveto (3857   struct buf *next;) show
0 552 moveto (3858   struct buf *qnext; // disk queue) show
0 540 moveto (3859   uchar data[BSIZE];) show
0 528 moveto (3860 };) show
0 516 moveto (3861 #define B_VALID 0x2  // buffer has been read from disk) show
0 504 moveto (3862 #define B_DIRTY 0x4  // buffer needs to be written to disk) show
0 492 moveto (3863 ) show
0 480 moveto (3864 ) show
0 468 moveto (3865 ) show
0 456 moveto (3866 ) show
0 444 moveto (3867 ) show
0 432 moveto (3868 ) show
0 420 moveto (3869 ) show
0 408 moveto (3870 ) show
0 396 moveto (3871 ) show
0 384 moveto (3872 ) show
0 372 moveto (3873 ) show
0 360 moveto (3874 ) show
0 348 moveto (3875 ) show
0 336 moveto (3876 ) show
0 324 moveto (3877 ) show
0 312 moveto (3878 ) show
0 300 moveto (3879 ) show
0 288 moveto (3880 ) show
0 276 moveto (3881 ) show
0 264 moveto (3882 ) show
0 252 moveto (3883 ) show
0 240 moveto (3884 ) show
0 228 moveto (3885 ) show
0 216 moveto (3886 ) show
0 204 moveto (3887 ) show
0 192 moveto (3888 ) show
0 180 moveto (3889 ) show
0 168 moveto (3890 ) show
0 156 moveto (3891 ) show
0 144 moveto (3892 ) show
0 132 moveto (3893 ) show
0 120 moveto (3894 ) show
0 108 moveto (3895 ) show
0 96 moveto (3896 ) show
0 84 moveto (3897 ) show
0 72 moveto (3898 ) show
0 60 moveto (3899 ) show
0 24 moveto (Sheet 38) show
grestore
restore
showpage
%%Page: 48 48
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sleeplock.h  Page 1) show
0 648 moveto (3900 // Long-term locks for processes) show
0 636 moveto (3901 struct sleeplock {) show
0 624 moveto (3902   uint locked;       // Is the lock held?) show
0 612 moveto (3903   struct spinlock lk; // spinlock protecting this sleep lock) show
0 600 moveto (3904 ) show
0 588 moveto (3905   // For debugging:) show
0 576 moveto (3906   char *name;        // Name of lock.) show
0 564 moveto (3907   int pid;           // Process holding lock) show
0 552 moveto (3908 };) show
0 540 moveto (3909 ) show
0 528 moveto (3910 ) show
0 516 moveto (3911 ) show
0 504 moveto (3912 ) show
0 492 moveto (3913 ) show
0 480 moveto (3914 ) show
0 468 moveto (3915 ) show
0 456 moveto (3916 ) show
0 444 moveto (3917 ) show
0 432 moveto (3918 ) show
0 420 moveto (3919 ) show
0 408 moveto (3920 ) show
0 396 moveto (3921 ) show
0 384 moveto (3922 ) show
0 372 moveto (3923 ) show
0 360 moveto (3924 ) show
0 348 moveto (3925 ) show
0 336 moveto (3926 ) show
0 324 moveto (3927 ) show
0 312 moveto (3928 ) show
0 300 moveto (3929 ) show
0 288 moveto (3930 ) show
0 276 moveto (3931 ) show
0 264 moveto (3932 ) show
0 252 moveto (3933 ) show
0 240 moveto (3934 ) show
0 228 moveto (3935 ) show
0 216 moveto (3936 ) show
0 204 moveto (3937 ) show
0 192 moveto (3938 ) show
0 180 moveto (3939 ) show
0 168 moveto (3940 ) show
0 156 moveto (3941 ) show
0 144 moveto (3942 ) show
0 132 moveto (3943 ) show
0 120 moveto (3944 ) show
0 108 moveto (3945 ) show
0 96 moveto (3946 ) show
0 84 moveto (3947 ) show
0 72 moveto (3948 ) show
0 60 moveto (3949 ) show
0 24 moveto (Sheet 39) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fcntl.h  Page 1) show
0 648 moveto (3950 #define O_RDONLY  0x000) show
0 636 moveto (3951 #define O_WRONLY  0x001) show
0 624 moveto (3952 #define O_RDWR    0x002) show
0 612 moveto (3953 #define O_CREATE  0x200) show
0 600 moveto (3954 ) show
0 588 moveto (3955 ) show
0 576 moveto (3956 ) show
0 564 moveto (3957 ) show
0 552 moveto (3958 ) show
0 540 moveto (3959 ) show
0 528 moveto (3960 ) show
0 516 moveto (3961 ) show
0 504 moveto (3962 ) show
0 492 moveto (3963 ) show
0 480 moveto (3964 ) show
0 468 moveto (3965 ) show
0 456 moveto (3966 ) show
0 444 moveto (3967 ) show
0 432 moveto (3968 ) show
0 420 moveto (3969 ) show
0 408 moveto (3970 ) show
0 396 moveto (3971 ) show
0 384 moveto (3972 ) show
0 372 moveto (3973 ) show
0 360 moveto (3974 ) show
0 348 moveto (3975 ) show
0 336 moveto (3976 ) show
0 324 moveto (3977 ) show
0 312 moveto (3978 ) show
0 300 moveto (3979 ) show
0 288 moveto (3980 ) show
0 276 moveto (3981 ) show
0 264 moveto (3982 ) show
0 252 moveto (3983 ) show
0 240 moveto (3984 ) show
0 228 moveto (3985 ) show
0 216 moveto (3986 ) show
0 204 moveto (3987 ) show
0 192 moveto (3988 ) show
0 180 moveto (3989 ) show
0 168 moveto (3990 ) show
0 156 moveto (3991 ) show
0 144 moveto (3992 ) show
0 132 moveto (3993 ) show
0 120 moveto (3994 ) show
0 108 moveto (3995 ) show
0 96 moveto (3996 ) show
0 84 moveto (3997 ) show
0 72 moveto (3998 ) show
0 60 moveto (3999 ) show
0 24 moveto (Sheet 39) show
grestore
restore
showpage
%%Page: 49 49
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/stat.h  Page 1) show
0 648 moveto (4000 #define T_DIR  1   // Directory) show
0 636 moveto (4001 #define T_FILE 2   // File) show
0 624 moveto (4002 #define T_DEV  3   // Device) show
0 612 moveto (4003 ) show
0 600 moveto (4004 struct stat {) show
0 588 moveto (4005   short type;  // Type of file) show
0 576 moveto (4006   int dev;     // File system's disk device) show
0 564 moveto (4007   uint ino;    // Inode number) show
0 552 moveto (4008   short nlink; // Number of links to file) show
0 540 moveto (4009   uint size;   // Size of file in bytes) show
0 528 moveto (4010 };) show
0 516 moveto (4011 ) show
0 504 moveto (4012 ) show
0 492 moveto (4013 ) show
0 480 moveto (4014 ) show
0 468 moveto (4015 ) show
0 456 moveto (4016 ) show
0 444 moveto (4017 ) show
0 432 moveto (4018 ) show
0 420 moveto (4019 ) show
0 408 moveto (4020 ) show
0 396 moveto (4021 ) show
0 384 moveto (4022 ) show
0 372 moveto (4023 ) show
0 360 moveto (4024 ) show
0 348 moveto (4025 ) show
0 336 moveto (4026 ) show
0 324 moveto (4027 ) show
0 312 moveto (4028 ) show
0 300 moveto (4029 ) show
0 288 moveto (4030 ) show
0 276 moveto (4031 ) show
0 264 moveto (4032 ) show
0 252 moveto (4033 ) show
0 240 moveto (4034 ) show
0 228 moveto (4035 ) show
0 216 moveto (4036 ) show
0 204 moveto (4037 ) show
0 192 moveto (4038 ) show
0 180 moveto (4039 ) show
0 168 moveto (4040 ) show
0 156 moveto (4041 ) show
0 144 moveto (4042 ) show
0 132 moveto (4043 ) show
0 120 moveto (4044 ) show
0 108 moveto (4045 ) show
0 96 moveto (4046 ) show
0 84 moveto (4047 ) show
0 72 moveto (4048 ) show
0 60 moveto (4049 ) show
0 24 moveto (Sheet 40) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.h  Page 1) show
0 648 moveto (4050 // On-disk file system format.) show
0 636 moveto (4051 // Both the kernel and user programs use this header file.) show
0 624 moveto (4052 ) show
0 612 moveto (4053 ) show
0 600 moveto (4054 #define ROOTINO 1  // root i-number) show
0 588 moveto (4055 #define BSIZE 512  // block size) show
0 576 moveto (4056 ) show
0 564 moveto (4057 // Disk layout:) show
0 552 moveto (4058 // [ boot block | super block | log | inode blocks |) show
0 540 moveto (4059 //                                          free bit map | data blocks]) show
0 528 moveto (4060 //) show
0 516 moveto (4061 // mkfs computes the super block and builds an initial file system. The) show
0 504 moveto (4062 // super block describes the disk layout:) show
0 492 moveto (4063 struct superblock {) show
0 480 moveto (4064   uint size;         // Size of file system image \(blocks\)) show
0 468 moveto (4065   uint nblocks;      // Number of data blocks) show
0 456 moveto (4066   uint ninodes;      // Number of inodes.) show
0 444 moveto (4067   uint nlog;         // Number of log blocks) show
0 432 moveto (4068   uint logstart;     // Block number of first log block) show
0 420 moveto (4069   uint inodestart;   // Block number of first inode block) show
0 408 moveto (4070   uint bmapstart;    // Block number of first free map block) show
0 396 moveto (4071 };) show
0 384 moveto (4072 ) show
0 372 moveto (4073 #define NDIRECT 12) show
0 360 moveto (4074 #define NINDIRECT \(BSIZE / sizeof\(uint\)\)) show
0 348 moveto (4075 #define MAXFILE \(NDIRECT + NINDIRECT\)) show
0 336 moveto (4076 ) show
0 324 moveto (4077 // On-disk inode structure) show
0 312 moveto (4078 struct dinode {) show
0 300 moveto (4079   short type;           // File type) show
0 288 moveto (4080   short major;          // Major device number \(T_DEV only\)) show
0 276 moveto (4081   short minor;          // Minor device number \(T_DEV only\)) show
0 264 moveto (4082   short nlink;          // Number of links to inode in file system) show
0 252 moveto (4083   uint size;            // Size of file \(bytes\)) show
0 240 moveto (4084   uint addrs[NDIRECT+1];   // Data block addresses) show
0 228 moveto (4085 };) show
0 216 moveto (4086 ) show
0 204 moveto (4087 ) show
0 192 moveto (4088 ) show
0 180 moveto (4089 ) show
0 168 moveto (4090 ) show
0 156 moveto (4091 ) show
0 144 moveto (4092 ) show
0 132 moveto (4093 ) show
0 120 moveto (4094 ) show
0 108 moveto (4095 ) show
0 96 moveto (4096 ) show
0 84 moveto (4097 ) show
0 72 moveto (4098 ) show
0 60 moveto (4099 ) show
0 24 moveto (Sheet 40) show
grestore
restore
showpage
%%Page: 50 50
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.h  Page 2) show
0 648 moveto (4100 // Inodes per block.) show
0 636 moveto (4101 #define IPB           \(BSIZE / sizeof\(struct dinode\)\)) show
0 624 moveto (4102 ) show
0 612 moveto (4103 // Block containing inode i) show
0 600 moveto (4104 #define IBLOCK\(i, sb\)     \(\(i\) / IPB + sb.inodestart\)) show
0 588 moveto (4105 ) show
0 576 moveto (4106 // Bitmap bits per block) show
0 564 moveto (4107 #define BPB           \(BSIZE*8\)) show
0 552 moveto (4108 ) show
0 540 moveto (4109 // Block of free map containing bit for block b) show
0 528 moveto (4110 #define BBLOCK\(b, sb\) \(b/BPB + sb.bmapstart\)) show
0 516 moveto (4111 ) show
0 504 moveto (4112 // Directory is a file containing a sequence of dirent structures.) show
0 492 moveto (4113 #define DIRSIZ 14) show
0 480 moveto (4114 ) show
0 468 moveto (4115 struct dirent {) show
0 456 moveto (4116   ushort inum;) show
0 444 moveto (4117   char name[DIRSIZ];) show
0 432 moveto (4118 };) show
0 420 moveto (4119 ) show
0 408 moveto (4120 ) show
0 396 moveto (4121 ) show
0 384 moveto (4122 ) show
0 372 moveto (4123 ) show
0 360 moveto (4124 ) show
0 348 moveto (4125 ) show
0 336 moveto (4126 ) show
0 324 moveto (4127 ) show
0 312 moveto (4128 ) show
0 300 moveto (4129 ) show
0 288 moveto (4130 ) show
0 276 moveto (4131 ) show
0 264 moveto (4132 ) show
0 252 moveto (4133 ) show
0 240 moveto (4134 ) show
0 228 moveto (4135 ) show
0 216 moveto (4136 ) show
0 204 moveto (4137 ) show
0 192 moveto (4138 ) show
0 180 moveto (4139 ) show
0 168 moveto (4140 ) show
0 156 moveto (4141 ) show
0 144 moveto (4142 ) show
0 132 moveto (4143 ) show
0 120 moveto (4144 ) show
0 108 moveto (4145 ) show
0 96 moveto (4146 ) show
0 84 moveto (4147 ) show
0 72 moveto (4148 ) show
0 60 moveto (4149 ) show
0 24 moveto (Sheet 41) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/file.h  Page 1) show
0 648 moveto (4150 struct file {) show
0 636 moveto (4151   enum { FD_NONE, FD_PIPE, FD_INODE } type;) show
0 624 moveto (4152   int ref; // reference count) show
0 612 moveto (4153   char readable;) show
0 600 moveto (4154   char writable;) show
0 588 moveto (4155   struct pipe *pipe;) show
0 576 moveto (4156   struct inode *ip;) show
0 564 moveto (4157   uint off;) show
0 552 moveto (4158 };) show
0 540 moveto (4159 ) show
0 528 moveto (4160 ) show
0 516 moveto (4161 // in-memory copy of an inode) show
0 504 moveto (4162 struct inode {) show
0 492 moveto (4163   uint dev;           // Device number) show
0 480 moveto (4164   uint inum;          // Inode number) show
0 468 moveto (4165   int ref;            // Reference count) show
0 456 moveto (4166   struct sleeplock lock; // protects everything below here) show
0 444 moveto (4167   int valid;          // inode has been read from disk?) show
0 432 moveto (4168 ) show
0 420 moveto (4169   short type;         // copy of disk inode) show
0 408 moveto (4170   short major;) show
0 396 moveto (4171   short minor;) show
0 384 moveto (4172   short nlink;) show
0 372 moveto (4173   uint size;) show
0 360 moveto (4174   uint addrs[NDIRECT+1];) show
0 348 moveto (4175 };) show
0 336 moveto (4176 ) show
0 324 moveto (4177 // table mapping major device number to) show
0 312 moveto (4178 // device functions) show
0 300 moveto (4179 struct devsw {) show
0 288 moveto (4180   int \(*read\)\(struct inode*, char*, int\);) show
0 276 moveto (4181   int \(*write\)\(struct inode*, char*, int\);) show
0 264 moveto (4182 };) show
0 252 moveto (4183 ) show
0 240 moveto (4184 extern struct devsw devsw[];) show
0 228 moveto (4185 ) show
0 216 moveto (4186 #define CONSOLE 1) show
0 204 moveto (4187 ) show
0 192 moveto (4188 ) show
0 180 moveto (4189 ) show
0 168 moveto (4190 ) show
0 156 moveto (4191 ) show
0 144 moveto (4192 ) show
0 132 moveto (4193 ) show
0 120 moveto (4194 ) show
0 108 moveto (4195 ) show
0 96 moveto (4196 ) show
0 84 moveto (4197 ) show
0 72 moveto (4198 ) show
0 60 moveto (4199 ) show
0 24 moveto (Sheet 41) show
grestore
restore
showpage
%%Page: 51 51
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/ide.c  Page 1) show
0 648 moveto (4200 // Simple PIO-based \(non-DMA\) IDE driver code.) show
0 636 moveto (4201 ) show
0 624 moveto (4202 #include "types.h") show
0 612 moveto (4203 #include "defs.h") show
0 600 moveto (4204 #include "param.h") show
0 588 moveto (4205 #include "memlayout.h") show
0 576 moveto (4206 #include "mmu.h") show
0 564 moveto (4207 #include "proc.h") show
0 552 moveto (4208 #include "x86.h") show
0 540 moveto (4209 #include "traps.h") show
0 528 moveto (4210 #include "spinlock.h") show
0 516 moveto (4211 #include "sleeplock.h") show
0 504 moveto (4212 #include "fs.h") show
0 492 moveto (4213 #include "buf.h") show
0 480 moveto (4214 ) show
0 468 moveto (4215 #define SECTOR_SIZE   512) show
0 456 moveto (4216 #define IDE_BSY       0x80) show
0 444 moveto (4217 #define IDE_DRDY      0x40) show
0 432 moveto (4218 #define IDE_DF        0x20) show
0 420 moveto (4219 #define IDE_ERR       0x01) show
0 408 moveto (4220 ) show
0 396 moveto (4221 #define IDE_CMD_READ  0x20) show
0 384 moveto (4222 #define IDE_CMD_WRITE 0x30) show
0 372 moveto (4223 #define IDE_CMD_RDMUL 0xc4) show
0 360 moveto (4224 #define IDE_CMD_WRMUL 0xc5) show
0 348 moveto (4225 ) show
0 336 moveto (4226 // idequeue points to the buf now being read/written to the disk.) show
0 324 moveto (4227 // idequeue->qnext points to the next buf to be processed.) show
0 312 moveto (4228 // You must hold idelock while manipulating queue.) show
0 300 moveto (4229 ) show
0 288 moveto (4230 static struct spinlock idelock;) show
0 276 moveto (4231 static struct buf *idequeue;) show
0 264 moveto (4232 ) show
0 252 moveto (4233 static int havedisk1;) show
0 240 moveto (4234 static void idestart\(struct buf*\);) show
0 228 moveto (4235 ) show
0 216 moveto (4236 // Wait for IDE disk to become ready.) show
0 204 moveto (4237 static int) show
0 192 moveto (4238 idewait\(int checkerr\)) show
0 180 moveto (4239 {) show
0 168 moveto (4240   int r;) show
0 156 moveto (4241 ) show
0 144 moveto (4242   while\(\(\(r = inb\(0x1f7\)\) & \(IDE_BSY|IDE_DRDY\)\) != IDE_DRDY\)) show
0 132 moveto (4243     ;) show
0 120 moveto (4244   if\(checkerr && \(r & \(IDE_DF|IDE_ERR\)\) != 0\)) show
0 108 moveto (4245     return -1;) show
0 96 moveto (4246   return 0;) show
0 84 moveto (4247 }) show
0 72 moveto (4248 ) show
0 60 moveto (4249 ) show
0 24 moveto (Sheet 42) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/ide.c  Page 2) show
0 648 moveto (4250 void) show
0 636 moveto (4251 ideinit\(void\)) show
0 624 moveto (4252 {) show
0 612 moveto (4253   int i;) show
0 600 moveto (4254 ) show
0 588 moveto (4255   initlock\(&idelock, "ide"\);) show
0 576 moveto (4256   ioapicenable\(IRQ_IDE, ncpu - 1\);) show
0 564 moveto (4257   idewait\(0\);) show
0 552 moveto (4258 ) show
0 540 moveto (4259   // Check if disk 1 is present) show
0 528 moveto (4260   outb\(0x1f6, 0xe0 | \(1<<4\)\);) show
0 516 moveto (4261   for\(i=0; i<1000; i++\){) show
0 504 moveto (4262     if\(inb\(0x1f7\) != 0\){) show
0 492 moveto (4263       havedisk1 = 1;) show
0 480 moveto (4264       break;) show
0 468 moveto (4265     }) show
0 456 moveto (4266   }) show
0 444 moveto (4267 ) show
0 432 moveto (4268   // Switch back to disk 0.) show
0 420 moveto (4269   outb\(0x1f6, 0xe0 | \(0<<4\)\);) show
0 408 moveto (4270 }) show
0 396 moveto (4271 ) show
0 384 moveto (4272 // Start the request for b.  Caller must hold idelock.) show
0 372 moveto (4273 static void) show
0 360 moveto (4274 idestart\(struct buf *b\)) show
0 348 moveto (4275 {) show
0 336 moveto (4276   if\(b == 0\)) show
0 324 moveto (4277     panic\("idestart"\);) show
0 312 moveto (4278   if\(b->blockno >= FSSIZE\)) show
0 300 moveto (4279     panic\("incorrect blockno"\);) show
0 288 moveto (4280   int sector_per_block =  BSIZE/SECTOR_SIZE;) show
0 276 moveto (4281   int sector = b->blockno * sector_per_block;) show
0 264 moveto (4282   int read_cmd = \(sector_per_block == 1\) ? IDE_CMD_READ :  IDE_CMD_RDMUL;) show
0 252 moveto (4283   int write_cmd = \(sector_per_block == 1\) ? IDE_CMD_WRITE : IDE_CMD_WRMUL;) show
0 240 moveto (4284 ) show
0 228 moveto (4285   if \(sector_per_block > 7\) panic\("idestart"\);) show
0 216 moveto (4286 ) show
0 204 moveto (4287   idewait\(0\);) show
0 192 moveto (4288   outb\(0x3f6, 0\);  // generate interrupt) show
0 180 moveto (4289   outb\(0x1f2, sector_per_block\);  // number of sectors) show
0 168 moveto (4290   outb\(0x1f3, sector & 0xff\);) show
0 156 moveto (4291   outb\(0x1f4, \(sector >> 8\) & 0xff\);) show
0 144 moveto (4292   outb\(0x1f5, \(sector >> 16\) & 0xff\);) show
0 132 moveto (4293   outb\(0x1f6, 0xe0 | \(\(b->dev&1\)<<4\) | \(\(sector>>24\)&0x0f\)\);) show
0 120 moveto (4294   if\(b->flags & B_DIRTY\){) show
0 108 moveto (4295     outb\(0x1f7, write_cmd\);) show
0 96 moveto (4296     outsl\(0x1f0, b->data, BSIZE/4\);) show
0 84 moveto (4297   } else {) show
0 72 moveto (4298     outb\(0x1f7, read_cmd\);) show
0 60 moveto (4299   }) show
0 24 moveto (Sheet 42) show
grestore
restore
showpage
%%Page: 52 52
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/ide.c  Page 3) show
0 648 moveto (4300 }) show
0 636 moveto (4301 ) show
0 624 moveto (4302 // Interrupt handler.) show
0 612 moveto (4303 void) show
0 600 moveto (4304 ideintr\(void\)) show
0 588 moveto (4305 {) show
0 576 moveto (4306   struct buf *b;) show
0 564 moveto (4307 ) show
0 552 moveto (4308   // First queued buffer is the active request.) show
0 540 moveto (4309   acquire\(&idelock\);) show
0 528 moveto (4310 ) show
0 516 moveto (4311   if\(\(b = idequeue\) == 0\){) show
0 504 moveto (4312     release\(&idelock\);) show
0 492 moveto (4313     return;) show
0 480 moveto (4314   }) show
0 468 moveto (4315   idequeue = b->qnext;) show
0 456 moveto (4316 ) show
0 444 moveto (4317   // Read data if needed.) show
0 432 moveto (4318   if\(!\(b->flags & B_DIRTY\) && idewait\(1\) >= 0\)) show
0 420 moveto (4319     insl\(0x1f0, b->data, BSIZE/4\);) show
0 408 moveto (4320 ) show
0 396 moveto (4321   // Wake process waiting for this buf.) show
0 384 moveto (4322   b->flags |= B_VALID;) show
0 372 moveto (4323   b->flags &= ~B_DIRTY;) show
0 360 moveto (4324   wakeup\(b\);) show
0 348 moveto (4325 ) show
0 336 moveto (4326   // Start disk on next buf in queue.) show
0 324 moveto (4327   if\(idequeue != 0\)) show
0 312 moveto (4328     idestart\(idequeue\);) show
0 300 moveto (4329 ) show
0 288 moveto (4330   release\(&idelock\);) show
0 276 moveto (4331 }) show
0 264 moveto (4332 ) show
0 252 moveto (4333 ) show
0 240 moveto (4334 ) show
0 228 moveto (4335 ) show
0 216 moveto (4336 ) show
0 204 moveto (4337 ) show
0 192 moveto (4338 ) show
0 180 moveto (4339 ) show
0 168 moveto (4340 ) show
0 156 moveto (4341 ) show
0 144 moveto (4342 ) show
0 132 moveto (4343 ) show
0 120 moveto (4344 ) show
0 108 moveto (4345 ) show
0 96 moveto (4346 ) show
0 84 moveto (4347 ) show
0 72 moveto (4348 ) show
0 60 moveto (4349 ) show
0 24 moveto (Sheet 43) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/ide.c  Page 4) show
0 648 moveto (4350 // Sync buf with disk.) show
0 636 moveto (4351 // If B_DIRTY is set, write buf to disk, clear B_DIRTY, set B_VALID.) show
0 624 moveto (4352 // Else if B_VALID is not set, read buf from disk, set B_VALID.) show
0 612 moveto (4353 void) show
0 600 moveto (4354 iderw\(struct buf *b\)) show
0 588 moveto (4355 {) show
0 576 moveto (4356   struct buf **pp;) show
0 564 moveto (4357 ) show
0 552 moveto (4358   if\(!holdingsleep\(&b->lock\)\)) show
0 540 moveto (4359     panic\("iderw: buf not locked"\);) show
0 528 moveto (4360   if\(\(b->flags & \(B_VALID|B_DIRTY\)\) == B_VALID\)) show
0 516 moveto (4361     panic\("iderw: nothing to do"\);) show
0 504 moveto (4362   if\(b->dev != 0 && !havedisk1\)) show
0 492 moveto (4363     panic\("iderw: ide disk 1 not present"\);) show
0 480 moveto (4364 ) show
0 468 moveto (4365   acquire\(&idelock\);  ) show
0 456 moveto (4366 ) show
0 444 moveto (4367   // Append b to idequeue.) show
0 432 moveto (4368   b->qnext = 0;) show
0 420 moveto (4369   for\(pp=&idequeue; *pp; pp=&\(*pp\)->qnext\)  ) show
0 408 moveto (4370     ;) show
0 396 moveto (4371   *pp = b;) show
0 384 moveto (4372 ) show
0 372 moveto (4373   // Start disk if necessary.) show
0 360 moveto (4374   if\(idequeue == b\)) show
0 348 moveto (4375     idestart\(b\);) show
0 336 moveto (4376 ) show
0 324 moveto (4377   // Wait for request to finish.) show
0 312 moveto (4378   while\(\(b->flags & \(B_VALID|B_DIRTY\)\) != B_VALID\){) show
0 300 moveto (4379     sleep\(b, &idelock\);) show
0 288 moveto (4380   }) show
0 276 moveto (4381 ) show
0 264 moveto (4382 ) show
0 252 moveto (4383   release\(&idelock\);) show
0 240 moveto (4384 }) show
0 228 moveto (4385 ) show
0 216 moveto (4386 ) show
0 204 moveto (4387 ) show
0 192 moveto (4388 ) show
0 180 moveto (4389 ) show
0 168 moveto (4390 ) show
0 156 moveto (4391 ) show
0 144 moveto (4392 ) show
0 132 moveto (4393 ) show
0 120 moveto (4394 ) show
0 108 moveto (4395 ) show
0 96 moveto (4396 ) show
0 84 moveto (4397 ) show
0 72 moveto (4398 ) show
0 60 moveto (4399 ) show
0 24 moveto (Sheet 43) show
grestore
restore
showpage
%%Page: 53 53
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/bio.c  Page 1) show
0 648 moveto (4400 // Buffer cache.) show
0 636 moveto (4401 //) show
0 624 moveto (4402 // The buffer cache is a linked list of buf structures holding) show
0 612 moveto (4403 // cached copies of disk block contents.  Caching disk blocks) show
0 600 moveto (4404 // in memory reduces the number of disk reads and also provides) show
0 588 moveto (4405 // a synchronization point for disk blocks used by multiple processes.) show
0 576 moveto (4406 //) show
0 564 moveto (4407 // Interface:) show
0 552 moveto (4408 // * To get a buffer for a particular disk block, call bread.) show
0 540 moveto (4409 // * After changing buffer data, call bwrite to write it to disk.) show
0 528 moveto (4410 // * When done with the buffer, call brelse.) show
0 516 moveto (4411 // * Do not use the buffer after calling brelse.) show
0 504 moveto (4412 // * Only one process at a time can use a buffer,) show
0 492 moveto (4413 //     so do not keep them longer than necessary.) show
0 480 moveto (4414 //) show
0 468 moveto (4415 // The implementation uses two state flags internally:) show
0 456 moveto (4416 // * B_VALID: the buffer data has been read from the disk.) show
0 444 moveto (4417 // * B_DIRTY: the buffer data has been modified) show
0 432 moveto (4418 //     and needs to be written to disk.) show
0 420 moveto (4419 ) show
0 408 moveto (4420 #include "types.h") show
0 396 moveto (4421 #include "defs.h") show
0 384 moveto (4422 #include "param.h") show
0 372 moveto (4423 #include "spinlock.h") show
0 360 moveto (4424 #include "sleeplock.h") show
0 348 moveto (4425 #include "fs.h") show
0 336 moveto (4426 #include "buf.h") show
0 324 moveto (4427 ) show
0 312 moveto (4428 struct {) show
0 300 moveto (4429   struct spinlock lock;) show
0 288 moveto (4430   struct buf buf[NBUF];) show
0 276 moveto (4431 ) show
0 264 moveto (4432   // Linked list of all buffers, through prev/next.) show
0 252 moveto (4433   // head.next is most recently used.) show
0 240 moveto (4434   struct buf head;) show
0 228 moveto (4435 } bcache;) show
0 216 moveto (4436 ) show
0 204 moveto (4437 void) show
0 192 moveto (4438 binit\(void\)) show
0 180 moveto (4439 {) show
0 168 moveto (4440   struct buf *b;) show
0 156 moveto (4441 ) show
0 144 moveto (4442   initlock\(&bcache.lock, "bcache"\);) show
0 132 moveto (4443 ) show
0 120 moveto (4444 ) show
0 108 moveto (4445 ) show
0 96 moveto (4446 ) show
0 84 moveto (4447 ) show
0 72 moveto (4448 ) show
0 60 moveto (4449 ) show
0 24 moveto (Sheet 44) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/bio.c  Page 2) show
0 648 moveto (4450   // Create linked list of buffers) show
0 636 moveto (4451   bcache.head.prev = &bcache.head;) show
0 624 moveto (4452   bcache.head.next = &bcache.head;) show
0 612 moveto (4453   for\(b = bcache.buf; b < bcache.buf+NBUF; b++\){) show
0 600 moveto (4454     b->next = bcache.head.next;) show
0 588 moveto (4455     b->prev = &bcache.head;) show
0 576 moveto (4456     initsleeplock\(&b->lock, "buffer"\);) show
0 564 moveto (4457     bcache.head.next->prev = b;) show
0 552 moveto (4458     bcache.head.next = b;) show
0 540 moveto (4459   }) show
0 528 moveto (4460 }) show
0 516 moveto (4461 ) show
0 504 moveto (4462 // Look through buffer cache for block on device dev.) show
0 492 moveto (4463 // If not found, allocate a buffer.) show
0 480 moveto (4464 // In either case, return locked buffer.) show
0 468 moveto (4465 static struct buf*) show
0 456 moveto (4466 bget\(uint dev, uint blockno\)) show
0 444 moveto (4467 {) show
0 432 moveto (4468   struct buf *b;) show
0 420 moveto (4469 ) show
0 408 moveto (4470   acquire\(&bcache.lock\);) show
0 396 moveto (4471 ) show
0 384 moveto (4472   // Is the block already cached?) show
0 372 moveto (4473   for\(b = bcache.head.next; b != &bcache.head; b = b->next\){) show
0 360 moveto (4474     if\(b->dev == dev && b->blockno == blockno\){) show
0 348 moveto (4475       b->refcnt++;) show
0 336 moveto (4476       release\(&bcache.lock\);) show
0 324 moveto (4477       acquiresleep\(&b->lock\);) show
0 312 moveto (4478       return b;) show
0 300 moveto (4479     }) show
0 288 moveto (4480   }) show
0 276 moveto (4481 ) show
0 264 moveto (4482   // Not cached; recycle an unused buffer.) show
0 252 moveto (4483   // Even if refcnt==0, B_DIRTY indicates a buffer is in use) show
0 240 moveto (4484   // because log.c has modified it but not yet committed it.) show
0 228 moveto (4485   for\(b = bcache.head.prev; b != &bcache.head; b = b->prev\){) show
0 216 moveto (4486     if\(b->refcnt == 0 && \(b->flags & B_DIRTY\) == 0\) {) show
0 204 moveto (4487       b->dev = dev;) show
0 192 moveto (4488       b->blockno = blockno;) show
0 180 moveto (4489       b->flags = 0;) show
0 168 moveto (4490       b->refcnt = 1;) show
0 156 moveto (4491       release\(&bcache.lock\);) show
0 144 moveto (4492       acquiresleep\(&b->lock\);) show
0 132 moveto (4493       return b;) show
0 120 moveto (4494     }) show
0 108 moveto (4495   }) show
0 96 moveto (4496   panic\("bget: no buffers"\);) show
0 84 moveto (4497 }) show
0 72 moveto (4498 ) show
0 60 moveto (4499 ) show
0 24 moveto (Sheet 44) show
grestore
restore
showpage
%%Page: 54 54
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/bio.c  Page 3) show
0 648 moveto (4500 // Return a locked buf with the contents of the indicated block.) show
0 636 moveto (4501 struct buf*) show
0 624 moveto (4502 bread\(uint dev, uint blockno\)) show
0 612 moveto (4503 {) show
0 600 moveto (4504   struct buf *b;) show
0 588 moveto (4505 ) show
0 576 moveto (4506   b = bget\(dev, blockno\);) show
0 564 moveto (4507   if\(\(b->flags & B_VALID\) == 0\) {) show
0 552 moveto (4508     iderw\(b\);) show
0 540 moveto (4509   }) show
0 528 moveto (4510   return b;) show
0 516 moveto (4511 }) show
0 504 moveto (4512 ) show
0 492 moveto (4513 // Write b's contents to disk.  Must be locked.) show
0 480 moveto (4514 void) show
0 468 moveto (4515 bwrite\(struct buf *b\)) show
0 456 moveto (4516 {) show
0 444 moveto (4517   if\(!holdingsleep\(&b->lock\)\)) show
0 432 moveto (4518     panic\("bwrite"\);) show
0 420 moveto (4519   b->flags |= B_DIRTY;) show
0 408 moveto (4520   iderw\(b\);) show
0 396 moveto (4521 }) show
0 384 moveto (4522 ) show
0 372 moveto (4523 // Release a locked buffer.) show
0 360 moveto (4524 // Move to the head of the MRU list.) show
0 348 moveto (4525 void) show
0 336 moveto (4526 brelse\(struct buf *b\)) show
0 324 moveto (4527 {) show
0 312 moveto (4528   if\(!holdingsleep\(&b->lock\)\)) show
0 300 moveto (4529     panic\("brelse"\);) show
0 288 moveto (4530 ) show
0 276 moveto (4531   releasesleep\(&b->lock\);) show
0 264 moveto (4532 ) show
0 252 moveto (4533   acquire\(&bcache.lock\);) show
0 240 moveto (4534   b->refcnt--;) show
0 228 moveto (4535   if \(b->refcnt == 0\) {) show
0 216 moveto (4536     // no one is waiting for it.) show
0 204 moveto (4537     b->next->prev = b->prev;) show
0 192 moveto (4538     b->prev->next = b->next;) show
0 180 moveto (4539     b->next = bcache.head.next;) show
0 168 moveto (4540     b->prev = &bcache.head;) show
0 156 moveto (4541     bcache.head.next->prev = b;) show
0 144 moveto (4542     bcache.head.next = b;) show
0 132 moveto (4543   }) show
0 120 moveto (4544 ) show
0 108 moveto (4545   release\(&bcache.lock\);) show
0 96 moveto (4546 }) show
0 84 moveto (4547 ) show
0 72 moveto (4548 ) show
0 60 moveto (4549 ) show
0 24 moveto (Sheet 45) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/bio.c  Page 4) show
0 648 moveto (4550 // Blank page.) show
0 636 moveto (4551 ) show
0 624 moveto (4552 ) show
0 612 moveto (4553 ) show
0 600 moveto (4554 ) show
0 588 moveto (4555 ) show
0 576 moveto (4556 ) show
0 564 moveto (4557 ) show
0 552 moveto (4558 ) show
0 540 moveto (4559 ) show
0 528 moveto (4560 ) show
0 516 moveto (4561 ) show
0 504 moveto (4562 ) show
0 492 moveto (4563 ) show
0 480 moveto (4564 ) show
0 468 moveto (4565 ) show
0 456 moveto (4566 ) show
0 444 moveto (4567 ) show
0 432 moveto (4568 ) show
0 420 moveto (4569 ) show
0 408 moveto (4570 ) show
0 396 moveto (4571 ) show
0 384 moveto (4572 ) show
0 372 moveto (4573 ) show
0 360 moveto (4574 ) show
0 348 moveto (4575 ) show
0 336 moveto (4576 ) show
0 324 moveto (4577 ) show
0 312 moveto (4578 ) show
0 300 moveto (4579 ) show
0 288 moveto (4580 ) show
0 276 moveto (4581 ) show
0 264 moveto (4582 ) show
0 252 moveto (4583 ) show
0 240 moveto (4584 ) show
0 228 moveto (4585 ) show
0 216 moveto (4586 ) show
0 204 moveto (4587 ) show
0 192 moveto (4588 ) show
0 180 moveto (4589 ) show
0 168 moveto (4590 ) show
0 156 moveto (4591 ) show
0 144 moveto (4592 ) show
0 132 moveto (4593 ) show
0 120 moveto (4594 ) show
0 108 moveto (4595 ) show
0 96 moveto (4596 ) show
0 84 moveto (4597 ) show
0 72 moveto (4598 ) show
0 60 moveto (4599 ) show
0 24 moveto (Sheet 45) show
grestore
restore
showpage
%%Page: 55 55
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sleeplock.c  Page 1) show
0 648 moveto (4600 // Sleeping locks) show
0 636 moveto (4601 ) show
0 624 moveto (4602 #include "types.h") show
0 612 moveto (4603 #include "defs.h") show
0 600 moveto (4604 #include "param.h") show
0 588 moveto (4605 #include "x86.h") show
0 576 moveto (4606 #include "memlayout.h") show
0 564 moveto (4607 #include "mmu.h") show
0 552 moveto (4608 #include "proc.h") show
0 540 moveto (4609 #include "spinlock.h") show
0 528 moveto (4610 #include "sleeplock.h") show
0 516 moveto (4611 ) show
0 504 moveto (4612 void) show
0 492 moveto (4613 initsleeplock\(struct sleeplock *lk, char *name\)) show
0 480 moveto (4614 {) show
0 468 moveto (4615   initlock\(&lk->lk, "sleep lock"\);) show
0 456 moveto (4616   lk->name = name;) show
0 444 moveto (4617   lk->locked = 0;) show
0 432 moveto (4618   lk->pid = 0;) show
0 420 moveto (4619 }) show
0 408 moveto (4620 ) show
0 396 moveto (4621 void) show
0 384 moveto (4622 acquiresleep\(struct sleeplock *lk\)) show
0 372 moveto (4623 {) show
0 360 moveto (4624   acquire\(&lk->lk\);) show
0 348 moveto (4625   while \(lk->locked\) {) show
0 336 moveto (4626     sleep\(lk, &lk->lk\);) show
0 324 moveto (4627   }) show
0 312 moveto (4628   lk->locked = 1;) show
0 300 moveto (4629   lk->pid = myproc\(\)->pid;) show
0 288 moveto (4630   release\(&lk->lk\);) show
0 276 moveto (4631 }) show
0 264 moveto (4632 ) show
0 252 moveto (4633 void) show
0 240 moveto (4634 releasesleep\(struct sleeplock *lk\)) show
0 228 moveto (4635 {) show
0 216 moveto (4636   acquire\(&lk->lk\);) show
0 204 moveto (4637   lk->locked = 0;) show
0 192 moveto (4638   lk->pid = 0;) show
0 180 moveto (4639   wakeup\(lk\);) show
0 168 moveto (4640   release\(&lk->lk\);) show
0 156 moveto (4641 }) show
0 144 moveto (4642 ) show
0 132 moveto (4643 ) show
0 120 moveto (4644 ) show
0 108 moveto (4645 ) show
0 96 moveto (4646 ) show
0 84 moveto (4647 ) show
0 72 moveto (4648 ) show
0 60 moveto (4649 ) show
0 24 moveto (Sheet 46) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sleeplock.c  Page 2) show
0 648 moveto (4650 int) show
0 636 moveto (4651 holdingsleep\(struct sleeplock *lk\)) show
0 624 moveto (4652 {) show
0 612 moveto (4653   int r;) show
0 600 moveto (4654 ) show
0 588 moveto (4655   acquire\(&lk->lk\);) show
0 576 moveto (4656   r = lk->locked && \(lk->pid == myproc\(\)->pid\);) show
0 564 moveto (4657   release\(&lk->lk\);) show
0 552 moveto (4658   return r;) show
0 540 moveto (4659 }) show
0 528 moveto (4660 ) show
0 516 moveto (4661 ) show
0 504 moveto (4662 ) show
0 492 moveto (4663 ) show
0 480 moveto (4664 ) show
0 468 moveto (4665 ) show
0 456 moveto (4666 ) show
0 444 moveto (4667 ) show
0 432 moveto (4668 ) show
0 420 moveto (4669 ) show
0 408 moveto (4670 ) show
0 396 moveto (4671 ) show
0 384 moveto (4672 ) show
0 372 moveto (4673 ) show
0 360 moveto (4674 ) show
0 348 moveto (4675 ) show
0 336 moveto (4676 ) show
0 324 moveto (4677 ) show
0 312 moveto (4678 ) show
0 300 moveto (4679 ) show
0 288 moveto (4680 ) show
0 276 moveto (4681 ) show
0 264 moveto (4682 ) show
0 252 moveto (4683 ) show
0 240 moveto (4684 ) show
0 228 moveto (4685 ) show
0 216 moveto (4686 ) show
0 204 moveto (4687 ) show
0 192 moveto (4688 ) show
0 180 moveto (4689 ) show
0 168 moveto (4690 ) show
0 156 moveto (4691 ) show
0 144 moveto (4692 ) show
0 132 moveto (4693 ) show
0 120 moveto (4694 ) show
0 108 moveto (4695 ) show
0 96 moveto (4696 ) show
0 84 moveto (4697 ) show
0 72 moveto (4698 ) show
0 60 moveto (4699 ) show
0 24 moveto (Sheet 46) show
grestore
restore
showpage
%%Page: 56 56
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/log.c  Page 1) show
0 648 moveto (4700 #include "types.h") show
0 636 moveto (4701 #include "defs.h") show
0 624 moveto (4702 #include "param.h") show
0 612 moveto (4703 #include "spinlock.h") show
0 600 moveto (4704 #include "sleeplock.h") show
0 588 moveto (4705 #include "fs.h") show
0 576 moveto (4706 #include "buf.h") show
0 564 moveto (4707 ) show
0 552 moveto (4708 // Simple logging that allows concurrent FS system calls.) show
0 540 moveto (4709 //) show
0 528 moveto (4710 // A log transaction contains the updates of multiple FS system) show
0 516 moveto (4711 // calls. The logging system only commits when there are) show
0 504 moveto (4712 // no FS system calls active. Thus there is never) show
0 492 moveto (4713 // any reasoning required about whether a commit might) show
0 480 moveto (4714 // write an uncommitted system call's updates to disk.) show
0 468 moveto (4715 //) show
0 456 moveto (4716 // A system call should call begin_op\(\)/end_op\(\) to mark) show
0 444 moveto (4717 // its start and end. Usually begin_op\(\) just increments) show
0 432 moveto (4718 // the count of in-progress FS system calls and returns.) show
0 420 moveto (4719 // But if it thinks the log is close to running out, it) show
0 408 moveto (4720 // sleeps until the last outstanding end_op\(\) commits.) show
0 396 moveto (4721 //) show
0 384 moveto (4722 // The log is a physical re-do log containing disk blocks.) show
0 372 moveto (4723 // The on-disk log format:) show
0 360 moveto (4724 //   header block, containing block #s for block A, B, C, ...) show
0 348 moveto (4725 //   block A) show
0 336 moveto (4726 //   block B) show
0 324 moveto (4727 //   block C) show
0 312 moveto (4728 //   ...) show
0 300 moveto (4729 // Log appends are synchronous.) show
0 288 moveto (4730 ) show
0 276 moveto (4731 // Contents of the header block, used for both the on-disk header block) show
0 264 moveto (4732 // and to keep track in memory of logged block# before commit.) show
0 252 moveto (4733 struct logheader {) show
0 240 moveto (4734   int n;) show
0 228 moveto (4735   int block[LOGSIZE];) show
0 216 moveto (4736 };) show
0 204 moveto (4737 ) show
0 192 moveto (4738 struct log {) show
0 180 moveto (4739   struct spinlock lock;) show
0 168 moveto (4740   int start;) show
0 156 moveto (4741   int size;) show
0 144 moveto (4742   int outstanding; // how many FS sys calls are executing.) show
0 132 moveto (4743   int committing;  // in commit\(\), please wait.) show
0 120 moveto (4744   int dev;) show
0 108 moveto (4745   struct logheader lh;) show
0 96 moveto (4746 };) show
0 84 moveto (4747 ) show
0 72 moveto (4748 ) show
0 60 moveto (4749 ) show
0 24 moveto (Sheet 47) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/log.c  Page 2) show
0 648 moveto (4750 struct log log;) show
0 636 moveto (4751 ) show
0 624 moveto (4752 static void recover_from_log\(void\);) show
0 612 moveto (4753 static void commit\(\);) show
0 600 moveto (4754 ) show
0 588 moveto (4755 void) show
0 576 moveto (4756 initlog\(int dev\)) show
0 564 moveto (4757 {) show
0 552 moveto (4758   if \(sizeof\(struct logheader\) >= BSIZE\)) show
0 540 moveto (4759     panic\("initlog: too big logheader"\);) show
0 528 moveto (4760 ) show
0 516 moveto (4761   struct superblock sb;) show
0 504 moveto (4762   initlock\(&log.lock, "log"\);) show
0 492 moveto (4763   readsb\(dev, &sb\);) show
0 480 moveto (4764   log.start = sb.logstart;) show
0 468 moveto (4765   log.size = sb.nlog;) show
0 456 moveto (4766   log.dev = dev;) show
0 444 moveto (4767   recover_from_log\(\);) show
0 432 moveto (4768 }) show
0 420 moveto (4769 ) show
0 408 moveto (4770 // Copy committed blocks from log to their home location) show
0 396 moveto (4771 static void) show
0 384 moveto (4772 install_trans\(void\)) show
0 372 moveto (4773 {) show
0 360 moveto (4774   int tail;) show
0 348 moveto (4775 ) show
0 336 moveto (4776   for \(tail = 0; tail < log.lh.n; tail++\) {) show
0 324 moveto (4777     struct buf *lbuf = bread\(log.dev, log.start+tail+1\); // read log block) show
0 312 moveto (4778     struct buf *dbuf = bread\(log.dev, log.lh.block[tail]\); // read dst) show
0 300 moveto (4779     memmove\(dbuf->data, lbuf->data, BSIZE\);  // copy block to dst) show
0 288 moveto (4780     bwrite\(dbuf\);  // write dst to disk) show
0 276 moveto (4781     brelse\(lbuf\);) show
0 264 moveto (4782     brelse\(dbuf\);) show
0 252 moveto (4783   }) show
0 240 moveto (4784 }) show
0 228 moveto (4785 ) show
0 216 moveto (4786 // Read the log header from disk into the in-memory log header) show
0 204 moveto (4787 static void) show
0 192 moveto (4788 read_head\(void\)) show
0 180 moveto (4789 {) show
0 168 moveto (4790   struct buf *buf = bread\(log.dev, log.start\);) show
0 156 moveto (4791   struct logheader *lh = \(struct logheader *\) \(buf->data\);) show
0 144 moveto (4792   int i;) show
0 132 moveto (4793   log.lh.n = lh->n;) show
0 120 moveto (4794   for \(i = 0; i < log.lh.n; i++\) {) show
0 108 moveto (4795     log.lh.block[i] = lh->block[i];) show
0 96 moveto (4796   }) show
0 84 moveto (4797   brelse\(buf\);) show
0 72 moveto (4798 }) show
0 60 moveto (4799 ) show
0 24 moveto (Sheet 47) show
grestore
restore
showpage
%%Page: 57 57
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/log.c  Page 3) show
0 648 moveto (4800 // Write in-memory log header to disk.) show
0 636 moveto (4801 // This is the true point at which the) show
0 624 moveto (4802 // current transaction commits.) show
0 612 moveto (4803 static void) show
0 600 moveto (4804 write_head\(void\)) show
0 588 moveto (4805 {) show
0 576 moveto (4806   struct buf *buf = bread\(log.dev, log.start\);) show
0 564 moveto (4807   struct logheader *hb = \(struct logheader *\) \(buf->data\);) show
0 552 moveto (4808   int i;) show
0 540 moveto (4809   hb->n = log.lh.n;) show
0 528 moveto (4810   for \(i = 0; i < log.lh.n; i++\) {) show
0 516 moveto (4811     hb->block[i] = log.lh.block[i];) show
0 504 moveto (4812   }) show
0 492 moveto (4813   bwrite\(buf\);) show
0 480 moveto (4814   brelse\(buf\);) show
0 468 moveto (4815 }) show
0 456 moveto (4816 ) show
0 444 moveto (4817 static void) show
0 432 moveto (4818 recover_from_log\(void\)) show
0 420 moveto (4819 {) show
0 408 moveto (4820   read_head\(\);) show
0 396 moveto (4821   install_trans\(\); // if committed, copy from log to disk) show
0 384 moveto (4822   log.lh.n = 0;) show
0 372 moveto (4823   write_head\(\); // clear the log) show
0 360 moveto (4824 }) show
0 348 moveto (4825 ) show
0 336 moveto (4826 // called at the start of each FS system call.) show
0 324 moveto (4827 void) show
0 312 moveto (4828 begin_op\(void\)) show
0 300 moveto (4829 {) show
0 288 moveto (4830   acquire\(&log.lock\);) show
0 276 moveto (4831   while\(1\){) show
0 264 moveto (4832     if\(log.committing\){) show
0 252 moveto (4833       sleep\(&log, &log.lock\);) show
0 240 moveto (4834     } else if\(log.lh.n + \(log.outstanding+1\)*MAXOPBLOCKS > LOGSIZE\){) show
0 228 moveto (4835       // this op might exhaust log space; wait for commit.) show
0 216 moveto (4836       sleep\(&log, &log.lock\);) show
0 204 moveto (4837     } else {) show
0 192 moveto (4838       log.outstanding += 1;) show
0 180 moveto (4839       release\(&log.lock\);) show
0 168 moveto (4840       break;) show
0 156 moveto (4841     }) show
0 144 moveto (4842   }) show
0 132 moveto (4843 }) show
0 120 moveto (4844 ) show
0 108 moveto (4845 ) show
0 96 moveto (4846 ) show
0 84 moveto (4847 ) show
0 72 moveto (4848 ) show
0 60 moveto (4849 ) show
0 24 moveto (Sheet 48) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/log.c  Page 4) show
0 648 moveto (4850 // called at the end of each FS system call.) show
0 636 moveto (4851 // commits if this was the last outstanding operation.) show
0 624 moveto (4852 void) show
0 612 moveto (4853 end_op\(void\)) show
0 600 moveto (4854 {) show
0 588 moveto (4855   int do_commit = 0;) show
0 576 moveto (4856 ) show
0 564 moveto (4857   acquire\(&log.lock\);) show
0 552 moveto (4858   log.outstanding -= 1;) show
0 540 moveto (4859   if\(log.committing\)) show
0 528 moveto (4860     panic\("log.committing"\);) show
0 516 moveto (4861   if\(log.outstanding == 0\){) show
0 504 moveto (4862     do_commit = 1;) show
0 492 moveto (4863     log.committing = 1;) show
0 480 moveto (4864   } else {) show
0 468 moveto (4865     // begin_op\(\) may be waiting for log space,) show
0 456 moveto (4866     // and decrementing log.outstanding has decreased) show
0 444 moveto (4867     // the amount of reserved space.) show
0 432 moveto (4868     wakeup\(&log\);) show
0 420 moveto (4869   }) show
0 408 moveto (4870   release\(&log.lock\);) show
0 396 moveto (4871 ) show
0 384 moveto (4872   if\(do_commit\){) show
0 372 moveto (4873     // call commit w/o holding locks, since not allowed) show
0 360 moveto (4874     // to sleep with locks.) show
0 348 moveto (4875     commit\(\);) show
0 336 moveto (4876     acquire\(&log.lock\);) show
0 324 moveto (4877     log.committing = 0;) show
0 312 moveto (4878     wakeup\(&log\);) show
0 300 moveto (4879     release\(&log.lock\);) show
0 288 moveto (4880   }) show
0 276 moveto (4881 }) show
0 264 moveto (4882 ) show
0 252 moveto (4883 // Copy modified blocks from cache to log.) show
0 240 moveto (4884 static void) show
0 228 moveto (4885 write_log\(void\)) show
0 216 moveto (4886 {) show
0 204 moveto (4887   int tail;) show
0 192 moveto (4888 ) show
0 180 moveto (4889   for \(tail = 0; tail < log.lh.n; tail++\) {) show
0 168 moveto (4890     struct buf *to = bread\(log.dev, log.start+tail+1\); // log block) show
0 156 moveto (4891     struct buf *from = bread\(log.dev, log.lh.block[tail]\); // cache block) show
0 144 moveto (4892     memmove\(to->data, from->data, BSIZE\);) show
0 132 moveto (4893     bwrite\(to\);  // write the log) show
0 120 moveto (4894     brelse\(from\);) show
0 108 moveto (4895     brelse\(to\);) show
0 96 moveto (4896   }) show
0 84 moveto (4897 }) show
0 72 moveto (4898 ) show
0 60 moveto (4899 ) show
0 24 moveto (Sheet 48) show
grestore
restore
showpage
%%Page: 58 58
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/log.c  Page 5) show
0 648 moveto (4900 static void) show
0 636 moveto (4901 commit\(\)) show
0 624 moveto (4902 {) show
0 612 moveto (4903   if \(log.lh.n > 0\) {) show
0 600 moveto (4904     write_log\(\);     // Write modified blocks from cache to log) show
0 588 moveto (4905     write_head\(\);    // Write header to disk -- the real commit) show
0 576 moveto (4906     install_trans\(\); // Now install writes to home locations) show
0 564 moveto (4907     log.lh.n = 0;) show
0 552 moveto (4908     write_head\(\);    // Erase the transaction from the log) show
0 540 moveto (4909   }) show
0 528 moveto (4910 }) show
0 516 moveto (4911 ) show
0 504 moveto (4912 // Caller has modified b->data and is done with the buffer.) show
0 492 moveto (4913 // Record the block number and pin in the cache with B_DIRTY.) show
0 480 moveto (4914 // commit\(\)/write_log\(\) will do the disk write.) show
0 468 moveto (4915 //) show
0 456 moveto (4916 // log_write\(\) replaces bwrite\(\); a typical use is:) show
0 444 moveto (4917 //   bp = bread\(...\)) show
0 432 moveto (4918 //   modify bp->data[]) show
0 420 moveto (4919 //   log_write\(bp\)) show
0 408 moveto (4920 //   brelse\(bp\)) show
0 396 moveto (4921 void) show
0 384 moveto (4922 log_write\(struct buf *b\)) show
0 372 moveto (4923 {) show
0 360 moveto (4924   int i;) show
0 348 moveto (4925 ) show
0 336 moveto (4926   if \(log.lh.n >= LOGSIZE || log.lh.n >= log.size - 1\)) show
0 324 moveto (4927     panic\("too big a transaction"\);) show
0 312 moveto (4928   if \(log.outstanding < 1\)) show
0 300 moveto (4929     panic\("log_write outside of trans"\);) show
0 288 moveto (4930 ) show
0 276 moveto (4931   acquire\(&log.lock\);) show
0 264 moveto (4932   for \(i = 0; i < log.lh.n; i++\) {) show
0 252 moveto (4933     if \(log.lh.block[i] == b->blockno\)   // log absorbtion) show
0 240 moveto (4934       break;) show
0 228 moveto (4935   }) show
0 216 moveto (4936   log.lh.block[i] = b->blockno;) show
0 204 moveto (4937   if \(i == log.lh.n\)) show
0 192 moveto (4938     log.lh.n++;) show
0 180 moveto (4939   b->flags |= B_DIRTY; // prevent eviction) show
0 168 moveto (4940   release\(&log.lock\);) show
0 156 moveto (4941 }) show
0 144 moveto (4942 ) show
0 132 moveto (4943 ) show
0 120 moveto (4944 ) show
0 108 moveto (4945 ) show
0 96 moveto (4946 ) show
0 84 moveto (4947 ) show
0 72 moveto (4948 ) show
0 60 moveto (4949 ) show
0 24 moveto (Sheet 49) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 1) show
0 648 moveto (4950 // File system implementation.  Five layers:) show
0 636 moveto (4951 //   + Blocks: allocator for raw disk blocks.) show
0 624 moveto (4952 //   + Log: crash recovery for multi-step updates.) show
0 612 moveto (4953 //   + Files: inode allocator, reading, writing, metadata.) show
0 600 moveto (4954 //   + Directories: inode with special contents \(list of other inodes!\)) show
0 588 moveto (4955 //   + Names: paths like /usr/rtm/xv6/fs.c for convenient naming.) show
0 576 moveto (4956 //) show
0 564 moveto (4957 // This file contains the low-level file system manipulation) show
0 552 moveto (4958 // routines.  The \(higher-level\) system call implementations) show
0 540 moveto (4959 // are in sysfile.c.) show
0 528 moveto (4960 ) show
0 516 moveto (4961 #include "types.h") show
0 504 moveto (4962 #include "defs.h") show
0 492 moveto (4963 #include "param.h") show
0 480 moveto (4964 #include "stat.h") show
0 468 moveto (4965 #include "mmu.h") show
0 456 moveto (4966 #include "proc.h") show
0 444 moveto (4967 #include "spinlock.h") show
0 432 moveto (4968 #include "sleeplock.h") show
0 420 moveto (4969 #include "fs.h") show
0 408 moveto (4970 #include "buf.h") show
0 396 moveto (4971 #include "file.h") show
0 384 moveto (4972 ) show
0 372 moveto (4973 #define min\(a, b\) \(\(a\) < \(b\) ? \(a\) : \(b\)\)) show
0 360 moveto (4974 static void itrunc\(struct inode*\);) show
0 348 moveto (4975 // there should be one superblock per disk device, but we run with) show
0 336 moveto (4976 // only one device) show
0 324 moveto (4977 struct superblock sb;) show
0 312 moveto (4978 ) show
0 300 moveto (4979 // Read the super block.) show
0 288 moveto (4980 void) show
0 276 moveto (4981 readsb\(int dev, struct superblock *sb\)) show
0 264 moveto (4982 {) show
0 252 moveto (4983   struct buf *bp;) show
0 240 moveto (4984 ) show
0 228 moveto (4985   bp = bread\(dev, 1\);) show
0 216 moveto (4986   memmove\(sb, bp->data, sizeof\(*sb\)\);) show
0 204 moveto (4987   brelse\(bp\);) show
0 192 moveto (4988 }) show
0 180 moveto (4989 ) show
0 168 moveto (4990 ) show
0 156 moveto (4991 ) show
0 144 moveto (4992 ) show
0 132 moveto (4993 ) show
0 120 moveto (4994 ) show
0 108 moveto (4995 ) show
0 96 moveto (4996 ) show
0 84 moveto (4997 ) show
0 72 moveto (4998 ) show
0 60 moveto (4999 ) show
0 24 moveto (Sheet 49) show
grestore
restore
showpage
%%Page: 59 59
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 2) show
0 648 moveto (5000 // Zero a block.) show
0 636 moveto (5001 static void) show
0 624 moveto (5002 bzero\(int dev, int bno\)) show
0 612 moveto (5003 {) show
0 600 moveto (5004   struct buf *bp;) show
0 588 moveto (5005 ) show
0 576 moveto (5006   bp = bread\(dev, bno\);) show
0 564 moveto (5007   memset\(bp->data, 0, BSIZE\);) show
0 552 moveto (5008   log_write\(bp\);) show
0 540 moveto (5009   brelse\(bp\);) show
0 528 moveto (5010 }) show
0 516 moveto (5011 ) show
0 504 moveto (5012 // Blocks.) show
0 492 moveto (5013 ) show
0 480 moveto (5014 // Allocate a zeroed disk block.) show
0 468 moveto (5015 static uint) show
0 456 moveto (5016 balloc\(uint dev\)) show
0 444 moveto (5017 {) show
0 432 moveto (5018   int b, bi, m;) show
0 420 moveto (5019   struct buf *bp;) show
0 408 moveto (5020 ) show
0 396 moveto (5021   bp = 0;) show
0 384 moveto (5022   for\(b = 0; b < sb.size; b += BPB\){) show
0 372 moveto (5023     bp = bread\(dev, BBLOCK\(b, sb\)\);) show
0 360 moveto (5024     for\(bi = 0; bi < BPB && b + bi < sb.size; bi++\){) show
0 348 moveto (5025       m = 1 << \(bi % 8\);) show
0 336 moveto (5026       if\(\(bp->data[bi/8] & m\) == 0\){  // Is block free?) show
0 324 moveto (5027         bp->data[bi/8] |= m;  // Mark block in use.) show
0 312 moveto (5028         log_write\(bp\);) show
0 300 moveto (5029         brelse\(bp\);) show
0 288 moveto (5030         bzero\(dev, b + bi\);) show
0 276 moveto (5031         return b + bi;) show
0 264 moveto (5032       }) show
0 252 moveto (5033     }) show
0 240 moveto (5034     brelse\(bp\);) show
0 228 moveto (5035   }) show
0 216 moveto (5036   panic\("balloc: out of blocks"\);) show
0 204 moveto (5037 }) show
0 192 moveto (5038 ) show
0 180 moveto (5039 ) show
0 168 moveto (5040 ) show
0 156 moveto (5041 ) show
0 144 moveto (5042 ) show
0 132 moveto (5043 ) show
0 120 moveto (5044 ) show
0 108 moveto (5045 ) show
0 96 moveto (5046 ) show
0 84 moveto (5047 ) show
0 72 moveto (5048 ) show
0 60 moveto (5049 ) show
0 24 moveto (Sheet 50) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 3) show
0 648 moveto (5050 // Free a disk block.) show
0 636 moveto (5051 static void) show
0 624 moveto (5052 bfree\(int dev, uint b\)) show
0 612 moveto (5053 {) show
0 600 moveto (5054   struct buf *bp;) show
0 588 moveto (5055   int bi, m;) show
0 576 moveto (5056 ) show
0 564 moveto (5057   readsb\(dev, &sb\);) show
0 552 moveto (5058   bp = bread\(dev, BBLOCK\(b, sb\)\);) show
0 540 moveto (5059   bi = b % BPB;) show
0 528 moveto (5060   m = 1 << \(bi % 8\);) show
0 516 moveto (5061   if\(\(bp->data[bi/8] & m\) == 0\)) show
0 504 moveto (5062     panic\("freeing free block"\);) show
0 492 moveto (5063   bp->data[bi/8] &= ~m;) show
0 480 moveto (5064   log_write\(bp\);) show
0 468 moveto (5065   brelse\(bp\);) show
0 456 moveto (5066 }) show
0 444 moveto (5067 ) show
0 432 moveto (5068 // Inodes.) show
0 420 moveto (5069 //) show
0 408 moveto (5070 // An inode describes a single unnamed file.) show
0 396 moveto (5071 // The inode disk structure holds metadata: the file's type,) show
0 384 moveto (5072 // its size, the number of links referring to it, and the) show
0 372 moveto (5073 // list of blocks holding the file's content.) show
0 360 moveto (5074 //) show
0 348 moveto (5075 // The inodes are laid out sequentially on disk at) show
0 336 moveto (5076 // sb.startinode. Each inode has a number, indicating its) show
0 324 moveto (5077 // position on the disk.) show
0 312 moveto (5078 //) show
0 300 moveto (5079 // The kernel keeps a cache of in-use inodes in memory) show
0 288 moveto (5080 // to provide a place for synchronizing access) show
0 276 moveto (5081 // to inodes used by multiple processes. The cached) show
0 264 moveto (5082 // inodes include book-keeping information that is) show
0 252 moveto (5083 // not stored on disk: ip->ref and ip->valid.) show
0 240 moveto (5084 //) show
0 228 moveto (5085 // An inode and its in-memory representation go through a) show
0 216 moveto (5086 // sequence of states before they can be used by the) show
0 204 moveto (5087 // rest of the file system code.) show
0 192 moveto (5088 //) show
0 180 moveto (5089 // * Allocation: an inode is allocated if its type \(on disk\)) show
0 168 moveto (5090 //   is non-zero. ialloc\(\) allocates, and iput\(\) frees if) show
0 156 moveto (5091 //   the reference and link counts have fallen to zero.) show
0 144 moveto (5092 //) show
0 132 moveto (5093 // * Referencing in cache: an entry in the inode cache) show
0 120 moveto (5094 //   is free if ip->ref is zero. Otherwise ip->ref tracks) show
0 108 moveto (5095 //   the number of in-memory pointers to the entry \(open) show
0 96 moveto (5096 //   files and current directories\). iget\(\) finds or) show
0 84 moveto (5097 //   creates a cache entry and increments its ref; iput\(\)) show
0 72 moveto (5098 //   decrements ref.) show
0 60 moveto (5099 //) show
0 24 moveto (Sheet 50) show
grestore
restore
showpage
%%Page: 60 60
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 4) show
0 648 moveto (5100 // * Valid: the information \(type, size, &c\) in an inode) show
0 636 moveto (5101 //   cache entry is only correct when ip->valid is 1.) show
0 624 moveto (5102 //   ilock\(\) reads the inode from) show
0 612 moveto (5103 //   the disk and sets ip->valid, while iput\(\) clears) show
0 600 moveto (5104 //   ip->valid if ip->ref has fallen to zero.) show
0 588 moveto (5105 //) show
0 576 moveto (5106 // * Locked: file system code may only examine and modify) show
0 564 moveto (5107 //   the information in an inode and its content if it) show
0 552 moveto (5108 //   has first locked the inode.) show
0 540 moveto (5109 //) show
0 528 moveto (5110 // Thus a typical sequence is:) show
0 516 moveto (5111 //   ip = iget\(dev, inum\)) show
0 504 moveto (5112 //   ilock\(ip\)) show
0 492 moveto (5113 //   ... examine and modify ip->xxx ...) show
0 480 moveto (5114 //   iunlock\(ip\)) show
0 468 moveto (5115 //   iput\(ip\)) show
0 456 moveto (5116 //) show
0 444 moveto (5117 // ilock\(\) is separate from iget\(\) so that system calls can) show
0 432 moveto (5118 // get a long-term reference to an inode \(as for an open file\)) show
0 420 moveto (5119 // and only lock it for short periods \(e.g., in read\(\)\).) show
0 408 moveto (5120 // The separation also helps avoid deadlock and races during) show
0 396 moveto (5121 // pathname lookup. iget\(\) increments ip->ref so that the inode) show
0 384 moveto (5122 // stays cached and pointers to it remain valid.) show
0 372 moveto (5123 //) show
0 360 moveto (5124 // Many internal file system functions expect the caller to) show
0 348 moveto (5125 // have locked the inodes involved; this lets callers create) show
0 336 moveto (5126 // multi-step atomic operations.) show
0 324 moveto (5127 //) show
0 312 moveto (5128 // The icache.lock spin-lock protects the allocation of icache) show
0 300 moveto (5129 // entries. Since ip->ref indicates whether an entry is free,) show
0 288 moveto (5130 // and ip->dev and ip->inum indicate which i-node an entry) show
0 276 moveto (5131 // holds, one must hold icache.lock while using any of those fields.) show
0 264 moveto (5132 //) show
0 252 moveto (5133 // An ip->lock sleep-lock protects all ip-> fields other than ref,) show
0 240 moveto (5134 // dev, and inum.  One must hold ip->lock in order to) show
0 228 moveto (5135 // read or write that inode's ip->valid, ip->size, ip->type, &c.) show
0 216 moveto (5136 ) show
0 204 moveto (5137 struct {) show
0 192 moveto (5138   struct spinlock lock;) show
0 180 moveto (5139   struct inode inode[NINODE];) show
0 168 moveto (5140 } icache;) show
0 156 moveto (5141 ) show
0 144 moveto (5142 void) show
0 132 moveto (5143 iinit\(int dev\)) show
0 120 moveto (5144 {) show
0 108 moveto (5145   int i = 0;) show
0 96 moveto (5146 ) show
0 84 moveto (5147   initlock\(&icache.lock, "icache"\);) show
0 72 moveto (5148   for\(i = 0; i < NINODE; i++\) {) show
0 60 moveto (5149     initsleeplock\(&icache.inode[i].lock, "inode"\);) show
0 24 moveto (Sheet 51) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 5) show
0 648 moveto (5150   }) show
0 636 moveto (5151 ) show
0 624 moveto (5152   readsb\(dev, &sb\);) show
0 612 moveto (5153   cprintf\("sb: size %d nblocks %d ninodes %d nlog %d logstart %d\\) show
0 600 moveto (5154  inodestart %d bmap start %d\\n", sb.size, sb.nblocks,) show
0 588 moveto (5155           sb.ninodes, sb.nlog, sb.logstart, sb.inodestart,) show
0 576 moveto (5156           sb.bmapstart\);) show
0 564 moveto (5157 }) show
0 552 moveto (5158 ) show
0 540 moveto (5159 static struct inode* iget\(uint dev, uint inum\);) show
0 528 moveto (5160 ) show
0 516 moveto (5161 ) show
0 504 moveto (5162 ) show
0 492 moveto (5163 ) show
0 480 moveto (5164 ) show
0 468 moveto (5165 ) show
0 456 moveto (5166 ) show
0 444 moveto (5167 ) show
0 432 moveto (5168 ) show
0 420 moveto (5169 ) show
0 408 moveto (5170 ) show
0 396 moveto (5171 ) show
0 384 moveto (5172 ) show
0 372 moveto (5173 ) show
0 360 moveto (5174 ) show
0 348 moveto (5175 ) show
0 336 moveto (5176 ) show
0 324 moveto (5177 ) show
0 312 moveto (5178 ) show
0 300 moveto (5179 ) show
0 288 moveto (5180 ) show
0 276 moveto (5181 ) show
0 264 moveto (5182 ) show
0 252 moveto (5183 ) show
0 240 moveto (5184 ) show
0 228 moveto (5185 ) show
0 216 moveto (5186 ) show
0 204 moveto (5187 ) show
0 192 moveto (5188 ) show
0 180 moveto (5189 ) show
0 168 moveto (5190 ) show
0 156 moveto (5191 ) show
0 144 moveto (5192 ) show
0 132 moveto (5193 ) show
0 120 moveto (5194 ) show
0 108 moveto (5195 ) show
0 96 moveto (5196 ) show
0 84 moveto (5197 ) show
0 72 moveto (5198 ) show
0 60 moveto (5199 ) show
0 24 moveto (Sheet 51) show
grestore
restore
showpage
%%Page: 61 61
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 6) show
0 648 moveto (5200 // Allocate an inode on device dev.) show
0 636 moveto (5201 // Mark it as allocated by  giving it type type.) show
0 624 moveto (5202 // Returns an unlocked but allocated and referenced inode.) show
0 612 moveto (5203 struct inode*) show
0 600 moveto (5204 ialloc\(uint dev, short type\)) show
0 588 moveto (5205 {) show
0 576 moveto (5206   int inum;) show
0 564 moveto (5207   struct buf *bp;) show
0 552 moveto (5208   struct dinode *dip;) show
0 540 moveto (5209 ) show
0 528 moveto (5210   for\(inum = 1; inum < sb.ninodes; inum++\){) show
0 516 moveto (5211     bp = bread\(dev, IBLOCK\(inum, sb\)\);) show
0 504 moveto (5212     dip = \(struct dinode*\)bp->data + inum%IPB;) show
0 492 moveto (5213     if\(dip->type == 0\){  // a free inode) show
0 480 moveto (5214       memset\(dip, 0, sizeof\(*dip\)\);) show
0 468 moveto (5215       dip->type = type;) show
0 456 moveto (5216       log_write\(bp\);   // mark it allocated on the disk) show
0 444 moveto (5217       brelse\(bp\);) show
0 432 moveto (5218       return iget\(dev, inum\);) show
0 420 moveto (5219     }) show
0 408 moveto (5220     brelse\(bp\);) show
0 396 moveto (5221   }) show
0 384 moveto (5222   panic\("ialloc: no inodes"\);) show
0 372 moveto (5223 }) show
0 360 moveto (5224 ) show
0 348 moveto (5225 // Copy a modified in-memory inode to disk.) show
0 336 moveto (5226 // Must be called after every change to an ip->xxx field) show
0 324 moveto (5227 // that lives on disk, since i-node cache is write-through.) show
0 312 moveto (5228 // Caller must hold ip->lock.) show
0 300 moveto (5229 void) show
0 288 moveto (5230 iupdate\(struct inode *ip\)) show
0 276 moveto (5231 {) show
0 264 moveto (5232   struct buf *bp;) show
0 252 moveto (5233   struct dinode *dip;) show
0 240 moveto (5234 ) show
0 228 moveto (5235   bp = bread\(ip->dev, IBLOCK\(ip->inum, sb\)\);) show
0 216 moveto (5236   dip = \(struct dinode*\)bp->data + ip->inum%IPB;) show
0 204 moveto (5237   dip->type = ip->type;) show
0 192 moveto (5238   dip->major = ip->major;) show
0 180 moveto (5239   dip->minor = ip->minor;) show
0 168 moveto (5240   dip->nlink = ip->nlink;) show
0 156 moveto (5241   dip->size = ip->size;) show
0 144 moveto (5242   memmove\(dip->addrs, ip->addrs, sizeof\(ip->addrs\)\);) show
0 132 moveto (5243   log_write\(bp\);) show
0 120 moveto (5244   brelse\(bp\);) show
0 108 moveto (5245 }) show
0 96 moveto (5246 ) show
0 84 moveto (5247 ) show
0 72 moveto (5248 ) show
0 60 moveto (5249 ) show
0 24 moveto (Sheet 52) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 7) show
0 648 moveto (5250 // Find the inode with number inum on device dev) show
0 636 moveto (5251 // and return the in-memory copy. Does not lock) show
0 624 moveto (5252 // the inode and does not read it from disk.) show
0 612 moveto (5253 static struct inode*) show
0 600 moveto (5254 iget\(uint dev, uint inum\)) show
0 588 moveto (5255 {) show
0 576 moveto (5256   struct inode *ip, *empty;) show
0 564 moveto (5257 ) show
0 552 moveto (5258   acquire\(&icache.lock\);) show
0 540 moveto (5259 ) show
0 528 moveto (5260   // Is the inode already cached?) show
0 516 moveto (5261   empty = 0;) show
0 504 moveto (5262   for\(ip = &icache.inode[0]; ip < &icache.inode[NINODE]; ip++\){) show
0 492 moveto (5263     if\(ip->ref > 0 && ip->dev == dev && ip->inum == inum\){) show
0 480 moveto (5264       ip->ref++;) show
0 468 moveto (5265       release\(&icache.lock\);) show
0 456 moveto (5266       return ip;) show
0 444 moveto (5267     }) show
0 432 moveto (5268     if\(empty == 0 && ip->ref == 0\)    // Remember empty slot.) show
0 420 moveto (5269       empty = ip;) show
0 408 moveto (5270   }) show
0 396 moveto (5271 ) show
0 384 moveto (5272   // Recycle an inode cache entry.) show
0 372 moveto (5273   if\(empty == 0\)) show
0 360 moveto (5274     panic\("iget: no inodes"\);) show
0 348 moveto (5275 ) show
0 336 moveto (5276   ip = empty;) show
0 324 moveto (5277   ip->dev = dev;) show
0 312 moveto (5278   ip->inum = inum;) show
0 300 moveto (5279   ip->ref = 1;) show
0 288 moveto (5280   ip->valid = 0;) show
0 276 moveto (5281   release\(&icache.lock\);) show
0 264 moveto (5282 ) show
0 252 moveto (5283   return ip;) show
0 240 moveto (5284 }) show
0 228 moveto (5285 ) show
0 216 moveto (5286 // Increment reference count for ip.) show
0 204 moveto (5287 // Returns ip to enable ip = idup\(ip1\) idiom.) show
0 192 moveto (5288 struct inode*) show
0 180 moveto (5289 idup\(struct inode *ip\)) show
0 168 moveto (5290 {) show
0 156 moveto (5291   acquire\(&icache.lock\);) show
0 144 moveto (5292   ip->ref++;) show
0 132 moveto (5293   release\(&icache.lock\);) show
0 120 moveto (5294   return ip;) show
0 108 moveto (5295 }) show
0 96 moveto (5296 ) show
0 84 moveto (5297 ) show
0 72 moveto (5298 ) show
0 60 moveto (5299 ) show
0 24 moveto (Sheet 52) show
grestore
restore
showpage
%%Page: 62 62
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 8) show
0 648 moveto (5300 // Lock the given inode.) show
0 636 moveto (5301 // Reads the inode from disk if necessary.) show
0 624 moveto (5302 void) show
0 612 moveto (5303 ilock\(struct inode *ip\)) show
0 600 moveto (5304 {) show
0 588 moveto (5305   struct buf *bp;) show
0 576 moveto (5306   struct dinode *dip;) show
0 564 moveto (5307 ) show
0 552 moveto (5308   if\(ip == 0 || ip->ref < 1\)) show
0 540 moveto (5309     panic\("ilock"\);) show
0 528 moveto (5310 ) show
0 516 moveto (5311   acquiresleep\(&ip->lock\);) show
0 504 moveto (5312 ) show
0 492 moveto (5313   if\(ip->valid == 0\){) show
0 480 moveto (5314     bp = bread\(ip->dev, IBLOCK\(ip->inum, sb\)\);) show
0 468 moveto (5315     dip = \(struct dinode*\)bp->data + ip->inum%IPB;) show
0 456 moveto (5316     ip->type = dip->type;) show
0 444 moveto (5317     ip->major = dip->major;) show
0 432 moveto (5318     ip->minor = dip->minor;) show
0 420 moveto (5319     ip->nlink = dip->nlink;) show
0 408 moveto (5320     ip->size = dip->size;) show
0 396 moveto (5321     memmove\(ip->addrs, dip->addrs, sizeof\(ip->addrs\)\);) show
0 384 moveto (5322     brelse\(bp\);) show
0 372 moveto (5323     ip->valid = 1;) show
0 360 moveto (5324     if\(ip->type == 0\)) show
0 348 moveto (5325       panic\("ilock: no type"\);) show
0 336 moveto (5326   }) show
0 324 moveto (5327 }) show
0 312 moveto (5328 ) show
0 300 moveto (5329 // Unlock the given inode.) show
0 288 moveto (5330 void) show
0 276 moveto (5331 iunlock\(struct inode *ip\)) show
0 264 moveto (5332 {) show
0 252 moveto (5333   if\(ip == 0 || !holdingsleep\(&ip->lock\) || ip->ref < 1\)) show
0 240 moveto (5334     panic\("iunlock"\);) show
0 228 moveto (5335 ) show
0 216 moveto (5336   releasesleep\(&ip->lock\);) show
0 204 moveto (5337 }) show
0 192 moveto (5338 ) show
0 180 moveto (5339 ) show
0 168 moveto (5340 ) show
0 156 moveto (5341 ) show
0 144 moveto (5342 ) show
0 132 moveto (5343 ) show
0 120 moveto (5344 ) show
0 108 moveto (5345 ) show
0 96 moveto (5346 ) show
0 84 moveto (5347 ) show
0 72 moveto (5348 ) show
0 60 moveto (5349 ) show
0 24 moveto (Sheet 53) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 9) show
0 648 moveto (5350 // Drop a reference to an in-memory inode.) show
0 636 moveto (5351 // If that was the last reference, the inode cache entry can) show
0 624 moveto (5352 // be recycled.) show
0 612 moveto (5353 // If that was the last reference and the inode has no links) show
0 600 moveto (5354 // to it, free the inode \(and its content\) on disk.) show
0 588 moveto (5355 // All calls to iput\(\) must be inside a transaction in) show
0 576 moveto (5356 // case it has to free the inode.) show
0 564 moveto (5357 void) show
0 552 moveto (5358 iput\(struct inode *ip\)) show
0 540 moveto (5359 {) show
0 528 moveto (5360   acquiresleep\(&ip->lock\);) show
0 516 moveto (5361   if\(ip->valid && ip->nlink == 0\){) show
0 504 moveto (5362     acquire\(&icache.lock\);) show
0 492 moveto (5363     int r = ip->ref;) show
0 480 moveto (5364     release\(&icache.lock\);) show
0 468 moveto (5365     if\(r == 1\){) show
0 456 moveto (5366       // inode has no links and no other references: truncate and free.) show
0 444 moveto (5367       itrunc\(ip\);) show
0 432 moveto (5368       ip->type = 0;) show
0 420 moveto (5369       iupdate\(ip\);) show
0 408 moveto (5370       ip->valid = 0;) show
0 396 moveto (5371     }) show
0 384 moveto (5372   }) show
0 372 moveto (5373   releasesleep\(&ip->lock\);) show
0 360 moveto (5374 ) show
0 348 moveto (5375   acquire\(&icache.lock\);) show
0 336 moveto (5376   ip->ref--;) show
0 324 moveto (5377   release\(&icache.lock\);) show
0 312 moveto (5378 }) show
0 300 moveto (5379 ) show
0 288 moveto (5380 // Common idiom: unlock, then put.) show
0 276 moveto (5381 void) show
0 264 moveto (5382 iunlockput\(struct inode *ip\)) show
0 252 moveto (5383 {) show
0 240 moveto (5384   iunlock\(ip\);) show
0 228 moveto (5385   iput\(ip\);) show
0 216 moveto (5386 }) show
0 204 moveto (5387 ) show
0 192 moveto (5388 ) show
0 180 moveto (5389 ) show
0 168 moveto (5390 ) show
0 156 moveto (5391 ) show
0 144 moveto (5392 ) show
0 132 moveto (5393 ) show
0 120 moveto (5394 ) show
0 108 moveto (5395 ) show
0 96 moveto (5396 ) show
0 84 moveto (5397 ) show
0 72 moveto (5398 ) show
0 60 moveto (5399 ) show
0 24 moveto (Sheet 53) show
grestore
restore
showpage
%%Page: 63 63
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 10) show
0 648 moveto (5400 // Inode content) show
0 636 moveto (5401 //) show
0 624 moveto (5402 // The content \(data\) associated with each inode is stored) show
0 612 moveto (5403 // in blocks on the disk. The first NDIRECT block numbers) show
0 600 moveto (5404 // are listed in ip->addrs[].  The next NINDIRECT blocks are) show
0 588 moveto (5405 // listed in block ip->addrs[NDIRECT].) show
0 576 moveto (5406 ) show
0 564 moveto (5407 // Return the disk block address of the nth block in inode ip.) show
0 552 moveto (5408 // If there is no such block, bmap allocates one.) show
0 540 moveto (5409 static uint) show
0 528 moveto (5410 bmap\(struct inode *ip, uint bn\)) show
0 516 moveto (5411 {) show
0 504 moveto (5412   uint addr, *a;) show
0 492 moveto (5413   struct buf *bp;) show
0 480 moveto (5414 ) show
0 468 moveto (5415   if\(bn < NDIRECT\){) show
0 456 moveto (5416     if\(\(addr = ip->addrs[bn]\) == 0\)) show
0 444 moveto (5417       ip->addrs[bn] = addr = balloc\(ip->dev\);) show
0 432 moveto (5418     return addr;) show
0 420 moveto (5419   }) show
0 408 moveto (5420   bn -= NDIRECT;) show
0 396 moveto (5421 ) show
0 384 moveto (5422   if\(bn < NINDIRECT\){) show
0 372 moveto (5423     // Load indirect block, allocating if necessary.) show
0 360 moveto (5424     if\(\(addr = ip->addrs[NDIRECT]\) == 0\)) show
0 348 moveto (5425       ip->addrs[NDIRECT] = addr = balloc\(ip->dev\);) show
0 336 moveto (5426     bp = bread\(ip->dev, addr\);) show
0 324 moveto (5427     a = \(uint*\)bp->data;) show
0 312 moveto (5428     if\(\(addr = a[bn]\) == 0\){) show
0 300 moveto (5429       a[bn] = addr = balloc\(ip->dev\);) show
0 288 moveto (5430       log_write\(bp\);) show
0 276 moveto (5431     }) show
0 264 moveto (5432     brelse\(bp\);) show
0 252 moveto (5433     return addr;) show
0 240 moveto (5434   }) show
0 228 moveto (5435 ) show
0 216 moveto (5436   panic\("bmap: out of range"\);) show
0 204 moveto (5437 }) show
0 192 moveto (5438 ) show
0 180 moveto (5439 ) show
0 168 moveto (5440 ) show
0 156 moveto (5441 ) show
0 144 moveto (5442 ) show
0 132 moveto (5443 ) show
0 120 moveto (5444 ) show
0 108 moveto (5445 ) show
0 96 moveto (5446 ) show
0 84 moveto (5447 ) show
0 72 moveto (5448 ) show
0 60 moveto (5449 ) show
0 24 moveto (Sheet 54) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 11) show
0 648 moveto (5450 // Truncate inode \(discard contents\).) show
0 636 moveto (5451 // Only called when the inode has no links) show
0 624 moveto (5452 // to it \(no directory entries referring to it\)) show
0 612 moveto (5453 // and has no in-memory reference to it \(is) show
0 600 moveto (5454 // not an open file or current directory\).) show
0 588 moveto (5455 static void) show
0 576 moveto (5456 itrunc\(struct inode *ip\)) show
0 564 moveto (5457 {) show
0 552 moveto (5458   int i, j;) show
0 540 moveto (5459   struct buf *bp;) show
0 528 moveto (5460   uint *a;) show
0 516 moveto (5461 ) show
0 504 moveto (5462   for\(i = 0; i < NDIRECT; i++\){) show
0 492 moveto (5463     if\(ip->addrs[i]\){) show
0 480 moveto (5464       bfree\(ip->dev, ip->addrs[i]\);) show
0 468 moveto (5465       ip->addrs[i] = 0;) show
0 456 moveto (5466     }) show
0 444 moveto (5467   }) show
0 432 moveto (5468 ) show
0 420 moveto (5469   if\(ip->addrs[NDIRECT]\){) show
0 408 moveto (5470     bp = bread\(ip->dev, ip->addrs[NDIRECT]\);) show
0 396 moveto (5471     a = \(uint*\)bp->data;) show
0 384 moveto (5472     for\(j = 0; j < NINDIRECT; j++\){) show
0 372 moveto (5473       if\(a[j]\)) show
0 360 moveto (5474         bfree\(ip->dev, a[j]\);) show
0 348 moveto (5475     }) show
0 336 moveto (5476     brelse\(bp\);) show
0 324 moveto (5477     bfree\(ip->dev, ip->addrs[NDIRECT]\);) show
0 312 moveto (5478     ip->addrs[NDIRECT] = 0;) show
0 300 moveto (5479   }) show
0 288 moveto (5480 ) show
0 276 moveto (5481   ip->size = 0;) show
0 264 moveto (5482   iupdate\(ip\);) show
0 252 moveto (5483 }) show
0 240 moveto (5484 ) show
0 228 moveto (5485 // Copy stat information from inode.) show
0 216 moveto (5486 // Caller must hold ip->lock.) show
0 204 moveto (5487 void) show
0 192 moveto (5488 stati\(struct inode *ip, struct stat *st\)) show
0 180 moveto (5489 {) show
0 168 moveto (5490   st->dev = ip->dev;) show
0 156 moveto (5491   st->ino = ip->inum;) show
0 144 moveto (5492   st->type = ip->type;) show
0 132 moveto (5493   st->nlink = ip->nlink;) show
0 120 moveto (5494   st->size = ip->size;) show
0 108 moveto (5495 }) show
0 96 moveto (5496 ) show
0 84 moveto (5497 ) show
0 72 moveto (5498 ) show
0 60 moveto (5499 ) show
0 24 moveto (Sheet 54) show
grestore
restore
showpage
%%Page: 64 64
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 12) show
0 648 moveto (5500 // Read data from inode.) show
0 636 moveto (5501 // Caller must hold ip->lock.) show
0 624 moveto (5502 int) show
0 612 moveto (5503 readi\(struct inode *ip, char *dst, uint off, uint n\)) show
0 600 moveto (5504 {) show
0 588 moveto (5505   uint tot, m;) show
0 576 moveto (5506   struct buf *bp;) show
0 564 moveto (5507 ) show
0 552 moveto (5508   if\(ip->type == T_DEV\){) show
0 540 moveto (5509     if\(ip->major < 0 || ip->major >= NDEV || !devsw[ip->major].read\)) show
0 528 moveto (5510       return -1;) show
0 516 moveto (5511     return devsw[ip->major].read\(ip, dst, n\);) show
0 504 moveto (5512   }) show
0 492 moveto (5513 ) show
0 480 moveto (5514   if\(off > ip->size || off + n < off\)) show
0 468 moveto (5515     return -1;) show
0 456 moveto (5516   if\(off + n > ip->size\)) show
0 444 moveto (5517     n = ip->size - off;) show
0 432 moveto (5518 ) show
0 420 moveto (5519   for\(tot=0; tot<n; tot+=m, off+=m, dst+=m\){) show
0 408 moveto (5520     bp = bread\(ip->dev, bmap\(ip, off/BSIZE\)\);) show
0 396 moveto (5521     m = min\(n - tot, BSIZE - off%BSIZE\);) show
0 384 moveto (5522     memmove\(dst, bp->data + off%BSIZE, m\);) show
0 372 moveto (5523     brelse\(bp\);) show
0 360 moveto (5524   }) show
0 348 moveto (5525   return n;) show
0 336 moveto (5526 }) show
0 324 moveto (5527 ) show
0 312 moveto (5528 ) show
0 300 moveto (5529 ) show
0 288 moveto (5530 ) show
0 276 moveto (5531 ) show
0 264 moveto (5532 ) show
0 252 moveto (5533 ) show
0 240 moveto (5534 ) show
0 228 moveto (5535 ) show
0 216 moveto (5536 ) show
0 204 moveto (5537 ) show
0 192 moveto (5538 ) show
0 180 moveto (5539 ) show
0 168 moveto (5540 ) show
0 156 moveto (5541 ) show
0 144 moveto (5542 ) show
0 132 moveto (5543 ) show
0 120 moveto (5544 ) show
0 108 moveto (5545 ) show
0 96 moveto (5546 ) show
0 84 moveto (5547 ) show
0 72 moveto (5548 ) show
0 60 moveto (5549 ) show
0 24 moveto (Sheet 55) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 13) show
0 648 moveto (5550 // Write data to inode.) show
0 636 moveto (5551 // Caller must hold ip->lock.) show
0 624 moveto (5552 int) show
0 612 moveto (5553 writei\(struct inode *ip, char *src, uint off, uint n\)) show
0 600 moveto (5554 {) show
0 588 moveto (5555   uint tot, m;) show
0 576 moveto (5556   struct buf *bp;) show
0 564 moveto (5557 ) show
0 552 moveto (5558   if\(ip->type == T_DEV\){) show
0 540 moveto (5559     if\(ip->major < 0 || ip->major >= NDEV || !devsw[ip->major].write\)) show
0 528 moveto (5560       return -1;) show
0 516 moveto (5561     return devsw[ip->major].write\(ip, src, n\);) show
0 504 moveto (5562   }) show
0 492 moveto (5563 ) show
0 480 moveto (5564   if\(off > ip->size || off + n < off\)) show
0 468 moveto (5565     return -1;) show
0 456 moveto (5566   if\(off + n > MAXFILE*BSIZE\)) show
0 444 moveto (5567     return -1;) show
0 432 moveto (5568 ) show
0 420 moveto (5569   for\(tot=0; tot<n; tot+=m, off+=m, src+=m\){) show
0 408 moveto (5570     bp = bread\(ip->dev, bmap\(ip, off/BSIZE\)\);) show
0 396 moveto (5571     m = min\(n - tot, BSIZE - off%BSIZE\);) show
0 384 moveto (5572     memmove\(bp->data + off%BSIZE, src, m\);) show
0 372 moveto (5573     log_write\(bp\);) show
0 360 moveto (5574     brelse\(bp\);) show
0 348 moveto (5575   }) show
0 336 moveto (5576 ) show
0 324 moveto (5577   if\(n > 0 && off > ip->size\){) show
0 312 moveto (5578     ip->size = off;) show
0 300 moveto (5579     iupdate\(ip\);) show
0 288 moveto (5580   }) show
0 276 moveto (5581   return n;) show
0 264 moveto (5582 }) show
0 252 moveto (5583 ) show
0 240 moveto (5584 ) show
0 228 moveto (5585 ) show
0 216 moveto (5586 ) show
0 204 moveto (5587 ) show
0 192 moveto (5588 ) show
0 180 moveto (5589 ) show
0 168 moveto (5590 ) show
0 156 moveto (5591 ) show
0 144 moveto (5592 ) show
0 132 moveto (5593 ) show
0 120 moveto (5594 ) show
0 108 moveto (5595 ) show
0 96 moveto (5596 ) show
0 84 moveto (5597 ) show
0 72 moveto (5598 ) show
0 60 moveto (5599 ) show
0 24 moveto (Sheet 55) show
grestore
restore
showpage
%%Page: 65 65
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 14) show
0 648 moveto (5600 // Directories) show
0 636 moveto (5601 ) show
0 624 moveto (5602 int) show
0 612 moveto (5603 namecmp\(const char *s, const char *t\)) show
0 600 moveto (5604 {) show
0 588 moveto (5605   return strncmp\(s, t, DIRSIZ\);) show
0 576 moveto (5606 }) show
0 564 moveto (5607 ) show
0 552 moveto (5608 // Look for a directory entry in a directory.) show
0 540 moveto (5609 // If found, set *poff to byte offset of entry.) show
0 528 moveto (5610 struct inode*) show
0 516 moveto (5611 dirlookup\(struct inode *dp, char *name, uint *poff\)) show
0 504 moveto (5612 {) show
0 492 moveto (5613   uint off, inum;) show
0 480 moveto (5614   struct dirent de;) show
0 468 moveto (5615 ) show
0 456 moveto (5616   if\(dp->type != T_DIR\)) show
0 444 moveto (5617     panic\("dirlookup not DIR"\);) show
0 432 moveto (5618 ) show
0 420 moveto (5619   for\(off = 0; off < dp->size; off += sizeof\(de\)\){) show
0 408 moveto (5620     if\(readi\(dp, \(char*\)&de, off, sizeof\(de\)\) != sizeof\(de\)\)) show
0 396 moveto (5621       panic\("dirlookup read"\);) show
0 384 moveto (5622     if\(de.inum == 0\)) show
0 372 moveto (5623       continue;) show
0 360 moveto (5624     if\(namecmp\(name, de.name\) == 0\){) show
0 348 moveto (5625       // entry matches path element) show
0 336 moveto (5626       if\(poff\)) show
0 324 moveto (5627         *poff = off;) show
0 312 moveto (5628       inum = de.inum;) show
0 300 moveto (5629       return iget\(dp->dev, inum\);) show
0 288 moveto (5630     }) show
0 276 moveto (5631   }) show
0 264 moveto (5632 ) show
0 252 moveto (5633   return 0;) show
0 240 moveto (5634 }) show
0 228 moveto (5635 ) show
0 216 moveto (5636 ) show
0 204 moveto (5637 ) show
0 192 moveto (5638 ) show
0 180 moveto (5639 ) show
0 168 moveto (5640 ) show
0 156 moveto (5641 ) show
0 144 moveto (5642 ) show
0 132 moveto (5643 ) show
0 120 moveto (5644 ) show
0 108 moveto (5645 ) show
0 96 moveto (5646 ) show
0 84 moveto (5647 ) show
0 72 moveto (5648 ) show
0 60 moveto (5649 ) show
0 24 moveto (Sheet 56) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 15) show
0 648 moveto (5650 // Write a new directory entry \(name, inum\) into the directory dp.) show
0 636 moveto (5651 int) show
0 624 moveto (5652 dirlink\(struct inode *dp, char *name, uint inum\)) show
0 612 moveto (5653 {) show
0 600 moveto (5654   int off;) show
0 588 moveto (5655   struct dirent de;) show
0 576 moveto (5656   struct inode *ip;) show
0 564 moveto (5657 ) show
0 552 moveto (5658   // Check that name is not present.) show
0 540 moveto (5659   if\(\(ip = dirlookup\(dp, name, 0\)\) != 0\){) show
0 528 moveto (5660     iput\(ip\);) show
0 516 moveto (5661     return -1;) show
0 504 moveto (5662   }) show
0 492 moveto (5663 ) show
0 480 moveto (5664   // Look for an empty dirent.) show
0 468 moveto (5665   for\(off = 0; off < dp->size; off += sizeof\(de\)\){) show
0 456 moveto (5666     if\(readi\(dp, \(char*\)&de, off, sizeof\(de\)\) != sizeof\(de\)\)) show
0 444 moveto (5667       panic\("dirlink read"\);) show
0 432 moveto (5668     if\(de.inum == 0\)) show
0 420 moveto (5669       break;) show
0 408 moveto (5670   }) show
0 396 moveto (5671 ) show
0 384 moveto (5672   strncpy\(de.name, name, DIRSIZ\);) show
0 372 moveto (5673   de.inum = inum;) show
0 360 moveto (5674   if\(writei\(dp, \(char*\)&de, off, sizeof\(de\)\) != sizeof\(de\)\)) show
0 348 moveto (5675     panic\("dirlink"\);) show
0 336 moveto (5676 ) show
0 324 moveto (5677   return 0;) show
0 312 moveto (5678 }) show
0 300 moveto (5679 ) show
0 288 moveto (5680 ) show
0 276 moveto (5681 ) show
0 264 moveto (5682 ) show
0 252 moveto (5683 ) show
0 240 moveto (5684 ) show
0 228 moveto (5685 ) show
0 216 moveto (5686 ) show
0 204 moveto (5687 ) show
0 192 moveto (5688 ) show
0 180 moveto (5689 ) show
0 168 moveto (5690 ) show
0 156 moveto (5691 ) show
0 144 moveto (5692 ) show
0 132 moveto (5693 ) show
0 120 moveto (5694 ) show
0 108 moveto (5695 ) show
0 96 moveto (5696 ) show
0 84 moveto (5697 ) show
0 72 moveto (5698 ) show
0 60 moveto (5699 ) show
0 24 moveto (Sheet 56) show
grestore
restore
showpage
%%Page: 66 66
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 16) show
0 648 moveto (5700 // Paths) show
0 636 moveto (5701 ) show
0 624 moveto (5702 // Copy the next path element from path into name.) show
0 612 moveto (5703 // Return a pointer to the element following the copied one.) show
0 600 moveto (5704 // The returned path has no leading slashes,) show
0 588 moveto (5705 // so the caller can check *path=='\\0' to see if the name is the last one.) show
0 576 moveto (5706 // If no name to remove, return 0.) show
0 564 moveto (5707 //) show
0 552 moveto (5708 // Examples:) show
0 540 moveto (5709 //   skipelem\("a/bb/c", name\) = "bb/c", setting name = "a") show
0 528 moveto (5710 //   skipelem\("///a//bb", name\) = "bb", setting name = "a") show
0 516 moveto (5711 //   skipelem\("a", name\) = "", setting name = "a") show
0 504 moveto (5712 //   skipelem\("", name\) = skipelem\("////", name\) = 0) show
0 492 moveto (5713 //) show
0 480 moveto (5714 static char*) show
0 468 moveto (5715 skipelem\(char *path, char *name\)) show
0 456 moveto (5716 {) show
0 444 moveto (5717   char *s;) show
0 432 moveto (5718   int len;) show
0 420 moveto (5719 ) show
0 408 moveto (5720   while\(*path == '/'\)) show
0 396 moveto (5721     path++;) show
0 384 moveto (5722   if\(*path == 0\)) show
0 372 moveto (5723     return 0;) show
0 360 moveto (5724   s = path;) show
0 348 moveto (5725   while\(*path != '/' && *path != 0\)) show
0 336 moveto (5726     path++;) show
0 324 moveto (5727   len = path - s;) show
0 312 moveto (5728   if\(len >= DIRSIZ\)) show
0 300 moveto (5729     memmove\(name, s, DIRSIZ\);) show
0 288 moveto (5730   else {) show
0 276 moveto (5731     memmove\(name, s, len\);) show
0 264 moveto (5732     name[len] = 0;) show
0 252 moveto (5733   }) show
0 240 moveto (5734   while\(*path == '/'\)) show
0 228 moveto (5735     path++;) show
0 216 moveto (5736   return path;) show
0 204 moveto (5737 }) show
0 192 moveto (5738 ) show
0 180 moveto (5739 ) show
0 168 moveto (5740 ) show
0 156 moveto (5741 ) show
0 144 moveto (5742 ) show
0 132 moveto (5743 ) show
0 120 moveto (5744 ) show
0 108 moveto (5745 ) show
0 96 moveto (5746 ) show
0 84 moveto (5747 ) show
0 72 moveto (5748 ) show
0 60 moveto (5749 ) show
0 24 moveto (Sheet 57) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 17) show
0 648 moveto (5750 // Look up and return the inode for a path name.) show
0 636 moveto (5751 // If parent != 0, return the inode for the parent and copy the final) show
0 624 moveto (5752 // path element into name, which must have room for DIRSIZ bytes.) show
0 612 moveto (5753 // Must be called inside a transaction since it calls iput\(\).) show
0 600 moveto (5754 static struct inode*) show
0 588 moveto (5755 namex\(char *path, int nameiparent, char *name\)) show
0 576 moveto (5756 {) show
0 564 moveto (5757   struct inode *ip, *next;) show
0 552 moveto (5758 ) show
0 540 moveto (5759   if\(*path == '/'\)) show
0 528 moveto (5760     ip = iget\(ROOTDEV, ROOTINO\);) show
0 516 moveto (5761   else) show
0 504 moveto (5762     ip = idup\(myproc\(\)->cwd\);) show
0 492 moveto (5763 ) show
0 480 moveto (5764   while\(\(path = skipelem\(path, name\)\) != 0\){) show
0 468 moveto (5765     ilock\(ip\);) show
0 456 moveto (5766     if\(ip->type != T_DIR\){) show
0 444 moveto (5767       iunlockput\(ip\);) show
0 432 moveto (5768       return 0;) show
0 420 moveto (5769     }) show
0 408 moveto (5770     if\(nameiparent && *path == '\\0'\){) show
0 396 moveto (5771       // Stop one level early.) show
0 384 moveto (5772       iunlock\(ip\);) show
0 372 moveto (5773       return ip;) show
0 360 moveto (5774     }) show
0 348 moveto (5775     if\(\(next = dirlookup\(ip, name, 0\)\) == 0\){) show
0 336 moveto (5776       iunlockput\(ip\);) show
0 324 moveto (5777       return 0;) show
0 312 moveto (5778     }) show
0 300 moveto (5779     iunlockput\(ip\);) show
0 288 moveto (5780     ip = next;) show
0 276 moveto (5781   }) show
0 264 moveto (5782   if\(nameiparent\){) show
0 252 moveto (5783     iput\(ip\);) show
0 240 moveto (5784     return 0;) show
0 228 moveto (5785   }) show
0 216 moveto (5786   return ip;) show
0 204 moveto (5787 }) show
0 192 moveto (5788 ) show
0 180 moveto (5789 struct inode*) show
0 168 moveto (5790 namei\(char *path\)) show
0 156 moveto (5791 {) show
0 144 moveto (5792   char name[DIRSIZ];) show
0 132 moveto (5793   return namex\(path, 0, name\);) show
0 120 moveto (5794 }) show
0 108 moveto (5795 ) show
0 96 moveto (5796 ) show
0 84 moveto (5797 ) show
0 72 moveto (5798 ) show
0 60 moveto (5799 ) show
0 24 moveto (Sheet 57) show
grestore
restore
showpage
%%Page: 67 67
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/fs.c  Page 18) show
0 648 moveto (5800 struct inode*) show
0 636 moveto (5801 nameiparent\(char *path, char *name\)) show
0 624 moveto (5802 {) show
0 612 moveto (5803   return namex\(path, 1, name\);) show
0 600 moveto (5804 }) show
0 588 moveto (5805 ) show
0 576 moveto (5806 ) show
0 564 moveto (5807 ) show
0 552 moveto (5808 ) show
0 540 moveto (5809 ) show
0 528 moveto (5810 ) show
0 516 moveto (5811 ) show
0 504 moveto (5812 ) show
0 492 moveto (5813 ) show
0 480 moveto (5814 ) show
0 468 moveto (5815 ) show
0 456 moveto (5816 ) show
0 444 moveto (5817 ) show
0 432 moveto (5818 ) show
0 420 moveto (5819 ) show
0 408 moveto (5820 ) show
0 396 moveto (5821 ) show
0 384 moveto (5822 ) show
0 372 moveto (5823 ) show
0 360 moveto (5824 ) show
0 348 moveto (5825 ) show
0 336 moveto (5826 ) show
0 324 moveto (5827 ) show
0 312 moveto (5828 ) show
0 300 moveto (5829 ) show
0 288 moveto (5830 ) show
0 276 moveto (5831 ) show
0 264 moveto (5832 ) show
0 252 moveto (5833 ) show
0 240 moveto (5834 ) show
0 228 moveto (5835 ) show
0 216 moveto (5836 ) show
0 204 moveto (5837 ) show
0 192 moveto (5838 ) show
0 180 moveto (5839 ) show
0 168 moveto (5840 ) show
0 156 moveto (5841 ) show
0 144 moveto (5842 ) show
0 132 moveto (5843 ) show
0 120 moveto (5844 ) show
0 108 moveto (5845 ) show
0 96 moveto (5846 ) show
0 84 moveto (5847 ) show
0 72 moveto (5848 ) show
0 60 moveto (5849 ) show
0 24 moveto (Sheet 58) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/file.c  Page 1) show
0 648 moveto (5850 //) show
0 636 moveto (5851 // File descriptors) show
0 624 moveto (5852 //) show
0 612 moveto (5853 ) show
0 600 moveto (5854 #include "types.h") show
0 588 moveto (5855 #include "defs.h") show
0 576 moveto (5856 #include "param.h") show
0 564 moveto (5857 #include "fs.h") show
0 552 moveto (5858 #include "spinlock.h") show
0 540 moveto (5859 #include "sleeplock.h") show
0 528 moveto (5860 #include "file.h") show
0 516 moveto (5861 ) show
0 504 moveto (5862 struct devsw devsw[NDEV];) show
0 492 moveto (5863 struct {) show
0 480 moveto (5864   struct spinlock lock;) show
0 468 moveto (5865   struct file file[NFILE];) show
0 456 moveto (5866 } ftable;) show
0 444 moveto (5867 ) show
0 432 moveto (5868 void) show
0 420 moveto (5869 fileinit\(void\)) show
0 408 moveto (5870 {) show
0 396 moveto (5871   initlock\(&ftable.lock, "ftable"\);) show
0 384 moveto (5872 }) show
0 372 moveto (5873 ) show
0 360 moveto (5874 // Allocate a file structure.) show
0 348 moveto (5875 struct file*) show
0 336 moveto (5876 filealloc\(void\)) show
0 324 moveto (5877 {) show
0 312 moveto (5878   struct file *f;) show
0 300 moveto (5879 ) show
0 288 moveto (5880   acquire\(&ftable.lock\);) show
0 276 moveto (5881   for\(f = ftable.file; f < ftable.file + NFILE; f++\){) show
0 264 moveto (5882     if\(f->ref == 0\){) show
0 252 moveto (5883       f->ref = 1;) show
0 240 moveto (5884       release\(&ftable.lock\);) show
0 228 moveto (5885       return f;) show
0 216 moveto (5886     }) show
0 204 moveto (5887   }) show
0 192 moveto (5888   release\(&ftable.lock\);) show
0 180 moveto (5889   return 0;) show
0 168 moveto (5890 }) show
0 156 moveto (5891 ) show
0 144 moveto (5892 ) show
0 132 moveto (5893 ) show
0 120 moveto (5894 ) show
0 108 moveto (5895 ) show
0 96 moveto (5896 ) show
0 84 moveto (5897 ) show
0 72 moveto (5898 ) show
0 60 moveto (5899 ) show
0 24 moveto (Sheet 58) show
grestore
restore
showpage
%%Page: 68 68
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/file.c  Page 2) show
0 648 moveto (5900 // Increment ref count for file f.) show
0 636 moveto (5901 struct file*) show
0 624 moveto (5902 filedup\(struct file *f\)) show
0 612 moveto (5903 {) show
0 600 moveto (5904   acquire\(&ftable.lock\);) show
0 588 moveto (5905   if\(f->ref < 1\)) show
0 576 moveto (5906     panic\("filedup"\);) show
0 564 moveto (5907   f->ref++;) show
0 552 moveto (5908   release\(&ftable.lock\);) show
0 540 moveto (5909   return f;) show
0 528 moveto (5910 }) show
0 516 moveto (5911 ) show
0 504 moveto (5912 // Close file f.  \(Decrement ref count, close when reaches 0.\)) show
0 492 moveto (5913 void) show
0 480 moveto (5914 fileclose\(struct file *f\)) show
0 468 moveto (5915 {) show
0 456 moveto (5916   struct file ff;) show
0 444 moveto (5917 ) show
0 432 moveto (5918   acquire\(&ftable.lock\);) show
0 420 moveto (5919   if\(f->ref < 1\)) show
0 408 moveto (5920     panic\("fileclose"\);) show
0 396 moveto (5921   if\(--f->ref > 0\){) show
0 384 moveto (5922     release\(&ftable.lock\);) show
0 372 moveto (5923     return;) show
0 360 moveto (5924   }) show
0 348 moveto (5925   ff = *f;) show
0 336 moveto (5926   f->ref = 0;) show
0 324 moveto (5927   f->type = FD_NONE;) show
0 312 moveto (5928   release\(&ftable.lock\);) show
0 300 moveto (5929 ) show
0 288 moveto (5930   if\(ff.type == FD_PIPE\)) show
0 276 moveto (5931     pipeclose\(ff.pipe, ff.writable\);) show
0 264 moveto (5932   else if\(ff.type == FD_INODE\){) show
0 252 moveto (5933     begin_op\(\);) show
0 240 moveto (5934     iput\(ff.ip\);) show
0 228 moveto (5935     end_op\(\);) show
0 216 moveto (5936   }) show
0 204 moveto (5937 }) show
0 192 moveto (5938 ) show
0 180 moveto (5939 ) show
0 168 moveto (5940 ) show
0 156 moveto (5941 ) show
0 144 moveto (5942 ) show
0 132 moveto (5943 ) show
0 120 moveto (5944 ) show
0 108 moveto (5945 ) show
0 96 moveto (5946 ) show
0 84 moveto (5947 ) show
0 72 moveto (5948 ) show
0 60 moveto (5949 ) show
0 24 moveto (Sheet 59) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/file.c  Page 3) show
0 648 moveto (5950 // Get metadata about file f.) show
0 636 moveto (5951 int) show
0 624 moveto (5952 filestat\(struct file *f, struct stat *st\)) show
0 612 moveto (5953 {) show
0 600 moveto (5954   if\(f->type == FD_INODE\){) show
0 588 moveto (5955     ilock\(f->ip\);) show
0 576 moveto (5956     stati\(f->ip, st\);) show
0 564 moveto (5957     iunlock\(f->ip\);) show
0 552 moveto (5958     return 0;) show
0 540 moveto (5959   }) show
0 528 moveto (5960   return -1;) show
0 516 moveto (5961 }) show
0 504 moveto (5962 ) show
0 492 moveto (5963 // Read from file f.) show
0 480 moveto (5964 int) show
0 468 moveto (5965 fileread\(struct file *f, char *addr, int n\)) show
0 456 moveto (5966 {) show
0 444 moveto (5967   int r;) show
0 432 moveto (5968 ) show
0 420 moveto (5969   if\(f->readable == 0\)) show
0 408 moveto (5970     return -1;) show
0 396 moveto (5971   if\(f->type == FD_PIPE\)) show
0 384 moveto (5972     return piperead\(f->pipe, addr, n\);) show
0 372 moveto (5973   if\(f->type == FD_INODE\){) show
0 360 moveto (5974     ilock\(f->ip\);) show
0 348 moveto (5975     if\(\(r = readi\(f->ip, addr, f->off, n\)\) > 0\)) show
0 336 moveto (5976       f->off += r;) show
0 324 moveto (5977     iunlock\(f->ip\);) show
0 312 moveto (5978     return r;) show
0 300 moveto (5979   }) show
0 288 moveto (5980   panic\("fileread"\);) show
0 276 moveto (5981 }) show
0 264 moveto (5982 ) show
0 252 moveto (5983 ) show
0 240 moveto (5984 ) show
0 228 moveto (5985 ) show
0 216 moveto (5986 ) show
0 204 moveto (5987 ) show
0 192 moveto (5988 ) show
0 180 moveto (5989 ) show
0 168 moveto (5990 ) show
0 156 moveto (5991 ) show
0 144 moveto (5992 ) show
0 132 moveto (5993 ) show
0 120 moveto (5994 ) show
0 108 moveto (5995 ) show
0 96 moveto (5996 ) show
0 84 moveto (5997 ) show
0 72 moveto (5998 ) show
0 60 moveto (5999 ) show
0 24 moveto (Sheet 59) show
grestore
restore
showpage
%%Page: 69 69
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/file.c  Page 4) show
0 648 moveto (6000 // Write to file f.) show
0 636 moveto (6001 int) show
0 624 moveto (6002 filewrite\(struct file *f, char *addr, int n\)) show
0 612 moveto (6003 {) show
0 600 moveto (6004   int r;) show
0 588 moveto (6005 ) show
0 576 moveto (6006   if\(f->writable == 0\)) show
0 564 moveto (6007     return -1;) show
0 552 moveto (6008   if\(f->type == FD_PIPE\)) show
0 540 moveto (6009     return pipewrite\(f->pipe, addr, n\);) show
0 528 moveto (6010   if\(f->type == FD_INODE\){) show
0 516 moveto (6011     // write a few blocks at a time to avoid exceeding) show
0 504 moveto (6012     // the maximum log transaction size, including) show
0 492 moveto (6013     // i-node, indirect block, allocation blocks,) show
0 480 moveto (6014     // and 2 blocks of slop for non-aligned writes.) show
0 468 moveto (6015     // this really belongs lower down, since writei\(\)) show
0 456 moveto (6016     // might be writing a device like the console.) show
0 444 moveto (6017     int max = \(\(MAXOPBLOCKS-1-1-2\) / 2\) * 512;) show
0 432 moveto (6018     int i = 0;) show
0 420 moveto (6019     while\(i < n\){) show
0 408 moveto (6020       int n1 = n - i;) show
0 396 moveto (6021       if\(n1 > max\)) show
0 384 moveto (6022         n1 = max;) show
0 372 moveto (6023 ) show
0 360 moveto (6024       begin_op\(\);) show
0 348 moveto (6025       ilock\(f->ip\);) show
0 336 moveto (6026       if \(\(r = writei\(f->ip, addr + i, f->off, n1\)\) > 0\)) show
0 324 moveto (6027         f->off += r;) show
0 312 moveto (6028       iunlock\(f->ip\);) show
0 300 moveto (6029       end_op\(\);) show
0 288 moveto (6030 ) show
0 276 moveto (6031       if\(r < 0\)) show
0 264 moveto (6032         break;) show
0 252 moveto (6033       if\(r != n1\)) show
0 240 moveto (6034         panic\("short filewrite"\);) show
0 228 moveto (6035       i += r;) show
0 216 moveto (6036     }) show
0 204 moveto (6037     return i == n ? n : -1;) show
0 192 moveto (6038   }) show
0 180 moveto (6039   panic\("filewrite"\);) show
0 168 moveto (6040 }) show
0 156 moveto (6041 ) show
0 144 moveto (6042 ) show
0 132 moveto (6043 ) show
0 120 moveto (6044 ) show
0 108 moveto (6045 ) show
0 96 moveto (6046 ) show
0 84 moveto (6047 ) show
0 72 moveto (6048 ) show
0 60 moveto (6049 ) show
0 24 moveto (Sheet 60) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 1) show
0 648 moveto (6050 //) show
0 636 moveto (6051 // File-system system calls.) show
0 624 moveto (6052 // Mostly argument checking, since we don't trust) show
0 612 moveto (6053 // user code, and calls into file.c and fs.c.) show
0 600 moveto (6054 //) show
0 588 moveto (6055 ) show
0 576 moveto (6056 #include "types.h") show
0 564 moveto (6057 #include "defs.h") show
0 552 moveto (6058 #include "param.h") show
0 540 moveto (6059 #include "stat.h") show
0 528 moveto (6060 #include "mmu.h") show
0 516 moveto (6061 #include "proc.h") show
0 504 moveto (6062 #include "fs.h") show
0 492 moveto (6063 #include "spinlock.h") show
0 480 moveto (6064 #include "sleeplock.h") show
0 468 moveto (6065 #include "file.h") show
0 456 moveto (6066 #include "fcntl.h") show
0 444 moveto (6067 ) show
0 432 moveto (6068 // Fetch the nth word-sized system call argument as a file descriptor) show
0 420 moveto (6069 // and return both the descriptor and the corresponding struct file.) show
0 408 moveto (6070 static int) show
0 396 moveto (6071 argfd\(int n, int *pfd, struct file **pf\)) show
0 384 moveto (6072 {) show
0 372 moveto (6073   int fd;) show
0 360 moveto (6074   struct file *f;) show
0 348 moveto (6075 ) show
0 336 moveto (6076   if\(argint\(n, &fd\) < 0\)) show
0 324 moveto (6077     return -1;) show
0 312 moveto (6078   if\(fd < 0 || fd >= NOFILE || \(f=myproc\(\)->ofile[fd]\) == 0\)) show
0 300 moveto (6079     return -1;) show
0 288 moveto (6080   if\(pfd\)) show
0 276 moveto (6081     *pfd = fd;) show
0 264 moveto (6082   if\(pf\)) show
0 252 moveto (6083     *pf = f;) show
0 240 moveto (6084   return 0;) show
0 228 moveto (6085 }) show
0 216 moveto (6086 ) show
0 204 moveto (6087 ) show
0 192 moveto (6088 ) show
0 180 moveto (6089 ) show
0 168 moveto (6090 ) show
0 156 moveto (6091 ) show
0 144 moveto (6092 ) show
0 132 moveto (6093 ) show
0 120 moveto (6094 ) show
0 108 moveto (6095 ) show
0 96 moveto (6096 ) show
0 84 moveto (6097 ) show
0 72 moveto (6098 ) show
0 60 moveto (6099 ) show
0 24 moveto (Sheet 60) show
grestore
restore
showpage
%%Page: 70 70
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 2) show
0 648 moveto (6100 // Allocate a file descriptor for the given file.) show
0 636 moveto (6101 // Takes over file reference from caller on success.) show
0 624 moveto (6102 static int) show
0 612 moveto (6103 fdalloc\(struct file *f\)) show
0 600 moveto (6104 {) show
0 588 moveto (6105   int fd;) show
0 576 moveto (6106   struct proc *curproc = myproc\(\);) show
0 564 moveto (6107 ) show
0 552 moveto (6108   for\(fd = 0; fd < NOFILE; fd++\){) show
0 540 moveto (6109     if\(curproc->ofile[fd] == 0\){) show
0 528 moveto (6110       curproc->ofile[fd] = f;) show
0 516 moveto (6111       return fd;) show
0 504 moveto (6112     }) show
0 492 moveto (6113   }) show
0 480 moveto (6114   return -1;) show
0 468 moveto (6115 }) show
0 456 moveto (6116 ) show
0 444 moveto (6117 int) show
0 432 moveto (6118 sys_dup\(void\)) show
0 420 moveto (6119 {) show
0 408 moveto (6120   struct file *f;) show
0 396 moveto (6121   int fd;) show
0 384 moveto (6122 ) show
0 372 moveto (6123   if\(argfd\(0, 0, &f\) < 0\)) show
0 360 moveto (6124     return -1;) show
0 348 moveto (6125   if\(\(fd=fdalloc\(f\)\) < 0\)) show
0 336 moveto (6126     return -1;) show
0 324 moveto (6127   filedup\(f\);) show
0 312 moveto (6128   return fd;) show
0 300 moveto (6129 }) show
0 288 moveto (6130 ) show
0 276 moveto (6131 int) show
0 264 moveto (6132 sys_read\(void\)) show
0 252 moveto (6133 {) show
0 240 moveto (6134   struct file *f;) show
0 228 moveto (6135   int n;) show
0 216 moveto (6136   char *p;) show
0 204 moveto (6137 ) show
0 192 moveto (6138   if\(argfd\(0, 0, &f\) < 0 || argint\(2, &n\) < 0 || argptr\(1, &p, n\) < 0\)) show
0 180 moveto (6139     return -1;) show
0 168 moveto (6140   return fileread\(f, p, n\);) show
0 156 moveto (6141 }) show
0 144 moveto (6142 ) show
0 132 moveto (6143 ) show
0 120 moveto (6144 ) show
0 108 moveto (6145 ) show
0 96 moveto (6146 ) show
0 84 moveto (6147 ) show
0 72 moveto (6148 ) show
0 60 moveto (6149 ) show
0 24 moveto (Sheet 61) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 3) show
0 648 moveto (6150 int) show
0 636 moveto (6151 sys_write\(void\)) show
0 624 moveto (6152 {) show
0 612 moveto (6153   struct file *f;) show
0 600 moveto (6154   int n;) show
0 588 moveto (6155   char *p;) show
0 576 moveto (6156 ) show
0 564 moveto (6157   if\(argfd\(0, 0, &f\) < 0 || argint\(2, &n\) < 0 || argptr\(1, &p, n\) < 0\)) show
0 552 moveto (6158     return -1;) show
0 540 moveto (6159   return filewrite\(f, p, n\);) show
0 528 moveto (6160 }) show
0 516 moveto (6161 ) show
0 504 moveto (6162 int) show
0 492 moveto (6163 sys_close\(void\)) show
0 480 moveto (6164 {) show
0 468 moveto (6165   int fd;) show
0 456 moveto (6166   struct file *f;) show
0 444 moveto (6167 ) show
0 432 moveto (6168   if\(argfd\(0, &fd, &f\) < 0\)) show
0 420 moveto (6169     return -1;) show
0 408 moveto (6170   myproc\(\)->ofile[fd] = 0;) show
0 396 moveto (6171   fileclose\(f\);) show
0 384 moveto (6172   return 0;) show
0 372 moveto (6173 }) show
0 360 moveto (6174 ) show
0 348 moveto (6175 int) show
0 336 moveto (6176 sys_fstat\(void\)) show
0 324 moveto (6177 {) show
0 312 moveto (6178   struct file *f;) show
0 300 moveto (6179   struct stat *st;) show
0 288 moveto (6180 ) show
0 276 moveto (6181   if\(argfd\(0, 0, &f\) < 0 || argptr\(1, \(void*\)&st, sizeof\(*st\)\) < 0\)) show
0 264 moveto (6182     return -1;) show
0 252 moveto (6183   return filestat\(f, st\);) show
0 240 moveto (6184 }) show
0 228 moveto (6185 ) show
0 216 moveto (6186 ) show
0 204 moveto (6187 ) show
0 192 moveto (6188 ) show
0 180 moveto (6189 ) show
0 168 moveto (6190 ) show
0 156 moveto (6191 ) show
0 144 moveto (6192 ) show
0 132 moveto (6193 ) show
0 120 moveto (6194 ) show
0 108 moveto (6195 ) show
0 96 moveto (6196 ) show
0 84 moveto (6197 ) show
0 72 moveto (6198 ) show
0 60 moveto (6199 ) show
0 24 moveto (Sheet 61) show
grestore
restore
showpage
%%Page: 71 71
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 4) show
0 648 moveto (6200 // Create the path new as a link to the same inode as old.) show
0 636 moveto (6201 int) show
0 624 moveto (6202 sys_link\(void\)) show
0 612 moveto (6203 {) show
0 600 moveto (6204   char name[DIRSIZ], *new, *old;) show
0 588 moveto (6205   struct inode *dp, *ip;) show
0 576 moveto (6206 ) show
0 564 moveto (6207   if\(argstr\(0, &old\) < 0 || argstr\(1, &new\) < 0\)) show
0 552 moveto (6208     return -1;) show
0 540 moveto (6209 ) show
0 528 moveto (6210   begin_op\(\);) show
0 516 moveto (6211   if\(\(ip = namei\(old\)\) == 0\){) show
0 504 moveto (6212     end_op\(\);) show
0 492 moveto (6213     return -1;) show
0 480 moveto (6214   }) show
0 468 moveto (6215 ) show
0 456 moveto (6216   ilock\(ip\);) show
0 444 moveto (6217   if\(ip->type == T_DIR\){) show
0 432 moveto (6218     iunlockput\(ip\);) show
0 420 moveto (6219     end_op\(\);) show
0 408 moveto (6220     return -1;) show
0 396 moveto (6221   }) show
0 384 moveto (6222 ) show
0 372 moveto (6223   ip->nlink++;) show
0 360 moveto (6224   iupdate\(ip\);) show
0 348 moveto (6225   iunlock\(ip\);) show
0 336 moveto (6226 ) show
0 324 moveto (6227   if\(\(dp = nameiparent\(new, name\)\) == 0\)) show
0 312 moveto (6228     goto bad;) show
0 300 moveto (6229   ilock\(dp\);) show
0 288 moveto (6230   if\(dp->dev != ip->dev || dirlink\(dp, name, ip->inum\) < 0\){) show
0 276 moveto (6231     iunlockput\(dp\);) show
0 264 moveto (6232     goto bad;) show
0 252 moveto (6233   }) show
0 240 moveto (6234   iunlockput\(dp\);) show
0 228 moveto (6235   iput\(ip\);) show
0 216 moveto (6236 ) show
0 204 moveto (6237   end_op\(\);) show
0 192 moveto (6238 ) show
0 180 moveto (6239   return 0;) show
0 168 moveto (6240 ) show
0 156 moveto (6241 bad:) show
0 144 moveto (6242   ilock\(ip\);) show
0 132 moveto (6243   ip->nlink--;) show
0 120 moveto (6244   iupdate\(ip\);) show
0 108 moveto (6245   iunlockput\(ip\);) show
0 96 moveto (6246   end_op\(\);) show
0 84 moveto (6247   return -1;) show
0 72 moveto (6248 }) show
0 60 moveto (6249 ) show
0 24 moveto (Sheet 62) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 5) show
0 648 moveto (6250 // Is the directory dp empty except for "." and ".." ?) show
0 636 moveto (6251 static int) show
0 624 moveto (6252 isdirempty\(struct inode *dp\)) show
0 612 moveto (6253 {) show
0 600 moveto (6254   int off;) show
0 588 moveto (6255   struct dirent de;) show
0 576 moveto (6256 ) show
0 564 moveto (6257   for\(off=2*sizeof\(de\); off<dp->size; off+=sizeof\(de\)\){) show
0 552 moveto (6258     if\(readi\(dp, \(char*\)&de, off, sizeof\(de\)\) != sizeof\(de\)\)) show
0 540 moveto (6259       panic\("isdirempty: readi"\);) show
0 528 moveto (6260     if\(de.inum != 0\)) show
0 516 moveto (6261       return 0;) show
0 504 moveto (6262   }) show
0 492 moveto (6263   return 1;) show
0 480 moveto (6264 }) show
0 468 moveto (6265 ) show
0 456 moveto (6266 ) show
0 444 moveto (6267 ) show
0 432 moveto (6268 ) show
0 420 moveto (6269 ) show
0 408 moveto (6270 ) show
0 396 moveto (6271 ) show
0 384 moveto (6272 ) show
0 372 moveto (6273 ) show
0 360 moveto (6274 ) show
0 348 moveto (6275 ) show
0 336 moveto (6276 ) show
0 324 moveto (6277 ) show
0 312 moveto (6278 ) show
0 300 moveto (6279 ) show
0 288 moveto (6280 ) show
0 276 moveto (6281 ) show
0 264 moveto (6282 ) show
0 252 moveto (6283 ) show
0 240 moveto (6284 ) show
0 228 moveto (6285 ) show
0 216 moveto (6286 ) show
0 204 moveto (6287 ) show
0 192 moveto (6288 ) show
0 180 moveto (6289 ) show
0 168 moveto (6290 ) show
0 156 moveto (6291 ) show
0 144 moveto (6292 ) show
0 132 moveto (6293 ) show
0 120 moveto (6294 ) show
0 108 moveto (6295 ) show
0 96 moveto (6296 ) show
0 84 moveto (6297 ) show
0 72 moveto (6298 ) show
0 60 moveto (6299 ) show
0 24 moveto (Sheet 62) show
grestore
restore
showpage
%%Page: 72 72
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 6) show
0 648 moveto (6300 int) show
0 636 moveto (6301 sys_unlink\(void\)) show
0 624 moveto (6302 {) show
0 612 moveto (6303   struct inode *ip, *dp;) show
0 600 moveto (6304   struct dirent de;) show
0 588 moveto (6305   char name[DIRSIZ], *path;) show
0 576 moveto (6306   uint off;) show
0 564 moveto (6307 ) show
0 552 moveto (6308   if\(argstr\(0, &path\) < 0\)) show
0 540 moveto (6309     return -1;) show
0 528 moveto (6310 ) show
0 516 moveto (6311   begin_op\(\);) show
0 504 moveto (6312   if\(\(dp = nameiparent\(path, name\)\) == 0\){) show
0 492 moveto (6313     end_op\(\);) show
0 480 moveto (6314     return -1;) show
0 468 moveto (6315   }) show
0 456 moveto (6316 ) show
0 444 moveto (6317   ilock\(dp\);) show
0 432 moveto (6318 ) show
0 420 moveto (6319   // Cannot unlink "." or "..".) show
0 408 moveto (6320   if\(namecmp\(name, "."\) == 0 || namecmp\(name, ".."\) == 0\)) show
0 396 moveto (6321     goto bad;) show
0 384 moveto (6322 ) show
0 372 moveto (6323   if\(\(ip = dirlookup\(dp, name, &off\)\) == 0\)) show
0 360 moveto (6324     goto bad;) show
0 348 moveto (6325   ilock\(ip\);) show
0 336 moveto (6326 ) show
0 324 moveto (6327   if\(ip->nlink < 1\)) show
0 312 moveto (6328     panic\("unlink: nlink < 1"\);) show
0 300 moveto (6329   if\(ip->type == T_DIR && !isdirempty\(ip\)\){) show
0 288 moveto (6330     iunlockput\(ip\);) show
0 276 moveto (6331     goto bad;) show
0 264 moveto (6332   }) show
0 252 moveto (6333 ) show
0 240 moveto (6334   memset\(&de, 0, sizeof\(de\)\);) show
0 228 moveto (6335   if\(writei\(dp, \(char*\)&de, off, sizeof\(de\)\) != sizeof\(de\)\)) show
0 216 moveto (6336     panic\("unlink: writei"\);) show
0 204 moveto (6337   if\(ip->type == T_DIR\){) show
0 192 moveto (6338     dp->nlink--;) show
0 180 moveto (6339     iupdate\(dp\);) show
0 168 moveto (6340   }) show
0 156 moveto (6341   iunlockput\(dp\);) show
0 144 moveto (6342 ) show
0 132 moveto (6343   ip->nlink--;) show
0 120 moveto (6344   iupdate\(ip\);) show
0 108 moveto (6345   iunlockput\(ip\);) show
0 96 moveto (6346 ) show
0 84 moveto (6347   end_op\(\);) show
0 72 moveto (6348 ) show
0 60 moveto (6349   return 0;) show
0 24 moveto (Sheet 63) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 7) show
0 648 moveto (6350 bad:) show
0 636 moveto (6351   iunlockput\(dp\);) show
0 624 moveto (6352   end_op\(\);) show
0 612 moveto (6353   return -1;) show
0 600 moveto (6354 }) show
0 588 moveto (6355 ) show
0 576 moveto (6356 static struct inode*) show
0 564 moveto (6357 create\(char *path, short type, short major, short minor\)) show
0 552 moveto (6358 {) show
0 540 moveto (6359   uint off;) show
0 528 moveto (6360   struct inode *ip, *dp;) show
0 516 moveto (6361   char name[DIRSIZ];) show
0 504 moveto (6362 ) show
0 492 moveto (6363   if\(\(dp = nameiparent\(path, name\)\) == 0\)) show
0 480 moveto (6364     return 0;) show
0 468 moveto (6365   ilock\(dp\);) show
0 456 moveto (6366 ) show
0 444 moveto (6367   if\(\(ip = dirlookup\(dp, name, &off\)\) != 0\){) show
0 432 moveto (6368     iunlockput\(dp\);) show
0 420 moveto (6369     ilock\(ip\);) show
0 408 moveto (6370     if\(type == T_FILE && ip->type == T_FILE\)) show
0 396 moveto (6371       return ip;) show
0 384 moveto (6372     iunlockput\(ip\);) show
0 372 moveto (6373     return 0;) show
0 360 moveto (6374   }) show
0 348 moveto (6375 ) show
0 336 moveto (6376   if\(\(ip = ialloc\(dp->dev, type\)\) == 0\)) show
0 324 moveto (6377     panic\("create: ialloc"\);) show
0 312 moveto (6378 ) show
0 300 moveto (6379   ilock\(ip\);) show
0 288 moveto (6380   ip->major = major;) show
0 276 moveto (6381   ip->minor = minor;) show
0 264 moveto (6382   ip->nlink = 1;) show
0 252 moveto (6383   iupdate\(ip\);) show
0 240 moveto (6384 ) show
0 228 moveto (6385   if\(type == T_DIR\){  // Create . and .. entries.) show
0 216 moveto (6386     dp->nlink++;  // for "..") show
0 204 moveto (6387     iupdate\(dp\);) show
0 192 moveto (6388     // No ip->nlink++ for ".": avoid cyclic ref count.) show
0 180 moveto (6389     if\(dirlink\(ip, ".", ip->inum\) < 0 || dirlink\(ip, "..", dp->inum\) < 0\)) show
0 168 moveto (6390       panic\("create dots"\);) show
0 156 moveto (6391   }) show
0 144 moveto (6392 ) show
0 132 moveto (6393   if\(dirlink\(dp, name, ip->inum\) < 0\)) show
0 120 moveto (6394     panic\("create: dirlink"\);) show
0 108 moveto (6395 ) show
0 96 moveto (6396   iunlockput\(dp\);) show
0 84 moveto (6397 ) show
0 72 moveto (6398   return ip;) show
0 60 moveto (6399 }) show
0 24 moveto (Sheet 63) show
grestore
restore
showpage
%%Page: 73 73
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 8) show
0 648 moveto (6400 int) show
0 636 moveto (6401 sys_open\(void\)) show
0 624 moveto (6402 {) show
0 612 moveto (6403   char *path;) show
0 600 moveto (6404   int fd, omode;) show
0 588 moveto (6405   struct file *f;) show
0 576 moveto (6406   struct inode *ip;) show
0 564 moveto (6407 ) show
0 552 moveto (6408   if\(argstr\(0, &path\) < 0 || argint\(1, &omode\) < 0\)) show
0 540 moveto (6409     return -1;) show
0 528 moveto (6410 ) show
0 516 moveto (6411   begin_op\(\);) show
0 504 moveto (6412 ) show
0 492 moveto (6413   if\(omode & O_CREATE\){) show
0 480 moveto (6414     ip = create\(path, T_FILE, 0, 0\);) show
0 468 moveto (6415     if\(ip == 0\){) show
0 456 moveto (6416       end_op\(\);) show
0 444 moveto (6417       return -1;) show
0 432 moveto (6418     }) show
0 420 moveto (6419   } else {) show
0 408 moveto (6420     if\(\(ip = namei\(path\)\) == 0\){) show
0 396 moveto (6421       end_op\(\);) show
0 384 moveto (6422       return -1;) show
0 372 moveto (6423     }) show
0 360 moveto (6424     ilock\(ip\);) show
0 348 moveto (6425     if\(ip->type == T_DIR && omode != O_RDONLY\){) show
0 336 moveto (6426       iunlockput\(ip\);) show
0 324 moveto (6427       end_op\(\);) show
0 312 moveto (6428       return -1;) show
0 300 moveto (6429     }) show
0 288 moveto (6430   }) show
0 276 moveto (6431 ) show
0 264 moveto (6432   if\(\(f = filealloc\(\)\) == 0 || \(fd = fdalloc\(f\)\) < 0\){) show
0 252 moveto (6433     if\(f\)) show
0 240 moveto (6434       fileclose\(f\);) show
0 228 moveto (6435     iunlockput\(ip\);) show
0 216 moveto (6436     end_op\(\);) show
0 204 moveto (6437     return -1;) show
0 192 moveto (6438   }) show
0 180 moveto (6439   iunlock\(ip\);) show
0 168 moveto (6440   end_op\(\);) show
0 156 moveto (6441 ) show
0 144 moveto (6442   f->type = FD_INODE;) show
0 132 moveto (6443   f->ip = ip;) show
0 120 moveto (6444   f->off = 0;) show
0 108 moveto (6445   f->readable = !\(omode & O_WRONLY\);) show
0 96 moveto (6446   f->writable = \(omode & O_WRONLY\) || \(omode & O_RDWR\);) show
0 84 moveto (6447   return fd;) show
0 72 moveto (6448 }) show
0 60 moveto (6449 ) show
0 24 moveto (Sheet 64) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 9) show
0 648 moveto (6450 int) show
0 636 moveto (6451 sys_mkdir\(void\)) show
0 624 moveto (6452 {) show
0 612 moveto (6453   char *path;) show
0 600 moveto (6454   struct inode *ip;) show
0 588 moveto (6455 ) show
0 576 moveto (6456   begin_op\(\);) show
0 564 moveto (6457   if\(argstr\(0, &path\) < 0 || \(ip = create\(path, T_DIR, 0, 0\)\) == 0\){) show
0 552 moveto (6458     end_op\(\);) show
0 540 moveto (6459     return -1;) show
0 528 moveto (6460   }) show
0 516 moveto (6461   iunlockput\(ip\);) show
0 504 moveto (6462   end_op\(\);) show
0 492 moveto (6463   return 0;) show
0 480 moveto (6464 }) show
0 468 moveto (6465 ) show
0 456 moveto (6466 int) show
0 444 moveto (6467 sys_mknod\(void\)) show
0 432 moveto (6468 {) show
0 420 moveto (6469   struct inode *ip;) show
0 408 moveto (6470   char *path;) show
0 396 moveto (6471   int major, minor;) show
0 384 moveto (6472 ) show
0 372 moveto (6473   begin_op\(\);) show
0 360 moveto (6474   if\(\(argstr\(0, &path\)\) < 0 ||) show
0 348 moveto (6475      argint\(1, &major\) < 0 ||) show
0 336 moveto (6476      argint\(2, &minor\) < 0 ||) show
0 324 moveto (6477      \(ip = create\(path, T_DEV, major, minor\)\) == 0\){) show
0 312 moveto (6478     end_op\(\);) show
0 300 moveto (6479     return -1;) show
0 288 moveto (6480   }) show
0 276 moveto (6481   iunlockput\(ip\);) show
0 264 moveto (6482   end_op\(\);) show
0 252 moveto (6483   return 0;) show
0 240 moveto (6484 }) show
0 228 moveto (6485 ) show
0 216 moveto (6486 ) show
0 204 moveto (6487 ) show
0 192 moveto (6488 ) show
0 180 moveto (6489 ) show
0 168 moveto (6490 ) show
0 156 moveto (6491 ) show
0 144 moveto (6492 ) show
0 132 moveto (6493 ) show
0 120 moveto (6494 ) show
0 108 moveto (6495 ) show
0 96 moveto (6496 ) show
0 84 moveto (6497 ) show
0 72 moveto (6498 ) show
0 60 moveto (6499 ) show
0 24 moveto (Sheet 64) show
grestore
restore
showpage
%%Page: 74 74
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 10) show
0 648 moveto (6500 int) show
0 636 moveto (6501 sys_chdir\(void\)) show
0 624 moveto (6502 {) show
0 612 moveto (6503   char *path;) show
0 600 moveto (6504   struct inode *ip;) show
0 588 moveto (6505   struct proc *curproc = myproc\(\);) show
0 576 moveto (6506 ) show
0 564 moveto (6507   begin_op\(\);) show
0 552 moveto (6508   if\(argstr\(0, &path\) < 0 || \(ip = namei\(path\)\) == 0\){) show
0 540 moveto (6509     end_op\(\);) show
0 528 moveto (6510     return -1;) show
0 516 moveto (6511   }) show
0 504 moveto (6512   ilock\(ip\);) show
0 492 moveto (6513   if\(ip->type != T_DIR\){) show
0 480 moveto (6514     iunlockput\(ip\);) show
0 468 moveto (6515     end_op\(\);) show
0 456 moveto (6516     return -1;) show
0 444 moveto (6517   }) show
0 432 moveto (6518   iunlock\(ip\);) show
0 420 moveto (6519   iput\(curproc->cwd\);) show
0 408 moveto (6520   end_op\(\);) show
0 396 moveto (6521   curproc->cwd = ip;) show
0 384 moveto (6522   return 0;) show
0 372 moveto (6523 }) show
0 360 moveto (6524 ) show
0 348 moveto (6525 int) show
0 336 moveto (6526 sys_exec\(void\)) show
0 324 moveto (6527 {) show
0 312 moveto (6528   char *path, *argv[MAXARG];) show
0 300 moveto (6529   int i;) show
0 288 moveto (6530   uint uargv, uarg;) show
0 276 moveto (6531 ) show
0 264 moveto (6532   if\(argstr\(0, &path\) < 0 || argint\(1, \(int*\)&uargv\) < 0\){) show
0 252 moveto (6533     return -1;) show
0 240 moveto (6534   }) show
0 228 moveto (6535   memset\(argv, 0, sizeof\(argv\)\);) show
0 216 moveto (6536   for\(i=0;; i++\){) show
0 204 moveto (6537     if\(i >= NELEM\(argv\)\)) show
0 192 moveto (6538       return -1;) show
0 180 moveto (6539     if\(fetchint\(uargv+4*i, \(int*\)&uarg\) < 0\)) show
0 168 moveto (6540       return -1;) show
0 156 moveto (6541     if\(uarg == 0\){) show
0 144 moveto (6542       argv[i] = 0;) show
0 132 moveto (6543       break;) show
0 120 moveto (6544     }) show
0 108 moveto (6545     if\(fetchstr\(uarg, &argv[i]\) < 0\)) show
0 96 moveto (6546       return -1;) show
0 84 moveto (6547   }) show
0 72 moveto (6548   return exec\(path, argv\);) show
0 60 moveto (6549 }) show
0 24 moveto (Sheet 65) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sysfile.c  Page 11) show
0 648 moveto (6550 int) show
0 636 moveto (6551 sys_pipe\(void\)) show
0 624 moveto (6552 {) show
0 612 moveto (6553   int *fd;) show
0 600 moveto (6554   struct file *rf, *wf;) show
0 588 moveto (6555   int fd0, fd1;) show
0 576 moveto (6556 ) show
0 564 moveto (6557   if\(argptr\(0, \(void*\)&fd, 2*sizeof\(fd[0]\)\) < 0\)) show
0 552 moveto (6558     return -1;) show
0 540 moveto (6559   if\(pipealloc\(&rf, &wf\) < 0\)) show
0 528 moveto (6560     return -1;) show
0 516 moveto (6561   fd0 = -1;) show
0 504 moveto (6562   if\(\(fd0 = fdalloc\(rf\)\) < 0 || \(fd1 = fdalloc\(wf\)\) < 0\){) show
0 492 moveto (6563     if\(fd0 >= 0\)) show
0 480 moveto (6564       myproc\(\)->ofile[fd0] = 0;) show
0 468 moveto (6565     fileclose\(rf\);) show
0 456 moveto (6566     fileclose\(wf\);) show
0 444 moveto (6567     return -1;) show
0 432 moveto (6568   }) show
0 420 moveto (6569   fd[0] = fd0;) show
0 408 moveto (6570   fd[1] = fd1;) show
0 396 moveto (6571   return 0;) show
0 384 moveto (6572 }) show
0 372 moveto (6573 ) show
0 360 moveto (6574 ) show
0 348 moveto (6575 ) show
0 336 moveto (6576 ) show
0 324 moveto (6577 ) show
0 312 moveto (6578 ) show
0 300 moveto (6579 ) show
0 288 moveto (6580 ) show
0 276 moveto (6581 ) show
0 264 moveto (6582 ) show
0 252 moveto (6583 ) show
0 240 moveto (6584 ) show
0 228 moveto (6585 ) show
0 216 moveto (6586 ) show
0 204 moveto (6587 ) show
0 192 moveto (6588 ) show
0 180 moveto (6589 ) show
0 168 moveto (6590 ) show
0 156 moveto (6591 ) show
0 144 moveto (6592 ) show
0 132 moveto (6593 ) show
0 120 moveto (6594 ) show
0 108 moveto (6595 ) show
0 96 moveto (6596 ) show
0 84 moveto (6597 ) show
0 72 moveto (6598 ) show
0 60 moveto (6599 ) show
0 24 moveto (Sheet 65) show
grestore
restore
showpage
%%Page: 75 75
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/exec.c  Page 1) show
0 648 moveto (6600 #include "types.h") show
0 636 moveto (6601 #include "param.h") show
0 624 moveto (6602 #include "memlayout.h") show
0 612 moveto (6603 #include "mmu.h") show
0 600 moveto (6604 #include "proc.h") show
0 588 moveto (6605 #include "defs.h") show
0 576 moveto (6606 #include "x86.h") show
0 564 moveto (6607 #include "elf.h") show
0 552 moveto (6608 ) show
0 540 moveto (6609 int) show
0 528 moveto (6610 exec\(char *path, char **argv\)) show
0 516 moveto (6611 {) show
0 504 moveto (6612   char *s, *last;) show
0 492 moveto (6613   int i, off;) show
0 480 moveto (6614   uint argc, sz, sp, ustack[3+MAXARG+1];) show
0 468 moveto (6615   struct elfhdr elf;) show
0 456 moveto (6616   struct inode *ip;) show
0 444 moveto (6617   struct proghdr ph;) show
0 432 moveto (6618   pde_t *pgdir, *oldpgdir;) show
0 420 moveto (6619   struct proc *curproc = myproc\(\);) show
0 408 moveto (6620 ) show
0 396 moveto (6621   begin_op\(\);) show
0 384 moveto (6622 ) show
0 372 moveto (6623   if\(\(ip = namei\(path\)\) == 0\){) show
0 360 moveto (6624     end_op\(\);) show
0 348 moveto (6625     cprintf\("exec: fail\\n"\);) show
0 336 moveto (6626     return -1;) show
0 324 moveto (6627   }) show
0 312 moveto (6628   ilock\(ip\);) show
0 300 moveto (6629   pgdir = 0;) show
0 288 moveto (6630 ) show
0 276 moveto (6631   // Check ELF header) show
0 264 moveto (6632   if\(readi\(ip, \(char*\)&elf, 0, sizeof\(elf\)\) != sizeof\(elf\)\)) show
0 252 moveto (6633     goto bad;) show
0 240 moveto (6634   if\(elf.magic != ELF_MAGIC\)) show
0 228 moveto (6635     goto bad;) show
0 216 moveto (6636 ) show
0 204 moveto (6637   if\(\(pgdir = setupkvm\(\)\) == 0\)) show
0 192 moveto (6638     goto bad;) show
0 180 moveto (6639 ) show
0 168 moveto (6640   // Load program into memory.) show
0 156 moveto (6641   sz = 0;) show
0 144 moveto (6642   for\(i=0, off=elf.phoff; i<elf.phnum; i++, off+=sizeof\(ph\)\){) show
0 132 moveto (6643     if\(readi\(ip, \(char*\)&ph, off, sizeof\(ph\)\) != sizeof\(ph\)\)) show
0 120 moveto (6644       goto bad;) show
0 108 moveto (6645     if\(ph.type != ELF_PROG_LOAD\)) show
0 96 moveto (6646       continue;) show
0 84 moveto (6647     if\(ph.memsz < ph.filesz\)) show
0 72 moveto (6648       goto bad;) show
0 60 moveto (6649     if\(ph.vaddr + ph.memsz < ph.vaddr\)) show
0 24 moveto (Sheet 66) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/exec.c  Page 2) show
0 648 moveto (6650       goto bad;) show
0 636 moveto (6651     if\(\(sz = allocuvm\(pgdir, sz, ph.vaddr + ph.memsz\)\) == 0\)) show
0 624 moveto (6652       goto bad;) show
0 612 moveto (6653     if\(ph.vaddr % PGSIZE != 0\)) show
0 600 moveto (6654       goto bad;) show
0 588 moveto (6655     if\(loaduvm\(pgdir, \(char*\)ph.vaddr, ip, ph.off, ph.filesz\) < 0\)) show
0 576 moveto (6656       goto bad;) show
0 564 moveto (6657   }) show
0 552 moveto (6658   iunlockput\(ip\);) show
0 540 moveto (6659   end_op\(\);) show
0 528 moveto (6660   ip = 0;) show
0 516 moveto (6661 ) show
0 504 moveto (6662   // Allocate two pages at the next page boundary.) show
0 492 moveto (6663   // Make the first inaccessible.  Use the second as the user stack.) show
0 480 moveto (6664   sz = PGROUNDUP\(sz\);) show
0 468 moveto (6665   if\(\(sz = allocuvm\(pgdir, sz, sz + 2*PGSIZE\)\) == 0\)) show
0 456 moveto (6666     goto bad;) show
0 444 moveto (6667   clearpteu\(pgdir, \(char*\)\(sz - 2*PGSIZE\)\);) show
0 432 moveto (6668   sp = sz;) show
0 420 moveto (6669 ) show
0 408 moveto (6670   // Push argument strings, prepare rest of stack in ustack.) show
0 396 moveto (6671   for\(argc = 0; argv[argc]; argc++\) {) show
0 384 moveto (6672     if\(argc >= MAXARG\)) show
0 372 moveto (6673       goto bad;) show
0 360 moveto (6674     sp = \(sp - \(strlen\(argv[argc]\) + 1\)\) & ~3;) show
0 348 moveto (6675     if\(copyout\(pgdir, sp, argv[argc], strlen\(argv[argc]\) + 1\) < 0\)) show
0 336 moveto (6676       goto bad;) show
0 324 moveto (6677     ustack[3+argc] = sp;) show
0 312 moveto (6678   }) show
0 300 moveto (6679   ustack[3+argc] = 0;) show
0 288 moveto (6680 ) show
0 276 moveto (6681   ustack[0] = 0xffffffff;  // fake return PC) show
0 264 moveto (6682   ustack[1] = argc;) show
0 252 moveto (6683   ustack[2] = sp - \(argc+1\)*4;  // argv pointer) show
0 240 moveto (6684 ) show
0 228 moveto (6685   sp -= \(3+argc+1\) * 4;) show
0 216 moveto (6686   if\(copyout\(pgdir, sp, ustack, \(3+argc+1\)*4\) < 0\)) show
0 204 moveto (6687     goto bad;) show
0 192 moveto (6688 ) show
0 180 moveto (6689   // Save program name for debugging.) show
0 168 moveto (6690   for\(last=s=path; *s; s++\)) show
0 156 moveto (6691     if\(*s == '/'\)) show
0 144 moveto (6692       last = s+1;) show
0 132 moveto (6693   safestrcpy\(curproc->name, last, sizeof\(curproc->name\)\);) show
0 120 moveto (6694 ) show
0 108 moveto (6695   // Commit to the user image.) show
0 96 moveto (6696   oldpgdir = curproc->pgdir;) show
0 84 moveto (6697   curproc->pgdir = pgdir;) show
0 72 moveto (6698   curproc->sz = sz;) show
0 60 moveto (6699   curproc->tf->eip = elf.entry;  // main) show
0 24 moveto (Sheet 66) show
grestore
restore
showpage
%%Page: 76 76
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/exec.c  Page 3) show
0 648 moveto (6700   curproc->tf->esp = sp;) show
0 636 moveto (6701   switchuvm\(curproc\);) show
0 624 moveto (6702   freevm\(oldpgdir\);) show
0 612 moveto (6703   return 0;) show
0 600 moveto (6704 ) show
0 588 moveto (6705  bad:) show
0 576 moveto (6706   if\(pgdir\)) show
0 564 moveto (6707     freevm\(pgdir\);) show
0 552 moveto (6708   if\(ip\){) show
0 540 moveto (6709     iunlockput\(ip\);) show
0 528 moveto (6710     end_op\(\);) show
0 516 moveto (6711   }) show
0 504 moveto (6712   return -1;) show
0 492 moveto (6713 }) show
0 480 moveto (6714 ) show
0 468 moveto (6715 ) show
0 456 moveto (6716 ) show
0 444 moveto (6717 ) show
0 432 moveto (6718 ) show
0 420 moveto (6719 ) show
0 408 moveto (6720 ) show
0 396 moveto (6721 ) show
0 384 moveto (6722 ) show
0 372 moveto (6723 ) show
0 360 moveto (6724 ) show
0 348 moveto (6725 ) show
0 336 moveto (6726 ) show
0 324 moveto (6727 ) show
0 312 moveto (6728 ) show
0 300 moveto (6729 ) show
0 288 moveto (6730 ) show
0 276 moveto (6731 ) show
0 264 moveto (6732 ) show
0 252 moveto (6733 ) show
0 240 moveto (6734 ) show
0 228 moveto (6735 ) show
0 216 moveto (6736 ) show
0 204 moveto (6737 ) show
0 192 moveto (6738 ) show
0 180 moveto (6739 ) show
0 168 moveto (6740 ) show
0 156 moveto (6741 ) show
0 144 moveto (6742 ) show
0 132 moveto (6743 ) show
0 120 moveto (6744 ) show
0 108 moveto (6745 ) show
0 96 moveto (6746 ) show
0 84 moveto (6747 ) show
0 72 moveto (6748 ) show
0 60 moveto (6749 ) show
0 24 moveto (Sheet 67) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/pipe.c  Page 1) show
0 648 moveto (6750 #include "types.h") show
0 636 moveto (6751 #include "defs.h") show
0 624 moveto (6752 #include "param.h") show
0 612 moveto (6753 #include "mmu.h") show
0 600 moveto (6754 #include "proc.h") show
0 588 moveto (6755 #include "fs.h") show
0 576 moveto (6756 #include "spinlock.h") show
0 564 moveto (6757 #include "sleeplock.h") show
0 552 moveto (6758 #include "file.h") show
0 540 moveto (6759 ) show
0 528 moveto (6760 #define PIPESIZE 512) show
0 516 moveto (6761 ) show
0 504 moveto (6762 struct pipe {) show
0 492 moveto (6763   struct spinlock lock;) show
0 480 moveto (6764   char data[PIPESIZE];) show
0 468 moveto (6765   uint nread;     // number of bytes read) show
0 456 moveto (6766   uint nwrite;    // number of bytes written) show
0 444 moveto (6767   int readopen;   // read fd is still open) show
0 432 moveto (6768   int writeopen;  // write fd is still open) show
0 420 moveto (6769 };) show
0 408 moveto (6770 ) show
0 396 moveto (6771 int) show
0 384 moveto (6772 pipealloc\(struct file **f0, struct file **f1\)) show
0 372 moveto (6773 {) show
0 360 moveto (6774   struct pipe *p;) show
0 348 moveto (6775 ) show
0 336 moveto (6776   p = 0;) show
0 324 moveto (6777   *f0 = *f1 = 0;) show
0 312 moveto (6778   if\(\(*f0 = filealloc\(\)\) == 0 || \(*f1 = filealloc\(\)\) == 0\)) show
0 300 moveto (6779     goto bad;) show
0 288 moveto (6780   if\(\(p = \(struct pipe*\)kalloc\(\)\) == 0\)) show
0 276 moveto (6781     goto bad;) show
0 264 moveto (6782   p->readopen = 1;) show
0 252 moveto (6783   p->writeopen = 1;) show
0 240 moveto (6784   p->nwrite = 0;) show
0 228 moveto (6785   p->nread = 0;) show
0 216 moveto (6786   initlock\(&p->lock, "pipe"\);) show
0 204 moveto (6787   \(*f0\)->type = FD_PIPE;) show
0 192 moveto (6788   \(*f0\)->readable = 1;) show
0 180 moveto (6789   \(*f0\)->writable = 0;) show
0 168 moveto (6790   \(*f0\)->pipe = p;) show
0 156 moveto (6791   \(*f1\)->type = FD_PIPE;) show
0 144 moveto (6792   \(*f1\)->readable = 0;) show
0 132 moveto (6793   \(*f1\)->writable = 1;) show
0 120 moveto (6794   \(*f1\)->pipe = p;) show
0 108 moveto (6795   return 0;) show
0 96 moveto (6796 ) show
0 84 moveto (6797 ) show
0 72 moveto (6798 ) show
0 60 moveto (6799 ) show
0 24 moveto (Sheet 67) show
grestore
restore
showpage
%%Page: 77 77
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/pipe.c  Page 2) show
0 648 moveto (6800  bad:) show
0 636 moveto (6801   if\(p\)) show
0 624 moveto (6802     kfree\(\(char*\)p\);) show
0 612 moveto (6803   if\(*f0\)) show
0 600 moveto (6804     fileclose\(*f0\);) show
0 588 moveto (6805   if\(*f1\)) show
0 576 moveto (6806     fileclose\(*f1\);) show
0 564 moveto (6807   return -1;) show
0 552 moveto (6808 }) show
0 540 moveto (6809 ) show
0 528 moveto (6810 void) show
0 516 moveto (6811 pipeclose\(struct pipe *p, int writable\)) show
0 504 moveto (6812 {) show
0 492 moveto (6813   acquire\(&p->lock\);) show
0 480 moveto (6814   if\(writable\){) show
0 468 moveto (6815     p->writeopen = 0;) show
0 456 moveto (6816     wakeup\(&p->nread\);) show
0 444 moveto (6817   } else {) show
0 432 moveto (6818     p->readopen = 0;) show
0 420 moveto (6819     wakeup\(&p->nwrite\);) show
0 408 moveto (6820   }) show
0 396 moveto (6821   if\(p->readopen == 0 && p->writeopen == 0\){) show
0 384 moveto (6822     release\(&p->lock\);) show
0 372 moveto (6823     kfree\(\(char*\)p\);) show
0 360 moveto (6824   } else) show
0 348 moveto (6825     release\(&p->lock\);) show
0 336 moveto (6826 }) show
0 324 moveto (6827 ) show
0 312 moveto (6828 ) show
0 300 moveto (6829 int) show
0 288 moveto (6830 pipewrite\(struct pipe *p, char *addr, int n\)) show
0 276 moveto (6831 {) show
0 264 moveto (6832   int i;) show
0 252 moveto (6833 ) show
0 240 moveto (6834   acquire\(&p->lock\);) show
0 228 moveto (6835   for\(i = 0; i < n; i++\){) show
0 216 moveto (6836     while\(p->nwrite == p->nread + PIPESIZE\){  ) show
0 204 moveto (6837       if\(p->readopen == 0 || myproc\(\)->killed\){) show
0 192 moveto (6838         release\(&p->lock\);) show
0 180 moveto (6839         return -1;) show
0 168 moveto (6840       }) show
0 156 moveto (6841       wakeup\(&p->nread\);) show
0 144 moveto (6842       sleep\(&p->nwrite, &p->lock\);  ) show
0 132 moveto (6843     }) show
0 120 moveto (6844     p->data[p->nwrite++ % PIPESIZE] = addr[i];) show
0 108 moveto (6845   }) show
0 96 moveto (6846   wakeup\(&p->nread\);  ) show
0 84 moveto (6847   release\(&p->lock\);) show
0 72 moveto (6848   return n;) show
0 60 moveto (6849 }) show
0 24 moveto (Sheet 68) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/pipe.c  Page 3) show
0 648 moveto (6850 int) show
0 636 moveto (6851 piperead\(struct pipe *p, char *addr, int n\)) show
0 624 moveto (6852 {) show
0 612 moveto (6853   int i;) show
0 600 moveto (6854 ) show
0 588 moveto (6855   acquire\(&p->lock\);) show
0 576 moveto (6856   while\(p->nread == p->nwrite && p->writeopen\){  ) show
0 564 moveto (6857     if\(myproc\(\)->killed\){) show
0 552 moveto (6858       release\(&p->lock\);) show
0 540 moveto (6859       return -1;) show
0 528 moveto (6860     }) show
0 516 moveto (6861     sleep\(&p->nread, &p->lock\); ) show
0 504 moveto (6862   }) show
0 492 moveto (6863   for\(i = 0; i < n; i++\){  ) show
0 480 moveto (6864     if\(p->nread == p->nwrite\)) show
0 468 moveto (6865       break;) show
0 456 moveto (6866     addr[i] = p->data[p->nread++ % PIPESIZE];) show
0 444 moveto (6867   }) show
0 432 moveto (6868   wakeup\(&p->nwrite\);  ) show
0 420 moveto (6869   release\(&p->lock\);) show
0 408 moveto (6870   return i;) show
0 396 moveto (6871 }) show
0 384 moveto (6872 ) show
0 372 moveto (6873 ) show
0 360 moveto (6874 ) show
0 348 moveto (6875 ) show
0 336 moveto (6876 ) show
0 324 moveto (6877 ) show
0 312 moveto (6878 ) show
0 300 moveto (6879 ) show
0 288 moveto (6880 ) show
0 276 moveto (6881 ) show
0 264 moveto (6882 ) show
0 252 moveto (6883 ) show
0 240 moveto (6884 ) show
0 228 moveto (6885 ) show
0 216 moveto (6886 ) show
0 204 moveto (6887 ) show
0 192 moveto (6888 ) show
0 180 moveto (6889 ) show
0 168 moveto (6890 ) show
0 156 moveto (6891 ) show
0 144 moveto (6892 ) show
0 132 moveto (6893 ) show
0 120 moveto (6894 ) show
0 108 moveto (6895 ) show
0 96 moveto (6896 ) show
0 84 moveto (6897 ) show
0 72 moveto (6898 ) show
0 60 moveto (6899 ) show
0 24 moveto (Sheet 68) show
grestore
restore
showpage
%%Page: 78 78
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/string.c  Page 1) show
0 648 moveto (6900 #include "types.h") show
0 636 moveto (6901 #include "x86.h") show
0 624 moveto (6902 ) show
0 612 moveto (6903 void*) show
0 600 moveto (6904 memset\(void *dst, int c, uint n\)) show
0 588 moveto (6905 {) show
0 576 moveto (6906   if \(\(int\)dst%4 == 0 && n%4 == 0\){) show
0 564 moveto (6907     c &= 0xFF;) show
0 552 moveto (6908     stosl\(dst, \(c<<24\)|\(c<<16\)|\(c<<8\)|c, n/4\);) show
0 540 moveto (6909   } else) show
0 528 moveto (6910     stosb\(dst, c, n\);) show
0 516 moveto (6911   return dst;) show
0 504 moveto (6912 }) show
0 492 moveto (6913 ) show
0 480 moveto (6914 int) show
0 468 moveto (6915 memcmp\(const void *v1, const void *v2, uint n\)) show
0 456 moveto (6916 {) show
0 444 moveto (6917   const uchar *s1, *s2;) show
0 432 moveto (6918 ) show
0 420 moveto (6919   s1 = v1;) show
0 408 moveto (6920   s2 = v2;) show
0 396 moveto (6921   while\(n-- > 0\){) show
0 384 moveto (6922     if\(*s1 != *s2\)) show
0 372 moveto (6923       return *s1 - *s2;) show
0 360 moveto (6924     s1++, s2++;) show
0 348 moveto (6925   }) show
0 336 moveto (6926 ) show
0 324 moveto (6927   return 0;) show
0 312 moveto (6928 }) show
0 300 moveto (6929 ) show
0 288 moveto (6930 void*) show
0 276 moveto (6931 memmove\(void *dst, const void *src, uint n\)) show
0 264 moveto (6932 {) show
0 252 moveto (6933   const char *s;) show
0 240 moveto (6934   char *d;) show
0 228 moveto (6935 ) show
0 216 moveto (6936   s = src;) show
0 204 moveto (6937   d = dst;) show
0 192 moveto (6938   if\(s < d && s + n > d\){) show
0 180 moveto (6939     s += n;) show
0 168 moveto (6940     d += n;) show
0 156 moveto (6941     while\(n-- > 0\)) show
0 144 moveto (6942       *--d = *--s;) show
0 132 moveto (6943   } else) show
0 120 moveto (6944     while\(n-- > 0\)) show
0 108 moveto (6945       *d++ = *s++;) show
0 96 moveto (6946 ) show
0 84 moveto (6947   return dst;) show
0 72 moveto (6948 }) show
0 60 moveto (6949 ) show
0 24 moveto (Sheet 69) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/string.c  Page 2) show
0 648 moveto (6950 // memcpy exists to placate GCC.  Use memmove.) show
0 636 moveto (6951 void*) show
0 624 moveto (6952 memcpy\(void *dst, const void *src, uint n\)) show
0 612 moveto (6953 {) show
0 600 moveto (6954   return memmove\(dst, src, n\);) show
0 588 moveto (6955 }) show
0 576 moveto (6956 ) show
0 564 moveto (6957 int) show
0 552 moveto (6958 strncmp\(const char *p, const char *q, uint n\)) show
0 540 moveto (6959 {) show
0 528 moveto (6960   while\(n > 0 && *p && *p == *q\)) show
0 516 moveto (6961     n--, p++, q++;) show
0 504 moveto (6962   if\(n == 0\)) show
0 492 moveto (6963     return 0;) show
0 480 moveto (6964   return \(uchar\)*p - \(uchar\)*q;) show
0 468 moveto (6965 }) show
0 456 moveto (6966 ) show
0 444 moveto (6967 char*) show
0 432 moveto (6968 strncpy\(char *s, const char *t, int n\)) show
0 420 moveto (6969 {) show
0 408 moveto (6970   char *os;) show
0 396 moveto (6971 ) show
0 384 moveto (6972   os = s;) show
0 372 moveto (6973   while\(n-- > 0 && \(*s++ = *t++\) != 0\)) show
0 360 moveto (6974     ;) show
0 348 moveto (6975   while\(n-- > 0\)) show
0 336 moveto (6976     *s++ = 0;) show
0 324 moveto (6977   return os;) show
0 312 moveto (6978 }) show
0 300 moveto (6979 ) show
0 288 moveto (6980 // Like strncpy but guaranteed to NUL-terminate.) show
0 276 moveto (6981 char*) show
0 264 moveto (6982 safestrcpy\(char *s, const char *t, int n\)) show
0 252 moveto (6983 {) show
0 240 moveto (6984   char *os;) show
0 228 moveto (6985 ) show
0 216 moveto (6986   os = s;) show
0 204 moveto (6987   if\(n <= 0\)) show
0 192 moveto (6988     return os;) show
0 180 moveto (6989   while\(--n > 0 && \(*s++ = *t++\) != 0\)) show
0 168 moveto (6990     ;) show
0 156 moveto (6991   *s = 0;) show
0 144 moveto (6992   return os;) show
0 132 moveto (6993 }) show
0 120 moveto (6994 ) show
0 108 moveto (6995 ) show
0 96 moveto (6996 ) show
0 84 moveto (6997 ) show
0 72 moveto (6998 ) show
0 60 moveto (6999 ) show
0 24 moveto (Sheet 69) show
grestore
restore
showpage
%%Page: 79 79
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/string.c  Page 3) show
0 648 moveto (7000 int) show
0 636 moveto (7001 strlen\(const char *s\)) show
0 624 moveto (7002 {) show
0 612 moveto (7003   int n;) show
0 600 moveto (7004 ) show
0 588 moveto (7005   for\(n = 0; s[n]; n++\)) show
0 576 moveto (7006     ;) show
0 564 moveto (7007   return n;) show
0 552 moveto (7008 }) show
0 540 moveto (7009 ) show
0 528 moveto (7010 ) show
0 516 moveto (7011 ) show
0 504 moveto (7012 ) show
0 492 moveto (7013 ) show
0 480 moveto (7014 ) show
0 468 moveto (7015 ) show
0 456 moveto (7016 ) show
0 444 moveto (7017 ) show
0 432 moveto (7018 ) show
0 420 moveto (7019 ) show
0 408 moveto (7020 ) show
0 396 moveto (7021 ) show
0 384 moveto (7022 ) show
0 372 moveto (7023 ) show
0 360 moveto (7024 ) show
0 348 moveto (7025 ) show
0 336 moveto (7026 ) show
0 324 moveto (7027 ) show
0 312 moveto (7028 ) show
0 300 moveto (7029 ) show
0 288 moveto (7030 ) show
0 276 moveto (7031 ) show
0 264 moveto (7032 ) show
0 252 moveto (7033 ) show
0 240 moveto (7034 ) show
0 228 moveto (7035 ) show
0 216 moveto (7036 ) show
0 204 moveto (7037 ) show
0 192 moveto (7038 ) show
0 180 moveto (7039 ) show
0 168 moveto (7040 ) show
0 156 moveto (7041 ) show
0 144 moveto (7042 ) show
0 132 moveto (7043 ) show
0 120 moveto (7044 ) show
0 108 moveto (7045 ) show
0 96 moveto (7046 ) show
0 84 moveto (7047 ) show
0 72 moveto (7048 ) show
0 60 moveto (7049 ) show
0 24 moveto (Sheet 70) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mp.h  Page 1) show
0 648 moveto (7050 // See MultiProcessor Specification Version 1.[14]) show
0 636 moveto (7051 ) show
0 624 moveto (7052 struct mp {             // floating pointer) show
0 612 moveto (7053   uchar signature[4];           // "_MP_") show
0 600 moveto (7054   void *physaddr;               // phys addr of MP config table) show
0 588 moveto (7055   uchar length;                 // 1) show
0 576 moveto (7056   uchar specrev;                // [14]) show
0 564 moveto (7057   uchar checksum;               // all bytes must add up to 0) show
0 552 moveto (7058   uchar type;                   // MP system config type) show
0 540 moveto (7059   uchar imcrp;) show
0 528 moveto (7060   uchar reserved[3];) show
0 516 moveto (7061 };) show
0 504 moveto (7062 ) show
0 492 moveto (7063 struct mpconf {         // configuration table header) show
0 480 moveto (7064   uchar signature[4];           // "PCMP") show
0 468 moveto (7065   ushort length;                // total table length) show
0 456 moveto (7066   uchar version;                // [14]) show
0 444 moveto (7067   uchar checksum;               // all bytes must add up to 0) show
0 432 moveto (7068   uchar product[20];            // product id) show
0 420 moveto (7069   uint *oemtable;               // OEM table pointer) show
0 408 moveto (7070   ushort oemlength;             // OEM table length) show
0 396 moveto (7071   ushort entry;                 // entry count) show
0 384 moveto (7072   uint *lapicaddr;              // address of local APIC) show
0 372 moveto (7073   ushort xlength;               // extended table length) show
0 360 moveto (7074   uchar xchecksum;              // extended table checksum) show
0 348 moveto (7075   uchar reserved;) show
0 336 moveto (7076 };) show
0 324 moveto (7077 ) show
0 312 moveto (7078 struct mpproc {         // processor table entry) show
0 300 moveto (7079   uchar type;                   // entry type \(0\)) show
0 288 moveto (7080   uchar apicid;                 // local APIC id) show
0 276 moveto (7081   uchar version;                // local APIC verison) show
0 264 moveto (7082   uchar flags;                  // CPU flags) show
0 252 moveto (7083     #define MPBOOT 0x02           // This proc is the bootstrap processor.) show
0 240 moveto (7084   uchar signature[4];           // CPU signature) show
0 228 moveto (7085   uint feature;                 // feature flags from CPUID instruction) show
0 216 moveto (7086   uchar reserved[8];) show
0 204 moveto (7087 };) show
0 192 moveto (7088 ) show
0 180 moveto (7089 struct mpioapic {       // I/O APIC table entry) show
0 168 moveto (7090   uchar type;                   // entry type \(2\)) show
0 156 moveto (7091   uchar apicno;                 // I/O APIC id) show
0 144 moveto (7092   uchar version;                // I/O APIC version) show
0 132 moveto (7093   uchar flags;                  // I/O APIC flags) show
0 120 moveto (7094   uint *addr;                  // I/O APIC address) show
0 108 moveto (7095 };) show
0 96 moveto (7096 ) show
0 84 moveto (7097 ) show
0 72 moveto (7098 ) show
0 60 moveto (7099 ) show
0 24 moveto (Sheet 70) show
grestore
restore
showpage
%%Page: 80 80
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mp.h  Page 2) show
0 648 moveto (7100 // Table entry types) show
0 636 moveto (7101 #define MPPROC    0x00  // One per processor) show
0 624 moveto (7102 #define MPBUS     0x01  // One per bus) show
0 612 moveto (7103 #define MPIOAPIC  0x02  // One per I/O APIC) show
0 600 moveto (7104 #define MPIOINTR  0x03  // One per bus interrupt source) show
0 588 moveto (7105 #define MPLINTR   0x04  // One per system interrupt source) show
0 576 moveto (7106 ) show
0 564 moveto (7107 ) show
0 552 moveto (7108 ) show
0 540 moveto (7109 ) show
0 528 moveto (7110 ) show
0 516 moveto (7111 ) show
0 504 moveto (7112 ) show
0 492 moveto (7113 ) show
0 480 moveto (7114 ) show
0 468 moveto (7115 ) show
0 456 moveto (7116 ) show
0 444 moveto (7117 ) show
0 432 moveto (7118 ) show
0 420 moveto (7119 ) show
0 408 moveto (7120 ) show
0 396 moveto (7121 ) show
0 384 moveto (7122 ) show
0 372 moveto (7123 ) show
0 360 moveto (7124 ) show
0 348 moveto (7125 ) show
0 336 moveto (7126 ) show
0 324 moveto (7127 ) show
0 312 moveto (7128 ) show
0 300 moveto (7129 ) show
0 288 moveto (7130 ) show
0 276 moveto (7131 ) show
0 264 moveto (7132 ) show
0 252 moveto (7133 ) show
0 240 moveto (7134 ) show
0 228 moveto (7135 ) show
0 216 moveto (7136 ) show
0 204 moveto (7137 ) show
0 192 moveto (7138 ) show
0 180 moveto (7139 ) show
0 168 moveto (7140 ) show
0 156 moveto (7141 ) show
0 144 moveto (7142 ) show
0 132 moveto (7143 ) show
0 120 moveto (7144 ) show
0 108 moveto (7145 ) show
0 96 moveto (7146 ) show
0 84 moveto (7147 ) show
0 72 moveto (7148 ) show
0 60 moveto (7149 ) show
0 24 moveto (Sheet 71) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mp.h  Page 3) show
0 648 moveto (7150 // Blank page.) show
0 636 moveto (7151 ) show
0 624 moveto (7152 ) show
0 612 moveto (7153 ) show
0 600 moveto (7154 ) show
0 588 moveto (7155 ) show
0 576 moveto (7156 ) show
0 564 moveto (7157 ) show
0 552 moveto (7158 ) show
0 540 moveto (7159 ) show
0 528 moveto (7160 ) show
0 516 moveto (7161 ) show
0 504 moveto (7162 ) show
0 492 moveto (7163 ) show
0 480 moveto (7164 ) show
0 468 moveto (7165 ) show
0 456 moveto (7166 ) show
0 444 moveto (7167 ) show
0 432 moveto (7168 ) show
0 420 moveto (7169 ) show
0 408 moveto (7170 ) show
0 396 moveto (7171 ) show
0 384 moveto (7172 ) show
0 372 moveto (7173 ) show
0 360 moveto (7174 ) show
0 348 moveto (7175 ) show
0 336 moveto (7176 ) show
0 324 moveto (7177 ) show
0 312 moveto (7178 ) show
0 300 moveto (7179 ) show
0 288 moveto (7180 ) show
0 276 moveto (7181 ) show
0 264 moveto (7182 ) show
0 252 moveto (7183 ) show
0 240 moveto (7184 ) show
0 228 moveto (7185 ) show
0 216 moveto (7186 ) show
0 204 moveto (7187 ) show
0 192 moveto (7188 ) show
0 180 moveto (7189 ) show
0 168 moveto (7190 ) show
0 156 moveto (7191 ) show
0 144 moveto (7192 ) show
0 132 moveto (7193 ) show
0 120 moveto (7194 ) show
0 108 moveto (7195 ) show
0 96 moveto (7196 ) show
0 84 moveto (7197 ) show
0 72 moveto (7198 ) show
0 60 moveto (7199 ) show
0 24 moveto (Sheet 71) show
grestore
restore
showpage
%%Page: 81 81
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mp.c  Page 1) show
0 648 moveto (7200 // Multiprocessor support) show
0 636 moveto (7201 // Search memory for MP description structures.) show
0 624 moveto (7202 // http://developer.intel.com/design/pentium/datashts/24201606.pdf) show
0 612 moveto (7203 ) show
0 600 moveto (7204 #include "types.h") show
0 588 moveto (7205 #include "defs.h") show
0 576 moveto (7206 #include "param.h") show
0 564 moveto (7207 #include "memlayout.h") show
0 552 moveto (7208 #include "mp.h") show
0 540 moveto (7209 #include "x86.h") show
0 528 moveto (7210 #include "mmu.h") show
0 516 moveto (7211 #include "proc.h") show
0 504 moveto (7212 ) show
0 492 moveto (7213 struct cpu cpus[NCPU];) show
0 480 moveto (7214 int ncpu;) show
0 468 moveto (7215 uchar ioapicid;) show
0 456 moveto (7216 ) show
0 444 moveto (7217 static uchar) show
0 432 moveto (7218 sum\(uchar *addr, int len\)) show
0 420 moveto (7219 {) show
0 408 moveto (7220   int i, sum;) show
0 396 moveto (7221 ) show
0 384 moveto (7222   sum = 0;) show
0 372 moveto (7223   for\(i=0; i<len; i++\)) show
0 360 moveto (7224     sum += addr[i];) show
0 348 moveto (7225   return sum;) show
0 336 moveto (7226 }) show
0 324 moveto (7227 ) show
0 312 moveto (7228 // Look for an MP structure in the len bytes at addr.) show
0 300 moveto (7229 static struct mp*) show
0 288 moveto (7230 mpsearch1\(uint a, int len\)) show
0 276 moveto (7231 {) show
0 264 moveto (7232   uchar *e, *p, *addr;) show
0 252 moveto (7233 ) show
0 240 moveto (7234   addr = P2V\(a\);) show
0 228 moveto (7235   e = addr+len;) show
0 216 moveto (7236   for\(p = addr; p < e; p += sizeof\(struct mp\)\)) show
0 204 moveto (7237     if\(memcmp\(p, "_MP_", 4\) == 0 && sum\(p, sizeof\(struct mp\)\) == 0\)) show
0 192 moveto (7238       return \(struct mp*\)p;) show
0 180 moveto (7239   return 0;) show
0 168 moveto (7240 }) show
0 156 moveto (7241 ) show
0 144 moveto (7242 ) show
0 132 moveto (7243 ) show
0 120 moveto (7244 ) show
0 108 moveto (7245 ) show
0 96 moveto (7246 ) show
0 84 moveto (7247 ) show
0 72 moveto (7248 ) show
0 60 moveto (7249 ) show
0 24 moveto (Sheet 72) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mp.c  Page 2) show
0 648 moveto (7250 // Search for the MP Floating Pointer Structure, which according to the) show
0 636 moveto (7251 // spec is in one of the following three locations:) show
0 624 moveto (7252 // 1\) in the first KB of the EBDA;) show
0 612 moveto (7253 // 2\) in the last KB of system base memory;) show
0 600 moveto (7254 // 3\) in the BIOS ROM between 0xE0000 and 0xFFFFF.) show
0 588 moveto (7255 static struct mp*) show
0 576 moveto (7256 mpsearch\(void\)) show
0 564 moveto (7257 {) show
0 552 moveto (7258   uchar *bda;) show
0 540 moveto (7259   uint p;) show
0 528 moveto (7260   struct mp *mp;) show
0 516 moveto (7261 ) show
0 504 moveto (7262   bda = \(uchar *\) P2V\(0x400\);) show
0 492 moveto (7263   if\(\(p = \(\(bda[0x0F]<<8\)| bda[0x0E]\) << 4\)\){) show
0 480 moveto (7264     if\(\(mp = mpsearch1\(p, 1024\)\)\)) show
0 468 moveto (7265       return mp;) show
0 456 moveto (7266   } else {) show
0 444 moveto (7267     p = \(\(bda[0x14]<<8\)|bda[0x13]\)*1024;) show
0 432 moveto (7268     if\(\(mp = mpsearch1\(p-1024, 1024\)\)\)) show
0 420 moveto (7269       return mp;) show
0 408 moveto (7270   }) show
0 396 moveto (7271   return mpsearch1\(0xF0000, 0x10000\);) show
0 384 moveto (7272 }) show
0 372 moveto (7273 ) show
0 360 moveto (7274 // Search for an MP configuration table.  For now,) show
0 348 moveto (7275 // don't accept the default configurations \(physaddr == 0\).) show
0 336 moveto (7276 // Check for correct signature, calculate the checksum and,) show
0 324 moveto (7277 // if correct, check the version.) show
0 312 moveto (7278 // To do: check extended table checksum.) show
0 300 moveto (7279 static struct mpconf*) show
0 288 moveto (7280 mpconfig\(struct mp **pmp\)) show
0 276 moveto (7281 {) show
0 264 moveto (7282   struct mpconf *conf;) show
0 252 moveto (7283   struct mp *mp;) show
0 240 moveto (7284 ) show
0 228 moveto (7285   if\(\(mp = mpsearch\(\)\) == 0 || mp->physaddr == 0\)) show
0 216 moveto (7286     return 0;) show
0 204 moveto (7287   conf = \(struct mpconf*\) P2V\(\(uint\) mp->physaddr\);) show
0 192 moveto (7288   if\(memcmp\(conf, "PCMP", 4\) != 0\)) show
0 180 moveto (7289     return 0;) show
0 168 moveto (7290   if\(conf->version != 1 && conf->version != 4\)) show
0 156 moveto (7291     return 0;) show
0 144 moveto (7292   if\(sum\(\(uchar*\)conf, conf->length\) != 0\)) show
0 132 moveto (7293     return 0;) show
0 120 moveto (7294   *pmp = mp;) show
0 108 moveto (7295   return conf;) show
0 96 moveto (7296 }) show
0 84 moveto (7297 ) show
0 72 moveto (7298 ) show
0 60 moveto (7299 ) show
0 24 moveto (Sheet 72) show
grestore
restore
showpage
%%Page: 82 82
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/mp.c  Page 3) show
0 648 moveto (7300 void) show
0 636 moveto (7301 mpinit\(void\)) show
0 624 moveto (7302 {) show
0 612 moveto (7303   uchar *p, *e;) show
0 600 moveto (7304   int ismp;) show
0 588 moveto (7305   struct mp *mp;) show
0 576 moveto (7306   struct mpconf *conf;) show
0 564 moveto (7307   struct mpproc *proc;) show
0 552 moveto (7308   struct mpioapic *ioapic;) show
0 540 moveto (7309 ) show
0 528 moveto (7310   if\(\(conf = mpconfig\(&mp\)\) == 0\)) show
0 516 moveto (7311     panic\("Expect to run on an SMP"\);) show
0 504 moveto (7312   ismp = 1;) show
0 492 moveto (7313   lapic = \(uint*\)conf->lapicaddr;) show
0 480 moveto (7314   for\(p=\(uchar*\)\(conf+1\), e=\(uchar*\)conf+conf->length; p<e; \){) show
0 468 moveto (7315     switch\(*p\){) show
0 456 moveto (7316     case MPPROC:) show
0 444 moveto (7317       proc = \(struct mpproc*\)p;) show
0 432 moveto (7318       if\(ncpu < NCPU\) {) show
0 420 moveto (7319         cpus[ncpu].apicid = proc->apicid;  // apicid may differ from ncpu) show
0 408 moveto (7320         ncpu++;) show
0 396 moveto (7321       }) show
0 384 moveto (7322       p += sizeof\(struct mpproc\);) show
0 372 moveto (7323       continue;) show
0 360 moveto (7324     case MPIOAPIC:) show
0 348 moveto (7325       ioapic = \(struct mpioapic*\)p;) show
0 336 moveto (7326       ioapicid = ioapic->apicno;) show
0 324 moveto (7327       p += sizeof\(struct mpioapic\);) show
0 312 moveto (7328       continue;) show
0 300 moveto (7329     case MPBUS:) show
0 288 moveto (7330     case MPIOINTR:) show
0 276 moveto (7331     case MPLINTR:) show
0 264 moveto (7332       p += 8;) show
0 252 moveto (7333       continue;) show
0 240 moveto (7334     default:) show
0 228 moveto (7335       ismp = 0;) show
0 216 moveto (7336       break;) show
0 204 moveto (7337     }) show
0 192 moveto (7338   }) show
0 180 moveto (7339   if\(!ismp\)) show
0 168 moveto (7340     panic\("Didn't find a suitable machine"\);) show
0 156 moveto (7341 ) show
0 144 moveto (7342   if\(mp->imcrp\){) show
0 132 moveto (7343     // Bochs doesn't support IMCR, so this doesn't run on Bochs.) show
0 120 moveto (7344     // But it would on real hardware.) show
0 108 moveto (7345     outb\(0x22, 0x70\);   // Select IMCR) show
0 96 moveto (7346     outb\(0x23, inb\(0x23\) | 1\);  // Mask external interrupts.) show
0 84 moveto (7347   }) show
0 72 moveto (7348 }) show
0 60 moveto (7349 ) show
0 24 moveto (Sheet 73) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/lapic.c  Page 1) show
0 648 moveto (7350 // The local APIC manages internal \(non-I/O\) interrupts.) show
0 636 moveto (7351 // See Chapter 8 & Appendix C of Intel processor manual volume 3.) show
0 624 moveto (7352 ) show
0 612 moveto (7353 #include "param.h") show
0 600 moveto (7354 #include "types.h") show
0 588 moveto (7355 #include "defs.h") show
0 576 moveto (7356 #include "date.h") show
0 564 moveto (7357 #include "memlayout.h") show
0 552 moveto (7358 #include "traps.h") show
0 540 moveto (7359 #include "mmu.h") show
0 528 moveto (7360 #include "x86.h") show
0 516 moveto (7361 ) show
0 504 moveto (7362 // Local APIC registers, divided by 4 for use as uint[] indices.) show
0 492 moveto (7363 #define ID      \(0x0020/4\)   // ID) show
0 480 moveto (7364 #define VER     \(0x0030/4\)   // Version) show
0 468 moveto (7365 #define TPR     \(0x0080/4\)   // Task Priority) show
0 456 moveto (7366 #define EOI     \(0x00B0/4\)   // EOI) show
0 444 moveto (7367 #define SVR     \(0x00F0/4\)   // Spurious Interrupt Vector) show
0 432 moveto (7368   #define ENABLE     0x00000100   // Unit Enable) show
0 420 moveto (7369 #define ESR     \(0x0280/4\)   // Error Status) show
0 408 moveto (7370 #define ICRLO   \(0x0300/4\)   // Interrupt Command) show
0 396 moveto (7371   #define INIT       0x00000500   // INIT/RESET) show
0 384 moveto (7372   #define STARTUP    0x00000600   // Startup IPI) show
0 372 moveto (7373   #define DELIVS     0x00001000   // Delivery status) show
0 360 moveto (7374   #define ASSERT     0x00004000   // Assert interrupt \(vs deassert\)) show
0 348 moveto (7375   #define DEASSERT   0x00000000) show
0 336 moveto (7376   #define LEVEL      0x00008000   // Level triggered) show
0 324 moveto (7377   #define BCAST      0x00080000   // Send to all APICs, including self.) show
0 312 moveto (7378   #define BUSY       0x00001000) show
0 300 moveto (7379   #define FIXED      0x00000000) show
0 288 moveto (7380 #define ICRHI   \(0x0310/4\)   // Interrupt Command [63:32]) show
0 276 moveto (7381 #define TIMER   \(0x0320/4\)   // Local Vector Table 0 \(TIMER\)) show
0 264 moveto (7382   #define X1         0x0000000B   // divide counts by 1) show
0 252 moveto (7383   #define PERIODIC   0x00020000   // Periodic) show
0 240 moveto (7384 #define PCINT   \(0x0340/4\)   // Performance Counter LVT) show
0 228 moveto (7385 #define LINT0   \(0x0350/4\)   // Local Vector Table 1 \(LINT0\)) show
0 216 moveto (7386 #define LINT1   \(0x0360/4\)   // Local Vector Table 2 \(LINT1\)) show
0 204 moveto (7387 #define ERROR   \(0x0370/4\)   // Local Vector Table 3 \(ERROR\)) show
0 192 moveto (7388   #define MASKED     0x00010000   // Interrupt masked) show
0 180 moveto (7389 #define TICR    \(0x0380/4\)   // Timer Initial Count) show
0 168 moveto (7390 #define TCCR    \(0x0390/4\)   // Timer Current Count) show
0 156 moveto (7391 #define TDCR    \(0x03E0/4\)   // Timer Divide Configuration) show
0 144 moveto (7392 ) show
0 132 moveto (7393 volatile uint *lapic;  // Initialized in mp.c) show
0 120 moveto (7394 ) show
0 108 moveto (7395 ) show
0 96 moveto (7396 ) show
0 84 moveto (7397 ) show
0 72 moveto (7398 ) show
0 60 moveto (7399 ) show
0 24 moveto (Sheet 73) show
grestore
restore
showpage
%%Page: 83 83
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/lapic.c  Page 2) show
0 648 moveto (7400 static void) show
0 636 moveto (7401 lapicw\(int index, int value\)) show
0 624 moveto (7402 {) show
0 612 moveto (7403   lapic[index] = value;) show
0 600 moveto (7404   lapic[ID];  // wait for write to finish, by reading) show
0 588 moveto (7405 }) show
0 576 moveto (7406 ) show
0 564 moveto (7407 void) show
0 552 moveto (7408 lapicinit\(void\)) show
0 540 moveto (7409 {) show
0 528 moveto (7410   if\(!lapic\)) show
0 516 moveto (7411     return;) show
0 504 moveto (7412 ) show
0 492 moveto (7413   // Enable local APIC; set spurious interrupt vector.) show
0 480 moveto (7414   lapicw\(SVR, ENABLE | \(T_IRQ0 + IRQ_SPURIOUS\)\);) show
0 468 moveto (7415 ) show
0 456 moveto (7416   // The timer repeatedly counts down at bus frequency) show
0 444 moveto (7417   // from lapic[TICR] and then issues an interrupt.) show
0 432 moveto (7418   // If xv6 cared more about precise timekeeping,) show
0 420 moveto (7419   // TICR would be calibrated using an external time source.) show
0 408 moveto (7420   lapicw\(TDCR, X1\);) show
0 396 moveto (7421   lapicw\(TIMER, PERIODIC | \(T_IRQ0 + IRQ_TIMER\)\);) show
0 384 moveto (7422   lapicw\(TICR, 10000000\);) show
0 372 moveto (7423 ) show
0 360 moveto (7424   // Disable logical interrupt lines.) show
0 348 moveto (7425   lapicw\(LINT0, MASKED\);) show
0 336 moveto (7426   lapicw\(LINT1, MASKED\);) show
0 324 moveto (7427 ) show
0 312 moveto (7428   // Disable performance counter overflow interrupts) show
0 300 moveto (7429   // on machines that provide that interrupt entry.) show
0 288 moveto (7430   if\(\(\(lapic[VER]>>16\) & 0xFF\) >= 4\)) show
0 276 moveto (7431     lapicw\(PCINT, MASKED\);) show
0 264 moveto (7432 ) show
0 252 moveto (7433   // Map error interrupt to IRQ_ERROR.) show
0 240 moveto (7434   lapicw\(ERROR, T_IRQ0 + IRQ_ERROR\);) show
0 228 moveto (7435 ) show
0 216 moveto (7436   // Clear error status register \(requires back-to-back writes\).) show
0 204 moveto (7437   lapicw\(ESR, 0\);) show
0 192 moveto (7438   lapicw\(ESR, 0\);) show
0 180 moveto (7439 ) show
0 168 moveto (7440   // Ack any outstanding interrupts.) show
0 156 moveto (7441   lapicw\(EOI, 0\);) show
0 144 moveto (7442 ) show
0 132 moveto (7443   // Send an Init Level De-Assert to synchronise arbitration ID's.) show
0 120 moveto (7444   lapicw\(ICRHI, 0\);) show
0 108 moveto (7445   lapicw\(ICRLO, BCAST | INIT | LEVEL\);) show
0 96 moveto (7446   while\(lapic[ICRLO] & DELIVS\)) show
0 84 moveto (7447     ;) show
0 72 moveto (7448 ) show
0 60 moveto (7449 ) show
0 24 moveto (Sheet 74) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/lapic.c  Page 3) show
0 648 moveto (7450   // Enable interrupts on the APIC \(but not on the processor\).) show
0 636 moveto (7451   lapicw\(TPR, 0\);) show
0 624 moveto (7452 }) show
0 612 moveto (7453 ) show
0 600 moveto (7454 int) show
0 588 moveto (7455 lapicid\(void\)) show
0 576 moveto (7456 {) show
0 564 moveto (7457   if \(!lapic\)) show
0 552 moveto (7458     return 0;) show
0 540 moveto (7459   return lapic[ID] >> 24;) show
0 528 moveto (7460 }) show
0 516 moveto (7461 ) show
0 504 moveto (7462 // Acknowledge interrupt.) show
0 492 moveto (7463 void) show
0 480 moveto (7464 lapiceoi\(void\)) show
0 468 moveto (7465 {) show
0 456 moveto (7466   if\(lapic\)) show
0 444 moveto (7467     lapicw\(EOI, 0\);) show
0 432 moveto (7468 }) show
0 420 moveto (7469 ) show
0 408 moveto (7470 // Spin for a given number of microseconds.) show
0 396 moveto (7471 // On real hardware would want to tune this dynamically.) show
0 384 moveto (7472 void) show
0 372 moveto (7473 microdelay\(int us\)) show
0 360 moveto (7474 {) show
0 348 moveto (7475 }) show
0 336 moveto (7476 ) show
0 324 moveto (7477 #define CMOS_PORT    0x70) show
0 312 moveto (7478 #define CMOS_RETURN  0x71) show
0 300 moveto (7479 ) show
0 288 moveto (7480 // Start additional processor running entry code at addr.) show
0 276 moveto (7481 // See Appendix B of MultiProcessor Specification.) show
0 264 moveto (7482 void) show
0 252 moveto (7483 lapicstartap\(uchar apicid, uint addr\)) show
0 240 moveto (7484 {) show
0 228 moveto (7485   int i;) show
0 216 moveto (7486   ushort *wrv;) show
0 204 moveto (7487 ) show
0 192 moveto (7488   // "The BSP must initialize CMOS shutdown code to 0AH) show
0 180 moveto (7489   // and the warm reset vector \(DWORD based at 40:67\) to point at) show
0 168 moveto (7490   // the AP startup code prior to the [universal startup algorithm].") show
0 156 moveto (7491   outb\(CMOS_PORT, 0xF\);  // offset 0xF is shutdown code) show
0 144 moveto (7492   outb\(CMOS_PORT+1, 0x0A\);) show
0 132 moveto (7493   wrv = \(ushort*\)P2V\(\(0x40<<4 | 0x67\)\);  // Warm reset vector) show
0 120 moveto (7494   wrv[0] = 0;) show
0 108 moveto (7495   wrv[1] = addr >> 4;) show
0 96 moveto (7496 ) show
0 84 moveto (7497 ) show
0 72 moveto (7498 ) show
0 60 moveto (7499 ) show
0 24 moveto (Sheet 74) show
grestore
restore
showpage
%%Page: 84 84
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/lapic.c  Page 4) show
0 648 moveto (7500   // "Universal startup algorithm.") show
0 636 moveto (7501   // Send INIT \(level-triggered\) interrupt to reset other CPU.) show
0 624 moveto (7502   lapicw\(ICRHI, apicid<<24\);) show
0 612 moveto (7503   lapicw\(ICRLO, INIT | LEVEL | ASSERT\);) show
0 600 moveto (7504   microdelay\(200\);) show
0 588 moveto (7505   lapicw\(ICRLO, INIT | LEVEL\);) show
0 576 moveto (7506   microdelay\(100\);    // should be 10ms, but too slow in Bochs!) show
0 564 moveto (7507 ) show
0 552 moveto (7508   // Send startup IPI \(twice!\) to enter code.) show
0 540 moveto (7509   // Regular hardware is supposed to only accept a STARTUP) show
0 528 moveto (7510   // when it is in the halted state due to an INIT.  So the second) show
0 516 moveto (7511   // should be ignored, but it is part of the official Intel algorithm.) show
0 504 moveto (7512   // Bochs complains about the second one.  Too bad for Bochs.) show
0 492 moveto (7513   for\(i = 0; i < 2; i++\){) show
0 480 moveto (7514     lapicw\(ICRHI, apicid<<24\);) show
0 468 moveto (7515     lapicw\(ICRLO, STARTUP | \(addr>>12\)\);) show
0 456 moveto (7516     microdelay\(200\);) show
0 444 moveto (7517   }) show
0 432 moveto (7518 }) show
0 420 moveto (7519 ) show
0 408 moveto (7520 #define CMOS_STATA   0x0a) show
0 396 moveto (7521 #define CMOS_STATB   0x0b) show
0 384 moveto (7522 #define CMOS_UIP    \(1 << 7\)        // RTC update in progress) show
0 372 moveto (7523 ) show
0 360 moveto (7524 #define SECS    0x00) show
0 348 moveto (7525 #define MINS    0x02) show
0 336 moveto (7526 #define HOURS   0x04) show
0 324 moveto (7527 #define DAY     0x07) show
0 312 moveto (7528 #define MONTH   0x08) show
0 300 moveto (7529 #define YEAR    0x09) show
0 288 moveto (7530 ) show
0 276 moveto (7531 static uint) show
0 264 moveto (7532 cmos_read\(uint reg\)) show
0 252 moveto (7533 {) show
0 240 moveto (7534   outb\(CMOS_PORT,  reg\);) show
0 228 moveto (7535   microdelay\(200\);) show
0 216 moveto (7536 ) show
0 204 moveto (7537   return inb\(CMOS_RETURN\);) show
0 192 moveto (7538 }) show
0 180 moveto (7539 ) show
0 168 moveto (7540 static void) show
0 156 moveto (7541 fill_rtcdate\(struct rtcdate *r\)) show
0 144 moveto (7542 {) show
0 132 moveto (7543   r->second = cmos_read\(SECS\);) show
0 120 moveto (7544   r->minute = cmos_read\(MINS\);) show
0 108 moveto (7545   r->hour   = cmos_read\(HOURS\);) show
0 96 moveto (7546   r->day    = cmos_read\(DAY\);) show
0 84 moveto (7547   r->month  = cmos_read\(MONTH\);) show
0 72 moveto (7548   r->year   = cmos_read\(YEAR\);) show
0 60 moveto (7549 }) show
0 24 moveto (Sheet 75) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/lapic.c  Page 5) show
0 648 moveto (7550 // qemu seems to use 24-hour GWT and the values are BCD encoded) show
0 636 moveto (7551 void) show
0 624 moveto (7552 cmostime\(struct rtcdate *r\)) show
0 612 moveto (7553 {) show
0 600 moveto (7554   struct rtcdate t1, t2;) show
0 588 moveto (7555   int sb, bcd;) show
0 576 moveto (7556 ) show
0 564 moveto (7557   sb = cmos_read\(CMOS_STATB\);) show
0 552 moveto (7558 ) show
0 540 moveto (7559   bcd = \(sb & \(1 << 2\)\) == 0;) show
0 528 moveto (7560 ) show
0 516 moveto (7561   // make sure CMOS doesn't modify time while we read it) show
0 504 moveto (7562   for\(;;\) {) show
0 492 moveto (7563     fill_rtcdate\(&t1\);) show
0 480 moveto (7564     if\(cmos_read\(CMOS_STATA\) & CMOS_UIP\)) show
0 468 moveto (7565         continue;) show
0 456 moveto (7566     fill_rtcdate\(&t2\);) show
0 444 moveto (7567     if\(memcmp\(&t1, &t2, sizeof\(t1\)\) == 0\)) show
0 432 moveto (7568       break;) show
0 420 moveto (7569   }) show
0 408 moveto (7570 ) show
0 396 moveto (7571   // convert) show
0 384 moveto (7572   if\(bcd\) {) show
0 372 moveto (7573 #define    CONV\(x\)     \(t1.x = \(\(t1.x >> 4\) * 10\) + \(t1.x & 0xf\)\)) show
0 360 moveto (7574     CONV\(second\);) show
0 348 moveto (7575     CONV\(minute\);) show
0 336 moveto (7576     CONV\(hour  \);) show
0 324 moveto (7577     CONV\(day   \);) show
0 312 moveto (7578     CONV\(month \);) show
0 300 moveto (7579     CONV\(year  \);) show
0 288 moveto (7580 #undef     CONV) show
0 276 moveto (7581   }) show
0 264 moveto (7582 ) show
0 252 moveto (7583   *r = t1;) show
0 240 moveto (7584   r->year += 2000;) show
0 228 moveto (7585 }) show
0 216 moveto (7586 ) show
0 204 moveto (7587 ) show
0 192 moveto (7588 ) show
0 180 moveto (7589 ) show
0 168 moveto (7590 ) show
0 156 moveto (7591 ) show
0 144 moveto (7592 ) show
0 132 moveto (7593 ) show
0 120 moveto (7594 ) show
0 108 moveto (7595 ) show
0 96 moveto (7596 ) show
0 84 moveto (7597 ) show
0 72 moveto (7598 ) show
0 60 moveto (7599 ) show
0 24 moveto (Sheet 75) show
grestore
restore
showpage
%%Page: 85 85
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/ioapic.c  Page 1) show
0 648 moveto (7600 // The I/O APIC manages hardware interrupts for an SMP system.) show
0 636 moveto (7601 // http://www.intel.com/design/chipsets/datashts/29056601.pdf) show
0 624 moveto (7602 // See also picirq.c.) show
0 612 moveto (7603 ) show
0 600 moveto (7604 #include "types.h") show
0 588 moveto (7605 #include "defs.h") show
0 576 moveto (7606 #include "traps.h") show
0 564 moveto (7607 ) show
0 552 moveto (7608 #define IOAPIC  0xFEC00000   // Default physical address of IO APIC) show
0 540 moveto (7609 ) show
0 528 moveto (7610 #define REG_ID     0x00  // Register index: ID) show
0 516 moveto (7611 #define REG_VER    0x01  // Register index: version) show
0 504 moveto (7612 #define REG_TABLE  0x10  // Redirection table base) show
0 492 moveto (7613 ) show
0 480 moveto (7614 // The redirection table starts at REG_TABLE and uses) show
0 468 moveto (7615 // two registers to configure each interrupt.) show
0 456 moveto (7616 // The first \(low\) register in a pair contains configuration bits.) show
0 444 moveto (7617 // The second \(high\) register contains a bitmask telling which) show
0 432 moveto (7618 // CPUs can serve that interrupt.) show
0 420 moveto (7619 #define INT_DISABLED   0x00010000  // Interrupt disabled) show
0 408 moveto (7620 #define INT_LEVEL      0x00008000  // Level-triggered \(vs edge-\)) show
0 396 moveto (7621 #define INT_ACTIVELOW  0x00002000  // Active low \(vs high\)) show
0 384 moveto (7622 #define INT_LOGICAL    0x00000800  // Destination is CPU id \(vs APIC ID\)) show
0 372 moveto (7623 ) show
0 360 moveto (7624 volatile struct ioapic *ioapic;) show
0 348 moveto (7625 ) show
0 336 moveto (7626 // IO APIC MMIO structure: write reg, then read or write data.) show
0 324 moveto (7627 struct ioapic {) show
0 312 moveto (7628   uint reg;) show
0 300 moveto (7629   uint pad[3];) show
0 288 moveto (7630   uint data;) show
0 276 moveto (7631 };) show
0 264 moveto (7632 ) show
0 252 moveto (7633 static uint) show
0 240 moveto (7634 ioapicread\(int reg\)) show
0 228 moveto (7635 {) show
0 216 moveto (7636   ioapic->reg = reg;) show
0 204 moveto (7637   return ioapic->data;) show
0 192 moveto (7638 }) show
0 180 moveto (7639 ) show
0 168 moveto (7640 static void) show
0 156 moveto (7641 ioapicwrite\(int reg, uint data\)) show
0 144 moveto (7642 {) show
0 132 moveto (7643   ioapic->reg = reg;) show
0 120 moveto (7644   ioapic->data = data;) show
0 108 moveto (7645 }) show
0 96 moveto (7646 ) show
0 84 moveto (7647 ) show
0 72 moveto (7648 ) show
0 60 moveto (7649 ) show
0 24 moveto (Sheet 76) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/ioapic.c  Page 2) show
0 648 moveto (7650 void) show
0 636 moveto (7651 ioapicinit\(void\)) show
0 624 moveto (7652 {) show
0 612 moveto (7653   int i, id, maxintr;) show
0 600 moveto (7654 ) show
0 588 moveto (7655   ioapic = \(volatile struct ioapic*\)IOAPIC;) show
0 576 moveto (7656   maxintr = \(ioapicread\(REG_VER\) >> 16\) & 0xFF;) show
0 564 moveto (7657   id = ioapicread\(REG_ID\) >> 24;) show
0 552 moveto (7658   if\(id != ioapicid\)) show
0 540 moveto (7659     cprintf\("ioapicinit: id isn't equal to ioapicid; not a MP\\n"\);) show
0 528 moveto (7660 ) show
0 516 moveto (7661   // Mark all interrupts edge-triggered, active high, disabled,) show
0 504 moveto (7662   // and not routed to any CPUs.) show
0 492 moveto (7663   for\(i = 0; i <= maxintr; i++\){) show
0 480 moveto (7664     ioapicwrite\(REG_TABLE+2*i, INT_DISABLED | \(T_IRQ0 + i\)\);) show
0 468 moveto (7665     ioapicwrite\(REG_TABLE+2*i+1, 0\);) show
0 456 moveto (7666   }) show
0 444 moveto (7667 }) show
0 432 moveto (7668 ) show
0 420 moveto (7669 void) show
0 408 moveto (7670 ioapicenable\(int irq, int cpunum\)) show
0 396 moveto (7671 {) show
0 384 moveto (7672   // Mark interrupt edge-triggered, active high,) show
0 372 moveto (7673   // enabled, and routed to the given cpunum,) show
0 360 moveto (7674   // which happens to be that cpu's APIC ID.) show
0 348 moveto (7675   ioapicwrite\(REG_TABLE+2*irq, T_IRQ0 + irq\);) show
0 336 moveto (7676   ioapicwrite\(REG_TABLE+2*irq+1, cpunum << 24\);) show
0 324 moveto (7677 }) show
0 312 moveto (7678 ) show
0 300 moveto (7679 ) show
0 288 moveto (7680 ) show
0 276 moveto (7681 ) show
0 264 moveto (7682 ) show
0 252 moveto (7683 ) show
0 240 moveto (7684 ) show
0 228 moveto (7685 ) show
0 216 moveto (7686 ) show
0 204 moveto (7687 ) show
0 192 moveto (7688 ) show
0 180 moveto (7689 ) show
0 168 moveto (7690 ) show
0 156 moveto (7691 ) show
0 144 moveto (7692 ) show
0 132 moveto (7693 ) show
0 120 moveto (7694 ) show
0 108 moveto (7695 ) show
0 96 moveto (7696 ) show
0 84 moveto (7697 ) show
0 72 moveto (7698 ) show
0 60 moveto (7699 ) show
0 24 moveto (Sheet 76) show
grestore
restore
showpage
%%Page: 86 86
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/kbd.h  Page 1) show
0 648 moveto (7700 // PC keyboard interface constants) show
0 636 moveto (7701 ) show
0 624 moveto (7702 #define KBSTATP         0x64    // kbd controller status port\(I\)) show
0 612 moveto (7703 #define KBS_DIB         0x01    // kbd data in buffer) show
0 600 moveto (7704 #define KBDATAP         0x60    // kbd data port\(I\)) show
0 588 moveto (7705 ) show
0 576 moveto (7706 #define NO              0) show
0 564 moveto (7707 ) show
0 552 moveto (7708 #define SHIFT           \(1<<0\)) show
0 540 moveto (7709 #define CTL             \(1<<1\)) show
0 528 moveto (7710 #define ALT             \(1<<2\)) show
0 516 moveto (7711 ) show
0 504 moveto (7712 #define CAPSLOCK        \(1<<3\)) show
0 492 moveto (7713 #define NUMLOCK         \(1<<4\)) show
0 480 moveto (7714 #define SCROLLLOCK      \(1<<5\)) show
0 468 moveto (7715 ) show
0 456 moveto (7716 #define E0ESC           \(1<<6\)) show
0 444 moveto (7717 ) show
0 432 moveto (7718 // Special keycodes) show
0 420 moveto (7719 #define KEY_HOME        0xE0) show
0 408 moveto (7720 #define KEY_END         0xE1) show
0 396 moveto (7721 #define KEY_UP          0xE2) show
0 384 moveto (7722 #define KEY_DN          0xE3) show
0 372 moveto (7723 #define KEY_LF          0xE4) show
0 360 moveto (7724 #define KEY_RT          0xE5) show
0 348 moveto (7725 #define KEY_PGUP        0xE6) show
0 336 moveto (7726 #define KEY_PGDN        0xE7) show
0 324 moveto (7727 #define KEY_INS         0xE8) show
0 312 moveto (7728 #define KEY_DEL         0xE9) show
0 300 moveto (7729 ) show
0 288 moveto (7730 // C\('A'\) == Control-A) show
0 276 moveto (7731 #define C\(x\) \(x - '@'\)) show
0 264 moveto (7732 ) show
0 252 moveto (7733 static uchar shiftcode[256] =) show
0 240 moveto (7734 {) show
0 228 moveto (7735   [0x1D] CTL,) show
0 216 moveto (7736   [0x2A] SHIFT,) show
0 204 moveto (7737   [0x36] SHIFT,) show
0 192 moveto (7738   [0x38] ALT,) show
0 180 moveto (7739   [0x9D] CTL,) show
0 168 moveto (7740   [0xB8] ALT) show
0 156 moveto (7741 };) show
0 144 moveto (7742 ) show
0 132 moveto (7743 static uchar togglecode[256] =) show
0 120 moveto (7744 {) show
0 108 moveto (7745   [0x3A] CAPSLOCK,) show
0 96 moveto (7746   [0x45] NUMLOCK,) show
0 84 moveto (7747   [0x46] SCROLLLOCK) show
0 72 moveto (7748 };) show
0 60 moveto (7749 ) show
0 24 moveto (Sheet 77) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/kbd.h  Page 2) show
0 648 moveto (7750 static uchar normalmap[256] =) show
0 636 moveto (7751 {) show
0 624 moveto (7752   NO,   0x1B, '1',  '2',  '3',  '4',  '5',  '6',  // 0x00) show
0 612 moveto (7753   '7',  '8',  '9',  '0',  '-',  '=',  '\\b', '\\t',) show
0 600 moveto (7754   'q',  'w',  'e',  'r',  't',  'y',  'u',  'i',  // 0x10) show
0 588 moveto (7755   'o',  'p',  '[',  ']',  '\\n', NO,   'a',  's',) show
0 576 moveto (7756   'd',  'f',  'g',  'h',  'j',  'k',  'l',  ';',  // 0x20) show
0 564 moveto (7757   '\\'', '`',  NO,   '\\\\', 'z',  'x',  'c',  'v',) show
0 552 moveto (7758   'b',  'n',  'm',  ',',  '.',  '/',  NO,   '*',  // 0x30) show
0 540 moveto (7759   NO,   ' ',  NO,   NO,   NO,   NO,   NO,   NO,) show
0 528 moveto (7760   NO,   NO,   NO,   NO,   NO,   NO,   NO,   '7',  // 0x40) show
0 516 moveto (7761   '8',  '9',  '-',  '4',  '5',  '6',  '+',  '1',) show
0 504 moveto (7762   '2',  '3',  '0',  '.',  NO,   NO,   NO,   NO,   // 0x50) show
0 492 moveto (7763   [0x9C] '\\n',      // KP_Enter) show
0 480 moveto (7764   [0xB5] '/',       // KP_Div) show
0 468 moveto (7765   [0xC8] KEY_UP,    [0xD0] KEY_DN,) show
0 456 moveto (7766   [0xC9] KEY_PGUP,  [0xD1] KEY_PGDN,) show
0 444 moveto (7767   [0xCB] KEY_LF,    [0xCD] KEY_RT,) show
0 432 moveto (7768   [0x97] KEY_HOME,  [0xCF] KEY_END,) show
0 420 moveto (7769   [0xD2] KEY_INS,   [0xD3] KEY_DEL) show
0 408 moveto (7770 };) show
0 396 moveto (7771 ) show
0 384 moveto (7772 static uchar shiftmap[256] =) show
0 372 moveto (7773 {) show
0 360 moveto (7774   NO,   033,  '!',  '@',  '#',  '$',  '%',  '^',  // 0x00) show
0 348 moveto (7775   '&',  '*',  '\(',  '\)',  '_',  '+',  '\\b', '\\t',) show
0 336 moveto (7776   'Q',  'W',  'E',  'R',  'T',  'Y',  'U',  'I',  // 0x10) show
0 324 moveto (7777   'O',  'P',  '{',  '}',  '\\n', NO,   'A',  'S',) show
0 312 moveto (7778   'D',  'F',  'G',  'H',  'J',  'K',  'L',  ':',  // 0x20) show
0 300 moveto (7779   '"',  '~',  NO,   '|',  'Z',  'X',  'C',  'V',) show
0 288 moveto (7780   'B',  'N',  'M',  '<',  '>',  '?',  NO,   '*',  // 0x30) show
0 276 moveto (7781   NO,   ' ',  NO,   NO,   NO,   NO,   NO,   NO,) show
0 264 moveto (7782   NO,   NO,   NO,   NO,   NO,   NO,   NO,   '7',  // 0x40) show
0 252 moveto (7783   '8',  '9',  '-',  '4',  '5',  '6',  '+',  '1',) show
0 240 moveto (7784   '2',  '3',  '0',  '.',  NO,   NO,   NO,   NO,   // 0x50) show
0 228 moveto (7785   [0x9C] '\\n',      // KP_Enter) show
0 216 moveto (7786   [0xB5] '/',       // KP_Div) show
0 204 moveto (7787   [0xC8] KEY_UP,    [0xD0] KEY_DN,) show
0 192 moveto (7788   [0xC9] KEY_PGUP,  [0xD1] KEY_PGDN,) show
0 180 moveto (7789   [0xCB] KEY_LF,    [0xCD] KEY_RT,) show
0 168 moveto (7790   [0x97] KEY_HOME,  [0xCF] KEY_END,) show
0 156 moveto (7791   [0xD2] KEY_INS,   [0xD3] KEY_DEL) show
0 144 moveto (7792 };) show
0 132 moveto (7793 ) show
0 120 moveto (7794 ) show
0 108 moveto (7795 ) show
0 96 moveto (7796 ) show
0 84 moveto (7797 ) show
0 72 moveto (7798 ) show
0 60 moveto (7799 ) show
0 24 moveto (Sheet 77) show
grestore
restore
showpage
%%Page: 87 87
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/kbd.h  Page 3) show
0 648 moveto (7800 static uchar ctlmap[256] =) show
0 636 moveto (7801 {) show
0 624 moveto (7802   NO,      NO,      NO,      NO,      NO,      NO,      NO,      NO,) show
0 612 moveto (7803   NO,      NO,      NO,      NO,      NO,      NO,      NO,      NO,) show
0 600 moveto (7804   C\('Q'\),  C\('W'\),  C\('E'\),  C\('R'\),  C\('T'\),  C\('Y'\),  C\('U'\),  C\('I'\),) show
0 588 moveto (7805   C\('O'\),  C\('P'\),  NO,      NO,      '\\r',    NO,      C\('A'\),  C\('S'\),) show
0 576 moveto (7806   C\('D'\),  C\('F'\),  C\('G'\),  C\('H'\),  C\('J'\),  C\('K'\),  C\('L'\),  NO,) show
0 564 moveto (7807   NO,      NO,      NO,      C\('\\\\'\), C\('Z'\),  C\('X'\),  C\('C'\),  C\('V'\),) show
0 552 moveto (7808   C\('B'\),  C\('N'\),  C\('M'\),  NO,      NO,      C\('/'\),  NO,      NO,) show
0 540 moveto (7809   [0x9C] '\\r',      // KP_Enter) show
0 528 moveto (7810   [0xB5] C\('/'\),    // KP_Div) show
0 516 moveto (7811   [0xC8] KEY_UP,    [0xD0] KEY_DN,) show
0 504 moveto (7812   [0xC9] KEY_PGUP,  [0xD1] KEY_PGDN,) show
0 492 moveto (7813   [0xCB] KEY_LF,    [0xCD] KEY_RT,) show
0 480 moveto (7814   [0x97] KEY_HOME,  [0xCF] KEY_END,) show
0 468 moveto (7815   [0xD2] KEY_INS,   [0xD3] KEY_DEL) show
0 456 moveto (7816 };) show
0 444 moveto (7817 ) show
0 432 moveto (7818 ) show
0 420 moveto (7819 ) show
0 408 moveto (7820 ) show
0 396 moveto (7821 ) show
0 384 moveto (7822 ) show
0 372 moveto (7823 ) show
0 360 moveto (7824 ) show
0 348 moveto (7825 ) show
0 336 moveto (7826 ) show
0 324 moveto (7827 ) show
0 312 moveto (7828 ) show
0 300 moveto (7829 ) show
0 288 moveto (7830 ) show
0 276 moveto (7831 ) show
0 264 moveto (7832 ) show
0 252 moveto (7833 ) show
0 240 moveto (7834 ) show
0 228 moveto (7835 ) show
0 216 moveto (7836 ) show
0 204 moveto (7837 ) show
0 192 moveto (7838 ) show
0 180 moveto (7839 ) show
0 168 moveto (7840 ) show
0 156 moveto (7841 ) show
0 144 moveto (7842 ) show
0 132 moveto (7843 ) show
0 120 moveto (7844 ) show
0 108 moveto (7845 ) show
0 96 moveto (7846 ) show
0 84 moveto (7847 ) show
0 72 moveto (7848 ) show
0 60 moveto (7849 ) show
0 24 moveto (Sheet 78) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/kbd.c  Page 1) show
0 648 moveto (7850 #include "types.h") show
0 636 moveto (7851 #include "x86.h") show
0 624 moveto (7852 #include "defs.h") show
0 612 moveto (7853 #include "kbd.h") show
0 600 moveto (7854 ) show
0 588 moveto (7855 int) show
0 576 moveto (7856 kbdgetc\(void\)) show
0 564 moveto (7857 {) show
0 552 moveto (7858   static uint shift;) show
0 540 moveto (7859   static uchar *charcode[4] = {) show
0 528 moveto (7860     normalmap, shiftmap, ctlmap, ctlmap) show
0 516 moveto (7861   };) show
0 504 moveto (7862   uint st, data, c;) show
0 492 moveto (7863 ) show
0 480 moveto (7864   st = inb\(KBSTATP\);) show
0 468 moveto (7865   if\(\(st & KBS_DIB\) == 0\)) show
0 456 moveto (7866     return -1;) show
0 444 moveto (7867   data = inb\(KBDATAP\);) show
0 432 moveto (7868 ) show
0 420 moveto (7869   if\(data == 0xE0\){) show
0 408 moveto (7870     shift |= E0ESC;) show
0 396 moveto (7871     return 0;) show
0 384 moveto (7872   } else if\(data & 0x80\){) show
0 372 moveto (7873     // Key released) show
0 360 moveto (7874     data = \(shift & E0ESC ? data : data & 0x7F\);) show
0 348 moveto (7875     shift &= ~\(shiftcode[data] | E0ESC\);) show
0 336 moveto (7876     return 0;) show
0 324 moveto (7877   } else if\(shift & E0ESC\){) show
0 312 moveto (7878     // Last character was an E0 escape; or with 0x80) show
0 300 moveto (7879     data |= 0x80;) show
0 288 moveto (7880     shift &= ~E0ESC;) show
0 276 moveto (7881   }) show
0 264 moveto (7882 ) show
0 252 moveto (7883   shift |= shiftcode[data];) show
0 240 moveto (7884   shift ^= togglecode[data];) show
0 228 moveto (7885   c = charcode[shift & \(CTL | SHIFT\)][data];) show
0 216 moveto (7886   if\(shift & CAPSLOCK\){) show
0 204 moveto (7887     if\('a' <= c && c <= 'z'\)) show
0 192 moveto (7888       c += 'A' - 'a';) show
0 180 moveto (7889     else if\('A' <= c && c <= 'Z'\)) show
0 168 moveto (7890       c += 'a' - 'A';) show
0 156 moveto (7891   }) show
0 144 moveto (7892   return c;) show
0 132 moveto (7893 }) show
0 120 moveto (7894 ) show
0 108 moveto (7895 void) show
0 96 moveto (7896 kbdintr\(void\)) show
0 84 moveto (7897 {) show
0 72 moveto (7898   consoleintr\(kbdgetc\);) show
0 60 moveto (7899 }) show
0 24 moveto (Sheet 78) show
grestore
restore
showpage
%%Page: 88 88
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/console.c  Page 1) show
0 648 moveto (7900 // Console input and output.) show
0 636 moveto (7901 // Input is from the keyboard or serial port.) show
0 624 moveto (7902 // Output is written to the screen and serial port.) show
0 612 moveto (7903 ) show
0 600 moveto (7904 #include "types.h") show
0 588 moveto (7905 #include "defs.h") show
0 576 moveto (7906 #include "param.h") show
0 564 moveto (7907 #include "traps.h") show
0 552 moveto (7908 #include "spinlock.h") show
0 540 moveto (7909 #include "sleeplock.h") show
0 528 moveto (7910 #include "fs.h") show
0 516 moveto (7911 #include "file.h") show
0 504 moveto (7912 #include "memlayout.h") show
0 492 moveto (7913 #include "mmu.h") show
0 480 moveto (7914 #include "proc.h") show
0 468 moveto (7915 #include "x86.h") show
0 456 moveto (7916 ) show
0 444 moveto (7917 static void consputc\(int\);) show
0 432 moveto (7918 ) show
0 420 moveto (7919 static int panicked = 0;) show
0 408 moveto (7920 ) show
0 396 moveto (7921 static struct {) show
0 384 moveto (7922   struct spinlock lock;) show
0 372 moveto (7923   int locking;) show
0 360 moveto (7924 } cons;) show
0 348 moveto (7925 ) show
0 336 moveto (7926 static void) show
0 324 moveto (7927 printint\(int xx, int base, int sign\)) show
0 312 moveto (7928 {) show
0 300 moveto (7929   static char digits[] = "0123456789abcdef";) show
0 288 moveto (7930   char buf[16];) show
0 276 moveto (7931   int i;) show
0 264 moveto (7932   uint x;) show
0 252 moveto (7933 ) show
0 240 moveto (7934   if\(sign && \(sign = xx < 0\)\)) show
0 228 moveto (7935     x = -xx;) show
0 216 moveto (7936   else) show
0 204 moveto (7937     x = xx;) show
0 192 moveto (7938 ) show
0 180 moveto (7939   i = 0;) show
0 168 moveto (7940   do{) show
0 156 moveto (7941     buf[i++] = digits[x % base];) show
0 144 moveto (7942   }while\(\(x /= base\) != 0\);) show
0 132 moveto (7943 ) show
0 120 moveto (7944   if\(sign\)) show
0 108 moveto (7945     buf[i++] = '-';) show
0 96 moveto (7946 ) show
0 84 moveto (7947   while\(--i >= 0\)) show
0 72 moveto (7948     consputc\(buf[i]\);) show
0 60 moveto (7949 }) show
0 24 moveto (Sheet 79) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/console.c  Page 2) show
0 648 moveto (7950 ) show
0 636 moveto (7951 ) show
0 624 moveto (7952 ) show
0 612 moveto (7953 ) show
0 600 moveto (7954 ) show
0 588 moveto (7955 ) show
0 576 moveto (7956 ) show
0 564 moveto (7957 ) show
0 552 moveto (7958 ) show
0 540 moveto (7959 ) show
0 528 moveto (7960 ) show
0 516 moveto (7961 ) show
0 504 moveto (7962 ) show
0 492 moveto (7963 ) show
0 480 moveto (7964 ) show
0 468 moveto (7965 ) show
0 456 moveto (7966 ) show
0 444 moveto (7967 ) show
0 432 moveto (7968 ) show
0 420 moveto (7969 ) show
0 408 moveto (7970 ) show
0 396 moveto (7971 ) show
0 384 moveto (7972 ) show
0 372 moveto (7973 ) show
0 360 moveto (7974 ) show
0 348 moveto (7975 ) show
0 336 moveto (7976 ) show
0 324 moveto (7977 ) show
0 312 moveto (7978 ) show
0 300 moveto (7979 ) show
0 288 moveto (7980 ) show
0 276 moveto (7981 ) show
0 264 moveto (7982 ) show
0 252 moveto (7983 ) show
0 240 moveto (7984 ) show
0 228 moveto (7985 ) show
0 216 moveto (7986 ) show
0 204 moveto (7987 ) show
0 192 moveto (7988 ) show
0 180 moveto (7989 ) show
0 168 moveto (7990 ) show
0 156 moveto (7991 ) show
0 144 moveto (7992 ) show
0 132 moveto (7993 ) show
0 120 moveto (7994 ) show
0 108 moveto (7995 ) show
0 96 moveto (7996 ) show
0 84 moveto (7997 ) show
0 72 moveto (7998 ) show
0 60 moveto (7999 ) show
0 24 moveto (Sheet 79) show
grestore
restore
showpage
%%Page: 89 89
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/console.c  Page 3) show
0 648 moveto (8000 // Print to the console. only understands %d, %x, %p, %s.) show
0 636 moveto (8001 void) show
0 624 moveto (8002 cprintf\(char *fmt, ...\)) show
0 612 moveto (8003 {) show
0 600 moveto (8004   int i, c, locking;) show
0 588 moveto (8005   uint *argp;) show
0 576 moveto (8006   char *s;) show
0 564 moveto (8007 ) show
0 552 moveto (8008   locking = cons.locking;) show
0 540 moveto (8009   if\(locking\)) show
0 528 moveto (8010     acquire\(&cons.lock\);) show
0 516 moveto (8011 ) show
0 504 moveto (8012   if \(fmt == 0\)) show
0 492 moveto (8013     panic\("null fmt"\);) show
0 480 moveto (8014 ) show
0 468 moveto (8015   argp = \(uint*\)\(void*\)\(&fmt + 1\);) show
0 456 moveto (8016   for\(i = 0; \(c = fmt[i] & 0xff\) != 0; i++\){) show
0 444 moveto (8017     if\(c != '%'\){) show
0 432 moveto (8018       consputc\(c\);) show
0 420 moveto (8019       continue;) show
0 408 moveto (8020     }) show
0 396 moveto (8021     c = fmt[++i] & 0xff;) show
0 384 moveto (8022     if\(c == 0\)) show
0 372 moveto (8023       break;) show
0 360 moveto (8024     switch\(c\){) show
0 348 moveto (8025     case 'd':) show
0 336 moveto (8026       printint\(*argp++, 10, 1\);) show
0 324 moveto (8027       break;) show
0 312 moveto (8028     case 'x':) show
0 300 moveto (8029     case 'p':) show
0 288 moveto (8030       printint\(*argp++, 16, 0\);) show
0 276 moveto (8031       break;) show
0 264 moveto (8032     case 's':) show
0 252 moveto (8033       if\(\(s = \(char*\)*argp++\) == 0\)) show
0 240 moveto (8034         s = "\(null\)";) show
0 228 moveto (8035       for\(; *s; s++\)) show
0 216 moveto (8036         consputc\(*s\);) show
0 204 moveto (8037       break;) show
0 192 moveto (8038     case '%':) show
0 180 moveto (8039       consputc\('%'\);) show
0 168 moveto (8040       break;) show
0 156 moveto (8041     default:) show
0 144 moveto (8042       // Print unknown % sequence to draw attention.) show
0 132 moveto (8043       consputc\('%'\);) show
0 120 moveto (8044       consputc\(c\);) show
0 108 moveto (8045       break;) show
0 96 moveto (8046     }) show
0 84 moveto (8047   }) show
0 72 moveto (8048 ) show
0 60 moveto (8049 ) show
0 24 moveto (Sheet 80) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/console.c  Page 4) show
0 648 moveto (8050   if\(locking\)) show
0 636 moveto (8051     release\(&cons.lock\);) show
0 624 moveto (8052 }) show
0 612 moveto (8053 ) show
0 600 moveto (8054 void) show
0 588 moveto (8055 panic\(char *s\)) show
0 576 moveto (8056 {) show
0 564 moveto (8057   int i;) show
0 552 moveto (8058   uint pcs[10];) show
0 540 moveto (8059 ) show
0 528 moveto (8060   cli\(\);) show
0 516 moveto (8061   cons.locking = 0;) show
0 504 moveto (8062   // use lapiccpunum so that we can call panic from mycpu\(\)) show
0 492 moveto (8063   cprintf\("lapicid %d: panic: ", lapicid\(\)\);) show
0 480 moveto (8064   cprintf\(s\);) show
0 468 moveto (8065   cprintf\("\\n"\);) show
0 456 moveto (8066   getcallerpcs\(&s, pcs\);) show
0 444 moveto (8067   for\(i=0; i<10; i++\)) show
0 432 moveto (8068     cprintf\(" %p", pcs[i]\);) show
0 420 moveto (8069   panicked = 1; // freeze other CPU) show
0 408 moveto (8070   for\(;;\)) show
0 396 moveto (8071     ;) show
0 384 moveto (8072 }) show
0 372 moveto (8073 ) show
0 360 moveto (8074 ) show
0 348 moveto (8075 ) show
0 336 moveto (8076 ) show
0 324 moveto (8077 ) show
0 312 moveto (8078 ) show
0 300 moveto (8079 ) show
0 288 moveto (8080 ) show
0 276 moveto (8081 ) show
0 264 moveto (8082 ) show
0 252 moveto (8083 ) show
0 240 moveto (8084 ) show
0 228 moveto (8085 ) show
0 216 moveto (8086 ) show
0 204 moveto (8087 ) show
0 192 moveto (8088 ) show
0 180 moveto (8089 ) show
0 168 moveto (8090 ) show
0 156 moveto (8091 ) show
0 144 moveto (8092 ) show
0 132 moveto (8093 ) show
0 120 moveto (8094 ) show
0 108 moveto (8095 ) show
0 96 moveto (8096 ) show
0 84 moveto (8097 ) show
0 72 moveto (8098 ) show
0 60 moveto (8099 ) show
0 24 moveto (Sheet 80) show
grestore
restore
showpage
%%Page: 90 90
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/console.c  Page 5) show
0 648 moveto (8100 #define BACKSPACE 0x100) show
0 636 moveto (8101 #define CRTPORT 0x3d4) show
0 624 moveto (8102 static ushort *crt = \(ushort*\)P2V\(0xb8000\);  // CGA memory) show
0 612 moveto (8103 ) show
0 600 moveto (8104 static void) show
0 588 moveto (8105 cgaputc\(int c\)) show
0 576 moveto (8106 {) show
0 564 moveto (8107   int pos;) show
0 552 moveto (8108 ) show
0 540 moveto (8109   // Cursor position: col + 80*row.) show
0 528 moveto (8110   outb\(CRTPORT, 14\);) show
0 516 moveto (8111   pos = inb\(CRTPORT+1\) << 8;) show
0 504 moveto (8112   outb\(CRTPORT, 15\);) show
0 492 moveto (8113   pos |= inb\(CRTPORT+1\);) show
0 480 moveto (8114 ) show
0 468 moveto (8115   if\(c == '\\n'\)) show
0 456 moveto (8116     pos += 80 - pos%80;) show
0 444 moveto (8117   else if\(c == BACKSPACE\){) show
0 432 moveto (8118     if\(pos > 0\) --pos;) show
0 420 moveto (8119   } else) show
0 408 moveto (8120     crt[pos++] = \(c&0xff\) | 0x0700;  // black on white) show
0 396 moveto (8121 ) show
0 384 moveto (8122   if\(pos < 0 || pos > 25*80\)) show
0 372 moveto (8123     panic\("pos under/overflow"\);) show
0 360 moveto (8124 ) show
0 348 moveto (8125   if\(\(pos/80\) >= 24\){  // Scroll up.) show
0 336 moveto (8126     memmove\(crt, crt+80, sizeof\(crt[0]\)*23*80\);) show
0 324 moveto (8127     pos -= 80;) show
0 312 moveto (8128     memset\(crt+pos, 0, sizeof\(crt[0]\)*\(24*80 - pos\)\);) show
0 300 moveto (8129   }) show
0 288 moveto (8130 ) show
0 276 moveto (8131   outb\(CRTPORT, 14\);) show
0 264 moveto (8132   outb\(CRTPORT+1, pos>>8\);) show
0 252 moveto (8133   outb\(CRTPORT, 15\);) show
0 240 moveto (8134   outb\(CRTPORT+1, pos\);) show
0 228 moveto (8135   crt[pos] = ' ' | 0x0700;) show
0 216 moveto (8136 }) show
0 204 moveto (8137 ) show
0 192 moveto (8138 ) show
0 180 moveto (8139 ) show
0 168 moveto (8140 ) show
0 156 moveto (8141 ) show
0 144 moveto (8142 ) show
0 132 moveto (8143 ) show
0 120 moveto (8144 ) show
0 108 moveto (8145 ) show
0 96 moveto (8146 ) show
0 84 moveto (8147 ) show
0 72 moveto (8148 ) show
0 60 moveto (8149 ) show
0 24 moveto (Sheet 81) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/console.c  Page 6) show
0 648 moveto (8150 void) show
0 636 moveto (8151 consputc\(int c\)) show
0 624 moveto (8152 {) show
0 612 moveto (8153   if\(panicked\){) show
0 600 moveto (8154     cli\(\);) show
0 588 moveto (8155     for\(;;\)) show
0 576 moveto (8156       ;) show
0 564 moveto (8157   }) show
0 552 moveto (8158 ) show
0 540 moveto (8159   if\(c == BACKSPACE\){) show
0 528 moveto (8160     uartputc\('\\b'\); uartputc\(' '\); uartputc\('\\b'\);) show
0 516 moveto (8161   } else) show
0 504 moveto (8162     uartputc\(c\);) show
0 492 moveto (8163   cgaputc\(c\);) show
0 480 moveto (8164 }) show
0 468 moveto (8165 ) show
0 456 moveto (8166 #define INPUT_BUF 128) show
0 444 moveto (8167 struct {) show
0 432 moveto (8168   char buf[INPUT_BUF];) show
0 420 moveto (8169   uint r;  // Read index) show
0 408 moveto (8170   uint w;  // Write index) show
0 396 moveto (8171   uint e;  // Edit index) show
0 384 moveto (8172 } input;) show
0 372 moveto (8173 ) show
0 360 moveto (8174 #define C\(x\)  \(\(x\)-'@'\)  // Control-x) show
0 348 moveto (8175 ) show
0 336 moveto (8176 void) show
0 324 moveto (8177 consoleintr\(int \(*getc\)\(void\)\)) show
0 312 moveto (8178 {) show
0 300 moveto (8179   int c, doprocdump = 0;) show
0 288 moveto (8180 ) show
0 276 moveto (8181   acquire\(&cons.lock\);) show
0 264 moveto (8182   while\(\(c = getc\(\)\) >= 0\){) show
0 252 moveto (8183     switch\(c\){) show
0 240 moveto (8184     case C\('P'\):  // Process listing.) show
0 228 moveto (8185       // procdump\(\) locks cons.lock indirectly; invoke later) show
0 216 moveto (8186       doprocdump = 1;) show
0 204 moveto (8187       break;) show
0 192 moveto (8188     case C\('U'\):  // Kill line.) show
0 180 moveto (8189       while\(input.e != input.w &&) show
0 168 moveto (8190             input.buf[\(input.e-1\) % INPUT_BUF] != '\\n'\){) show
0 156 moveto (8191         input.e--;) show
0 144 moveto (8192         consputc\(BACKSPACE\);) show
0 132 moveto (8193       }) show
0 120 moveto (8194       break;) show
0 108 moveto (8195     case C\('H'\): case '\\x7f':  // Backspace) show
0 96 moveto (8196       if\(input.e != input.w\){) show
0 84 moveto (8197         input.e--;) show
0 72 moveto (8198         consputc\(BACKSPACE\);) show
0 60 moveto (8199       }) show
0 24 moveto (Sheet 81) show
grestore
restore
showpage
%%Page: 91 91
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/console.c  Page 7) show
0 648 moveto (8200       break;) show
0 636 moveto (8201     default:) show
0 624 moveto (8202       if\(c != 0 && input.e-input.r < INPUT_BUF\){) show
0 612 moveto (8203         c = \(c == '\\r'\) ? '\\n' : c;) show
0 600 moveto (8204         input.buf[input.e++ % INPUT_BUF] = c;) show
0 588 moveto (8205         consputc\(c\);) show
0 576 moveto (8206         if\(c == '\\n' || c == C\('D'\) || input.e == input.r+INPUT_BUF\){) show
0 564 moveto (8207           input.w = input.e;) show
0 552 moveto (8208           wakeup\(&input.r\);) show
0 540 moveto (8209         }) show
0 528 moveto (8210       }) show
0 516 moveto (8211       break;) show
0 504 moveto (8212     }) show
0 492 moveto (8213   }) show
0 480 moveto (8214   release\(&cons.lock\);) show
0 468 moveto (8215   if\(doprocdump\) {) show
0 456 moveto (8216     procdump\(\);  // now call procdump\(\) wo. cons.lock held) show
0 444 moveto (8217   }) show
0 432 moveto (8218 }) show
0 420 moveto (8219 ) show
0 408 moveto (8220 int) show
0 396 moveto (8221 consoleread\(struct inode *ip, char *dst, int n\)) show
0 384 moveto (8222 {) show
0 372 moveto (8223   uint target;) show
0 360 moveto (8224   int c;) show
0 348 moveto (8225 ) show
0 336 moveto (8226   iunlock\(ip\);) show
0 324 moveto (8227   target = n;) show
0 312 moveto (8228   acquire\(&cons.lock\);) show
0 300 moveto (8229   while\(n > 0\){) show
0 288 moveto (8230     while\(input.r == input.w\){) show
0 276 moveto (8231       if\(myproc\(\)->killed\){) show
0 264 moveto (8232         release\(&cons.lock\);) show
0 252 moveto (8233         ilock\(ip\);) show
0 240 moveto (8234         return -1;) show
0 228 moveto (8235       }) show
0 216 moveto (8236       sleep\(&input.r, &cons.lock\);) show
0 204 moveto (8237     }) show
0 192 moveto (8238     c = input.buf[input.r++ % INPUT_BUF];) show
0 180 moveto (8239     if\(c == C\('D'\)\){  // EOF) show
0 168 moveto (8240       if\(n < target\){) show
0 156 moveto (8241         // Save ^D for next time, to make sure) show
0 144 moveto (8242         // caller gets a 0-byte result.) show
0 132 moveto (8243         input.r--;) show
0 120 moveto (8244       }) show
0 108 moveto (8245       break;) show
0 96 moveto (8246     }) show
0 84 moveto (8247     *dst++ = c;) show
0 72 moveto (8248     --n;) show
0 60 moveto (8249     if\(c == '\\n'\)) show
0 24 moveto (Sheet 82) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/console.c  Page 8) show
0 648 moveto (8250       break;) show
0 636 moveto (8251   }) show
0 624 moveto (8252   release\(&cons.lock\);) show
0 612 moveto (8253   ilock\(ip\);) show
0 600 moveto (8254 ) show
0 588 moveto (8255   return target - n;) show
0 576 moveto (8256 }) show
0 564 moveto (8257 ) show
0 552 moveto (8258 int) show
0 540 moveto (8259 consolewrite\(struct inode *ip, char *buf, int n\)) show
0 528 moveto (8260 {) show
0 516 moveto (8261   int i;) show
0 504 moveto (8262 ) show
0 492 moveto (8263   iunlock\(ip\);) show
0 480 moveto (8264   acquire\(&cons.lock\);) show
0 468 moveto (8265   for\(i = 0; i < n; i++\)) show
0 456 moveto (8266     consputc\(buf[i] & 0xff\);) show
0 444 moveto (8267   release\(&cons.lock\);) show
0 432 moveto (8268   ilock\(ip\);) show
0 420 moveto (8269 ) show
0 408 moveto (8270   return n;) show
0 396 moveto (8271 }) show
0 384 moveto (8272 ) show
0 372 moveto (8273 void) show
0 360 moveto (8274 consoleinit\(void\)) show
0 348 moveto (8275 {) show
0 336 moveto (8276   initlock\(&cons.lock, "console"\);) show
0 324 moveto (8277 ) show
0 312 moveto (8278   devsw[CONSOLE].write = consolewrite;) show
0 300 moveto (8279   devsw[CONSOLE].read = consoleread;) show
0 288 moveto (8280   cons.locking = 1;) show
0 276 moveto (8281 ) show
0 264 moveto (8282   ioapicenable\(IRQ_KBD, 0\);) show
0 252 moveto (8283 }) show
0 240 moveto (8284 ) show
0 228 moveto (8285 ) show
0 216 moveto (8286 ) show
0 204 moveto (8287 ) show
0 192 moveto (8288 ) show
0 180 moveto (8289 ) show
0 168 moveto (8290 ) show
0 156 moveto (8291 ) show
0 144 moveto (8292 ) show
0 132 moveto (8293 ) show
0 120 moveto (8294 ) show
0 108 moveto (8295 ) show
0 96 moveto (8296 ) show
0 84 moveto (8297 ) show
0 72 moveto (8298 ) show
0 60 moveto (8299 ) show
0 24 moveto (Sheet 82) show
grestore
restore
showpage
%%Page: 92 92
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/uart.c  Page 1) show
0 648 moveto (8300 // Intel 8250 serial port \(UART\).) show
0 636 moveto (8301 ) show
0 624 moveto (8302 #include "types.h") show
0 612 moveto (8303 #include "defs.h") show
0 600 moveto (8304 #include "param.h") show
0 588 moveto (8305 #include "traps.h") show
0 576 moveto (8306 #include "spinlock.h") show
0 564 moveto (8307 #include "sleeplock.h") show
0 552 moveto (8308 #include "fs.h") show
0 540 moveto (8309 #include "file.h") show
0 528 moveto (8310 #include "mmu.h") show
0 516 moveto (8311 #include "proc.h") show
0 504 moveto (8312 #include "x86.h") show
0 492 moveto (8313 ) show
0 480 moveto (8314 #define COM1    0x3f8) show
0 468 moveto (8315 ) show
0 456 moveto (8316 static int uart;    // is there a uart?) show
0 444 moveto (8317 ) show
0 432 moveto (8318 void) show
0 420 moveto (8319 uartinit\(void\)) show
0 408 moveto (8320 {) show
0 396 moveto (8321   char *p;) show
0 384 moveto (8322 ) show
0 372 moveto (8323   // Turn off the FIFO) show
0 360 moveto (8324   outb\(COM1+2, 0\);) show
0 348 moveto (8325 ) show
0 336 moveto (8326   // 9600 baud, 8 data bits, 1 stop bit, parity off.) show
0 324 moveto (8327   outb\(COM1+3, 0x80\);    // Unlock divisor) show
0 312 moveto (8328   outb\(COM1+0, 115200/9600\);) show
0 300 moveto (8329   outb\(COM1+1, 0\);) show
0 288 moveto (8330   outb\(COM1+3, 0x03\);    // Lock divisor, 8 data bits.) show
0 276 moveto (8331   outb\(COM1+4, 0\);) show
0 264 moveto (8332   outb\(COM1+1, 0x01\);    // Enable receive interrupts.) show
0 252 moveto (8333 ) show
0 240 moveto (8334   // If status is 0xFF, no serial port.) show
0 228 moveto (8335   if\(inb\(COM1+5\) == 0xFF\)) show
0 216 moveto (8336     return;) show
0 204 moveto (8337   uart = 1;) show
0 192 moveto (8338 ) show
0 180 moveto (8339   // Acknowledge pre-existing interrupt conditions;) show
0 168 moveto (8340   // enable interrupts.) show
0 156 moveto (8341   inb\(COM1+2\);) show
0 144 moveto (8342   inb\(COM1+0\);) show
0 132 moveto (8343   ioapicenable\(IRQ_COM1, 0\);) show
0 120 moveto (8344 ) show
0 108 moveto (8345   // Announce that we're here.) show
0 96 moveto (8346   for\(p="xv6...\\n"; *p; p++\)) show
0 84 moveto (8347     uartputc\(*p\);) show
0 72 moveto (8348 }) show
0 60 moveto (8349 ) show
0 24 moveto (Sheet 83) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/uart.c  Page 2) show
0 648 moveto (8350 void) show
0 636 moveto (8351 uartputc\(int c\)) show
0 624 moveto (8352 {) show
0 612 moveto (8353   int i;) show
0 600 moveto (8354 ) show
0 588 moveto (8355   if\(!uart\)) show
0 576 moveto (8356     return;) show
0 564 moveto (8357   for\(i = 0; i < 128 && !\(inb\(COM1+5\) & 0x20\); i++\)) show
0 552 moveto (8358     microdelay\(10\);) show
0 540 moveto (8359   outb\(COM1+0, c\);) show
0 528 moveto (8360 }) show
0 516 moveto (8361 ) show
0 504 moveto (8362 static int) show
0 492 moveto (8363 uartgetc\(void\)) show
0 480 moveto (8364 {) show
0 468 moveto (8365   if\(!uart\)) show
0 456 moveto (8366     return -1;) show
0 444 moveto (8367   if\(!\(inb\(COM1+5\) & 0x01\)\)) show
0 432 moveto (8368     return -1;) show
0 420 moveto (8369   return inb\(COM1+0\);) show
0 408 moveto (8370 }) show
0 396 moveto (8371 ) show
0 384 moveto (8372 void) show
0 372 moveto (8373 uartintr\(void\)) show
0 360 moveto (8374 {) show
0 348 moveto (8375   consoleintr\(uartgetc\);) show
0 336 moveto (8376 }) show
0 324 moveto (8377 ) show
0 312 moveto (8378 ) show
0 300 moveto (8379 ) show
0 288 moveto (8380 ) show
0 276 moveto (8381 ) show
0 264 moveto (8382 ) show
0 252 moveto (8383 ) show
0 240 moveto (8384 ) show
0 228 moveto (8385 ) show
0 216 moveto (8386 ) show
0 204 moveto (8387 ) show
0 192 moveto (8388 ) show
0 180 moveto (8389 ) show
0 168 moveto (8390 ) show
0 156 moveto (8391 ) show
0 144 moveto (8392 ) show
0 132 moveto (8393 ) show
0 120 moveto (8394 ) show
0 108 moveto (8395 ) show
0 96 moveto (8396 ) show
0 84 moveto (8397 ) show
0 72 moveto (8398 ) show
0 60 moveto (8399 ) show
0 24 moveto (Sheet 83) show
grestore
restore
showpage
%%Page: 93 93
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/initcode.S  Page 1) show
0 648 moveto (8400 # Initial process execs /init.) show
0 636 moveto (8401 # This code runs in user space.) show
0 624 moveto (8402 ) show
0 612 moveto (8403 #include "syscall.h") show
0 600 moveto (8404 #include "traps.h") show
0 588 moveto (8405 ) show
0 576 moveto (8406 ) show
0 564 moveto (8407 # exec\(init, argv\)) show
0 552 moveto (8408 .globl start) show
0 540 moveto (8409 start:) show
0 528 moveto (8410   pushl $argv) show
0 516 moveto (8411   pushl $init) show
0 504 moveto (8412   pushl $0  // where caller pc would be) show
0 492 moveto (8413   movl $SYS_exec, %eax) show
0 480 moveto (8414   int $T_SYSCALL) show
0 468 moveto (8415 ) show
0 456 moveto (8416 # for\(;;\) exit\(\);) show
0 444 moveto (8417 exit:) show
0 432 moveto (8418   movl $SYS_exit, %eax) show
0 420 moveto (8419   int $T_SYSCALL) show
0 408 moveto (8420   jmp exit) show
0 396 moveto (8421 ) show
0 384 moveto (8422 # char init[] = "/init\\0";) show
0 372 moveto (8423 init:) show
0 360 moveto (8424   .string "/init\\0") show
0 348 moveto (8425 ) show
0 336 moveto (8426 # char *argv[] = { init, 0 };) show
0 324 moveto (8427 .p2align 2) show
0 312 moveto (8428 argv:) show
0 300 moveto (8429   .long init) show
0 288 moveto (8430   .long 0) show
0 276 moveto (8431 ) show
0 264 moveto (8432 ) show
0 252 moveto (8433 ) show
0 240 moveto (8434 ) show
0 228 moveto (8435 ) show
0 216 moveto (8436 ) show
0 204 moveto (8437 ) show
0 192 moveto (8438 ) show
0 180 moveto (8439 ) show
0 168 moveto (8440 ) show
0 156 moveto (8441 ) show
0 144 moveto (8442 ) show
0 132 moveto (8443 ) show
0 120 moveto (8444 ) show
0 108 moveto (8445 ) show
0 96 moveto (8446 ) show
0 84 moveto (8447 ) show
0 72 moveto (8448 ) show
0 60 moveto (8449 ) show
0 24 moveto (Sheet 84) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/usys.S  Page 1) show
0 648 moveto (8450 #include "syscall.h") show
0 636 moveto (8451 #include "traps.h") show
0 624 moveto (8452 ) show
0 612 moveto (8453 #define SYSCALL\(name\) \\) show
0 600 moveto (8454   .globl name; \\) show
0 588 moveto (8455   name: \\) show
0 576 moveto (8456     movl $SYS_ ## name, %eax; \\) show
0 564 moveto (8457     int $T_SYSCALL; \\) show
0 552 moveto (8458     ret) show
0 540 moveto (8459 ) show
0 528 moveto (8460 SYSCALL\(fork\)) show
0 516 moveto (8461 SYSCALL\(exit\)) show
0 504 moveto (8462 SYSCALL\(wait\)) show
0 492 moveto (8463 SYSCALL\(pipe\)) show
0 480 moveto (8464 SYSCALL\(read\)) show
0 468 moveto (8465 SYSCALL\(write\)) show
0 456 moveto (8466 SYSCALL\(close\)) show
0 444 moveto (8467 SYSCALL\(kill\)) show
0 432 moveto (8468 SYSCALL\(exec\)) show
0 420 moveto (8469 SYSCALL\(open\)) show
0 408 moveto (8470 SYSCALL\(mknod\)) show
0 396 moveto (8471 SYSCALL\(unlink\)) show
0 384 moveto (8472 SYSCALL\(fstat\)) show
0 372 moveto (8473 SYSCALL\(link\)) show
0 360 moveto (8474 SYSCALL\(mkdir\)) show
0 348 moveto (8475 SYSCALL\(chdir\)) show
0 336 moveto (8476 SYSCALL\(dup\)) show
0 324 moveto (8477 SYSCALL\(getpid\)) show
0 312 moveto (8478 SYSCALL\(sbrk\)) show
0 300 moveto (8479 SYSCALL\(sleep\)) show
0 288 moveto (8480 SYSCALL\(uptime\)) show
0 276 moveto (8481 ) show
0 264 moveto (8482 ) show
0 252 moveto (8483 ) show
0 240 moveto (8484 ) show
0 228 moveto (8485 ) show
0 216 moveto (8486 ) show
0 204 moveto (8487 ) show
0 192 moveto (8488 ) show
0 180 moveto (8489 ) show
0 168 moveto (8490 ) show
0 156 moveto (8491 ) show
0 144 moveto (8492 ) show
0 132 moveto (8493 ) show
0 120 moveto (8494 ) show
0 108 moveto (8495 ) show
0 96 moveto (8496 ) show
0 84 moveto (8497 ) show
0 72 moveto (8498 ) show
0 60 moveto (8499 ) show
0 24 moveto (Sheet 84) show
grestore
restore
showpage
%%Page: 94 94
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/init.c  Page 1) show
0 648 moveto (8500 // init: The initial user-level program) show
0 636 moveto (8501 ) show
0 624 moveto (8502 #include "types.h") show
0 612 moveto (8503 #include "stat.h") show
0 600 moveto (8504 #include "user.h") show
0 588 moveto (8505 #include "fcntl.h") show
0 576 moveto (8506 ) show
0 564 moveto (8507 char *argv[] = { "sh", 0 };) show
0 552 moveto (8508 ) show
0 540 moveto (8509 int) show
0 528 moveto (8510 main\(void\)) show
0 516 moveto (8511 {) show
0 504 moveto (8512   int pid, wpid;) show
0 492 moveto (8513 ) show
0 480 moveto (8514   if\(open\("console", O_RDWR\) < 0\){) show
0 468 moveto (8515     mknod\("console", 1, 1\);) show
0 456 moveto (8516     open\("console", O_RDWR\);) show
0 444 moveto (8517   }) show
0 432 moveto (8518   dup\(0\);  // stdout) show
0 420 moveto (8519   dup\(0\);  // stderr) show
0 408 moveto (8520 ) show
0 396 moveto (8521   for\(;;\){) show
0 384 moveto (8522     printf\(1, "init: starting sh\\n"\);) show
0 372 moveto (8523     pid = fork\(\);) show
0 360 moveto (8524     if\(pid < 0\){) show
0 348 moveto (8525       printf\(1, "init: fork failed\\n"\);) show
0 336 moveto (8526       exit\(\);) show
0 324 moveto (8527     }) show
0 312 moveto (8528     if\(pid == 0\){) show
0 300 moveto (8529       exec\("sh", argv\);) show
0 288 moveto (8530       printf\(1, "init: exec sh failed\\n"\);) show
0 276 moveto (8531       exit\(\);) show
0 264 moveto (8532     }) show
0 252 moveto (8533     while\(\(wpid=wait\(\)\) >= 0 && wpid != pid\)) show
0 240 moveto (8534       printf\(1, "zombie!\\n"\);) show
0 228 moveto (8535   }) show
0 216 moveto (8536 }) show
0 204 moveto (8537 ) show
0 192 moveto (8538 ) show
0 180 moveto (8539 ) show
0 168 moveto (8540 ) show
0 156 moveto (8541 ) show
0 144 moveto (8542 ) show
0 132 moveto (8543 ) show
0 120 moveto (8544 ) show
0 108 moveto (8545 ) show
0 96 moveto (8546 ) show
0 84 moveto (8547 ) show
0 72 moveto (8548 ) show
0 60 moveto (8549 ) show
0 24 moveto (Sheet 85) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 1) show
0 648 moveto (8550 // Shell.) show
0 636 moveto (8551 ) show
0 624 moveto (8552 #include "types.h") show
0 612 moveto (8553 #include "user.h") show
0 600 moveto (8554 #include "fcntl.h") show
0 588 moveto (8555 ) show
0 576 moveto (8556 // Parsed command representation) show
0 564 moveto (8557 #define EXEC  1) show
0 552 moveto (8558 #define REDIR 2) show
0 540 moveto (8559 #define PIPE  3) show
0 528 moveto (8560 #define LIST  4) show
0 516 moveto (8561 #define BACK  5) show
0 504 moveto (8562 ) show
0 492 moveto (8563 #define MAXARGS 10) show
0 480 moveto (8564 ) show
0 468 moveto (8565 struct cmd {) show
0 456 moveto (8566   int type;) show
0 444 moveto (8567 };) show
0 432 moveto (8568 ) show
0 420 moveto (8569 struct execcmd {) show
0 408 moveto (8570   int type;) show
0 396 moveto (8571   char *argv[MAXARGS];) show
0 384 moveto (8572   char *eargv[MAXARGS];) show
0 372 moveto (8573 };) show
0 360 moveto (8574 ) show
0 348 moveto (8575 struct redircmd {) show
0 336 moveto (8576   int type;) show
0 324 moveto (8577   struct cmd *cmd;) show
0 312 moveto (8578   char *file;) show
0 300 moveto (8579   char *efile;) show
0 288 moveto (8580   int mode;) show
0 276 moveto (8581   int fd;) show
0 264 moveto (8582 };) show
0 252 moveto (8583 ) show
0 240 moveto (8584 struct pipecmd {) show
0 228 moveto (8585   int type;) show
0 216 moveto (8586   struct cmd *left;) show
0 204 moveto (8587   struct cmd *right;) show
0 192 moveto (8588 };) show
0 180 moveto (8589 ) show
0 168 moveto (8590 struct listcmd {) show
0 156 moveto (8591   int type;) show
0 144 moveto (8592   struct cmd *left;) show
0 132 moveto (8593   struct cmd *right;) show
0 120 moveto (8594 };) show
0 108 moveto (8595 ) show
0 96 moveto (8596 struct backcmd {) show
0 84 moveto (8597   int type;) show
0 72 moveto (8598   struct cmd *cmd;) show
0 60 moveto (8599 };) show
0 24 moveto (Sheet 85) show
grestore
restore
showpage
%%Page: 95 95
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 2) show
0 648 moveto (8600 int fork1\(void\);  // Fork but panics on failure.) show
0 636 moveto (8601 void panic\(char*\);) show
0 624 moveto (8602 struct cmd *parsecmd\(char*\);) show
0 612 moveto (8603 ) show
0 600 moveto (8604 // Execute cmd.  Never returns.) show
0 588 moveto (8605 void) show
0 576 moveto (8606 runcmd\(struct cmd *cmd\)) show
0 564 moveto (8607 {) show
0 552 moveto (8608   int p[2];) show
0 540 moveto (8609   struct backcmd *bcmd;) show
0 528 moveto (8610   struct execcmd *ecmd;) show
0 516 moveto (8611   struct listcmd *lcmd;) show
0 504 moveto (8612   struct pipecmd *pcmd;) show
0 492 moveto (8613   struct redircmd *rcmd;) show
0 480 moveto (8614 ) show
0 468 moveto (8615   if\(cmd == 0\)) show
0 456 moveto (8616     exit\(\);) show
0 444 moveto (8617 ) show
0 432 moveto (8618   switch\(cmd->type\){) show
0 420 moveto (8619   default:) show
0 408 moveto (8620     panic\("runcmd"\);) show
0 396 moveto (8621 ) show
0 384 moveto (8622   case EXEC:) show
0 372 moveto (8623     ecmd = \(struct execcmd*\)cmd;) show
0 360 moveto (8624     if\(ecmd->argv[0] == 0\)) show
0 348 moveto (8625       exit\(\);) show
0 336 moveto (8626     exec\(ecmd->argv[0], ecmd->argv\);) show
0 324 moveto (8627     printf\(2, "exec %s failed\\n", ecmd->argv[0]\);) show
0 312 moveto (8628     break;) show
0 300 moveto (8629 ) show
0 288 moveto (8630   case REDIR:) show
0 276 moveto (8631     rcmd = \(struct redircmd*\)cmd;) show
0 264 moveto (8632     close\(rcmd->fd\);) show
0 252 moveto (8633     if\(open\(rcmd->file, rcmd->mode\) < 0\){) show
0 240 moveto (8634       printf\(2, "open %s failed\\n", rcmd->file\);) show
0 228 moveto (8635       exit\(\);) show
0 216 moveto (8636     }) show
0 204 moveto (8637     runcmd\(rcmd->cmd\);) show
0 192 moveto (8638     break;) show
0 180 moveto (8639 ) show
0 168 moveto (8640   case LIST:) show
0 156 moveto (8641     lcmd = \(struct listcmd*\)cmd;) show
0 144 moveto (8642     if\(fork1\(\) == 0\)) show
0 132 moveto (8643       runcmd\(lcmd->left\);) show
0 120 moveto (8644     wait\(\);) show
0 108 moveto (8645     runcmd\(lcmd->right\);) show
0 96 moveto (8646     break;) show
0 84 moveto (8647 ) show
0 72 moveto (8648 ) show
0 60 moveto (8649 ) show
0 24 moveto (Sheet 86) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 3) show
0 648 moveto (8650   case PIPE:) show
0 636 moveto (8651     pcmd = \(struct pipecmd*\)cmd;) show
0 624 moveto (8652     if\(pipe\(p\) < 0\)) show
0 612 moveto (8653       panic\("pipe"\);) show
0 600 moveto (8654     if\(fork1\(\) == 0\){) show
0 588 moveto (8655       close\(1\);) show
0 576 moveto (8656       dup\(p[1]\);) show
0 564 moveto (8657       close\(p[0]\);) show
0 552 moveto (8658       close\(p[1]\);) show
0 540 moveto (8659       runcmd\(pcmd->left\);) show
0 528 moveto (8660     }) show
0 516 moveto (8661     if\(fork1\(\) == 0\){) show
0 504 moveto (8662       close\(0\);) show
0 492 moveto (8663       dup\(p[0]\);) show
0 480 moveto (8664       close\(p[0]\);) show
0 468 moveto (8665       close\(p[1]\);) show
0 456 moveto (8666       runcmd\(pcmd->right\);) show
0 444 moveto (8667     }) show
0 432 moveto (8668     close\(p[0]\);) show
0 420 moveto (8669     close\(p[1]\);) show
0 408 moveto (8670     wait\(\);) show
0 396 moveto (8671     wait\(\);) show
0 384 moveto (8672     break;) show
0 372 moveto (8673 ) show
0 360 moveto (8674   case BACK:) show
0 348 moveto (8675     bcmd = \(struct backcmd*\)cmd;) show
0 336 moveto (8676     if\(fork1\(\) == 0\)) show
0 324 moveto (8677       runcmd\(bcmd->cmd\);) show
0 312 moveto (8678     break;) show
0 300 moveto (8679   }) show
0 288 moveto (8680   exit\(\);) show
0 276 moveto (8681 }) show
0 264 moveto (8682 ) show
0 252 moveto (8683 int) show
0 240 moveto (8684 getcmd\(char *buf, int nbuf\)) show
0 228 moveto (8685 {) show
0 216 moveto (8686   printf\(2, "$ "\);) show
0 204 moveto (8687   memset\(buf, 0, nbuf\);) show
0 192 moveto (8688   gets\(buf, nbuf\);) show
0 180 moveto (8689   if\(buf[0] == 0\) // EOF) show
0 168 moveto (8690     return -1;) show
0 156 moveto (8691   return 0;) show
0 144 moveto (8692 }) show
0 132 moveto (8693 ) show
0 120 moveto (8694 ) show
0 108 moveto (8695 ) show
0 96 moveto (8696 ) show
0 84 moveto (8697 ) show
0 72 moveto (8698 ) show
0 60 moveto (8699 ) show
0 24 moveto (Sheet 86) show
grestore
restore
showpage
%%Page: 96 96
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 4) show
0 648 moveto (8700 int) show
0 636 moveto (8701 main\(void\)) show
0 624 moveto (8702 {) show
0 612 moveto (8703   static char buf[100];) show
0 600 moveto (8704   int fd;) show
0 588 moveto (8705 ) show
0 576 moveto (8706   // Ensure that three file descriptors are open.) show
0 564 moveto (8707   while\(\(fd = open\("console", O_RDWR\)\) >= 0\){) show
0 552 moveto (8708     if\(fd >= 3\){) show
0 540 moveto (8709       close\(fd\);) show
0 528 moveto (8710       break;) show
0 516 moveto (8711     }) show
0 504 moveto (8712   }) show
0 492 moveto (8713 ) show
0 480 moveto (8714   // Read and run input commands.) show
0 468 moveto (8715   while\(getcmd\(buf, sizeof\(buf\)\) >= 0\){) show
0 456 moveto (8716     if\(buf[0] == 'c' && buf[1] == 'd' && buf[2] == ' '\){) show
0 444 moveto (8717       // Chdir must be called by the parent, not the child.) show
0 432 moveto (8718       buf[strlen\(buf\)-1] = 0;  // chop \\n) show
0 420 moveto (8719       if\(chdir\(buf+3\) < 0\)) show
0 408 moveto (8720         printf\(2, "cannot cd %s\\n", buf+3\);) show
0 396 moveto (8721       continue;) show
0 384 moveto (8722     }) show
0 372 moveto (8723     if\(fork1\(\) == 0\)) show
0 360 moveto (8724       runcmd\(parsecmd\(buf\)\);) show
0 348 moveto (8725     wait\(\);) show
0 336 moveto (8726   }) show
0 324 moveto (8727   exit\(\);) show
0 312 moveto (8728 }) show
0 300 moveto (8729 ) show
0 288 moveto (8730 void) show
0 276 moveto (8731 panic\(char *s\)) show
0 264 moveto (8732 {) show
0 252 moveto (8733   printf\(2, "%s\\n", s\);) show
0 240 moveto (8734   exit\(\);) show
0 228 moveto (8735 }) show
0 216 moveto (8736 ) show
0 204 moveto (8737 int) show
0 192 moveto (8738 fork1\(void\)) show
0 180 moveto (8739 {) show
0 168 moveto (8740   int pid;) show
0 156 moveto (8741 ) show
0 144 moveto (8742   pid = fork\(\);) show
0 132 moveto (8743   if\(pid == -1\)) show
0 120 moveto (8744     panic\("fork"\);) show
0 108 moveto (8745   return pid;) show
0 96 moveto (8746 }) show
0 84 moveto (8747 ) show
0 72 moveto (8748 ) show
0 60 moveto (8749 ) show
0 24 moveto (Sheet 87) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 5) show
0 648 moveto (8750 // Constructors) show
0 636 moveto (8751 ) show
0 624 moveto (8752 struct cmd*) show
0 612 moveto (8753 execcmd\(void\)) show
0 600 moveto (8754 {) show
0 588 moveto (8755   struct execcmd *cmd;) show
0 576 moveto (8756 ) show
0 564 moveto (8757   cmd = malloc\(sizeof\(*cmd\)\);) show
0 552 moveto (8758   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 540 moveto (8759   cmd->type = EXEC;) show
0 528 moveto (8760   return \(struct cmd*\)cmd;) show
0 516 moveto (8761 }) show
0 504 moveto (8762 ) show
0 492 moveto (8763 struct cmd*) show
0 480 moveto (8764 redircmd\(struct cmd *subcmd, char *file, char *efile, int mode, int fd\)) show
0 468 moveto (8765 {) show
0 456 moveto (8766   struct redircmd *cmd;) show
0 444 moveto (8767 ) show
0 432 moveto (8768   cmd = malloc\(sizeof\(*cmd\)\);) show
0 420 moveto (8769   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 408 moveto (8770   cmd->type = REDIR;) show
0 396 moveto (8771   cmd->cmd = subcmd;) show
0 384 moveto (8772   cmd->file = file;) show
0 372 moveto (8773   cmd->efile = efile;) show
0 360 moveto (8774   cmd->mode = mode;) show
0 348 moveto (8775   cmd->fd = fd;) show
0 336 moveto (8776   return \(struct cmd*\)cmd;) show
0 324 moveto (8777 }) show
0 312 moveto (8778 ) show
0 300 moveto (8779 struct cmd*) show
0 288 moveto (8780 pipecmd\(struct cmd *left, struct cmd *right\)) show
0 276 moveto (8781 {) show
0 264 moveto (8782   struct pipecmd *cmd;) show
0 252 moveto (8783 ) show
0 240 moveto (8784   cmd = malloc\(sizeof\(*cmd\)\);) show
0 228 moveto (8785   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 216 moveto (8786   cmd->type = PIPE;) show
0 204 moveto (8787   cmd->left = left;) show
0 192 moveto (8788   cmd->right = right;) show
0 180 moveto (8789   return \(struct cmd*\)cmd;) show
0 168 moveto (8790 }) show
0 156 moveto (8791 ) show
0 144 moveto (8792 ) show
0 132 moveto (8793 ) show
0 120 moveto (8794 ) show
0 108 moveto (8795 ) show
0 96 moveto (8796 ) show
0 84 moveto (8797 ) show
0 72 moveto (8798 ) show
0 60 moveto (8799 ) show
0 24 moveto (Sheet 87) show
grestore
restore
showpage
%%Page: 97 97
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 6) show
0 648 moveto (8800 struct cmd*) show
0 636 moveto (8801 listcmd\(struct cmd *left, struct cmd *right\)) show
0 624 moveto (8802 {) show
0 612 moveto (8803   struct listcmd *cmd;) show
0 600 moveto (8804 ) show
0 588 moveto (8805   cmd = malloc\(sizeof\(*cmd\)\);) show
0 576 moveto (8806   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 564 moveto (8807   cmd->type = LIST;) show
0 552 moveto (8808   cmd->left = left;) show
0 540 moveto (8809   cmd->right = right;) show
0 528 moveto (8810   return \(struct cmd*\)cmd;) show
0 516 moveto (8811 }) show
0 504 moveto (8812 ) show
0 492 moveto (8813 struct cmd*) show
0 480 moveto (8814 backcmd\(struct cmd *subcmd\)) show
0 468 moveto (8815 {) show
0 456 moveto (8816   struct backcmd *cmd;) show
0 444 moveto (8817 ) show
0 432 moveto (8818   cmd = malloc\(sizeof\(*cmd\)\);) show
0 420 moveto (8819   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 408 moveto (8820   cmd->type = BACK;) show
0 396 moveto (8821   cmd->cmd = subcmd;) show
0 384 moveto (8822   return \(struct cmd*\)cmd;) show
0 372 moveto (8823 }) show
0 360 moveto (8824 ) show
0 348 moveto (8825 ) show
0 336 moveto (8826 ) show
0 324 moveto (8827 ) show
0 312 moveto (8828 ) show
0 300 moveto (8829 ) show
0 288 moveto (8830 ) show
0 276 moveto (8831 ) show
0 264 moveto (8832 ) show
0 252 moveto (8833 ) show
0 240 moveto (8834 ) show
0 228 moveto (8835 ) show
0 216 moveto (8836 ) show
0 204 moveto (8837 ) show
0 192 moveto (8838 ) show
0 180 moveto (8839 ) show
0 168 moveto (8840 ) show
0 156 moveto (8841 ) show
0 144 moveto (8842 ) show
0 132 moveto (8843 ) show
0 120 moveto (8844 ) show
0 108 moveto (8845 ) show
0 96 moveto (8846 ) show
0 84 moveto (8847 ) show
0 72 moveto (8848 ) show
0 60 moveto (8849 ) show
0 24 moveto (Sheet 88) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 7) show
0 648 moveto (8850 // Parsing) show
0 636 moveto (8851 ) show
0 624 moveto (8852 char whitespace[] = " \\t\\r\\n\\v";) show
0 612 moveto (8853 char symbols[] = "<|>&;\(\)";) show
0 600 moveto (8854 ) show
0 588 moveto (8855 int) show
0 576 moveto (8856 gettoken\(char **ps, char *es, char **q, char **eq\)) show
0 564 moveto (8857 {) show
0 552 moveto (8858   char *s;) show
0 540 moveto (8859   int ret;) show
0 528 moveto (8860 ) show
0 516 moveto (8861   s = *ps;) show
0 504 moveto (8862   while\(s < es && strchr\(whitespace, *s\)\)) show
0 492 moveto (8863     s++;) show
0 480 moveto (8864   if\(q\)) show
0 468 moveto (8865     *q = s;) show
0 456 moveto (8866   ret = *s;) show
0 444 moveto (8867   switch\(*s\){) show
0 432 moveto (8868   case 0:) show
0 420 moveto (8869     break;) show
0 408 moveto (8870   case '|':) show
0 396 moveto (8871   case '\(':) show
0 384 moveto (8872   case '\)':) show
0 372 moveto (8873   case ';':) show
0 360 moveto (8874   case '&':) show
0 348 moveto (8875   case '<':) show
0 336 moveto (8876     s++;) show
0 324 moveto (8877     break;) show
0 312 moveto (8878   case '>':) show
0 300 moveto (8879     s++;) show
0 288 moveto (8880     if\(*s == '>'\){) show
0 276 moveto (8881       ret = '+';) show
0 264 moveto (8882       s++;) show
0 252 moveto (8883     }) show
0 240 moveto (8884     break;) show
0 228 moveto (8885   default:) show
0 216 moveto (8886     ret = 'a';) show
0 204 moveto (8887     while\(s < es && !strchr\(whitespace, *s\) && !strchr\(symbols, *s\)\)) show
0 192 moveto (8888       s++;) show
0 180 moveto (8889     break;) show
0 168 moveto (8890   }) show
0 156 moveto (8891   if\(eq\)) show
0 144 moveto (8892     *eq = s;) show
0 132 moveto (8893 ) show
0 120 moveto (8894   while\(s < es && strchr\(whitespace, *s\)\)) show
0 108 moveto (8895     s++;) show
0 96 moveto (8896   *ps = s;) show
0 84 moveto (8897   return ret;) show
0 72 moveto (8898 }) show
0 60 moveto (8899 ) show
0 24 moveto (Sheet 88) show
grestore
restore
showpage
%%Page: 98 98
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 8) show
0 648 moveto (8900 int) show
0 636 moveto (8901 peek\(char **ps, char *es, char *toks\)) show
0 624 moveto (8902 {) show
0 612 moveto (8903   char *s;) show
0 600 moveto (8904 ) show
0 588 moveto (8905   s = *ps;) show
0 576 moveto (8906   while\(s < es && strchr\(whitespace, *s\)\)) show
0 564 moveto (8907     s++;) show
0 552 moveto (8908   *ps = s;) show
0 540 moveto (8909   return *s && strchr\(toks, *s\);) show
0 528 moveto (8910 }) show
0 516 moveto (8911 ) show
0 504 moveto (8912 struct cmd *parseline\(char**, char*\);) show
0 492 moveto (8913 struct cmd *parsepipe\(char**, char*\);) show
0 480 moveto (8914 struct cmd *parseexec\(char**, char*\);) show
0 468 moveto (8915 struct cmd *nulterminate\(struct cmd*\);) show
0 456 moveto (8916 ) show
0 444 moveto (8917 struct cmd*) show
0 432 moveto (8918 parsecmd\(char *s\)) show
0 420 moveto (8919 {) show
0 408 moveto (8920   char *es;) show
0 396 moveto (8921   struct cmd *cmd;) show
0 384 moveto (8922 ) show
0 372 moveto (8923   es = s + strlen\(s\);) show
0 360 moveto (8924   cmd = parseline\(&s, es\);) show
0 348 moveto (8925   peek\(&s, es, ""\);) show
0 336 moveto (8926   if\(s != es\){) show
0 324 moveto (8927     printf\(2, "leftovers: %s\\n", s\);) show
0 312 moveto (8928     panic\("syntax"\);) show
0 300 moveto (8929   }) show
0 288 moveto (8930   nulterminate\(cmd\);) show
0 276 moveto (8931   return cmd;) show
0 264 moveto (8932 }) show
0 252 moveto (8933 ) show
0 240 moveto (8934 struct cmd*) show
0 228 moveto (8935 parseline\(char **ps, char *es\)) show
0 216 moveto (8936 {) show
0 204 moveto (8937   struct cmd *cmd;) show
0 192 moveto (8938 ) show
0 180 moveto (8939   cmd = parsepipe\(ps, es\);) show
0 168 moveto (8940   while\(peek\(ps, es, "&"\)\){) show
0 156 moveto (8941     gettoken\(ps, es, 0, 0\);) show
0 144 moveto (8942     cmd = backcmd\(cmd\);) show
0 132 moveto (8943   }) show
0 120 moveto (8944   if\(peek\(ps, es, ";"\)\){) show
0 108 moveto (8945     gettoken\(ps, es, 0, 0\);) show
0 96 moveto (8946     cmd = listcmd\(cmd, parseline\(ps, es\)\);) show
0 84 moveto (8947   }) show
0 72 moveto (8948   return cmd;) show
0 60 moveto (8949 }) show
0 24 moveto (Sheet 89) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 9) show
0 648 moveto (8950 struct cmd*) show
0 636 moveto (8951 parsepipe\(char **ps, char *es\)) show
0 624 moveto (8952 {) show
0 612 moveto (8953   struct cmd *cmd;) show
0 600 moveto (8954 ) show
0 588 moveto (8955   cmd = parseexec\(ps, es\);) show
0 576 moveto (8956   if\(peek\(ps, es, "|"\)\){) show
0 564 moveto (8957     gettoken\(ps, es, 0, 0\);) show
0 552 moveto (8958     cmd = pipecmd\(cmd, parsepipe\(ps, es\)\);) show
0 540 moveto (8959   }) show
0 528 moveto (8960   return cmd;) show
0 516 moveto (8961 }) show
0 504 moveto (8962 ) show
0 492 moveto (8963 struct cmd*) show
0 480 moveto (8964 parseredirs\(struct cmd *cmd, char **ps, char *es\)) show
0 468 moveto (8965 {) show
0 456 moveto (8966   int tok;) show
0 444 moveto (8967   char *q, *eq;) show
0 432 moveto (8968 ) show
0 420 moveto (8969   while\(peek\(ps, es, "<>"\)\){) show
0 408 moveto (8970     tok = gettoken\(ps, es, 0, 0\);) show
0 396 moveto (8971     if\(gettoken\(ps, es, &q, &eq\) != 'a'\)) show
0 384 moveto (8972       panic\("missing file for redirection"\);) show
0 372 moveto (8973     switch\(tok\){) show
0 360 moveto (8974     case '<':) show
0 348 moveto (8975       cmd = redircmd\(cmd, q, eq, O_RDONLY, 0\);) show
0 336 moveto (8976       break;) show
0 324 moveto (8977     case '>':) show
0 312 moveto (8978       cmd = redircmd\(cmd, q, eq, O_WRONLY|O_CREATE, 1\);) show
0 300 moveto (8979       break;) show
0 288 moveto (8980     case '+':  // >>) show
0 276 moveto (8981       cmd = redircmd\(cmd, q, eq, O_WRONLY|O_CREATE, 1\);) show
0 264 moveto (8982       break;) show
0 252 moveto (8983     }) show
0 240 moveto (8984   }) show
0 228 moveto (8985   return cmd;) show
0 216 moveto (8986 }) show
0 204 moveto (8987 ) show
0 192 moveto (8988 ) show
0 180 moveto (8989 ) show
0 168 moveto (8990 ) show
0 156 moveto (8991 ) show
0 144 moveto (8992 ) show
0 132 moveto (8993 ) show
0 120 moveto (8994 ) show
0 108 moveto (8995 ) show
0 96 moveto (8996 ) show
0 84 moveto (8997 ) show
0 72 moveto (8998 ) show
0 60 moveto (8999 ) show
0 24 moveto (Sheet 89) show
grestore
restore
showpage
%%Page: 99 99
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 10) show
0 648 moveto (9000 struct cmd*) show
0 636 moveto (9001 parseblock\(char **ps, char *es\)) show
0 624 moveto (9002 {) show
0 612 moveto (9003   struct cmd *cmd;) show
0 600 moveto (9004 ) show
0 588 moveto (9005   if\(!peek\(ps, es, "\("\)\)) show
0 576 moveto (9006     panic\("parseblock"\);) show
0 564 moveto (9007   gettoken\(ps, es, 0, 0\);) show
0 552 moveto (9008   cmd = parseline\(ps, es\);) show
0 540 moveto (9009   if\(!peek\(ps, es, "\)"\)\)) show
0 528 moveto (9010     panic\("syntax - missing \)"\);) show
0 516 moveto (9011   gettoken\(ps, es, 0, 0\);) show
0 504 moveto (9012   cmd = parseredirs\(cmd, ps, es\);) show
0 492 moveto (9013   return cmd;) show
0 480 moveto (9014 }) show
0 468 moveto (9015 ) show
0 456 moveto (9016 struct cmd*) show
0 444 moveto (9017 parseexec\(char **ps, char *es\)) show
0 432 moveto (9018 {) show
0 420 moveto (9019   char *q, *eq;) show
0 408 moveto (9020   int tok, argc;) show
0 396 moveto (9021   struct execcmd *cmd;) show
0 384 moveto (9022   struct cmd *ret;) show
0 372 moveto (9023 ) show
0 360 moveto (9024   if\(peek\(ps, es, "\("\)\)) show
0 348 moveto (9025     return parseblock\(ps, es\);) show
0 336 moveto (9026 ) show
0 324 moveto (9027   ret = execcmd\(\);) show
0 312 moveto (9028   cmd = \(struct execcmd*\)ret;) show
0 300 moveto (9029 ) show
0 288 moveto (9030   argc = 0;) show
0 276 moveto (9031   ret = parseredirs\(ret, ps, es\);) show
0 264 moveto (9032   while\(!peek\(ps, es, "|\)&;"\)\){) show
0 252 moveto (9033     if\(\(tok=gettoken\(ps, es, &q, &eq\)\) == 0\)) show
0 240 moveto (9034       break;) show
0 228 moveto (9035     if\(tok != 'a'\)) show
0 216 moveto (9036       panic\("syntax"\);) show
0 204 moveto (9037     cmd->argv[argc] = q;) show
0 192 moveto (9038     cmd->eargv[argc] = eq;) show
0 180 moveto (9039     argc++;) show
0 168 moveto (9040     if\(argc >= MAXARGS\)) show
0 156 moveto (9041       panic\("too many args"\);) show
0 144 moveto (9042     ret = parseredirs\(ret, ps, es\);) show
0 132 moveto (9043   }) show
0 120 moveto (9044   cmd->argv[argc] = 0;) show
0 108 moveto (9045   cmd->eargv[argc] = 0;) show
0 96 moveto (9046   return ret;) show
0 84 moveto (9047 }) show
0 72 moveto (9048 ) show
0 60 moveto (9049 ) show
0 24 moveto (Sheet 90) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/sh.c  Page 11) show
0 648 moveto (9050 // NUL-terminate all the counted strings.) show
0 636 moveto (9051 struct cmd*) show
0 624 moveto (9052 nulterminate\(struct cmd *cmd\)) show
0 612 moveto (9053 {) show
0 600 moveto (9054   int i;) show
0 588 moveto (9055   struct backcmd *bcmd;) show
0 576 moveto (9056   struct execcmd *ecmd;) show
0 564 moveto (9057   struct listcmd *lcmd;) show
0 552 moveto (9058   struct pipecmd *pcmd;) show
0 540 moveto (9059   struct redircmd *rcmd;) show
0 528 moveto (9060 ) show
0 516 moveto (9061   if\(cmd == 0\)) show
0 504 moveto (9062     return 0;) show
0 492 moveto (9063 ) show
0 480 moveto (9064   switch\(cmd->type\){) show
0 468 moveto (9065   case EXEC:) show
0 456 moveto (9066     ecmd = \(struct execcmd*\)cmd;) show
0 444 moveto (9067     for\(i=0; ecmd->argv[i]; i++\)) show
0 432 moveto (9068       *ecmd->eargv[i] = 0;) show
0 420 moveto (9069     break;) show
0 408 moveto (9070 ) show
0 396 moveto (9071   case REDIR:) show
0 384 moveto (9072     rcmd = \(struct redircmd*\)cmd;) show
0 372 moveto (9073     nulterminate\(rcmd->cmd\);) show
0 360 moveto (9074     *rcmd->efile = 0;) show
0 348 moveto (9075     break;) show
0 336 moveto (9076 ) show
0 324 moveto (9077   case PIPE:) show
0 312 moveto (9078     pcmd = \(struct pipecmd*\)cmd;) show
0 300 moveto (9079     nulterminate\(pcmd->left\);) show
0 288 moveto (9080     nulterminate\(pcmd->right\);) show
0 276 moveto (9081     break;) show
0 264 moveto (9082 ) show
0 252 moveto (9083   case LIST:) show
0 240 moveto (9084     lcmd = \(struct listcmd*\)cmd;) show
0 228 moveto (9085     nulterminate\(lcmd->left\);) show
0 216 moveto (9086     nulterminate\(lcmd->right\);) show
0 204 moveto (9087     break;) show
0 192 moveto (9088 ) show
0 180 moveto (9089   case BACK:) show
0 168 moveto (9090     bcmd = \(struct backcmd*\)cmd;) show
0 156 moveto (9091     nulterminate\(bcmd->cmd\);) show
0 144 moveto (9092     break;) show
0 132 moveto (9093   }) show
0 120 moveto (9094   return cmd;) show
0 108 moveto (9095 }) show
0 96 moveto (9096 ) show
0 84 moveto (9097 ) show
0 72 moveto (9098 ) show
0 60 moveto (9099 ) show
0 24 moveto (Sheet 90) show
grestore
restore
showpage
%%Page: 100 100
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/bootasm.S  Page 1) show
0 648 moveto (9100 #include "asm.h") show
0 636 moveto (9101 #include "memlayout.h") show
0 624 moveto (9102 #include "mmu.h") show
0 612 moveto (9103 ) show
0 600 moveto (9104 # Start the first CPU: switch to 32-bit protected mode, jump into C.) show
0 588 moveto (9105 # The BIOS loads this code from the first sector of the hard disk into) show
0 576 moveto (9106 # memory at physical address 0x7c00 and starts executing in real mode) show
0 564 moveto (9107 # with %cs=0 %ip=7c00.) show
0 552 moveto (9108 ) show
0 540 moveto (9109 .code16                       # Assemble for 16-bit mode) show
0 528 moveto (9110 .globl start) show
0 516 moveto (9111 start:) show
0 504 moveto (9112   cli                         # BIOS enabled interrupts; disable) show
0 492 moveto (9113 ) show
0 480 moveto (9114   # Zero data segment registers DS, ES, and SS.) show
0 468 moveto (9115   xorw    %ax,%ax             # Set %ax to zero) show
0 456 moveto (9116   movw    %ax,%ds             # -> Data Segment) show
0 444 moveto (9117   movw    %ax,%es             # -> Extra Segment) show
0 432 moveto (9118   movw    %ax,%ss             # -> Stack Segment) show
0 420 moveto (9119 ) show
0 408 moveto (9120   # Physical address line A20 is tied to zero so that the first PCs) show
0 396 moveto (9121   # with 2 MB would run software that assumed 1 MB.  Undo that.) show
0 384 moveto (9122 seta20.1:) show
0 372 moveto (9123   inb     $0x64,%al               # Wait for not busy) show
0 360 moveto (9124   testb   $0x2,%al) show
0 348 moveto (9125   jnz     seta20.1) show
0 336 moveto (9126 ) show
0 324 moveto (9127   movb    $0xd1,%al               # 0xd1 -> port 0x64) show
0 312 moveto (9128   outb    %al,$0x64) show
0 300 moveto (9129 ) show
0 288 moveto (9130 seta20.2:) show
0 276 moveto (9131   inb     $0x64,%al               # Wait for not busy) show
0 264 moveto (9132   testb   $0x2,%al) show
0 252 moveto (9133   jnz     seta20.2) show
0 240 moveto (9134 ) show
0 228 moveto (9135   movb    $0xdf,%al               # 0xdf -> port 0x60) show
0 216 moveto (9136   outb    %al,$0x60) show
0 204 moveto (9137 ) show
0 192 moveto (9138   # Switch from real to protected mode.  Use a bootstrap GDT that makes) show
0 180 moveto (9139   # virtual addresses map directly to physical addresses so that the) show
0 168 moveto (9140   # effective memory map doesn't change during the transition.) show
0 156 moveto (9141   lgdt    gdtdesc) show
0 144 moveto (9142   movl    %cr0, %eax) show
0 132 moveto (9143   orl     $CR0_PE, %eax) show
0 120 moveto (9144   movl    %eax, %cr0) show
0 108 moveto (9145 ) show
0 96 moveto (9146 ) show
0 84 moveto (9147 ) show
0 72 moveto (9148 ) show
0 60 moveto (9149 ) show
0 24 moveto (Sheet 91) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/bootasm.S  Page 2) show
0 648 moveto (9150   # Complete the transition to 32-bit protected mode by using a long jmp) show
0 636 moveto (9151   # to reload %cs and %eip.  The segment descriptors are set up with no) show
0 624 moveto (9152   # translation, so that the mapping is still the identity mapping.) show
0 612 moveto (9153   ljmp    $\(SEG_KCODE<<3\), $start32) show
0 600 moveto (9154 ) show
0 588 moveto (9155 .code32  # Tell assembler to generate 32-bit code now.) show
0 576 moveto (9156 start32:) show
0 564 moveto (9157   # Set up the protected-mode data segment registers) show
0 552 moveto (9158   movw    $\(SEG_KDATA<<3\), %ax    # Our data segment selector) show
0 540 moveto (9159   movw    %ax, %ds                # -> DS: Data Segment) show
0 528 moveto (9160   movw    %ax, %es                # -> ES: Extra Segment) show
0 516 moveto (9161   movw    %ax, %ss                # -> SS: Stack Segment) show
0 504 moveto (9162   movw    $0, %ax                 # Zero segments not ready for use) show
0 492 moveto (9163   movw    %ax, %fs                # -> FS) show
0 480 moveto (9164   movw    %ax, %gs                # -> GS) show
0 468 moveto (9165 ) show
0 456 moveto (9166   # Set up the stack pointer and call into C.) show
0 444 moveto (9167   movl    $start, %esp) show
0 432 moveto (9168   call    bootmain) show
0 420 moveto (9169 ) show
0 408 moveto (9170   # If bootmain returns \(it shouldn't\), trigger a Bochs) show
0 396 moveto (9171   # breakpoint if running under Bochs, then loop.) show
0 384 moveto (9172   movw    $0x8a00, %ax            # 0x8a00 -> port 0x8a00) show
0 372 moveto (9173   movw    %ax, %dx) show
0 360 moveto (9174   outw    %ax, %dx) show
0 348 moveto (9175   movw    $0x8ae0, %ax            # 0x8ae0 -> port 0x8a00) show
0 336 moveto (9176   outw    %ax, %dx) show
0 324 moveto (9177 spin:) show
0 312 moveto (9178   jmp     spin) show
0 300 moveto (9179 ) show
0 288 moveto (9180 # Bootstrap GDT) show
0 276 moveto (9181 .p2align 2                                # force 4 byte alignment) show
0 264 moveto (9182 gdt:) show
0 252 moveto (9183   SEG_NULLASM                             # null seg) show
0 240 moveto (9184   SEG_ASM\(STA_X|STA_R, 0x0, 0xffffffff\)   # code seg) show
0 228 moveto (9185   SEG_ASM\(STA_W, 0x0, 0xffffffff\)         # data seg) show
0 216 moveto (9186 ) show
0 204 moveto (9187 gdtdesc:) show
0 192 moveto (9188   .word   \(gdtdesc - gdt - 1\)             # sizeof\(gdt\) - 1) show
0 180 moveto (9189   .long   gdt                             # address gdt) show
0 168 moveto (9190 ) show
0 156 moveto (9191 ) show
0 144 moveto (9192 ) show
0 132 moveto (9193 ) show
0 120 moveto (9194 ) show
0 108 moveto (9195 ) show
0 96 moveto (9196 ) show
0 84 moveto (9197 ) show
0 72 moveto (9198 ) show
0 60 moveto (9199 ) show
0 24 moveto (Sheet 91) show
grestore
restore
showpage
%%Page: 101 101
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/bootmain.c  Page 1) show
0 648 moveto (9200 // Boot loader.) show
0 636 moveto (9201 //) show
0 624 moveto (9202 // Part of the boot block, along with bootasm.S, which calls bootmain\(\).) show
0 612 moveto (9203 // bootasm.S has put the processor into protected 32-bit mode.) show
0 600 moveto (9204 // bootmain\(\) loads an ELF kernel image from the disk starting at) show
0 588 moveto (9205 // sector 1 and then jumps to the kernel entry routine.) show
0 576 moveto (9206 ) show
0 564 moveto (9207 #include "types.h") show
0 552 moveto (9208 #include "elf.h") show
0 540 moveto (9209 #include "x86.h") show
0 528 moveto (9210 #include "memlayout.h") show
0 516 moveto (9211 ) show
0 504 moveto (9212 #define SECTSIZE  512) show
0 492 moveto (9213 ) show
0 480 moveto (9214 void readseg\(uchar*, uint, uint\);) show
0 468 moveto (9215 ) show
0 456 moveto (9216 void) show
0 444 moveto (9217 bootmain\(void\)) show
0 432 moveto (9218 {) show
0 420 moveto (9219   struct elfhdr *elf;) show
0 408 moveto (9220   struct proghdr *ph, *eph;) show
0 396 moveto (9221   void \(*entry\)\(void\);) show
0 384 moveto (9222   uchar* pa;) show
0 372 moveto (9223 ) show
0 360 moveto (9224   elf = \(struct elfhdr*\)0x10000;  // scratch space) show
0 348 moveto (9225 ) show
0 336 moveto (9226   // Read 1st page off disk) show
0 324 moveto (9227   readseg\(\(uchar*\)elf, 4096, 0\);) show
0 312 moveto (9228 ) show
0 300 moveto (9229   // Is this an ELF executable?) show
0 288 moveto (9230   if\(elf->magic != ELF_MAGIC\)) show
0 276 moveto (9231     return;  // let bootasm.S handle error) show
0 264 moveto (9232 ) show
0 252 moveto (9233   // Load each program segment \(ignores ph flags\).) show
0 240 moveto (9234   ph = \(struct proghdr*\)\(\(uchar*\)elf + elf->phoff\);) show
0 228 moveto (9235   eph = ph + elf->phnum;) show
0 216 moveto (9236   for\(; ph < eph; ph++\){) show
0 204 moveto (9237     pa = \(uchar*\)ph->paddr;) show
0 192 moveto (9238     readseg\(pa, ph->filesz, ph->off\);) show
0 180 moveto (9239     if\(ph->memsz > ph->filesz\)) show
0 168 moveto (9240       stosb\(pa + ph->filesz, 0, ph->memsz - ph->filesz\);) show
0 156 moveto (9241   }) show
0 144 moveto (9242 ) show
0 132 moveto (9243   // Call the entry point from the ELF header.) show
0 120 moveto (9244   // Does not return!) show
0 108 moveto (9245   entry = \(void\(*\)\(void\)\)\(elf->entry\);) show
0 96 moveto (9246   entry\(\);) show
0 84 moveto (9247 }) show
0 72 moveto (9248 ) show
0 60 moveto (9249 ) show
0 24 moveto (Sheet 92) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/bootmain.c  Page 2) show
0 648 moveto (9250 void) show
0 636 moveto (9251 waitdisk\(void\)) show
0 624 moveto (9252 {) show
0 612 moveto (9253   // Wait for disk ready.) show
0 600 moveto (9254   while\(\(inb\(0x1F7\) & 0xC0\) != 0x40\)) show
0 588 moveto (9255     ;) show
0 576 moveto (9256 }) show
0 564 moveto (9257 ) show
0 552 moveto (9258 // Read a single sector at offset into dst.) show
0 540 moveto (9259 void) show
0 528 moveto (9260 readsect\(void *dst, uint offset\)) show
0 516 moveto (9261 {) show
0 504 moveto (9262   // Issue command.) show
0 492 moveto (9263   waitdisk\(\);) show
0 480 moveto (9264   outb\(0x1F2, 1\);   // count = 1) show
0 468 moveto (9265   outb\(0x1F3, offset\);) show
0 456 moveto (9266   outb\(0x1F4, offset >> 8\);) show
0 444 moveto (9267   outb\(0x1F5, offset >> 16\);) show
0 432 moveto (9268   outb\(0x1F6, \(offset >> 24\) | 0xE0\);) show
0 420 moveto (9269   outb\(0x1F7, 0x20\);  // cmd 0x20 - read sectors) show
0 408 moveto (9270 ) show
0 396 moveto (9271   // Read data.) show
0 384 moveto (9272   waitdisk\(\);) show
0 372 moveto (9273   insl\(0x1F0, dst, SECTSIZE/4\);) show
0 360 moveto (9274 }) show
0 348 moveto (9275 ) show
0 336 moveto (9276 // Read 'count' bytes at 'offset' from kernel into physical address 'pa'.) show
0 324 moveto (9277 // Might copy more than asked.) show
0 312 moveto (9278 void) show
0 300 moveto (9279 readseg\(uchar* pa, uint count, uint offset\)) show
0 288 moveto (9280 {) show
0 276 moveto (9281   uchar* epa;) show
0 264 moveto (9282 ) show
0 252 moveto (9283   epa = pa + count;) show
0 240 moveto (9284 ) show
0 228 moveto (9285   // Round down to sector boundary.) show
0 216 moveto (9286   pa -= offset % SECTSIZE;) show
0 204 moveto (9287 ) show
0 192 moveto (9288   // Translate from bytes to sectors; kernel starts at sector 1.) show
0 180 moveto (9289   offset = \(offset / SECTSIZE\) + 1;) show
0 168 moveto (9290 ) show
0 156 moveto (9291   // If this is too slow, we could read lots of sectors at a time.) show
0 144 moveto (9292   // We'd write more to memory than asked, but it doesn't matter --) show
0 132 moveto (9293   // we load in increasing order.) show
0 120 moveto (9294   for\(; pa < epa; pa += SECTSIZE, offset++\)) show
0 108 moveto (9295     readsect\(pa, offset\);) show
0 96 moveto (9296 }) show
0 84 moveto (9297 ) show
0 72 moveto (9298 ) show
0 60 moveto (9299 ) show
0 24 moveto (Sheet 92) show
grestore
restore
showpage
%%Page: 102 102
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/kernel.ld  Page 1) show
0 648 moveto (9300 /* Simple linker script for the JOS kernel.) show
0 636 moveto (9301    See the GNU ld 'info' manual \("info ld"\) to learn the syntax. */) show
0 624 moveto (9302 ) show
0 612 moveto (9303 OUTPUT_FORMAT\("elf32-i386", "elf32-i386", "elf32-i386"\)) show
0 600 moveto (9304 OUTPUT_ARCH\(i386\)) show
0 588 moveto (9305 ENTRY\(_start\)) show
0 576 moveto (9306 ) show
0 564 moveto (9307 SECTIONS) show
0 552 moveto (9308 {) show
0 540 moveto (9309 ) show
8 mp_a_x mul 540 moveto (/* Link the kernel at this address: "." means the current address */) show
0 528 moveto (9310         /* Must be equal to KERNLINK */) show
0 516 moveto (9311 ) show
8 mp_a_x mul 516 moveto (. = 0x80100000;) show
0 504 moveto (9312 ) show
0 492 moveto (9313 ) show
8 mp_a_x mul 492 moveto (.text : AT\(0x100000\) {) show
0 480 moveto (9314 ) show
16 mp_a_x mul 480 moveto (*\(.text .stub .text.* .gnu.linkonce.t.*\)) show
0 468 moveto (9315 ) show
8 mp_a_x mul 468 moveto (}) show
0 456 moveto (9316 ) show
0 444 moveto (9317 ) show
8 mp_a_x mul 444 moveto (PROVIDE\(etext = .\);) show
32 mp_a_x mul 444 moveto (/* Define the 'etext' symbol to this value */) show
0 432 moveto (9318 ) show
0 420 moveto (9319 ) show
8 mp_a_x mul 420 moveto (.rodata : {) show
0 408 moveto (9320 ) show
16 mp_a_x mul 408 moveto (*\(.rodata .rodata.* .gnu.linkonce.r.*\)) show
0 396 moveto (9321 ) show
8 mp_a_x mul 396 moveto (}) show
0 384 moveto (9322 ) show
0 372 moveto (9323 ) show
8 mp_a_x mul 372 moveto (/* Include debugging information in kernel memory */) show
0 360 moveto (9324 ) show
8 mp_a_x mul 360 moveto (.stab : {) show
0 348 moveto (9325 ) show
16 mp_a_x mul 348 moveto (PROVIDE\(__STAB_BEGIN__ = .\);) show
0 336 moveto (9326 ) show
16 mp_a_x mul 336 moveto (*\(.stab\);) show
0 324 moveto (9327 ) show
16 mp_a_x mul 324 moveto (PROVIDE\(__STAB_END__ = .\);) show
0 312 moveto (9328 ) show
16 mp_a_x mul 312 moveto (BYTE\(0\)) show
32 mp_a_x mul 312 moveto (/* Force the linker to allocate space) show
0 300 moveto (9329 ) show
35 mp_a_x mul 300 moveto (for this section */) show
0 288 moveto (9330 ) show
8 mp_a_x mul 288 moveto (}) show
0 276 moveto (9331 ) show
0 264 moveto (9332 ) show
8 mp_a_x mul 264 moveto (.stabstr : {) show
0 252 moveto (9333 ) show
16 mp_a_x mul 252 moveto (PROVIDE\(__STABSTR_BEGIN__ = .\);) show
0 240 moveto (9334 ) show
16 mp_a_x mul 240 moveto (*\(.stabstr\);) show
0 228 moveto (9335 ) show
16 mp_a_x mul 228 moveto (PROVIDE\(__STABSTR_END__ = .\);) show
0 216 moveto (9336 ) show
16 mp_a_x mul 216 moveto (BYTE\(0\)) show
32 mp_a_x mul 216 moveto (/* Force the linker to allocate space) show
0 204 moveto (9337 ) show
35 mp_a_x mul 204 moveto (for this section */) show
0 192 moveto (9338 ) show
8 mp_a_x mul 192 moveto (}) show
0 180 moveto (9339 ) show
0 168 moveto (9340 ) show
8 mp_a_x mul 168 moveto (/* Adjust the address for the data segment to the next page */) show
0 156 moveto (9341 ) show
8 mp_a_x mul 156 moveto (. = ALIGN\(0x1000\);) show
0 144 moveto (9342 ) show
0 132 moveto (9343 ) show
8 mp_a_x mul 132 moveto (/* Conventionally, Unix linkers provide pseudo-symbols) show
0 120 moveto (9344 ) show
9 mp_a_x mul 120 moveto (* etext, edata, and end, at the end of the text, data, and bss.) show
0 108 moveto (9345 ) show
9 mp_a_x mul 108 moveto (* For the kernel mapping, we need the address at the beginning) show
0 96 moveto (9346 ) show
9 mp_a_x mul 96 moveto (* of the data section, but that's not one of the conventional) show
0 84 moveto (9347 ) show
9 mp_a_x mul 84 moveto (* symbols, because the convention started before there was a) show
0 72 moveto (9348 ) show
9 mp_a_x mul 72 moveto (* read-only rodata section between text and data. */) show
0 60 moveto (9349 ) show
8 mp_a_x mul 60 moveto (PROVIDE\(data = .\);) show
0 24 moveto (Sheet 93) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
0 684 moveto (Sep 13 14:32 2018  xv6/kernel.ld  Page 2) show
0 648 moveto (9350 ) show
8 mp_a_x mul 648 moveto (/* The data segment */) show
0 636 moveto (9351 ) show
8 mp_a_x mul 636 moveto (.data : {) show
0 624 moveto (9352 ) show
16 mp_a_x mul 624 moveto (*\(.data\)) show
0 612 moveto (9353 ) show
8 mp_a_x mul 612 moveto (}) show
0 600 moveto (9354 ) show
0 588 moveto (9355 ) show
8 mp_a_x mul 588 moveto (PROVIDE\(edata = .\);) show
0 576 moveto (9356 ) show
0 564 moveto (9357 ) show
8 mp_a_x mul 564 moveto (.bss : {) show
0 552 moveto (9358 ) show
16 mp_a_x mul 552 moveto (*\(.bss\)) show
0 540 moveto (9359 ) show
8 mp_a_x mul 540 moveto (}) show
0 528 moveto (9360 ) show
0 516 moveto (9361 ) show
8 mp_a_x mul 516 moveto (PROVIDE\(end = .\);) show
0 504 moveto (9362 ) show
0 492 moveto (9363 ) show
8 mp_a_x mul 492 moveto (/DISCARD/ : {) show
0 480 moveto (9364 ) show
16 mp_a_x mul 480 moveto (*\(.eh_frame .note.GNU-stack\)) show
0 468 moveto (9365 ) show
8 mp_a_x mul 468 moveto (}) show
0 456 moveto (9366 }) show
0 444 moveto (9367 ) show
0 432 moveto (9368 ) show
0 420 moveto (9369 ) show
0 408 moveto (9370 ) show
0 396 moveto (9371 ) show
0 384 moveto (9372 ) show
0 372 moveto (9373 ) show
0 360 moveto (9374 ) show
0 348 moveto (9375 ) show
0 336 moveto (9376 ) show
0 324 moveto (9377 ) show
0 312 moveto (9378 ) show
0 300 moveto (9379 ) show
0 288 moveto (9380 ) show
0 276 moveto (9381 ) show
0 264 moveto (9382 ) show
0 252 moveto (9383 ) show
0 240 moveto (9384 ) show
0 228 moveto (9385 ) show
0 216 moveto (9386 ) show
0 204 moveto (9387 ) show
0 192 moveto (9388 ) show
0 180 moveto (9389 ) show
0 168 moveto (9390 ) show
0 156 moveto (9391 ) show
0 144 moveto (9392 ) show
0 132 moveto (9393 ) show
0 120 moveto (9394 ) show
0 108 moveto (9395 ) show
0 96 moveto (9396 ) show
0 84 moveto (9397 ) show
0 72 moveto (9398 ) show
0 60 moveto (9399 ) show
0 24 moveto (Sheet 93) show
grestore
restore
showpage
%%Trailer
%%Pages: 103
